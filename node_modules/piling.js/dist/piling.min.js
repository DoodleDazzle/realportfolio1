!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","pixi.js"],t):t((e=e||self).pilingJs={},e.PIXI)}(this,(function(e,t){"use strict";function n(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}var r=function(e){return function(){var t=this,r=arguments;return new Promise((function(i,o){var a=e.apply(t,r);function s(e){n(a,i,o,s,u,"next",e)}function u(e){n(a,i,o,s,u,"throw",e)}s(void 0)}))}},i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function o(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function a(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var s=a((function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(e,t,n,r){var i=t&&t.prototype instanceof l?t:l,o=Object.create(i.prototype),a=new S(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return k()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===c)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=u(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===c)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(e,n,a),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var c={};function l(){}function f(){}function h(){}var p={};p[i]=function(){return this};var d=Object.getPrototypeOf,g=d&&d(d(E([])));g&&g!==t&&n.call(g,i)&&(p=g);var m=h.prototype=l.prototype=Object.create(p);function v(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function y(e,t){var r;this._invoke=function(i,o){function a(){return new t((function(r,a){!function r(i,o,a,s){var c=u(e[i],e,o);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==typeof f&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(f).then((function(e){l.value=e,a(l)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,c;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function E(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=m.constructor=h,h.constructor=f,h[a]=f.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,a in e||(e[a]="GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},v(y.prototype),y.prototype[o]=function(){return this},e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(s(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},v(m),m[a]="Generator",m[i]=function(){return this},m.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=E,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,c):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;x(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),c}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));var u=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r};var c=function(e){if(Array.isArray(e))return u(e)};var l=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)};var f=function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}};var h=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var p=function(e){return c(e)||l(e)||f(e)||h()};var d=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e};var g=function(e){if(Array.isArray(e))return e};var m=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}};var v=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var y=function(e,t){return g(e)||m(e,t)||f(e,t)||v()},b="undefined"!=typeof Float32Array?Float32Array:Array;function w(){var e=new b(16);return b!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function x(e){var t=new b(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function S(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],p=t[11],d=t[12],g=t[13],m=t[14],v=t[15],y=n*s-r*a,b=n*u-i*a,w=n*c-o*a,x=r*u-i*s,S=r*c-o*s,E=i*c-o*u,k=l*g-f*d,M=l*m-h*d,O=l*v-p*d,A=f*m-h*g,j=f*v-p*g,P=h*v-p*m,C=y*P-b*j+w*A+x*O-S*M+E*k;return C?(C=1/C,e[0]=(s*P-u*j+c*A)*C,e[1]=(i*j-r*P-o*A)*C,e[2]=(g*E-m*S+v*x)*C,e[3]=(h*S-f*E-p*x)*C,e[4]=(u*O-a*P-c*M)*C,e[5]=(n*P-i*O+o*M)*C,e[6]=(m*w-d*E-v*b)*C,e[7]=(l*E-h*w+p*b)*C,e[8]=(a*j-s*O+c*k)*C,e[9]=(r*O-n*j-o*k)*C,e[10]=(d*S-g*w+v*y)*C,e[11]=(f*w-l*S-p*y)*C,e[12]=(s*M-a*A-u*k)*C,e[13]=(n*A-r*M+i*k)*C,e[14]=(g*b-d*x-m*y)*C,e[15]=(l*x-f*b+h*y)*C,e):null}function E(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=t[9],p=t[10],d=t[11],g=t[12],m=t[13],v=t[14],y=t[15],b=n[0],w=n[1],x=n[2],S=n[3];return e[0]=b*r+w*s+x*f+S*g,e[1]=b*i+w*u+x*h+S*m,e[2]=b*o+w*c+x*p+S*v,e[3]=b*a+w*l+x*d+S*y,b=n[4],w=n[5],x=n[6],S=n[7],e[4]=b*r+w*s+x*f+S*g,e[5]=b*i+w*u+x*h+S*m,e[6]=b*o+w*c+x*p+S*v,e[7]=b*a+w*l+x*d+S*y,b=n[8],w=n[9],x=n[10],S=n[11],e[8]=b*r+w*s+x*f+S*g,e[9]=b*i+w*u+x*h+S*m,e[10]=b*o+w*c+x*p+S*v,e[11]=b*a+w*l+x*d+S*y,b=n[12],w=n[13],x=n[14],S=n[15],e[12]=b*r+w*s+x*f+S*g,e[13]=b*i+w*u+x*h+S*m,e[14]=b*o+w*c+x*p+S*v,e[15]=b*a+w*l+x*d+S*y,e}function k(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function M(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var O,A;O=new b(4),b!=Float32Array&&(O[0]=0,O[1]=0,O[2]=0,O[3]=0),A=O;!function(){var e=function(){var e=new b(2);return b!=Float32Array&&(e[0]=0,e[1]=0),e}()}();const j=(e=[0,0],t=1,n=0,r=[0,0],i=[0,1/0])=>{const o=new Float32Array(16),a=new Float32Array(16),s=new Float32Array(16);let u=w(),c=[...r.slice(0,2),0,1];const l=[...i],f=()=>function(e,t){var n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(o,a,s),e[2]=Math.hypot(u,c,l),e}(o,u)[0],h=([e=0,t=0]=[],n=1,r=0)=>{u=w(),p([-e,-t]),g(r),d(1/n)},p=([e=0,t=0]=[])=>{o[0]=e,o[1]=t,o[2]=0;const n=k(a,o);E(u,n,u)},d=(e,t)=>{if(e<=0)return;const n=f(),r=n*e;if(1===(e=Math.max(l[0],Math.min(r,l[1]))/n))return;o[0]=e,o[1]=e,o[2]=1;const i=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(a,o),h=t?[...t,0]:c,p=k(o,h);E(u,p,E(u,i,E(u,S(s,p),u)))},g=e=>{const t=w();!function(e,t,n){var r,i,o,a=n[0],s=n[1],u=n[2],c=Math.hypot(a,s,u);c<1e-6||(a*=c=1/c,s*=c,u*=c,r=Math.sin(t),o=1-(i=Math.cos(t)),e[0]=a*a*o+i,e[1]=s*a*o+u*r,e[2]=u*a*o-s*r,e[3]=0,e[4]=a*s*o-u*r,e[5]=s*s*o+i,e[6]=u*s*o+a*r,e[7]=0,e[8]=a*u*o+s*r,e[9]=s*u*o-a*r,e[10]=u*u*o+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1)}(t,e,[0,0,1]),E(u,t,u)},m=e=>{!e||e.length<16||(u=e)};return h(e,t,n),{get translation(){return function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}(o,u).slice(0,2)},get target(){return M(o,c,S(s,u)).slice(0,2)},get scaling(){return f()},get scaleBounds(){return[...l]},get distance(){return 1/f()},get rotation(){return Math.acos(u[0])},get view(){return u},get viewCenter(){return c.slice(0,2)},lookAt:h,translate:p,pan:p,rotate:g,scale:d,zoom:d,reset:()=>{h(e,t,n)},set:(...e)=>(console.warn("Deprecated. Please use `setView()` instead."),m(...e)),setScaleBounds:e=>{l[0]=e[0],l[1]=e[1]},setView:m,setViewCenter:e=>{c=[...e.slice(0,2),0,1]}}},P=(e,{distance:t=1,target:n=[0,0],rotation:r=0,isNdc:i=!0,isFixed:o=!1,isPan:a=!0,panSpeed:s=1,isRotate:u=!0,rotateSpeed:c=1,isZoom:l=!0,zoomSpeed:f=1,viewCenter:h=null,scaleBounds:p=null,onKeyDown:d=(()=>{}),onKeyUp:g=(()=>{}),onMouseDown:m=(()=>{}),onMouseUp:v=(()=>{}),onMouseMove:y=(()=>{}),onWheel:b=(()=>{})}={})=>{let w=j(n,t,r,h,p),x=!1,S=0,E=0,k=0,M=0,O=!1,A=0,P=0,C=0,_=1,I=1,R=1,T=!1;const L=i?e=>e/_*2*R:e=>e,B=i?e=>e/I*2:e=>-e,N=i?e=>(e/_*2-1)*R:e=>e,D=i?e=>1-e/I*2:e=>e,z=()=>{const t=e.getBoundingClientRect();P=t.top,C=t.left,_=t.width,I=t.height,R=_/I},F=e=>{T=!1,g(e)},V=e=>{T=e.altKey,d(e)},U=e=>{O=!1,v(e)},Y=e=>{O=1===e.buttons,m(e)},X=e=>{k=S,M=E,S=e.clientX-C,E=e.clientY-P,y(e)},q=e=>{e.preventDefault();const t=1===e.deltaMode?12:1;A+=t*(e.deltaY||0),b(e)};return window.addEventListener("keydown",V,{passive:!0}),window.addEventListener("keyup",F,{passive:!0}),e.addEventListener("mousedown",Y,{passive:!0}),window.addEventListener("mouseup",U,{passive:!0}),window.addEventListener("mousemove",X,{passive:!0}),e.addEventListener("wheel",q,{passive:!1}),z(),w.config=({isFixed:e=null,isPan:t=null,isRotate:n=null,isZoom:r=null,panSpeed:i=null,rotateSpeed:h=null,zoomSpeed:p=null}={})=>{o=null!==e?e:o,a=null!==t?t:a,u=null!==n?n:u,l=null!==r?r:l,s=+i>0?i:s,c=+h>0?h:c,f=+p>0?p:f},w.dispose=()=>{w=void 0,window.removeEventListener("keydown",V),window.removeEventListener("keyup",F),e.removeEventListener("mousedown",Y),window.removeEventListener("mouseup",U),window.removeEventListener("mousemove",X),e.removeEventListener("wheel",q)},w.refresh=z,w.tick=()=>{if(o)return!1;if(x=!1,a&&O&&!T&&(w.pan([L(s*(S-k)),B(s*(M-E))]),x=!0),l&&A){const e=f*Math.exp(A/I),t=N(S),n=D(E);w.scale(1/e,[t,n]),x=!0}if(u&&O&&T){const e=_/2,t=I/2,n=k-e,r=t-M,i=S-e,o=t-E,a=function(e,t){var n=e[0],r=e[1],i=t[0],o=t[1],a=n*n+r*r;a>0&&(a=1/Math.sqrt(a));var s=i*i+o*o;s>0&&(s=1/Math.sqrt(s));var u=(n*i+r*o)*a*s;return u>1?0:u<-1?Math.PI:Math.acos(u)}([n,r],[i,o]),s=n*o-i*r;w.rotate(c*a*Math.sign(s)),x=!0}return A=0,k=S,M=E,x},w},C=(()=>{try{return new window.BroadcastChannel("pub-sub-es")}catch(e){return{postMessage:()=>{}}}})(),_=e=>(t,n,r=1/0)=>(e[t]||(e[t]=[],e.__times__[t]=[]),e[t].push(n),e.__times__[t].push(+r||1/0),{event:t,handler:n}),I=e=>(t,n)=>{if("object"==typeof t&&(n=t.handler,t=t.event),!e[t])return;const r=e[t].indexOf(n);-1===r||r>=e[t].length||(e[t].splice(r,1),e.__times__[t].splice(r,1))},R=(e,t)=>(n,r,i)=>{if(!e[n])return;const o=I(e);if(e[n].forEach((t,i)=>{t(r),e.__times__[n][i]--,e.__times__[n][i]<1&&o(n,t)}),t&&!i)try{C.postMessage({event:n,news:r})}catch(e){if(!(e instanceof DOMException))throw e;console.warn(`Could not broadcast '${n}' globally. Payload is not clonable.`)}},T=e=>()=>{Object.keys(e).filter(e=>"_"!==e[0]).forEach(t=>{e[t]=void 0,e.__times__[t]=void 0,delete e[t],delete e.__times__[t]})},L=(e={__times__:{}})=>(e.__times__||(e.__times__={}),{publish:R(e),subscribe:_(e),unsubscribe:I(e),clear:T(e),stack:e}),B={__times__:{}},N={publish:R(B,!0),subscribe:_(B),unsubscribe:I(B),stack:B};C.onmessage=({data:{event:e,news:t}})=>N.publish(e,t,!0);const D=(e,t,n=window.requestAnimationFrame)=>{let r,i=!1;return(...o)=>{if(r=o,!i)return i=!0,n(()=>{const n=e(...r);i=!1,t&&t(n)})}};var z,F,V,U,Y,X,q,H,G,W,$,K,Z,Q,J,ee=a((function(e,t){e.exports=function(){function e(e,r,i,o,a){!function e(n,r,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=r-i+1,c=Math.log(s),l=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*l*(s-l)/s)*(u-s/2<0?-1:1);e(n,r,Math.max(i,Math.floor(r-u*l/s+f)),Math.min(o,Math.floor(r+(s-u)*l/s+f)),a)}var h=n[r],p=i,d=o;for(t(n,i,r),a(n[o],h)>0&&t(n,i,o);p<d;){for(t(n,p,d),p++,d--;a(n[p],h)<0;)p++;for(;a(n[d],h)>0;)d--}0===a(n[i],h)?t(n,i,d):t(n,++d,o),d<=r&&(i=d+1),r<=d&&(o=d-1)}}(e,r,i||0,o||e.length-1,a||n)}function t(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function n(e,t){return e<t?-1:e>t?1:0}var r=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(e,t,n){if(!n)return t.indexOf(e);for(var r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function o(e,t){a(e,0,e.children.length,t,e)}function a(e,t,n,r,i){i||(i=d(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o=t;o<n;o++){var a=e.children[o];s(i,e.leaf?r(a):a)}return i}function s(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function u(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function l(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function f(e){return e.maxX-e.minX+(e.maxY-e.minY)}function h(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function d(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(t,n,r,i,o){for(var a=[n,r];a.length;)if(!((r=a.pop())-(n=a.pop())<=i)){var s=n+Math.ceil((r-n)/i/2)*i;e(t,s,n,r,o),a.push(n,s,s,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(e){var t=this.data,n=[];if(!p(e,t))return n;for(var r=this.toBBox,i=[];t;){for(var o=0;o<t.children.length;o++){var a=t.children[o],s=t.leaf?r(a):a;p(e,s)&&(t.leaf?n.push(a):h(e,s)?this._all(a,n):i.push(a))}t=i.pop()}return n},r.prototype.collides=function(e){var t=this.data;if(!p(e,t))return!1;for(var n=[];t;){for(var r=0;r<t.children.length;r++){var i=t.children[r],o=t.leaf?this.toBBox(i):i;if(p(e,o)){if(t.leaf||h(e,o))return!0;n.push(i)}}t=n.pop()}return!1},r.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},r.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},r.prototype.clear=function(){return this.data=d([]),this},r.prototype.remove=function(e,t){if(!e)return this;for(var n,r,o,a=this.data,s=this.toBBox(e),u=[],c=[];a||u.length;){if(a||(a=u.pop(),r=u[u.length-1],n=c.pop(),o=!0),a.leaf){var l=i(e,a.children,t);if(-1!==l)return a.children.splice(l,1),u.push(a),this._condense(u),this}o||a.leaf||!h(a,s)?r?(n++,a=r.children[n],o=!1):a=null:(u.push(a),c.push(n),n=0,r=a,a=a.children[0])}return this},r.prototype.toBBox=function(e){return e},r.prototype.compareMinX=function(e,t){return e.minX-t.minX},r.prototype.compareMinY=function(e,t){return e.minY-t.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(e){return this.data=e,this},r.prototype._all=function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},r.prototype._build=function(e,t,n,r){var i,a=n-t+1,s=this._maxEntries;if(a<=s)return o(i=d(e.slice(t,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,r-1))),(i=d([])).leaf=!1,i.height=r;var u=Math.ceil(a/s),c=u*Math.ceil(Math.sqrt(s));g(e,t,n,c,this.compareMinX);for(var l=t;l<=n;l+=c){var f=Math.min(l+c-1,n);g(e,l,f,u,this.compareMinY);for(var h=l;h<=f;h+=u){var p=Math.min(h+u-1,f);i.children.push(this._build(e,h,p,r-1))}}return o(i,this.toBBox),i},r.prototype._chooseSubtree=function(e,t,n,r){for(;r.push(t),!t.leaf&&r.length-1!==n;){for(var i=1/0,o=1/0,a=void 0,s=0;s<t.children.length;s++){var u=t.children[s],c=l(u),f=(h=e,p=u,(Math.max(p.maxX,h.maxX)-Math.min(p.minX,h.minX))*(Math.max(p.maxY,h.maxY)-Math.min(p.minY,h.minY))-c);f<o?(o=f,i=c<i?c:i,a=u):f===o&&c<i&&(i=c,a=u)}t=a||t.children[0]}var h,p;return t},r.prototype._insert=function(e,t,n){var r=n?e:this.toBBox(e),i=[],o=this._chooseSubtree(r,this.data,t,i);for(o.children.push(e),s(o,r);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(r,i,t)},r.prototype._split=function(e,t){var n=e[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var a=this._chooseSplitIndex(n,i,r),s=d(n.children.splice(a,n.children.length-a));s.height=n.height,s.leaf=n.leaf,o(n,this.toBBox),o(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(n,s)},r.prototype._splitRoot=function(e,t){this.data=d([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(e,t,n){for(var r,i,o,s,u,c,f,h=1/0,p=1/0,d=t;d<=n-t;d++){var g=a(e,0,d,this.toBBox),m=a(e,d,n,this.toBBox),v=(i=g,o=m,s=Math.max(i.minX,o.minX),u=Math.max(i.minY,o.minY),c=Math.min(i.maxX,o.maxX),f=Math.min(i.maxY,o.maxY),Math.max(0,c-s)*Math.max(0,f-u)),y=l(g)+l(m);v<h?(h=v,r=d,p=y<p?y:p):v===h&&y<p&&(p=y,r=d)}return r||n-t},r.prototype._chooseSplitAxis=function(e,t,n){var r=e.leaf?this.compareMinX:u,i=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.children.sort(r)},r.prototype._allDistMargin=function(e,t,n,r){e.children.sort(r);for(var i=this.toBBox,o=a(e,0,t,i),u=a(e,n-t,n,i),c=f(o)+f(u),l=t;l<n-t;l++){var h=e.children[l];s(o,e.leaf?i(h):h),c+=f(o)}for(var p=n-t-1;p>=t;p--){var d=e.children[p];s(u,e.leaf?i(d):d),c+=f(u)}return c},r.prototype._adjustParentBBoxes=function(e,t,n){for(var r=n;r>=0;r--)s(t[r],e)},r.prototype._condense=function(e){for(var t=e.length-1,n=void 0;t>=0;t--)0===e[t].children.length?t>0?(n=e[t-1].children).splice(n.indexOf(e[t]),1):this.clear():o(e[t],this.toBBox)},r}()})),te=!1;function ne(){if(!te){te=!0;var e=navigator.userAgent,t=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(e),n=/(Mac OS X)|(Windows)|(Linux)/.exec(e);if(K=/\b(iPhone|iP[ao]d)/.exec(e),Z=/\b(iP[ao]d)/.exec(e),W=/Android/i.exec(e),Q=/FBAN\/\w+;/i.exec(e),J=/Mobile/i.exec(e),$=!!/Win64/.exec(e),t){(z=t[1]?parseFloat(t[1]):t[5]?parseFloat(t[5]):NaN)&&document&&document.documentMode&&(z=document.documentMode);var r=/(?:Trident\/(\d+.\d+))/.exec(e);X=r?parseFloat(r[1])+4:z,F=t[2]?parseFloat(t[2]):NaN,V=t[3]?parseFloat(t[3]):NaN,(U=t[4]?parseFloat(t[4]):NaN)?(t=/(?:Chrome\/(\d+\.\d+))/.exec(e),Y=t&&t[1]?parseFloat(t[1]):NaN):Y=NaN}else z=F=V=Y=U=NaN;if(n){if(n[1]){var i=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(e);q=!i||parseFloat(i[1].replace("_","."))}else q=!1;H=!!n[2],G=!!n[3]}else q=H=G=!1}}var re,ie={ie:function(){return ne()||z},ieCompatibilityMode:function(){return ne()||X>z},ie64:function(){return ie.ie()&&$},firefox:function(){return ne()||F},opera:function(){return ne()||V},webkit:function(){return ne()||U},safari:function(){return ie.webkit()},chrome:function(){return ne()||Y},windows:function(){return ne()||H},osx:function(){return ne()||q},linux:function(){return ne()||G},iphone:function(){return ne()||K},mobile:function(){return ne()||K||Z||W||J},nativeApp:function(){return ne()||Q},android:function(){return ne()||W},ipad:function(){return ne()||Z}},oe=ie,ae=!("undefined"==typeof window||!window.document||!window.document.createElement),se={canUseDOM:ae,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:ae&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:ae&&!!window.screen,isInWorker:!ae};se.canUseDOM&&(re=document.implementation&&document.implementation.hasFeature&&!0!==document.implementation.hasFeature("",""))
/**
   * Checks if an event is supported in the current execution environment.
   *
   * NOTE: This will not work correctly for non-generic events such as `change`,
   * `reset`, `load`, `error`, and `select`.
   *
   * Borrows from Modernizr.
   *
   * @param {string} eventNameSuffix Event name, e.g. "click".
   * @param {?boolean} capture Check if the capture phase is supported.
   * @return {boolean} True if the event is supported.
   * @internal
   * @license Modernizr 3.0.0pre (Custom Build) | MIT
   */;var ue=function(e,t){if(!se.canUseDOM||t&&!("addEventListener"in document))return!1;var n="on"+e,r=n in document;if(!r){var i=document.createElement("div");i.setAttribute(n,"return;"),r="function"==typeof i[n]}return!r&&re&&"wheel"===e&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r};function ce(e){var t=0,n=0,r=0,i=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=n,n=0),r=10*t,i=10*n,"deltaY"in e&&(i=e.deltaY),"deltaX"in e&&(r=e.deltaX),(r||i)&&e.deltaMode&&(1==e.deltaMode?(r*=40,i*=40):(r*=800,i*=800)),r&&!t&&(t=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:t,spinY:n,pixelX:r,pixelY:i}}ce.getEventType=function(){return oe.firefox()?"DOMMouseScroll":ue("wheel")?"wheel":"mousewheel"};var le=ce,fe="BATCHING_REDUCER.BATCH";function he(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fe;return{type:t,meta:{batch:!0},payload:e}}const pe=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,de=e=>--e*e*e+1,ge=(e,t,n)=>e*(1-(n=Math.min(1,Math.max(0,n))))+t*n,me=(e,t,n)=>e.map((e,r)=>ge(e,t[r],n)),ve=e=>e,ye=(e,t,n=6)=>Math.abs(e-t)<10**-n,be=(e,t=ve)=>{const n=new Set,r=[];for(let i=0;i<e.length;i++){const o=t(e[i]);n.has(o)||(n.add(o),r.push(o))}return r},we=Array.isArray,xe=e=>!!(e&&e.constructor&&e.call&&e.apply),Se=e=>!!e&&e.constructor===Object,Ee=e=>Math.sqrt(e.reduce((e,t)=>e+t**2,0)),ke=e=>e.reduce((e,t)=>t>e?t:e,-1/0),Me=e=>{switch(e.length){case 0:return[];case 1:return e[0];default:return e.reduce((e,t)=>t.map((t,n)=>e[n]>t?e[n]:t),new Array(e[0].length).fill(-1/0))}},Oe=e=>Re(e)/e.length,Ae=e=>{switch(e.length){case 0:return[];case 1:return e[0];default:return e.reduce((t,n)=>n.map((n,r)=>t[r]+n/e.length),new Array(e[0].length).fill(0))}},je=e=>e[Math.floor(e.length/2)],Pe=je,Ce=e=>e.reduce((e,t)=>t<e?t:e,1/0),_e=e=>{switch(e.length){case 0:return[];case 1:return e[0];default:return e.reduce((e,t)=>t.map((t,n)=>e[n]<t?e[n]:t),new Array(e[0].length).fill(1/0))}},Ie=e=>{const t=Ee(e);return e.map(e=>e/t)},Re=e=>e.reduce((e,t)=>t?e+t:e,0),Te=e=>{switch(e.length){case 0:return[];case 1:return e[0];default:return e.reduce((e,t)=>t.map((t,n)=>e[n]+t),new Array(e[0].length).fill(0))}},Le="http://www.w3.org/2000/svg",Be=(e,t)=>{if(e.namespaceURI===Le){if(!De(e,t)){const n=e.getAttribute("class")||"";e.setAttribute("class",`${n} ${t}`)}}else e.classList?e.classList.add(t):De(e,t)||(e.className+=" "+t)},Ne=e=>{const t=document.createElement("div");return t.insertAdjacentHTML("beforeend",e),t.firstChild},De=(e,t)=>{if(e.namespaceURI===Le){const n=e.getAttribute("class");return n&&!!n.match(new RegExp(`(\\s|^)${t}(\\s|$)`))}return e.classList?e.classList.contains(t):!!e.className.match(new RegExp(`(\\s|^)${t}(\\s|$)`))},ze=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},Fe=e=>{e.removeChild(e.lastChild)},Ve=(e,t)=>{const n=new RegExp(`(\\s|^)${t}(\\s|$)`);if(e.namespaceURI===Le){const t=e.getAttribute("class")||"";e.setAttribute("class",t.replace(n," "))}else e.classList?e.classList.remove(t):De(e,t)&&(e.className=e.className.replace(n," "))},Ue=(e,...t)=>(t.forEach(t=>{const n=Object.keys(t).reduce((e,n)=>(e[n]=Object.getOwnPropertyDescriptor(t,n),e),{});Object.getOwnPropertySymbols(t).forEach(e=>{const r=Object.getOwnPropertyDescriptor(t,e);r.enumerable&&(n[e]=r)}),Object.defineProperties(e,n)}),e),Ye=e=>Xe(void 0,e),Xe=(e,t)=>{if(null===t||"object"!=typeof t)return t;if(t.constructor!==Object&&t.constructor!==Array)return t;if(t.constructor===Date||t.constructor===RegExp||t.constructor===Function||t.constructor===String||t.constructor===Number||t.constructor===Boolean)return new t.constructor(t);const n=e||new t.constructor;return Object.keys(t).forEach(e=>{const r=Object.getOwnPropertyDescriptor(t,e);void 0===n[e]&&(void 0===r.value?Object.defineProperty(n,e,r):n[e]=Xe(void 0,t[e]))}),n},qe=(e,t)=>{if(null===t||"object"!=typeof t)return t;if(t.constructor!==Object&&t.constructor!==Array)return new t.constructor(t);const n=new e.constructor;let r=!1;return Object.keys(t).forEach(i=>{const o=Object.getOwnPropertyDescriptor(t,i);void 0===e[i]?void 0===o.value?Object.defineProperty(n,i,o):n[i]=Xe(void 0,t[i]):n[i]=qe(e[i],t[i]),r=r||n[i]!==e[i]}),r=r||Object.keys(e).filter(e=>void 0===t[e]).length,r?n:e},He=e=>e.split(/(?=[A-Z])/).join("_").toUpperCase(),Ge=e=>`${e[0].toUpperCase()}${e.substr(1)}`,We=e=>t=>Array.prototype.forEach.call(t,e),$e=(...e)=>t=>e.reduce((e,t)=>t(e),t),Ke=e=>t=>Ue({__proto__:{constructor:e}},t),Ze=(e,t)=>n=>Ue(n,{[e](...e){return t.apply(this,e)}}),Qe=(e,{initialValue:t,getter:n,setter:r,cloner:i=ve,transformer:o=ve,validator:a=(()=>!0)}={})=>s=>{let u=t;const c=n?()=>n():()=>i(u),l=r?e=>r(e):e=>{const t=o(e);u=a(t)?t:u};return Ue(s,{get[e](){return c()},["set"+Ge(e)](e){l(e)}})},Je=(e,t)=>n=>Ue(n,{get[e](){return t()}}),et=(e,t)=>n=>Ue(n,{get[e](){return t}}),tt=(e,t,n,r)=>Math.abs(e-n)+Math.abs(t-r),nt=(e,t,n,r)=>Math.sqrt((e-n)**2+(t-r)**2),rt=([e,t]=[],n=[])=>{let r,i,o,a,s=!1;for(let u=0,c=n.length-2;u<n.length;u+=2)r=n[u],i=n[u+1],o=n[c],a=n[c+1],i>t!=a>t&&e<(o-r)*(t-i)/(a-i)+r&&(s=!s),c=u;return s},it=(e,t)=>new Map(function*(){yield*e,yield*t}()),ot=e=>new Worker(window.URL.createObjectURL(new Blob([`(${e.toString()})()`],{type:"text/javascript"}))),at=()=>{},st=(e,t)=>e-t,ut=(e,t)=>t-e,ct=(e,{getter:t=ve,comparator:n=st,ignoreNull:r=!1}={})=>Object.entries(e).map(r?([e,n])=>null===t(n)?void 0:[e,t(n)]:([e,n])=>[e,t(n)]).sort((e,t)=>n(e[1],t[1])).reduce((e,t,n)=>t?(e[t[0]]=n,e):e,new e.constructor),lt=(e,t)=>{let n;const r=(...r)=>{clearTimeout(n),n=setTimeout(()=>{n=null,e(...r)},t)};return r.cancel=()=>{clearTimeout(n)},r.now=(...t)=>e(...t),r},ft=(e=1)=>new Promise(t=>{let n=0;const r=()=>requestAnimationFrame(()=>{n++,n<e?r():t()});r()}),ht=(e,t,n=null)=>{let r,i=0;n=null===n?t:n;const o=(...t)=>{clearTimeout(r),r=setTimeout(()=>{i>0&&(e(...t),i=0)},n)};let a=!1;const s=(...n)=>{a?(i++,o(...n)):(e(...n),o(...n),a=!0,i=0,setTimeout(()=>{a=!1},t))};return s.reset=()=>{a=!1},s.cancel=()=>{clearTimeout(r)},s.now=(...t)=>e(...t),s},pt=e=>new Promise(t=>setTimeout(t,e));var dt=new Array(256);!function(e){for(var t=0;t<256;++t){var n=t,r=t,i=7;for(n>>>=1;n;n>>>=1)r<<=1,r|=1&n,--i;e[t]=r<<i&255}}(dt);var gt=function(e){return!(e&e-1||!e)},mt=function(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1},vt=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1};var yt=function(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=n;return t},bt=function(e){return null!=e&&(wt(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&wt(e.slice(0,0))}(e)||!!e._isBuffer)};
/*!
   * Determine if an object is a Buffer
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   */function wt(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var xt="undefined"!=typeof Float64Array;function St(e,t){return e[0]-t[0]}function Et(){var e,t=this.stride,n=new Array(t.length);for(e=0;e<n.length;++e)n[e]=[Math.abs(t[e]),e];n.sort(St);var r=new Array(n.length);for(e=0;e<r.length;++e)r[e]=n[e][1];return r}function kt(e,t){var n=["View",t,"d",e].join("");t<0&&(n="View_Nil"+e);var r="generic"===e;if(-1===t){var i="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(i)()}if(0===t){i="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(r?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(r?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}";return new Function("TrivialArray",i)(Mt[e][0])}i=["'use strict'"];var o=yt(t),a=o.map((function(e){return"i"+e})),s="this.offset+"+o.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),u=o.map((function(e){return"b"+e})).join(","),c=o.map((function(e){return"c"+e})).join(",");i.push("function "+n+"(a,"+u+","+c+",d){this.data=a","this.shape=["+u+"]","this.stride=["+c+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),i.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+o.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),t<4?(i.push("function "+n+"_order(){"),2===t?i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push("proto.set=function "+n+"_set("+a.join(",")+",v){"),r?i.push("return this.data.set("+s+",v)}"):i.push("return this.data["+s+"]=v}"),i.push("proto.get=function "+n+"_get("+a.join(",")+"){"),r?i.push("return this.data.get("+s+")}"):i.push("return this.data["+s+"]}"),i.push("proto.index=function "+n+"_index(",a.join(),"){return "+s+"}"),i.push("proto.hi=function "+n+"_hi("+a.join(",")+"){return new "+n+"(this.data,"+o.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+o.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var l=o.map((function(e){return"a"+e+"=this.shape["+e+"]"})),f=o.map((function(e){return"c"+e+"=this.stride["+e+"]"}));i.push("proto.lo=function "+n+"_lo("+a.join(",")+"){var b=this.offset,d=0,"+l.join(",")+","+f.join(","));for(var h=0;h<t;++h)i.push("if(typeof i"+h+"==='number'&&i"+h+">=0){d=i"+h+"|0;b+=c"+h+"*d;a"+h+"-=d}");i.push("return new "+n+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"c"+e})).join(",")+",b)}"),i.push("proto.step=function "+n+"_step("+a.join(",")+"){var "+o.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+o.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(h=0;h<t;++h)i.push("if(typeof i"+h+"==='number'){d=i"+h+"|0;if(d<0){c+=b"+h+"*(a"+h+"-1);a"+h+"=ceil(-a"+h+"/d)}else{a"+h+"=ceil(a"+h+"/d)}b"+h+"*=d}");i.push("return new "+n+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"b"+e})).join(",")+",c)}");var p=new Array(t),d=new Array(t);for(h=0;h<t;++h)p[h]="a[i"+h+"]",d[h]="b[i"+h+"]";i.push("proto.transpose=function "+n+"_transpose("+a+"){"+a.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+p.join(",")+","+d.join(",")+",this.offset)}"),i.push("proto.pick=function "+n+"_pick("+a+"){var a=[],b=[],c=this.offset");for(h=0;h<t;++h)i.push("if(typeof i"+h+"==='number'&&i"+h+">=0){c=(c+this.stride["+h+"]*i"+h+")|0}else{a.push(this.shape["+h+"]);b.push(this.stride["+h+"])}");return i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),i.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+o.map((function(e){return"shape["+e+"]"})).join(",")+","+o.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",i.join("\n"))(Mt[e],Et)}var Mt={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};var Ot=function(e,t,n,r){if(void 0===e)return(0,Mt.array[0])([]);"number"==typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var i=t.length;if(void 0===n){n=new Array(i);for(var o=i-1,a=1;o>=0;--o)n[o]=a,a*=t[o]}if(void 0===r){r=0;for(o=0;o<i;++o)n[o]<0&&(r-=(t[o]-1)*n[o])}for(var s=function(e){if(bt(e))return"buffer";if(xt)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),u=Mt[s];u.length<=i+1;)u.push(kt(s,u.length-1));return(0,u[i+1])(e,t,n,r)};var At=function(e,t,n){return 0===e.length?e:t?(n||e.sort(t),function(e,t){for(var n=1,r=e.length,i=e[0],o=e[0],a=1;a<r;++a)if(o=i,t(i=e[a],o)){if(a===n){n++;continue}e[n++]=i}return e.length=n,e}(e,t)):(n||e.sort(),function(e){for(var t=1,n=e.length,r=e[0],i=e[0],o=1;o<n;++o,i=r)if(i=r,(r=e[o])!==i){if(o===t){t++;continue}e[t++]=r}return e.length=t,e}(e))};function jt(e,t,n){var r,i,o=e.length,a=t.arrayArgs.length,s=t.indexArgs.length>0,u=[],c=[],l=0,f=0;for(r=0;r<o;++r)c.push(["i",r,"=0"].join(""));for(i=0;i<a;++i)for(r=0;r<o;++r)f=l,l=e[r],0===r?c.push(["d",i,"s",r,"=t",i,"p",l].join("")):c.push(["d",i,"s",r,"=(t",i,"p",l,"-s",f,"*t",i,"p",f,")"].join(""));for(c.length>0&&u.push("var "+c.join(",")),r=o-1;r>=0;--r)l=e[r],u.push(["for(i",r,"=0;i",r,"<s",l,";++i",r,"){"].join(""));for(u.push(n),r=0;r<o;++r){for(f=l,l=e[r],i=0;i<a;++i)u.push(["p",i,"+=d",i,"s",r].join(""));s&&(r>0&&u.push(["index[",f,"]-=s",f].join("")),u.push(["++index[",l,"]"].join(""))),u.push("}")}return u.join("\n")}function Pt(e,t,n){for(var r=e.body,i=[],o=[],a=0;a<e.args.length;++a){var s=e.args[a];if(!(s.count<=0)){var u=new RegExp(s.name,"g"),c="",l=t.arrayArgs.indexOf(a);switch(t.argTypes[a]){case"offset":var f=t.offsetArgIndex.indexOf(a);l=t.offsetArgs[f].array,c="+q"+f;case"array":c="p"+l+c;var h="l"+a,p="a"+l;if(0===t.arrayBlockIndices[l])1===s.count?"generic"===n[l]?s.lvalue?(i.push(["var ",h,"=",p,".get(",c,")"].join("")),r=r.replace(u,h),o.push([p,".set(",c,",",h,")"].join(""))):r=r.replace(u,[p,".get(",c,")"].join("")):r=r.replace(u,[p,"[",c,"]"].join("")):"generic"===n[l]?(i.push(["var ",h,"=",p,".get(",c,")"].join("")),r=r.replace(u,h),s.lvalue&&o.push([p,".set(",c,",",h,")"].join(""))):(i.push(["var ",h,"=",p,"[",c,"]"].join("")),r=r.replace(u,h),s.lvalue&&o.push([p,"[",c,"]=",h].join("")));else{for(var d=[s.name],g=[c],m=0;m<Math.abs(t.arrayBlockIndices[l]);m++)d.push("\\s*\\[([^\\]]+)\\]"),g.push("$"+(m+1)+"*t"+l+"b"+m);if(u=new RegExp(d.join(""),"g"),c=g.join("+"),"generic"===n[l])throw new Error("cwise: Generic arrays not supported in combination with blocks!");r=r.replace(u,[p,"[",c,"]"].join(""))}break;case"scalar":r=r.replace(u,"Y"+t.scalarArgs.indexOf(a));break;case"index":r=r.replace(u,"index");break;case"shape":r=r.replace(u,"shape")}}}return[i.join("\n"),r,o.join("\n")].join("\n").trim()}function Ct(e){for(var t=new Array(e.length),n=!0,r=0;r<e.length;++r){var i=e[r],o=i.match(/\d+/);o=o?o[0]:"",0===i.charAt(0)?t[r]="u"+i.charAt(1)+o:t[r]=i.charAt(0)+o,r>0&&(n=n&&t[r]===t[r-1])}return n?t[0]:t.join("")}var _t=function(e,t){for(var n=t[1].length-Math.abs(e.arrayBlockIndices[0])|0,r=new Array(e.arrayArgs.length),i=new Array(e.arrayArgs.length),o=0;o<e.arrayArgs.length;++o)i[o]=t[2*o],r[o]=t[2*o+1];var a=[],s=[],u=[],c=[],l=[];for(o=0;o<e.arrayArgs.length;++o){e.arrayBlockIndices[o]<0?(u.push(0),c.push(n),a.push(n),s.push(n+e.arrayBlockIndices[o])):(u.push(e.arrayBlockIndices[o]),c.push(e.arrayBlockIndices[o]+n),a.push(0),s.push(e.arrayBlockIndices[o]));for(var f=[],h=0;h<r[o].length;h++)u[o]<=r[o][h]&&r[o][h]<c[o]&&f.push(r[o][h]-u[o]);l.push(f)}var p=["SS"],d=["'use strict'"],g=[];for(h=0;h<n;++h)g.push(["s",h,"=SS[",h,"]"].join(""));for(o=0;o<e.arrayArgs.length;++o){p.push("a"+o),p.push("t"+o),p.push("p"+o);for(h=0;h<n;++h)g.push(["t",o,"p",h,"=t",o,"[",u[o]+h,"]"].join(""));for(h=0;h<Math.abs(e.arrayBlockIndices[o]);++h)g.push(["t",o,"b",h,"=t",o,"[",a[o]+h,"]"].join(""))}for(o=0;o<e.scalarArgs.length;++o)p.push("Y"+o);if(e.shapeArgs.length>0&&g.push("shape=SS.slice(0)"),e.indexArgs.length>0){var m=new Array(n);for(o=0;o<n;++o)m[o]="0";g.push(["index=[",m.join(","),"]"].join(""))}for(o=0;o<e.offsetArgs.length;++o){var v=e.offsetArgs[o],y=[];for(h=0;h<v.offset.length;++h)0!==v.offset[h]&&(1===v.offset[h]?y.push(["t",v.array,"p",h].join("")):y.push([v.offset[h],"*t",v.array,"p",h].join("")));0===y.length?g.push("q"+o+"=0"):g.push(["q",o,"=",y.join("+")].join(""))}var b=At([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));for((g=g.concat(b)).length>0&&d.push("var "+g.join(",")),o=0;o<e.arrayArgs.length;++o)d.push("p"+o+"|=0");e.pre.body.length>3&&d.push(Pt(e.pre,e,i));var w=Pt(e.body,e,i),x=function(e){for(var t=0,n=e[0].length;t<n;){for(var r=1;r<e.length;++r)if(e[r][t]!==e[0][t])return t;++t}return t}(l);x<n?d.push(function(e,t,n,r){for(var i=t.length,o=n.arrayArgs.length,a=n.blockSize,s=n.indexArgs.length>0,u=[],c=0;c<o;++c)u.push(["var offset",c,"=p",c].join(""));for(c=e;c<i;++c)u.push(["for(var j"+c+"=SS[",t[c],"]|0;j",c,">0;){"].join("")),u.push(["if(j",c,"<",a,"){"].join("")),u.push(["s",t[c],"=j",c].join("")),u.push(["j",c,"=0"].join("")),u.push(["}else{s",t[c],"=",a].join("")),u.push(["j",c,"-=",a,"}"].join("")),s&&u.push(["index[",t[c],"]=j",c].join(""));for(c=0;c<o;++c){for(var l=["offset"+c],f=e;f<i;++f)l.push(["j",f,"*t",c,"p",t[f]].join(""));u.push(["p",c,"=(",l.join("+"),")"].join(""))}for(u.push(jt(t,n,r)),c=e;c<i;++c)u.push("}");return u.join("\n")}(x,l[0],e,w)):d.push(jt(l[0],e,w)),e.post.body.length>3&&d.push(Pt(e.post,e,i)),e.debug&&console.log("-----Generated cwise routine for ",t,":\n"+d.join("\n")+"\n----------");var S=[e.funcName||"unnamed","_cwise_loop_",r[0].join("s"),"m",x,Ct(i)].join("");return new Function(["function ",S,"(",p.join(","),"){",d.join("\n"),"} return ",S].join(""))()};var It=function(e){var t=["'use strict'","var CACHED={}"],n=[],r=e.funcName+"_cwise_thunk";t.push(["return function ",r,"(",e.shimArgs.join(","),"){"].join(""));for(var i=[],o=[],a=[["array",e.arrayArgs[0],".shape.slice(",Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?","+e.arrayBlockIndices[0]+")":")"].join("")],s=[],u=[],c=0;c<e.arrayArgs.length;++c){var l=e.arrayArgs[c];n.push(["t",l,"=array",l,".dtype,","r",l,"=array",l,".order"].join("")),i.push("t"+l),i.push("r"+l),o.push("t"+l),o.push("r"+l+".join()"),a.push("array"+l+".data"),a.push("array"+l+".stride"),a.push("array"+l+".offset|0"),c>0&&(s.push("array"+e.arrayArgs[0]+".shape.length===array"+l+".shape.length+"+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[c]))),u.push("array"+e.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[0])+"]===array"+l+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[c])+"]"))}for(e.arrayArgs.length>1&&(t.push("if (!("+s.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),t.push("for(var shapeIndex=array"+e.arrayArgs[0]+".shape.length-"+Math.abs(e.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),t.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),t.push("}")),c=0;c<e.scalarArgs.length;++c)a.push("scalar"+e.scalarArgs[c]);return n.push(["type=[",o.join(","),"].join()"].join("")),n.push("proc=CACHED[type]"),t.push("var "+n.join(",")),t.push(["if(!proc){","CACHED[type]=proc=compile([",i.join(","),"])}","return proc(",a.join(","),")}"].join("")),e.debug&&console.log("-----Generated thunk:\n"+t.join("\n")+"\n----------"),new Function("compile",t.join("\n"))(_t.bind(void 0,e))};function Rt(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}var Tt=function(e){var t=new Rt;t.pre=e.pre,t.body=e.body,t.post=e.post;var n=e.args.slice(0);t.argTypes=n;for(var r=0;r<n.length;++r){var i=n[r];if("array"===i||"object"==typeof i&&i.blockIndices){if(t.argTypes[r]="array",t.arrayArgs.push(r),t.arrayBlockIndices.push(i.blockIndices?i.blockIndices:0),t.shimArgs.push("array"+r),r<t.pre.args.length&&t.pre.args[r].count>0)throw new Error("cwise: pre() block may not reference array args");if(r<t.post.args.length&&t.post.args[r].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===i)t.scalarArgs.push(r),t.shimArgs.push("scalar"+r);else if("index"===i){if(t.indexArgs.push(r),r<t.pre.args.length&&t.pre.args[r].count>0)throw new Error("cwise: pre() block may not reference array index");if(r<t.body.args.length&&t.body.args[r].lvalue)throw new Error("cwise: body() block may not write to array index");if(r<t.post.args.length&&t.post.args[r].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===i){if(t.shapeArgs.push(r),r<t.pre.args.length&&t.pre.args[r].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(r<t.body.args.length&&t.body.args[r].lvalue)throw new Error("cwise: body() block may not write to array shape");if(r<t.post.args.length&&t.post.args[r].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof i||!i.offset)throw new Error("cwise: Unknown argument type "+n[r]);t.argTypes[r]="offset",t.offsetArgs.push({array:i.array,offset:i.offset}),t.offsetArgIndex.push(r)}}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>n.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>n.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>n.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||"cwise",t.blockSize=e.blockSize||64,It(t)},Lt=a((function(e,t){var n={body:"",args:[],thisVars:[],localVars:[]};function r(e){if(!e)return n;for(var t=0;t<e.args.length;++t){var r=e.args[t];e.args[t]=0===t?{name:r,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:r,lvalue:!1,rvalue:!0,count:1}}return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function i(e){for(var t=[],n=0;n<e.args.length;++n)t.push("a"+n);return new Function("P",["return function ",e.funcName,"_ndarrayops(",t.join(","),") {P(",t.join(","),");return a0}"].join(""))(function(e){return Tt({args:e.args,pre:r(e.pre),body:r(e.body),post:r(e.proc),funcName:e.funcName})}(e))}var o={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var e in o){var n=o[e];t[e]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+n+"c"},funcName:e}),t[e+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a"+n+"=b"},rvalue:!0,funcName:e+"eq"}),t[e+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+n+"s"},funcName:e+"s"}),t[e+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a"+n+"=s"},rvalue:!0,funcName:e+"seq"})}}();var a={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var e in a){var n=a[e];t[e]=i({args:["array","array"],body:{args:["a","b"],body:"a="+n+"b"},funcName:e}),t[e+"eq"]=i({args:["array"],body:{args:["a"],body:"a="+n+"a"},rvalue:!0,count:2,funcName:e+"eq"})}}();var s={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var e in s){var n=s[e];t[e]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+n+"c"},funcName:e}),t[e+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+n+"s"},funcName:e+"s"}),t[e+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a=a"+n+"b"},rvalue:!0,count:2,funcName:e+"eq"}),t[e+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+n+"s"},rvalue:!0,count:2,funcName:e+"seq"})}}();var u=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var e=0;e<u.length;++e){var n=u[e];t[n]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:n}),t[n+"eq"]=i({args:["array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"eq"})}}();var c=["max","min","atan2","pow"];!function(){for(var e=0;e<c.length;++e){var n=c[e];t[n]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:n}),t[n+"s"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:n+"s"}),t[n+"eq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"eq"}),t[n+"seq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"seq"})}}();var l=["atan2","pow"];!function(){for(var e=0;e<l.length;++e){var n=l[e];t[n+"op"]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:n+"op"}),t[n+"ops"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:n+"ops"}),t[n+"opeq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"opeq"}),t[n+"opseq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"opseq"})}}(),t.any=Tt({args:["array"],pre:n,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),t.all=Tt({args:["array"],pre:n,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),t.sum=Tt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),t.prod=Tt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),t.norm2squared=Tt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),t.norm2=Tt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),t.norminf=Tt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),t.norm1=Tt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),t.sup=Tt({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.inf=Tt({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.argmin=Tt({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.argmax=Tt({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.random=i({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),t.assign=i({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),t.assigns=i({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),t.equals=Tt({args:["array","array"],pre:n,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})})),Bt=a((function(e,t){!function(e){var t,n,r,i,o,a,s,u,c,l,f,h,p,d,g,m,v,y;function b(e,t){if(!e)throw new Error("ASSERT: "+t)}function w(e){return e>=48&&e<=57}function x(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function S(e){return"01234567".indexOf(e)>=0}function E(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function k(e){return 10===e||13===e||8232===e||8233===e}function M(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&s.NonAsciiIdentifierStart.test(String.fromCharCode(e))}function O(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&s.NonAsciiIdentifierPart.test(String.fromCharCode(e))}function A(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function j(e){return"eval"===e||"arguments"===e}function P(e,t,n,r,i){var o;b("number"==typeof n,"Comment must have valid position"),v.lastCommentStart>=n||(v.lastCommentStart=n,o={type:e,value:t},y.range&&(o.range=[n,r]),y.loc&&(o.loc=i),y.comments.push(o),y.attachComment&&(y.leadingComments.push(o),y.trailingComments.push(o)))}function C(e){var t,n,r,i;for(t=f-e,n={start:{line:h,column:f-p-e}};f<d;)if(r=c.charCodeAt(f),++f,k(r))return y.comments&&(i=c.slice(t+e,f-1),n.end={line:h,column:f-p-1},P("Line",i,t,f-1,n)),13===r&&10===c.charCodeAt(f)&&++f,++h,void(p=f);y.comments&&(i=c.slice(t+e,f),n.end={line:h,column:f-p},P("Line",i,t,f,n))}function _(){var e,t,n,r;for(y.comments&&(e=f-2,t={start:{line:h,column:f-p-2}});f<d;)if(k(n=c.charCodeAt(f)))13===n&&10===c.charCodeAt(f+1)&&++f,++h,++f,p=f,f>=d&&G({},a.UnexpectedToken,"ILLEGAL");else if(42===n){if(47===c.charCodeAt(f+1))return++f,++f,void(y.comments&&(r=c.slice(e+2,f-2),t.end={line:h,column:f-p},P("Block",r,e,f,t)));++f}else++f;G({},a.UnexpectedToken,"ILLEGAL")}function I(){var e,t;for(t=0===f;f<d;)if(E(e=c.charCodeAt(f)))++f;else if(k(e))++f,13===e&&10===c.charCodeAt(f)&&++f,++h,p=f,t=!0;else if(47===e)if(47===(e=c.charCodeAt(f+1)))++f,++f,C(2),t=!0;else{if(42!==e)break;++f,++f,_()}else if(t&&45===e){if(45!==c.charCodeAt(f+1)||62!==c.charCodeAt(f+2))break;f+=3,C(3)}else{if(60!==e)break;if("!--"!==c.slice(f+1,f+4))break;++f,++f,++f,++f,C(4)}}function R(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t){if(!(f<d&&x(c[f])))return"";r=c[f++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())}return String.fromCharCode(i)}function T(){var e,t;for(e=c.charCodeAt(f++),t=String.fromCharCode(e),92===e&&(117!==c.charCodeAt(f)&&G({},a.UnexpectedToken,"ILLEGAL"),++f,(e=R("u"))&&"\\"!==e&&M(e.charCodeAt(0))||G({},a.UnexpectedToken,"ILLEGAL"),t=e);f<d&&O(e=c.charCodeAt(f));)++f,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==c.charCodeAt(f)&&G({},a.UnexpectedToken,"ILLEGAL"),++f,(e=R("u"))&&"\\"!==e&&O(e.charCodeAt(0))||G({},a.UnexpectedToken,"ILLEGAL"),t+=e);return t}function L(){var e,n;return e=f,{type:1===(n=92===c.charCodeAt(f)?T():function(){var e,t;for(e=f++;f<d;){if(92===(t=c.charCodeAt(f)))return f=e,T();if(!O(t))break;++f}return c.slice(e,f)}()).length?t.Identifier:function(e){if(l&&A(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}(n)?t.Keyword:"null"===n?t.NullLiteral:"true"===n||"false"===n?t.BooleanLiteral:t.Identifier,value:n,lineNumber:h,lineStart:p,start:e,end:f}}function B(){var e,n,r,i,o=f,s=c.charCodeAt(f),u=c[f];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++f,y.tokenize&&(40===s?y.openParenToken=y.tokens.length:123===s&&(y.openCurlyToken=y.tokens.length)),{type:t.Punctuator,value:String.fromCharCode(s),lineNumber:h,lineStart:p,start:o,end:f};default:if(61===(e=c.charCodeAt(f+1)))switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return f+=2,{type:t.Punctuator,value:String.fromCharCode(s)+String.fromCharCode(e),lineNumber:h,lineStart:p,start:o,end:f};case 33:case 61:return f+=2,61===c.charCodeAt(f)&&++f,{type:t.Punctuator,value:c.slice(o,f),lineNumber:h,lineStart:p,start:o,end:f}}}return">>>="===(i=c.substr(f,4))?{type:t.Punctuator,value:i,lineNumber:h,lineStart:p,start:o,end:f+=4}:">>>"===(r=i.substr(0,3))||"<<="===r||">>="===r?{type:t.Punctuator,value:r,lineNumber:h,lineStart:p,start:o,end:f+=3}:u===(n=r.substr(0,2))[1]&&"+-<>&|".indexOf(u)>=0||"=>"===n?{type:t.Punctuator,value:n,lineNumber:h,lineStart:p,start:o,end:f+=2}:"<>=!+-*%&|^/".indexOf(u)>=0?(++f,{type:t.Punctuator,value:u,lineNumber:h,lineStart:p,start:o,end:f}):void G({},a.UnexpectedToken,"ILLEGAL")}function N(){var e,n,r;if(b(w((r=c[f]).charCodeAt(0))||"."===r,"Numeric literal must start with a decimal digit or a decimal point"),n=f,e="","."!==r){if(e=c[f++],r=c[f],"0"===e){if("x"===r||"X"===r)return++f,function(e){for(var n="";f<d&&x(c[f]);)n+=c[f++];return 0===n.length&&G({},a.UnexpectedToken,"ILLEGAL"),M(c.charCodeAt(f))&&G({},a.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseInt("0x"+n,16),lineNumber:h,lineStart:p,start:e,end:f}}(n);if(S(r)&&function(){var e,t;for(e=f+1;e<d;++e){if("8"===(t=c[e])||"9"===t)return!1;if(!S(t))return!0}return!0}())return function(e){for(var n="0"+c[f++];f<d&&S(c[f]);)n+=c[f++];return(M(c.charCodeAt(f))||w(c.charCodeAt(f)))&&G({},a.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseInt(n,8),octal:!0,lineNumber:h,lineStart:p,start:e,end:f}}(n)}for(;w(c.charCodeAt(f));)e+=c[f++];r=c[f]}if("."===r){for(e+=c[f++];w(c.charCodeAt(f));)e+=c[f++];r=c[f]}if("e"===r||"E"===r)if(e+=c[f++],"+"!==(r=c[f])&&"-"!==r||(e+=c[f++]),w(c.charCodeAt(f)))for(;w(c.charCodeAt(f));)e+=c[f++];else G({},a.UnexpectedToken,"ILLEGAL");return M(c.charCodeAt(f))&&G({},a.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseFloat(e),lineNumber:h,lineStart:p,start:n,end:f}}function D(){var e,n,r,i;return m=null,I(),e=f,n=function(){var e,t,n,r;for(b("/"===(e=c[f]),"Regular expression literal must start with a slash"),t=c[f++],n=!1,r=!1;f<d;)if(t+=e=c[f++],"\\"===e)k((e=c[f++]).charCodeAt(0))&&G({},a.UnterminatedRegExp),t+=e;else if(k(e.charCodeAt(0)))G({},a.UnterminatedRegExp);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||G({},a.UnterminatedRegExp),{value:t.substr(1,t.length-2),literal:t}}(),r=function(){var e,t,n,r;for(t="",n="";f<d&&O((e=c[f]).charCodeAt(0));)if(++f,"\\"===e&&f<d)if("u"===(e=c[f])){if(r=++f,e=R("u"))for(n+=e,t+="\\u";r<f;++r)t+=c[r];else f=r,n+="u",t+="\\u";W({},a.UnexpectedToken,"ILLEGAL")}else t+="\\",W({},a.UnexpectedToken,"ILLEGAL");else n+=e,t+=e;return{value:n,literal:t}}(),i=function(e,t){var n;try{n=new RegExp(e,t)}catch(e){G({},a.InvalidRegExp)}return n}(n.value,r.value),y.tokenize?{type:t.RegularExpression,value:i,lineNumber:h,lineStart:p,start:e,end:f}:{literal:n.literal+r.literal,value:i,start:e,end:f}}function z(){var e,t,n,r;return I(),e=f,t={start:{line:h,column:f-p}},n=D(),t.end={line:h,column:f-p},y.tokenize||(y.tokens.length>0&&(r=y.tokens[y.tokens.length-1]).range[0]===e&&"Punctuator"===r.type&&("/"!==r.value&&"/="!==r.value||y.tokens.pop()),y.tokens.push({type:"RegularExpression",value:n.literal,range:[e,f],loc:t})),n}function F(){var e;return I(),f>=d?{type:t.EOF,lineNumber:h,lineStart:p,start:f,end:f}:M(e=c.charCodeAt(f))?L():40===e||41===e||59===e?B():39===e||34===e?function(){var e,n,r,i,o,s,u,l,g="",m=!1;for(u=h,l=p,b("'"===(e=c[f])||'"'===e,"String literal must starts with a quote"),n=f,++f;f<d;){if((r=c[f++])===e){e="";break}if("\\"===r)if((r=c[f++])&&k(r.charCodeAt(0)))++h,"\r"===r&&"\n"===c[f]&&++f,p=f;else switch(r){case"u":case"x":s=f,(o=R(r))?g+=o:(f=s,g+=r);break;case"n":g+="\n";break;case"r":g+="\r";break;case"t":g+="\t";break;case"b":g+="\b";break;case"f":g+="\f";break;case"v":g+="\v";break;default:S(r)?(0!==(i="01234567".indexOf(r))&&(m=!0),f<d&&S(c[f])&&(m=!0,i=8*i+"01234567".indexOf(c[f++]),"0123".indexOf(r)>=0&&f<d&&S(c[f])&&(i=8*i+"01234567".indexOf(c[f++]))),g+=String.fromCharCode(i)):g+=r}else{if(k(r.charCodeAt(0)))break;g+=r}}return""!==e&&G({},a.UnexpectedToken,"ILLEGAL"),{type:t.StringLiteral,value:g,octal:m,startLineNumber:u,startLineStart:l,lineNumber:h,lineStart:p,start:n,end:f}}():46===e?w(c.charCodeAt(f+1))?N():B():w(e)?N():y.tokenize&&47===e?function(){var e,t;if(!(e=y.tokens[y.tokens.length-1]))return z();if("Punctuator"===e.type){if("]"===e.value)return B();if(")"===e.value)return!(t=y.tokens[y.openParenToken-1])||"Keyword"!==t.type||"if"!==t.value&&"while"!==t.value&&"for"!==t.value&&"with"!==t.value?B():z();if("}"===e.value){if(y.tokens[y.openCurlyToken-3]&&"Keyword"===y.tokens[y.openCurlyToken-3].type){if(!(t=y.tokens[y.openCurlyToken-4]))return B()}else{if(!y.tokens[y.openCurlyToken-4]||"Keyword"!==y.tokens[y.openCurlyToken-4].type)return B();if(!(t=y.tokens[y.openCurlyToken-5]))return z()}return r.indexOf(t.value)>=0?B():z()}return z()}return"Keyword"===e.type&&"this"!==e.value?z():B()}():B()}function V(){var e,r,i;return I(),e={start:{line:h,column:f-p}},r=F(),e.end={line:h,column:f-p},r.type!==t.EOF&&(i=c.slice(r.start,r.end),y.tokens.push({type:n[r.type],value:i,range:[r.start,r.end],loc:e})),r}function U(){var e;return f=(e=m).end,h=e.lineNumber,p=e.lineStart,m=void 0!==y.tokens?V():F(),f=e.end,h=e.lineNumber,p=e.lineStart,e}function Y(){var e,t,n;e=f,t=h,n=p,m=void 0!==y.tokens?V():F(),f=e,h=t,p=n}function X(e,t){this.line=e,this.column=t}function q(e,t,n,r){this.start=new X(e,t),this.end=new X(n,r)}function H(){var e,t,n,r;return e=f,t=h,n=p,I(),r=h!==t,f=e,h=t,p=n,r}function G(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(function(e,t){return b(t<r.length,"Message reference must be in range"),r[t]}));throw"number"==typeof e.lineNumber?((n=new Error("Line "+e.lineNumber+": "+i)).index=e.start,n.lineNumber=e.lineNumber,n.column=e.start-p+1):((n=new Error("Line "+h+": "+i)).index=f,n.lineNumber=h,n.column=f-p+1),n.description=i,n}function W(){try{G.apply(null,arguments)}catch(e){if(!y.errors)throw e;y.errors.push(e)}}function $(e){if(e.type===t.EOF&&G(e,a.UnexpectedEOS),e.type===t.NumericLiteral&&G(e,a.UnexpectedNumber),e.type===t.StringLiteral&&G(e,a.UnexpectedString),e.type===t.Identifier&&G(e,a.UnexpectedIdentifier),e.type===t.Keyword){if(function(e){switch(e){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0;default:return!1}}(e.value))G(e,a.UnexpectedReserved);else if(l&&A(e.value))return void W(e,a.StrictReservedWord);G(e,a.UnexpectedToken,e.value)}G(e,a.UnexpectedToken,e.value)}function K(e){var n=U();n.type===t.Punctuator&&n.value===e||$(n)}function Z(e){var n=U();n.type===t.Keyword&&n.value===e||$(n)}function Q(e){return m.type===t.Punctuator&&m.value===e}function J(e){return m.type===t.Keyword&&m.value===e}function ee(){var e,n=f,r=h,i=p,o=m;if(59===c.charCodeAt(f)||Q(";"))U();else{if(e=h,I(),h!==e)return f=n,h=r,p=i,void(m=o);m.type===t.EOF||Q("}")||$(m)}}function te(e){return e.type===i.Identifier||e.type===i.MemberExpression}function ne(e,t){var n,r,i;return n=l,i=m,r=Me(),t&&l&&j(e[0].name)&&W(t,a.StrictParamName),l=n,g.markEnd(g.createFunctionExpression(null,e,[],r),i)}function re(){var e,n;return n=m,(e=U()).type===t.StringLiteral||e.type===t.NumericLiteral?(l&&e.octal&&W(e,a.StrictOctalLiteral),g.markEnd(g.createLiteral(e),n)):g.markEnd(g.createIdentifier(e.value),n)}function ie(){var e,n,r,i,o,s;return s=m,(e=m).type===t.Identifier?(r=re(),"get"!==e.value||Q(":")?"set"!==e.value||Q(":")?(K(":"),i=ge(),g.markEnd(g.createProperty("init",r,i),s)):(n=re(),K("("),(e=m).type!==t.Identifier?(K(")"),W(e,a.UnexpectedToken,e.value),i=ne([])):(o=[ye()],K(")"),i=ne(o,e)),g.markEnd(g.createProperty("set",n,i),s)):(n=re(),K("("),K(")"),i=ne([]),g.markEnd(g.createProperty("get",n,i),s))):e.type!==t.EOF&&e.type!==t.Punctuator?(n=re(),K(":"),i=ge(),g.markEnd(g.createProperty("init",n,i),s)):void $(e)}function oe(){var e,n,r,s;if(Q("("))return function(){var e;return K("("),e=me(),K(")"),e}();if(Q("["))return function(){var e,t=[];for(e=m,K("[");!Q("]");)Q(",")?(U(),t.push(null)):(t.push(ge()),Q("]")||K(","));return U(),g.markEnd(g.createArrayExpression(t),e)}();if(Q("{"))return function(){var e,t,n,r,s,u=[],c={},f=String;for(s=m,K("{");!Q("}");)t=(e=ie()).key.type===i.Identifier?e.key.name:f(e.key.value),r="init"===e.kind?o.Data:"get"===e.kind?o.Get:o.Set,n="$"+t,Object.prototype.hasOwnProperty.call(c,n)?(c[n]===o.Data?l&&r===o.Data?W({},a.StrictDuplicateProperty):r!==o.Data&&W({},a.AccessorDataProperty):r===o.Data?W({},a.AccessorDataProperty):c[n]&r&&W({},a.AccessorGetSet),c[n]|=r):c[n]=r,u.push(e),Q("}")||K(",");return K("}"),g.markEnd(g.createObjectExpression(u),s)}();if(e=m.type,s=m,e===t.Identifier)r=g.createIdentifier(U().value);else if(e===t.StringLiteral||e===t.NumericLiteral)l&&m.octal&&W(m,a.StrictOctalLiteral),r=g.createLiteral(U());else if(e===t.Keyword){if(J("function"))return function(){var e,t,n,r,i,o,s,u,c,f=null;return c=m,Z("function"),Q("(")||(e=m,f=ye(),l?j(e.value)&&W(e,a.StrictFunctionName):j(e.value)?(n=e,r=a.StrictFunctionName):A(e.value)&&(n=e,r=a.StrictReservedWord)),i=Oe(n),o=i.params,t=i.stricted,n=i.firstRestricted,i.message&&(r=i.message),u=l,s=Me(),l&&n&&G(n,r),l&&t&&W(t,r),l=u,g.markEnd(g.createFunctionExpression(f,o,[],s),c)}();J("this")?(U(),r=g.createThisExpression()):$(U())}else e===t.BooleanLiteral?((n=U()).value="true"===n.value,r=g.createLiteral(n)):e===t.NullLiteral?((n=U()).value=null,r=g.createLiteral(n)):Q("/")||Q("/=")?(r=void 0!==y.tokens?g.createLiteral(z()):g.createLiteral(D()),Y()):$(U());return g.markEnd(r,s)}function ae(){var e=[];if(K("("),!Q(")"))for(;f<d&&(e.push(ge()),!Q(")"));)K(",");return K(")"),e}function se(){var e,n;return n=m,function(e){return e.type===t.Identifier||e.type===t.Keyword||e.type===t.BooleanLiteral||e.type===t.NullLiteral}(e=U())||$(e),g.markEnd(g.createIdentifier(e.value),n)}function ue(){return K("."),se()}function ce(){var e;return K("["),e=me(),K("]"),e}function le(){var e,t,n;return n=m,Z("new"),e=function(){var e,t,n;for(b(v.allowIn,"callee of new expression always allow in keyword."),n=m,e=J("new")?le():oe();Q(".")||Q("[");)Q("[")?(t=ce(),e=g.createMemberExpression("[",e,t)):(t=ue(),e=g.createMemberExpression(".",e,t)),g.markEnd(e,n);return e}(),t=Q("(")?ae():[],g.markEnd(g.createNewExpression(e,t),n)}function fe(){var e,n,r=m;return e=function(){var e,t,n,r,i=v.allowIn;for(r=m,v.allowIn=!0,e=J("new")?le():oe();;){if(Q("."))n=ue(),e=g.createMemberExpression(".",e,n);else if(Q("("))t=ae(),e=g.createCallExpression(e,t);else{if(!Q("["))break;n=ce(),e=g.createMemberExpression("[",e,n)}g.markEnd(e,r)}return v.allowIn=i,e}(),m.type===t.Punctuator&&(!Q("++")&&!Q("--")||H()||(l&&e.type===i.Identifier&&j(e.name)&&W({},a.StrictLHSPostfix),te(e)||W({},a.InvalidLHSInAssignment),n=U(),e=g.markEnd(g.createPostfixExpression(n.value,e),r))),e}function he(){var e,n,r;return m.type!==t.Punctuator&&m.type!==t.Keyword?n=fe():Q("++")||Q("--")?(r=m,e=U(),n=he(),l&&n.type===i.Identifier&&j(n.name)&&W({},a.StrictLHSPrefix),te(n)||W({},a.InvalidLHSInAssignment),n=g.createUnaryExpression(e.value,n),n=g.markEnd(n,r)):Q("+")||Q("-")||Q("~")||Q("!")?(r=m,e=U(),n=he(),n=g.createUnaryExpression(e.value,n),n=g.markEnd(n,r)):J("delete")||J("void")||J("typeof")?(r=m,e=U(),n=he(),n=g.createUnaryExpression(e.value,n),n=g.markEnd(n,r),l&&"delete"===n.operator&&n.argument.type===i.Identifier&&W({},a.StrictDelete)):n=fe(),n}function pe(e,n){var r=0;if(e.type!==t.Punctuator&&e.type!==t.Keyword)return 0;switch(e.value){case"||":r=1;break;case"&&":r=2;break;case"|":r=3;break;case"^":r=4;break;case"&":r=5;break;case"==":case"!=":case"===":case"!==":r=6;break;case"<":case">":case"<=":case">=":case"instanceof":r=7;break;case"in":r=n?7:0;break;case"<<":case">>":case">>>":r=8;break;case"+":case"-":r=9;break;case"*":case"/":case"%":r=11}return r}function de(){var e,t,n,r,i;return i=m,e=function(){var e,t,n,r,i,o,a,s,u,c;if(e=m,u=he(),0===(i=pe(r=m,v.allowIn)))return u;for(r.prec=i,U(),t=[e,m],o=[u,r,a=he()];(i=pe(m,v.allowIn))>0;){for(;o.length>2&&i<=o[o.length-2].prec;)a=o.pop(),s=o.pop().value,u=o.pop(),n=g.createBinaryExpression(s,u,a),t.pop(),e=t[t.length-1],g.markEnd(n,e),o.push(n);(r=U()).prec=i,o.push(r),t.push(m),n=he(),o.push(n)}for(n=o[c=o.length-1],t.pop();c>1;)n=g.createBinaryExpression(o[c-1].value,o[c-2],n),c-=2,e=t.pop(),g.markEnd(n,e);return n}(),Q("?")&&(U(),t=v.allowIn,v.allowIn=!0,n=ge(),v.allowIn=t,K(":"),r=ge(),e=g.createConditionalExpression(e,n,r),g.markEnd(e,i)),e}function ge(){var e,n,r,o,s,u;return e=m,s=m,o=n=de(),m.type!==t.Punctuator||"="!==(u=m.value)&&"*="!==u&&"/="!==u&&"%="!==u&&"+="!==u&&"-="!==u&&"<<="!==u&&">>="!==u&&">>>="!==u&&"&="!==u&&"^="!==u&&"|="!==u||(te(n)||W({},a.InvalidLHSInAssignment),l&&n.type===i.Identifier&&j(n.name)&&W(e,a.StrictLHSAssignment),e=U(),r=ge(),o=g.markEnd(g.createAssignmentExpression(e.value,n,r),s)),o}function me(){var e,t=m;if(e=ge(),Q(",")){for(e=g.createSequenceExpression([e]);f<d&&Q(",");)U(),e.expressions.push(ge());g.markEnd(e,t)}return e}function ve(){var e,t;return t=m,K("{"),e=function(){for(var e,t=[];f<d&&!Q("}")&&void 0!==(e=je());)t.push(e);return t}(),K("}"),g.markEnd(g.createBlockStatement(e),t)}function ye(){var e,n;return n=m,(e=U()).type!==t.Identifier&&$(e),g.markEnd(g.createIdentifier(e.value),n)}function be(e){var t,n,r=null;return n=m,t=ye(),l&&j(t.name)&&W({},a.StrictVarName),"const"===e?(K("="),r=ge()):Q("=")&&(U(),r=ge()),g.markEnd(g.createVariableDeclarator(t,r),n)}function we(e){var t=[];do{if(t.push(be(e)),!Q(","))break;U()}while(f<d);return t}function xe(){var e,t,n,r,i,o,s,u,c,l,f=v.allowIn;return e=t=n=null,Z("for"),K("("),Q(";")?U():(J("var")||J("let")?(v.allowIn=!1,l=m,u=U(),c=we(),e=g.markEnd(g.createVariableDeclaration(c,u.value),l),v.allowIn=f,1===e.declarations.length&&J("in")&&(U(),r=e,i=me(),e=null)):(v.allowIn=!1,e=me(),v.allowIn=f,J("in")&&(te(e)||W({},a.InvalidLHSInForIn),U(),r=e,i=me(),e=null)),void 0===r&&K(";")),void 0===r&&(Q(";")||(t=me()),K(";"),Q(")")||(n=me())),K(")"),s=v.inIteration,v.inIteration=!0,o=ke(),v.inIteration=s,void 0===r?g.createForStatement(e,t,n,o):g.createForInStatement(r,i,o)}function Se(){var e,t,n,r=[];for(n=m,J("default")?(U(),e=null):(Z("case"),e=me()),K(":");f<d&&!(Q("}")||J("default")||J("case"));)t=ke(),r.push(t);return g.markEnd(g.createSwitchCase(e,r),n)}function Ee(){var e,t,n,r,i=[],o=null;return Z("try"),e=ve(),J("catch")&&i.push((r=m,Z("catch"),K("("),Q(")")&&$(m),t=ye(),l&&j(t.name)&&W({},a.StrictCatchVariable),K(")"),n=ve(),g.markEnd(g.createCatchClause(t,n),r))),J("finally")&&(U(),o=ve()),0!==i.length||o||G({},a.NoCatchOrFinally),g.createTryStatement(e,[],i,o)}function ke(){var e,n,r,o,s,u,h,p,y,b=m.type;if(b===t.EOF&&$(m),b===t.Punctuator&&"{"===m.value)return ve();if(o=m,b===t.Punctuator)switch(m.value){case";":return g.markEnd((K(";"),g.createEmptyStatement()),o);case"(":return g.markEnd(function(){var e=me();return ee(),g.createExpressionStatement(e)}(),o)}if(b===t.Keyword)switch(m.value){case"break":return g.markEnd(function(){var e,n=null;return Z("break"),59===c.charCodeAt(f)?(U(),v.inIteration||v.inSwitch||G({},a.IllegalBreak),g.createBreakStatement(null)):H()?(v.inIteration||v.inSwitch||G({},a.IllegalBreak),g.createBreakStatement(null)):(m.type===t.Identifier&&(e="$"+(n=ye()).name,Object.prototype.hasOwnProperty.call(v.labelSet,e)||G({},a.UnknownLabel,n.name)),ee(),null!==n||v.inIteration||v.inSwitch||G({},a.IllegalBreak),g.createBreakStatement(n))}(),o);case"continue":return g.markEnd(function(){var e,n=null;return Z("continue"),59===c.charCodeAt(f)?(U(),v.inIteration||G({},a.IllegalContinue),g.createContinueStatement(null)):H()?(v.inIteration||G({},a.IllegalContinue),g.createContinueStatement(null)):(m.type===t.Identifier&&(e="$"+(n=ye()).name,Object.prototype.hasOwnProperty.call(v.labelSet,e)||G({},a.UnknownLabel,n.name)),ee(),null!==n||v.inIteration||G({},a.IllegalContinue),g.createContinueStatement(n))}(),o);case"debugger":return g.markEnd((Z("debugger"),ee(),g.createDebuggerStatement()),o);case"do":return g.markEnd((Z("do"),y=v.inIteration,v.inIteration=!0,h=ke(),v.inIteration=y,Z("while"),K("("),p=me(),K(")"),Q(";")&&U(),g.createDoWhileStatement(h,p)),o);case"for":return g.markEnd(xe(),o);case"function":return g.markEnd(Ae(),o);case"if":return g.markEnd(function(){var e,t,n;return Z("if"),K("("),e=me(),K(")"),t=ke(),J("else")?(U(),n=ke()):n=null,g.createIfStatement(e,t,n)}(),o);case"return":return g.markEnd((u=null,Z("return"),v.inFunctionBody||W({},a.IllegalReturn),32===c.charCodeAt(f)&&M(c.charCodeAt(f+1))?(u=me(),ee(),g.createReturnStatement(u)):H()?g.createReturnStatement(null):(Q(";")||Q("}")||m.type===t.EOF||(u=me()),ee(),g.createReturnStatement(u))),o);case"switch":return g.markEnd(function(){var e,t,n,r,i;if(Z("switch"),K("("),e=me(),K(")"),K("{"),t=[],Q("}"))return U(),g.createSwitchStatement(e,t);for(r=v.inSwitch,v.inSwitch=!0,i=!1;f<d&&!Q("}");)null===(n=Se()).test&&(i&&G({},a.MultipleDefaultsInSwitch),i=!0),t.push(n);return v.inSwitch=r,K("}"),g.createSwitchStatement(e,t)}(),o);case"throw":return g.markEnd(function(){var e;return Z("throw"),H()&&G({},a.NewlineAfterThrow),e=me(),ee(),g.createThrowStatement(e)}(),o);case"try":return g.markEnd(Ee(),o);case"var":return g.markEnd((Z("var"),s=we(),ee(),g.createVariableDeclaration(s,"var")),o);case"while":return g.markEnd(function(){var e,t,n;return Z("while"),K("("),e=me(),K(")"),n=v.inIteration,v.inIteration=!0,t=ke(),v.inIteration=n,g.createWhileStatement(e,t)}(),o);case"with":return g.markEnd(function(){var e,t;return l&&(I(),W({},a.StrictModeWith)),Z("with"),K("("),e=me(),K(")"),t=ke(),g.createWithStatement(e,t)}(),o)}return(e=me()).type===i.Identifier&&Q(":")?(U(),r="$"+e.name,Object.prototype.hasOwnProperty.call(v.labelSet,r)&&G({},a.Redeclaration,"Label",e.name),v.labelSet[r]=!0,n=ke(),delete v.labelSet[r],g.markEnd(g.createLabeledStatement(e,n),o)):(ee(),g.markEnd(g.createExpressionStatement(e),o))}function Me(){var e,n,r,o,s,u,h,p,y=[];for(p=m,K("{");f<d&&m.type===t.StringLiteral&&(n=m,e=je(),y.push(e),e.expression.type===i.Literal);)"use strict"===c.slice(n.start+1,n.end-1)?(l=!0,r&&W(r,a.StrictOctalLiteral)):!r&&n.octal&&(r=n);for(o=v.labelSet,s=v.inIteration,u=v.inSwitch,h=v.inFunctionBody,v.labelSet={},v.inIteration=!1,v.inSwitch=!1,v.inFunctionBody=!0;f<d&&!Q("}")&&void 0!==(e=je());)y.push(e);return K("}"),v.labelSet=o,v.inIteration=s,v.inSwitch=u,v.inFunctionBody=h,g.markEnd(g.createBlockStatement(y),p)}function Oe(e){var t,n,r,i,o,s,u=[];if(K("("),!Q(")"))for(i={};f<d&&(n=m,t=ye(),o="$"+n.value,l?(j(n.value)&&(r=n,s=a.StrictParamName),Object.prototype.hasOwnProperty.call(i,o)&&(r=n,s=a.StrictParamDupe)):e||(j(n.value)?(e=n,s=a.StrictParamName):A(n.value)?(e=n,s=a.StrictReservedWord):Object.prototype.hasOwnProperty.call(i,o)&&(e=n,s=a.StrictParamDupe)),u.push(t),i[o]=!0,!Q(")"));)K(",");return K(")"),{params:u,stricted:r,firstRestricted:e,message:s}}function Ae(){var e,t,n,r,i,o,s,u,c,f;return f=m,Z("function"),r=m,e=ye(),l?j(r.value)&&W(r,a.StrictFunctionName):j(r.value)?(s=r,u=a.StrictFunctionName):A(r.value)&&(s=r,u=a.StrictReservedWord),t=(o=Oe(s)).params,i=o.stricted,s=o.firstRestricted,o.message&&(u=o.message),c=l,n=Me(),l&&s&&G(s,u),l&&i&&W(i,u),l=c,g.markEnd(g.createFunctionDeclaration(e,t,[],n),f)}function je(){if(m.type===t.Keyword)switch(m.value){case"const":case"let":return e=m.value,r=m,Z(e),n=we(e),ee(),g.markEnd(g.createVariableDeclaration(n,e),r);case"function":return Ae();default:return ke()}var e,n,r;if(m.type!==t.EOF)return ke()}function Pe(){var e,n;return I(),Y(),n=m,l=!1,e=function(){for(var e,n,r,o=[];f<d&&(n=m).type===t.StringLiteral&&(e=je(),o.push(e),e.expression.type===i.Literal);)"use strict"===c.slice(n.start+1,n.end-1)?(l=!0,r&&W(r,a.StrictOctalLiteral)):!r&&n.octal&&(r=n);for(;f<d&&void 0!==(e=je());)o.push(e);return o}(),g.markEnd(g.createProgram(e),n)}function Ce(){var e,t,n,r=[];for(e=0;e<y.tokens.length;++e)n={type:(t=y.tokens[e]).type,value:t.value},y.range&&(n.range=t.range),y.loc&&(n.loc=t.loc),r.push(n);y.tokens=r}(n={})[(t={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9}).BooleanLiteral]="Boolean",n[t.EOF]="<end>",n[t.Identifier]="Identifier",n[t.Keyword]="Keyword",n[t.NullLiteral]="Null",n[t.NumericLiteral]="Numeric",n[t.Punctuator]="Punctuator",n[t.StringLiteral]="String",n[t.RegularExpression]="RegularExpression",r=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="],i={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"},o={Data:1,Get:2,Set:4},a={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},s={NonAsciiIdentifierStart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),NonAsciiIdentifierPart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]")},u={name:"SyntaxTree",processComment:function(e){var t,n;if(!(e.type===i.Program&&e.body.length>0)){for(y.trailingComments.length>0?y.trailingComments[0].range[0]>=e.range[1]?(n=y.trailingComments,y.trailingComments=[]):y.trailingComments.length=0:y.bottomRightStack.length>0&&y.bottomRightStack[y.bottomRightStack.length-1].trailingComments&&y.bottomRightStack[y.bottomRightStack.length-1].trailingComments[0].range[0]>=e.range[1]&&(n=y.bottomRightStack[y.bottomRightStack.length-1].trailingComments,delete y.bottomRightStack[y.bottomRightStack.length-1].trailingComments);y.bottomRightStack.length>0&&y.bottomRightStack[y.bottomRightStack.length-1].range[0]>=e.range[0];)t=y.bottomRightStack.pop();t?t.leadingComments&&t.leadingComments[t.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=t.leadingComments,delete t.leadingComments):y.leadingComments.length>0&&y.leadingComments[y.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=y.leadingComments,y.leadingComments=[]),n&&(e.trailingComments=n),y.bottomRightStack.push(e)}},markEnd:function(e,t){return y.range&&(e.range=[t.start,f]),y.loc&&(e.loc=new q(void 0===t.startLineNumber?t.lineNumber:t.startLineNumber,t.start-(void 0===t.startLineStart?t.lineStart:t.startLineStart),h,f-p),this.postProcess(e)),y.attachComment&&this.processComment(e),e},postProcess:function(e){return y.source&&(e.loc.source=y.source),e},createArrayExpression:function(e){return{type:i.ArrayExpression,elements:e}},createAssignmentExpression:function(e,t,n){return{type:i.AssignmentExpression,operator:e,left:t,right:n}},createBinaryExpression:function(e,t,n){return{type:"||"===e||"&&"===e?i.LogicalExpression:i.BinaryExpression,operator:e,left:t,right:n}},createBlockStatement:function(e){return{type:i.BlockStatement,body:e}},createBreakStatement:function(e){return{type:i.BreakStatement,label:e}},createCallExpression:function(e,t){return{type:i.CallExpression,callee:e,arguments:t}},createCatchClause:function(e,t){return{type:i.CatchClause,param:e,body:t}},createConditionalExpression:function(e,t,n){return{type:i.ConditionalExpression,test:e,consequent:t,alternate:n}},createContinueStatement:function(e){return{type:i.ContinueStatement,label:e}},createDebuggerStatement:function(){return{type:i.DebuggerStatement}},createDoWhileStatement:function(e,t){return{type:i.DoWhileStatement,body:e,test:t}},createEmptyStatement:function(){return{type:i.EmptyStatement}},createExpressionStatement:function(e){return{type:i.ExpressionStatement,expression:e}},createForStatement:function(e,t,n,r){return{type:i.ForStatement,init:e,test:t,update:n,body:r}},createForInStatement:function(e,t,n){return{type:i.ForInStatement,left:e,right:t,body:n,each:!1}},createFunctionDeclaration:function(e,t,n,r){return{type:i.FunctionDeclaration,id:e,params:t,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createFunctionExpression:function(e,t,n,r){return{type:i.FunctionExpression,id:e,params:t,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createIdentifier:function(e){return{type:i.Identifier,name:e}},createIfStatement:function(e,t,n){return{type:i.IfStatement,test:e,consequent:t,alternate:n}},createLabeledStatement:function(e,t){return{type:i.LabeledStatement,label:e,body:t}},createLiteral:function(e){return{type:i.Literal,value:e.value,raw:c.slice(e.start,e.end)}},createMemberExpression:function(e,t,n){return{type:i.MemberExpression,computed:"["===e,object:t,property:n}},createNewExpression:function(e,t){return{type:i.NewExpression,callee:e,arguments:t}},createObjectExpression:function(e){return{type:i.ObjectExpression,properties:e}},createPostfixExpression:function(e,t){return{type:i.UpdateExpression,operator:e,argument:t,prefix:!1}},createProgram:function(e){return{type:i.Program,body:e}},createProperty:function(e,t,n){return{type:i.Property,key:t,value:n,kind:e}},createReturnStatement:function(e){return{type:i.ReturnStatement,argument:e}},createSequenceExpression:function(e){return{type:i.SequenceExpression,expressions:e}},createSwitchCase:function(e,t){return{type:i.SwitchCase,test:e,consequent:t}},createSwitchStatement:function(e,t){return{type:i.SwitchStatement,discriminant:e,cases:t}},createThisExpression:function(){return{type:i.ThisExpression}},createThrowStatement:function(e){return{type:i.ThrowStatement,argument:e}},createTryStatement:function(e,t,n,r){return{type:i.TryStatement,block:e,guardedHandlers:t,handlers:n,finalizer:r}},createUnaryExpression:function(e,t){return"++"===e||"--"===e?{type:i.UpdateExpression,operator:e,argument:t,prefix:!0}:{type:i.UnaryExpression,operator:e,argument:t,prefix:!0}},createVariableDeclaration:function(e,t){return{type:i.VariableDeclaration,declarations:e,kind:t}},createVariableDeclarator:function(e,t){return{type:i.VariableDeclarator,id:e,init:t}},createWhileStatement:function(e,t){return{type:i.WhileStatement,test:e,body:t}},createWithStatement:function(e,t){return{type:i.WithStatement,object:e,body:t}}},e.version="1.2.5",e.tokenize=function(e,n){var r;"string"==typeof e||e instanceof String||(e=String(e)),g=u,f=0,h=(c=e).length>0?1:0,p=0,d=c.length,m=null,v={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},y={},(n=n||{}).tokens=!0,y.tokens=[],y.tokenize=!0,y.openParenToken=-1,y.openCurlyToken=-1,y.range="boolean"==typeof n.range&&n.range,y.loc="boolean"==typeof n.loc&&n.loc,"boolean"==typeof n.comment&&n.comment&&(y.comments=[]),"boolean"==typeof n.tolerant&&n.tolerant&&(y.errors=[]);try{if(Y(),m.type===t.EOF)return y.tokens;for(U();m.type!==t.EOF;)try{U()}catch(e){if(y.errors){y.errors.push(e);break}throw e}Ce(),r=y.tokens,void 0!==y.comments&&(r.comments=y.comments),void 0!==y.errors&&(r.errors=y.errors)}catch(e){throw e}finally{y={}}return r},e.parse=function(e,t){var n,r;r=String,"string"==typeof e||e instanceof String||(e=r(e)),g=u,f=0,h=(c=e).length>0?1:0,p=0,d=c.length,m=null,v={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},y={},void 0!==t&&(y.range="boolean"==typeof t.range&&t.range,y.loc="boolean"==typeof t.loc&&t.loc,y.attachComment="boolean"==typeof t.attachComment&&t.attachComment,y.loc&&null!==t.source&&void 0!==t.source&&(y.source=r(t.source)),"boolean"==typeof t.tokens&&t.tokens&&(y.tokens=[]),"boolean"==typeof t.comment&&t.comment&&(y.comments=[]),"boolean"==typeof t.tolerant&&t.tolerant&&(y.errors=[]),y.attachComment&&(y.range=!0,y.comments=[],y.bottomRightStack=[],y.trailingComments=[],y.leadingComments=[]));try{n=Pe(),void 0!==y.comments&&(n.comments=y.comments),void 0!==y.tokens&&(Ce(),n.tokens=y.tokens),void 0!==y.errors&&(n.errors=y.errors)}catch(e){throw e}finally{y={}}return n},e.Syntax=function(){var e,t={};for(e in"function"==typeof Object.create&&(t=Object.create(null)),i)i.hasOwnProperty(e)&&(t[e]=i[e]);return"function"==typeof Object.freeze&&Object.freeze(t),t}()}(t)})),Nt=0;function Dt(e,t,n){this.name=e,this.lvalue=t,this.rvalue=n,this.count=0}function zt(e,t,n,r){this.body=e,this.args=t,this.thisVars=n,this.localVars=r}var Ft=function(e){for(var t=["(",e,")()"].join(""),n=Bt.parse(t,{range:!0}),r="_inline_"+Nt+++"_",o=function(e){for(var t=e.body[0].expression.callee.params,n=new Array(t.length),r=0;r<t.length;++r)n[r]=t[r].name;return n}(n),a=new Array(o.length),s=0;s<o.length;++s)a[s]=new Dt([r,"arg",s,"_"].join(""),!1,!1);for(var u=new Array(t.length),c=(s=0,t.length);s<c;++s)u[s]=t.charAt(s);var l,f=[],h=[];function p(e,t){for(var n=e.range[0],r=e.range[1],i=n+1;i<r;++i)u[i]="";u[n]=t}return function e(t,n){if(t.parent=n,"MemberExpression"===t.type)t.computed?(e(t.object,t),e(t.property,t)):"ThisExpression"===t.object.type?p(t,(b=t.property.name,w="this_"+b.replace(/\_/g,"__"),h.push(w),w)):e(t.object,t);else{if("ThisExpression"===t.type)throw new Error("cwise-parser: Computed this is not allowed");if("Identifier"===t.type){var s=t.name,u=o.indexOf(s);if(u>=0){var c=a[u],l=function(e){return"AssignmentExpression"===e.parent.type&&e.parent.left===e?"="===e.parent.operator?1:3:"UpdateExpression"===e.parent.type?3:2}(t);1&l&&(c.lvalue=!0),2&l&&(c.rvalue=!0),++c.count,p(t,c.name)}else(function(e){if("eval"===e)throw new Error("cwise-parser: eval() not allowed");return"undefined"!=typeof window?e in window:void 0!==i?e in i:"undefined"!=typeof self&&e in self})(s)||p(t,function(e){var t=r+e.replace(/\_/g,"__");return f.push(t),t}(s))}else if("Literal"===t.type)"string"==typeof t.value&&p(t,"'"+t.value.replace(/\_/g,"\\_").replace(/\'/g,"'")+"'");else{if("WithStatement"===t.type)throw new Error("cwise-parser: with() statements not allowed");for(var d=Object.keys(t),g=0,m=d.length;g<m;++g)if("parent"!==d[g]){var v=t[d[g]];if(v)if(v instanceof Array)for(var y=0;y<v.length;++y)v[y]&&"string"==typeof v[y].type&&e(v[y],t);else"string"==typeof v.type&&e(v,t)}}}var b,w}(n.body[0].expression.callee.body,void 0),At(f),At(h),new zt((l=n.body[0].expression.callee.body,u.slice(l.range[0],l.range[1]).join("")),a,h,f)},Vt=["args","body"],Ut=["pre","post","printCode","funcName","blockSize"];var Yt=function(e){for(var t in e)Vt.indexOf(t)<0&&Ut.indexOf(t)<0&&console.warn("cwise: Unknown argument '"+t+"' passed to expression compiler");for(var n=0;n<Vt.length;++n)if(!e[Vt[n]])throw new Error("cwise: Missing argument: "+Vt[n]);return Tt({args:e.args,pre:Ft(e.pre||function(){}),body:Ft(e.body),post:Ft(e.post||function(){}),debug:!!e.printCode,funcName:e.funcName||e.body.name||"cwise",blockSize:e.blockSize||64})};for(var Xt={add:function(e,t,n,r,i,o){Lt.add(e,n,i),Lt.add(t,r,o)},addeq:function(e,t,n,r){Lt.addeq(e,n),Lt.addeq(t,r)},adds:function(e,t,n,r,i,o){Lt.adds(e,n,i),Lt.adds(e,r,o)},addseq:function(e,t,n,r){Lt.addseq(e,n),Lt.addseq(t,r)},sub:function(e,t,n,r,i,o){Lt.sub(e,n,i),Lt.sub(t,r,o)},subeq:function(e,t,n,r){Lt.subeq(e,n),Lt.subeq(t,r)},subs:function(e,t,n,r,i,o){Lt.subs(e,n,i),Lt.subs(t,r,o)},subseq:function(e,t,n,r){Lt.subseq(e,n),Lt.subseq(t,r)},neg:function(e,t,n,r){Lt.neg(e,n),Lt.neg(t,r)},negeq:function(e,t){Lt.negeq(e),Lt.negeq(t)},conj:function(e,t,n,r){Lt.assign(e,n),Lt.neg(t,r)},conjeq:function(e,t){Lt.negeq(t)},mul:Yt({args:["array","array","array","array","array","array"],body:function(e,t,n,r,i,o){}}),muleq:Yt({args:["array","array","array","array"],body:function(e,t,n,r){}}),muls:Yt({args:["array","array","array","array","scalar","scalar"],pre:function(e,t,n,r,i,o){this.u=i+o,this.v=o-i},body:function(e,t,n,r,i,o){var a=n,s=i*(a+r);this.u,this.v}}),mulseq:Yt({args:["array","array","scalar","scalar"],pre:function(e,t,n,r){this.u=n+r,this.v=r-n},body:function(e,t,n,r){var i=e,o=n*(i+t);e=o-t*this.u,t=o+i*this.v}}),div:Yt({args:["array","array","array","array","array","array"],body:function(e,t,n,r,i,o){}}),diveq:Yt({args:["array","array","array","array"],body:function(e,t,n,r){}}),divs:Yt({args:["array","array","array","array","scalar","scalar"],pre:function(e,t,n,r,i,o){var a=i*i+o*o;i/=a,o/=-a,this.c=i,this.u=i+o,this.v=o-i},body:function(e,t,n,r,i,o){var a=n,s=r,u=this.c*(a+s);this.u,this.v}}),divseq:Yt({args:["array","array","scalar","scalar"],pre:function(e,t,n,r){var i=n*n+r*r;n/=i,r/=-i,this.c=n,this.u=n+r,this.v=r-n},body:function(e,t,n,r){var i=e,o=t,a=this.c*(i+o);e=a-o*this.u,t=a+i*this.v}}),recip:Yt({args:["array","array","array","array"],body:function(e,t,n,r){}}),recipeq:Yt({args:["array","array"],body:function(e,t){}}),exp:Yt({args:["array","array","array","array"],pre:function(){this.exp=Math.exp,this.cos=Math.cos,this.sin=Math.sin},body:function(e,t,n,r){var i=this.exp(n);this.cos(r),this.sin(r)}}),expeq:Yt({args:["array","array"],pre:function(){this.exp=Math.exp,this.cos=Math.cos,this.sin=Math.sin},body:function(e,t){var n=this.exp(e),r=out_ir;e=n*this.cos(r),this.sin(r)}}),mag:Yt({args:["array","array","array"],body:function(e,t,n){}}),abs:Yt({args:["array","array","array"],pre:function(){this.sqrt=Math.sqrt},body:function(e,t,n){this.sqrt(t*t+n*n)}}),arg:Lt.atan2},qt=function(e){var t=en(e),n=t[0],r=t[1];return 3*(n+r)/4-r},Ht=function(e){var t,n,r=en(e),i=r[0],o=r[1],a=new Kt(function(e,t,n){return 3*(t+n)/4-n}(0,i,o)),s=0,u=o>0?i-4:i;for(n=0;n<u;n+=4)t=$t[e.charCodeAt(n)]<<18|$t[e.charCodeAt(n+1)]<<12|$t[e.charCodeAt(n+2)]<<6|$t[e.charCodeAt(n+3)],a[s++]=t>>16&255,a[s++]=t>>8&255,a[s++]=255&t;2===o&&(t=$t[e.charCodeAt(n)]<<2|$t[e.charCodeAt(n+1)]>>4,a[s++]=255&t);1===o&&(t=$t[e.charCodeAt(n)]<<10|$t[e.charCodeAt(n+1)]<<4|$t[e.charCodeAt(n+2)]>>2,a[s++]=t>>8&255,a[s++]=255&t);return a},Gt=function(e){for(var t,n=e.length,r=n%3,i=[],o=0,a=n-r;o<a;o+=16383)i.push(tn(e,o,o+16383>a?a:o+16383));1===r?(t=e[n-1],i.push(Wt[t>>2]+Wt[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],i.push(Wt[t>>10]+Wt[t>>4&63]+Wt[t<<2&63]+"="));return i.join("")},Wt=[],$t=[],Kt="undefined"!=typeof Uint8Array?Uint8Array:Array,Zt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Qt=0,Jt=Zt.length;Qt<Jt;++Qt)Wt[Qt]=Zt[Qt],$t[Zt.charCodeAt(Qt)]=Qt;function en(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function tn(e,t,n){for(var r,i,o=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(Wt[(i=r)>>18&63]+Wt[i>>12&63]+Wt[i>>6&63]+Wt[63&i]);return o.join("")}$t["-".charCodeAt(0)]=62,$t["_".charCodeAt(0)]=63;var nn={byteLength:qt,toByteArray:Ht,fromByteArray:Gt},rn=function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,f=n?i-1:0,h=n?-1:1,p=e[t+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=s;l>0;o=256*o+e[t+f],f+=h,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+e[t+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=c}return(p?-1:1)*a*Math.pow(2,o-r)},on=function(e,t,n,r,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(a++,u/=2),a+f>=l?(s=0,a=l):a+f>=1?(s=(t*u-1)*Math.pow(2,i),a+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;e[n+p]=255&s,p+=d,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[n+p]=255&a,p+=d,a/=256,c-=8);e[n+p-d]|=128*g},an={}.toString,sn=Array.isArray||function(e){return"[object Array]"==an.call(e)},un=a((function(e,t){function n(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function r(e,t){if(n()<t)throw new RangeError("Invalid typed array length");return o.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=o.prototype:(null===e&&(e=new o(t)),e.length=t),e}function o(e,t,n){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(this,e)}return a(this,e,t,n)}function a(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);o.TYPED_ARRAY_SUPPORT?(e=t).__proto__=o.prototype:e=c(e,t);return e}(e,t,n,i):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!o.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|f(t,n),a=(e=r(e,i)).write(t,n);a!==i&&(e=e.slice(0,a));return e}(e,t,n):function(e,t){if(o.isBuffer(t)){var n=0|l(t.length);return 0===(e=r(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(i=t.length)!=i?r(e,0):c(e,t);if("Buffer"===t.type&&sn(t.data))return c(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t){if(s(t),e=r(e,t<0?0:0|l(t)),!o.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function c(e,t){var n=t.length<0?0:0|l(t.length);e=r(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function l(e){if(e>=n())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n().toString(16)+" bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return N(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return D(e).length;default:if(r)return N(e).length;t=(""+t).toLowerCase(),r=!0}}function h(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return O(this,t,n);case"utf8":case"utf-8":return E(this,t,n);case"ascii":return k(this,t,n);case"latin1":case"binary":return M(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function p(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function d(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=o.from(t,r)),o.isBuffer(t))return 0===t.length?-1:g(e,t,n,r,i);if("number"==typeof t)return t&=255,o.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):g(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function g(e,t,n,r,i){var o,a=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,n/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(o=n;o<s;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(n+u>s&&(n=s-u),o=n;o>=0;o--){for(var f=!0,h=0;h<u;h++)if(c(e,o+h)!==c(t,h)){f=!1;break}if(f)return o}return-1}function m(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function v(e,t,n,r){return z(N(t,e.length-n),e,n,r)}function y(e,t,n,r){return z(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function b(e,t,n,r){return y(e,t,n,r)}function w(e,t,n,r){return z(D(t),e,n,r)}function x(e,t,n,r){return z(function(e,t){for(var n,r,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function S(e,t,n){return 0===t&&n===e.length?nn.fromByteArray(e):nn.fromByteArray(e.slice(t,n))}function E(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,a,s,u,c=e[i],l=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(u=(15&c)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=f}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}t.Buffer=o,t.SlowBuffer=function(e){+e!=e&&(e=0);return o.alloc(+e)},t.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=void 0!==i.TYPED_ARRAY_SUPPORT?i.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=n(),o.poolSize=8192,o._augment=function(e){return e.__proto__=o.prototype,e},o.from=function(e,t,n){return a(null,e,t,n)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(e,t,n){return function(e,t,n,i){return s(t),t<=0?r(e,t):void 0!==n?"string"==typeof i?r(e,t).fill(n,i):r(e,t).fill(n):r(e,t)}(null,e,t,n)},o.allocUnsafe=function(e){return u(null,e)},o.allocUnsafeSlow=function(e){return u(null,e)},o.isBuffer=function(e){return!(null==e||!e._isBuffer)},o.compare=function(e,t){if(!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!sn(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=o.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var a=e[n];if(!o.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i),i+=a.length}return r},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},o.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?E(this,0,e):h.apply(this,arguments)},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},o.prototype.compare=function(e,t,n,r,i){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),u=Math.min(a,s),c=this.slice(r,i),l=e.slice(t,n),f=0;f<u;++f)if(c[f]!==l[f]){a=c[f],s=l[f];break}return a<s?-1:s<a?1:0},o.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},o.prototype.indexOf=function(e,t,n){return d(this,e,t,n,!0)},o.prototype.lastIndexOf=function(e,t,n){return d(this,e,t,n,!1)},o.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return m(this,e,t,n);case"utf8":case"utf-8":return v(this,e,t,n);case"ascii":return y(this,e,t,n);case"latin1":case"binary":return b(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function k(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function M(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function O(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=B(e[o]);return i}function A(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function j(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function P(e,t,n,r,i,a){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function C(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function _(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function I(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function R(e,t,n,r,i){return i||I(e,0,n,4),on(e,t,n,r,23,4),n+4}function T(e,t,n,r,i){return i||I(e,0,n,8),on(e,t,n,r,52,8),n+8}o.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),o.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=o.prototype;else{var i=t-e;n=new o(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+e]}return n},o.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||j(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},o.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||j(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},o.prototype.readUInt8=function(e,t){return t||j(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return t||j(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return t||j(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return t||j(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return t||j(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||j(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},o.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||j(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return t||j(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){t||j(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt16BE=function(e,t){t||j(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt32LE=function(e,t){return t||j(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return t||j(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return t||j(e,4,this.length),rn(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return t||j(e,4,this.length),rn(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return t||j(e,8,this.length),rn(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return t||j(e,8,this.length),rn(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||P(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},o.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||P(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},o.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,1,255,0),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):C(this,e,t,!0),t+2},o.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):C(this,e,t,!1),t+2},o.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):_(this,e,t,!0),t+4},o.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):_(this,e,t,!1),t+4},o.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);P(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},o.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);P(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,1,127,-128),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):C(this,e,t,!0),t+2},o.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):C(this,e,t,!1),t+2},o.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):_(this,e,t,!0),t+4},o.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):_(this,e,t,!1),t+4},o.prototype.writeFloatLE=function(e,t,n){return R(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return R(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return T(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return T(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(a<1e3||!o.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},o.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var s=o.isBuffer(e)?e:N(new o(e,r).toString()),u=s.length;for(a=0;a<n-t;++a)this[a+t]=s[a%u]}return this};var L=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function N(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function D(e){return nn.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(L,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}));var cn=function(e,t){switch(void 0===t&&(t=0),typeof e){case"number":if(e>0)return function(e,t){var n,r;for(n=new Array(e),r=0;r<e;++r)n[r]=t;return n}(0|e,t);break;case"object":if("number"==typeof e.length)return function e(t,n,r){var i=0|t[r];if(i<=0)return[];var o,a=new Array(i);if(r===t.length-1)for(o=0;o<i;++o)a[o]=n;else for(o=0;o<i;++o)a[o]=e(t,n,r+1);return a}(e,t,0)}return[]},ln=a((function(e,t){i.__TYPEDARRAY_POOL||(i.__TYPEDARRAY_POOL={UINT8:cn([32,0]),UINT16:cn([32,0]),UINT32:cn([32,0]),INT8:cn([32,0]),INT16:cn([32,0]),INT32:cn([32,0]),FLOAT:cn([32,0]),DOUBLE:cn([32,0]),DATA:cn([32,0]),UINT8C:cn([32,0]),BUFFER:cn([32,0])});var n="undefined"!=typeof Uint8ClampedArray,r=i.__TYPEDARRAY_POOL;r.UINT8C||(r.UINT8C=cn([32,0])),r.BUFFER||(r.BUFFER=cn([32,0]));var o=r.DATA,a=r.BUFFER;function s(e){if(e){var t=e.length||e.byteLength,n=mt(t);o[n].push(e)}}function u(e){e=vt(e);var t=mt(e),n=o[t];return n.length>0?n.pop():new ArrayBuffer(e)}function c(e){return new Uint8Array(u(e),0,e)}function l(e){return new Uint16Array(u(2*e),0,e)}function f(e){return new Uint32Array(u(4*e),0,e)}function h(e){return new Int8Array(u(e),0,e)}function p(e){return new Int16Array(u(2*e),0,e)}function d(e){return new Int32Array(u(4*e),0,e)}function g(e){return new Float32Array(u(4*e),0,e)}function m(e){return new Float64Array(u(8*e),0,e)}function v(e){return n?new Uint8ClampedArray(u(e),0,e):c(e)}function y(e){return new DataView(u(e),0,e)}function b(e){e=vt(e);var t=mt(e),n=a[t];return n.length>0?n.pop():new un.Buffer(e)}t.free=function(e){if(un.Buffer.isBuffer(e))a[mt(e.length)].push(e);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var t=e.length||e.byteLength,n=0|mt(t);o[n].push(e)}},t.freeUint8=t.freeUint16=t.freeUint32=t.freeInt8=t.freeInt16=t.freeInt32=t.freeFloat32=t.freeFloat=t.freeFloat64=t.freeDouble=t.freeUint8Clamped=t.freeDataView=function(e){s(e.buffer)},t.freeArrayBuffer=s,t.freeBuffer=function(e){a[mt(e.length)].push(e)},t.malloc=function(e,t){if(void 0===t||"arraybuffer"===t)return u(e);switch(t){case"uint8":return c(e);case"uint16":return l(e);case"uint32":return f(e);case"int8":return h(e);case"int16":return p(e);case"int32":return d(e);case"float":case"float32":return g(e);case"double":case"float64":return m(e);case"uint8_clamped":return v(e);case"buffer":return b(e);case"data":case"dataview":return y(e);default:return null}return null},t.mallocArrayBuffer=u,t.mallocUint8=c,t.mallocUint16=l,t.mallocUint32=f,t.mallocInt8=h,t.mallocInt16=p,t.mallocInt32=d,t.mallocFloat32=t.mallocFloat=g,t.mallocFloat64=t.mallocDouble=m,t.mallocUint8Clamped=v,t.mallocDataView=y,t.mallocBuffer=b,t.clearCache=function(){for(var e=0;e<32;++e)r.UINT8[e].length=0,r.UINT16[e].length=0,r.UINT32[e].length=0,r.INT8[e].length=0,r.INT16[e].length=0,r.INT32[e].length=0,r.FLOAT[e].length=0,r.DOUBLE[e].length=0,r.UINT8C[e].length=0,o[e].length=0,a[e].length=0}}));var fn=function(e,t,n,r,i,o,a){e|=0,t|=0,i|=0,o|=0,gt(n|=0)?pn(e,t,n,r,i,o):function(e,t,n,r,i,o,a){e|=0,t|=0,i|=0,o|=0,a|=0;var s,u,c,l,f,h,p,d,g,m=vt(2*(n|=0)+1),v=a,y=v+n,b=y+n,w=b+m,x=w+m,S=x+m,E=-e*Math.PI/n;for(g=0;g<n;++g)u=E*(g*g%(2*n)),l=Math.cos(u),f=Math.sin(u),r[x+(m-g)]=r[x+g]=r[v+g]=l,r[S+(m-g)]=r[S+g]=r[y+g]=f;for(g=n;g<=m-n;++g)r[x+g]=0;for(g=n;g<=m-n;++g)r[S+g]=0;pn(1,1,m,r,x,S),E=e<0?1/n:1;for(s=0;s<t;++s){for(g=0;g<n;++g)u=r[i+g],c=r[o+g],l=r[v+g],f=-r[y+g],h=l*(u+c),p=u*(f-l),d=c*(l+f),r[b+g]=h-d,r[w+g]=h+p;for(g=n;g<m;++g)r[b+g]=0;for(g=n;g<m;++g)r[w+g]=0;for(pn(1,1,m,r,b,w),g=0;g<m;++g)u=r[b+g],c=r[w+g],l=r[x+g],f=r[S+g],h=l*(u+c),p=u*(f-l),d=c*(l+f),r[b+g]=h-d,r[w+g]=h+p;for(pn(-1,1,m,r,b,w),g=0;g<n;++g)u=r[b+g],c=r[w+g],l=r[v+g],f=-r[y+g],h=l*(u+c),p=u*(f-l),d=c*(l+f),r[i+g]=E*(h-d),r[o+g]=E*(h+p);i+=n,o+=n}}(e,t,n,r,i,o,a)};var hn=function(e){return gt(e)?0:2*e+4*vt(2*e+1)};function pn(e,t,n,r,i,o){var a,s,u,c,l,f,h,p,d,g,m,v,y,b,w,x,S,E,k,M,O,A,j,P;for(e|=0,t|=0,i|=0,o|=0,s=mt(a=n|=0),E=0;E<t;++E){for(h=a>>1,l=0,u=0;u<a-1;u++){for(u<l&&(y=r[i+u],r[i+u]=r[i+l],r[i+l]=y,y=r[o+u],r[o+u]=r[o+l],r[o+l]=y),f=h;f<=l;)l-=f,f>>=1;l+=f}for(m=-1,v=0,g=1,p=0;p<s;p++){for(d=g,g<<=1,x=1,S=0,l=0;l<d;l++){for(u=l;u<a;u+=g)k=r[i+(c=u+d)],M=r[o+c],O=r[i+u],A=r[o+u],b=(j=x*(k+M))-M*(x+S),w=j+(P=k*(S-x)),r[i+c]=O-b,r[o+c]=A-w,r[i+u]+=b,r[o+u]+=w;P=x*(v-m),x=(j=m*(x+S))-S*(m+v),S=j+P}v=Math.sqrt((1-m)/2),e<0&&(v=-v),m=Math.sqrt((1+m)/2)}if(e<0){var C=1/a;for(u=0;u<a;u++)r[i+u]*=C,r[o+u]*=C}i+=n,o+=n}}fn.scratchMemory=hn;var dn=function(e,t,n){var r,i,o=t.shape,a=o.length,s=1,u=new Array(a),c=0;for(r=a-1;r>=0;--r)if(u[r]=s,s*=o[r],c=Math.max(c,fn.scratchMemory(o[r])),t.shape[r]!==n.shape[r])throw new Error("Shape mismatch, real and imaginary arrays must have same size");var l,f=4*s+c;l="array"===t.dtype||"float64"===t.dtype||"custom"===t.dtype?ln.mallocDouble(f):ln.mallocFloat(f);var h,p,d,g,m=Ot(l,o.slice(0),u,0),v=Ot(l,o.slice(0),u.slice(0),s),y=Ot(l,o.slice(0),u.slice(0),2*s),b=Ot(l,o.slice(0),u.slice(0),3*s),w=4*s;for(Lt.assign(m,t),Lt.assign(v,n),r=a-1;r>=0&&(fn(e,s/o[r],o[r],l,m.offset,v.offset,w),0!==r);--r){for(p=1,d=y.stride,g=b.stride,i=r-1;i<a;++i)g[i]=d[i]=p,p*=o[i];for(i=r-2;i>=0;--i)g[i]=d[i]=p,p*=o[i];Lt.assign(y,m),Lt.assign(b,v),h=m,m=y,y=h,h=v,v=b,b=h}Lt.assign(t,m),Lt.assign(n,v),ln.free(l)},gn=a((function(e){var t=Yt({args:["array","array","array","array"],body:function(e,t,n,r){}});function n(e,n,r,i,o,a,s,u){if(r.shape.length!==o.shape.length||e.shape.length!==r.shape.length)throw new Error("ndarray-convolve: Dimension mismatch");var c,l=r.shape.length,f=1,h=new Array(l),p=new Array(l);if(u)for(c=l-1;c>=0;--c)p[c]=r.shape[c],h[c]=f,f*=p[c];else for(c=l-1;c>=0;--c)p[c]=vt(r.shape[c]+o.shape[c]-1),h[c]=f,f*=p[c];var d=ln.mallocDouble(f),g=Ot(d,p,h,0);Lt.assigns(g,0),Lt.assign(g.hi.apply(g,r.shape),r);var m=ln.mallocDouble(f),v=Ot(m,p,h,0);Lt.assigns(v,0),i&&Lt.assign(v.hi.apply(v,i.shape),i),dn(1,g,v);var y=ln.mallocDouble(f),b=Ot(y,p,h,0);Lt.assigns(b,0),Lt.assign(b.hi.apply(b,o.shape),o);var w=ln.mallocDouble(f),x=Ot(w,p,h,0);Lt.assigns(x,0),a&&Lt.assign(x.hi.apply(v,a.shape),a),dn(1,b,x),s?t(g,v,b,x):Xt.muleq(g,v,b,x),dn(-1,g,v);var S,E,k=new Array(l),M=new Array(l),O=!1;for(c=0;c<l;++c)e.shape[c]>p[c]&&(O=!0),M[c]=u?0:Math.max(0,Math.min(p[c]-e.shape[c],Math.floor(o.shape[c]/2))),k[c]=Math.min(e.shape[c],p[c]-M[c]);O&&Lt.assign(e,0),S=(S=g.lo.apply(g,M)).hi.apply(S,k),Lt.assign(e.hi.apply(e,k),S),n&&(O&&Lt.assign(n,0),E=(E=v.lo.apply(v,M)).hi.apply(E,k),Lt.assign(n.hi.apply(n,k),E)),ln.freeDouble(d),ln.freeDouble(m),ln.freeDouble(y),ln.freeDouble(w)}e.exports=function(e,t,r,i,o,a){if(2===arguments.length)n(e,void 0,e,void 0,t,void 0,!1,!1);else if(3===arguments.length)n(e,void 0,t,void 0,r,void 0,!1,!1);else if(4===arguments.length)n(e,t,e,t,r,i,!1,!1);else{if(6!==arguments.length)throw new Error("ndarray-convolve: Invalid arguments for convolve");n(e,t,r,i,o,a,!1,!1)}return e},e.exports.wrap=function(e,t,r,i,o,a){if(2===arguments.length)n(e,void 0,e,void 0,t,void 0,!1,!0);else if(3===arguments.length)n(e,void 0,t,void 0,r,void 0,!1,!0);else if(4===arguments.length)n(e,t,e,t,r,i,!1,!0);else{if(6!==arguments.length)throw new Error("ndarray-convolve: Invalid arguments for convolve");n(e,t,r,i,o,a,!1,!0)}return e},e.exports.correlate=function(e,t,r,i,o,a){if(2===arguments.length)n(e,void 0,e,void 0,t,void 0,!0,!1);else if(3===arguments.length)n(e,void 0,t,void 0,r,void 0,!0,!1);else if(4===arguments.length)n(e,t,e,t,r,i,!0,!1);else{if(6!==arguments.length)throw new Error("ndarray-convolve: Invalid arguments for correlate");n(e,t,r,i,o,a,!0,!1)}return e},e.exports.correlate.wrap=function(e,t,r,i,o,a){if(2===arguments.length)n(e,void 0,e,void 0,t,void 0,!0,!0);else if(3===arguments.length)n(e,void 0,t,void 0,r,void 0,!0,!0);else if(4===arguments.length)n(e,t,e,t,r,i,!0,!0);else{if(6!==arguments.length)throw new Error("ndarray-convolve: Invalid arguments for correlate");n(e,t,r,i,o,a,!0,!0)}return e}})),mn=function(e,t){var n=new Set,r=[],i=!1,o=function(){r.forEach((function(e){return e.onDone()})),r=[]},a=ht((function(){var e=r.slice(0,100);r.splice(0,100),e.forEach((function(e){return e.onDone()}))}),50),s=D((function(){i=!0,n.forEach((function(e){e.update()&&r.push(e)})),e(),r.forEach((function(e){return n.delete(e)})),a()}),(function(){n.size?s():(o(),i&&t.publish("animationEnd"),i=!1)}));return{add:function(e){n.add(e),e.register(),s()},addBatch:function(e){e.forEach((function(e){n.add(e),e.register()})),s()},cancel:function(e){n.delete(e)}}},vn=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return Ue(e,{clone:function(){return e.constructor.apply(e,t)}})}},yn=function(e){var n;return e.isSprite?((n=new t.Sprite(e.texture)).interactive=e.interactive,n.x=e.x,n.y=e.y,n.anchor=e.anchor,n.width=e.width,n.height=e.height,n.angle=e.angle):e instanceof t.Mesh&&((n=new t.Mesh(e.geometry,e.shader,e.state)).interactive=e.interactive,n.x=e.x,n.y=e.y,n.anchor=e.anchor,n.width=e.width,n.height=e.height,n.angle=e.angle),n},bn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if("string"==typeof e||e instanceof String){if("#"===e[0])return[parseInt(e.substr(1),16),t];if("rgb"===e.substring(0,3)){var n=e.match(/(\d+),\s*(\d+),\s*(\d+),?\s*([\d.]+)?/);return[n.slice(1,4).map((function(e,t){return+e<<8*(2-t)})).reduce((function(e,t){return t+e}),0),Number.isNaN(+n[4])?1:+n[4]]}return[e.match(/(\d+),\s*(\d+),\s*(\d+)/).slice(1).map((function(e,t){return+e<<8*(2-t)})).reduce((function(e,t){return t+e}),0),t]}return[parseInt(e,10),t]};var wn=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function xn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Sn=function(e,t,n){return t&&xn(e.prototype,t),n&&xn(e,n),e},En=a((function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(n,r)}e.exports=t}));var kn=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&En(e,t)},Mn=a((function(e){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=t=function(e){return typeof e}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(n)}e.exports=t}));var On=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e};var An=function(e,t){return!t||"object"!==Mn(t)&&"function"!=typeof t?On(e):t},jn=a((function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(n)}e.exports=t}));function Pn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=jn(e);if(t){var i=jn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return An(this,n)}}var Cn=function(e){kn(n,e);var t=Pn(n);function n(e,r){var i;wn(this,n);var o=r||{},a=o.width,s=o.height,u=o.internalFormat,c=o.format,l=o.type;if(!(a&&s&&u&&c&&l))throw new Error("CustomBufferResource width, height, internalFormat, format, or type invalid");return(i=t.call(this,a,s)).data=e,i.internalFormat=u,i.format=c,i.type=l,i}return Sn(n,[{key:"upload",value:function(e,t,n){var r=e.gl;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1===t.alphaMode),n.width=t.width,n.height=t.height,r.texImage2D(t.target,0,r[this.internalFormat],t.width,t.height,0,r[this.format],r[this.type],this.data),!0}}]),n}(t.resources.Resource),_n=function(e,t){switch(t){case"Infinity":return 1/0;case"-Infinity":return-1/0;default:return t}},In=function(e){return JSON.parse(e,_n)},Rn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===e?t:e},Tn=function(e){for(var t=1/0,n=-1/0,r=1/0,i=-1/0,o=0;o<e.length;o+=2)t=e[o]<t?e[o]:t,n=e[o]>n?e[o]:n,r=e[o+1]<r?e[o+1]:r,i=e[o+1]>i?e[o+1]:i;return{minX:t,minY:r,maxX:n,maxY:i}},Ln=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return xe(e)?e(t,t.id,n):e},Bn=function(e,t){return xe(e)?e(t):e},Nn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e=new Set(e);var n=[],r=t.filter((function(t){return e.has(t)?(e.delete(t),!0):(n.push(t),!1)})),i=Array.from(e);return[i,n,r]},Dn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e},t=1,n=Math.log10(t),r=10,i=Math.log10(r),o=i-n,a=0,s=1,u=1,c=function(t){return Math.min(s,Math.max(a,s-(i-e(t))/o*u))};return c.domain=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(0===a.length)return[t,r];var s=y(a,2),u=s[0],l=s[1];return t=u,n=e(u),r=l,i=e(l),o=i-n||1,c},c.range=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(0===e.length)return[a,s];var t=y(e,2),n=t[0],r=t[1];return u=(s=r)-(a=n),c},c},zn=["left","center","right"],Fn=["top","center","bottom"],Vn=16777215,Un=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Yn={passive:!1},Xn={passive:!0},qn="inherit",Hn={property:function(e,t){return t},isCustom:!0},Gn=["auto","panZoom","scroll"],Wn=["#E69F00","#56B4E9","#009E73","#F0E442","#0072B2","#D55E00","#CC79A7"],$n={color:"#808080"},Kn=function(e){var t=["top","left"],n=we(e)?e[1]:e,r=we(e)?e[0]:e;return Fn.indexOf(r)>=0&&(t[0]=r),zn.indexOf(n)>=0&&(t[1]=n),t},Zn=function(e){var n,r=e;return r instanceof t.Texture||r instanceof t.Graphics||r instanceof t.Mesh||(r=Se(n=e)&&n.data&&(n.data.constructor===Float32Array||n.data.constructor===Uint8Array)&&n.shape?t.Texture.fromBuffer(e.data,e.shape[0],e.shape[1]):t.Texture.from(e)),r},Qn=function(e,t){return[e,t,0,1]},Jn=function(e,t){switch(t){case 1/0:return"Infinity";case-1/0:return"-Infinity";default:return t}},er=function(e){return JSON.stringify(e,Jn)},tr=function(e){return be(e).join("-")},nr=function(e){return Math.pow(2,e)},rr=t.BatchPluginFactory.create({fragment:"\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = vec4(color.rgb + (1.0 - color.rgb) * vColor.rgb * color.w, color.w);\n}\n"});t.Renderer.registerPlugin("brighten-tint",rr);var ir=t.BatchPluginFactory.create({fragment:"\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = vColor * vec4(color.a - color.rgb, color.a);\n}\n"});t.Renderer.registerPlugin("invert",ir);var or=function(e){return function(t){var n=0;return Ue(t,{brightness:function(t){if(n=t,0===t)e.tint=16777215,e.pluginName="batch";else{var r=parseInt(255*(t<0?1+t:t),10);e.tint=Re(new Array(3).fill().map((function(e,t){return r<<8*(2-t)}))),e.pluginName=t<0?"batch":"brighten-tint"}},invert:function(t){e.pluginName=t?"invert":"batch"},tint:function(t){if(0==+n){var r=null==t?16777215:bn(t,null)[0];e.tint=r}}})}},ar=function(e){return function(t){return Ue(t,{destroy:function(){e.destroy({baseTexture:!0,children:!0,texture:!0})}})}},sr=function(e,t,n){return function(r){return Ue(r,{scale:function(e){r.scaleFactor=e,r.scaleX(e),r.scaleY(e)},scaleX:function(n){r.scaleXFactor=n,e.width=t*n},scaleY:function(t){r.scaleYFactor=t,e.height=n*t}})}},ur=function(e,t,n){return function(r){return Ue(r,{get aspectRatio(){return e.width/e.height},get height(){return e.height},get center(){return[e.width/2,e.height/2]},get originalHeight(){return n},get size(){return Math.max(e.width,e.height)},get width(){return e.width},get originalWidth(){return t}})}},cr=function e(n){var r,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=o.anchor,s=void 0===a?[.5,.5]:a,u=Zn(n);u instanceof t.Texture?(i=(r=new t.Sprite(u)).anchor).set.apply(i,p(s)):r=u;return $e(Ke(e),et("displayObject",r),et("sprite",r),vn(u,{anchor:s}),or(r),sr(r,u.width,u.height),ur(r,u.width,u.height),ar(r))({})},lr=function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.backgroundFactory,o=r.fontSize,a=void 0===o?8:o,s=r.darkMode,u=void 0!==s&&s,c=r.onDestroy,l=void 0===c?at:c,f=new t.Container,h=n;if(!(n instanceof t.Texture)){var p=new t.Text(n,{fontFamily:"sans-serif",fontSize:a*window.devicePixelRatio,fill:16777215,align:"center"});p.updateText(),h=p.texture}var d,g=cr(h);i&&(d=i.create(),f.addChild(d)),f.addChild(g.displayObject),g.displayObject.width/=window.devicePixelRatio,g.displayObject.height/=window.devicePixelRatio;var m=!1,v=function(){return function(e){return Ue(e,{destroy:function(){m||(m=!0,l())}})}},y=function(e){g.invert(e),i.setColor(e?[1,1,1,1]:[0,0,0,1])};return y(u),$e(Ke(e),et("displayObject",f),et("background",d),et("image",g),vn(h,{backgroundFactory:i,fontSize:a,darkMode:u,onDestroy:l}),v())({setDarkMode:y})},fr=[0,0,0,1],hr=[0,0],pr=[.5,.5],dr="precision mediump float;\n// From PIXI\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\n\nattribute vec2 aVertexPosition;\n\nvarying vec2 vTexPos;\n\nvoid main() {\n  gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n  vTexPos = aVertexPosition;\n}\n",gr="precision mediump float;\nfloat udRoundBox(vec2 p, vec2 b, float r) {\n  return length(max(abs(p) - b, 0.0)) - r;\n}\n\nuniform vec2 uRectPos;\nuniform vec2 uRectSize;\nuniform vec4 uColor;\nuniform float uRounding;\nuniform float uSize;\n\nvarying vec2 vTexPos;\n\nvoid main() {\n  float texel = 1.0 / uSize;\n  float dist = udRoundBox(vTexPos - uRectPos, uRectSize, uRounding);\n\n  gl_FragColor = vec4(uColor.rgb, uColor.a * max(0.0, 1.0 - (dist * uSize * 2.0)));\n}",mr=new t.Geometry;mr.addAttribute("aVertexPosition",[-1,-1,1,-1,1,1,-1,1],2),mr.addIndex([0,1,2,0,3,2]);var vr,yr=new t.State,br=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.color,i=void 0===r?fr:r,o=n.rounding,a=void 0===o?.5:o,s=n.size,u=void 0===s?1:s,c={uColor:i,uRounding:a,uRectPos:hr,uRectSize:pr,uSize:u},l=new t.UniformGroup(c),f=t.Shader.from(dr,gr,l),h=function(){var e=new t.Mesh(mr,f,yr);return e.width=c.uSize/window.devicePixelRatio,e.height=c.uSize/window.devicePixelRatio,e},p=h(),d=function(e){c.uColor=e},g=function(){p.destroy(),c={}},m=function(e){c.uSize=e*window.devicePixelRatio};return $e(Ke(e))({create:h,destroy:g,setColor:d,setSize:m})},wr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fontSize,n=void 0===t?8:t,r=new Map,i={},o=br({size:n*window.devicePixelRatio*1.5}),a=function(e){return function(){i[e]=Math.max(0,i[e]-1),0===i[e]&&(r.get(e).image.destroy(),r.delete(e),delete i[e])}},s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=t.darkMode;if(r.has(e))return++i[e],r.get(e).clone();var u=lr(e,{backgroundFactory:o,darkMode:s,fontSize:n,onDestroy:a(e)});return i[e]=1,r.set(e,u),u},u=function(){r.forEach((function(e){return e.destroy()})),r.clear(),i={}};return{clear:u,create:s,destroy:u}},xr=function(){var e=document.createElement("style");document.head.appendChild(e);var t=e.sheet;return{addRule:function(e){var n=t.length;return t.insertRule(e,n),n},destroy:function(){document.head.removeChild(e)},removeRule:function(e){t.deleteRule(e)}}},Sr="pilingjs-breadcrumbs-button",Er=[".".concat(Sr," {\n  position: relative;\n  display: flex;\n  align-items: center;\n  line-height: 1em;\n  height: 2em;\n  margin-right: -0.25em;\n  padding: 0 0.5em 0 1em;\n  border-radius: 0 0.25em 0.25em 0;\n  text-color: black;\n  box-shadow: inset 0 0 0 1px #ccc;\n  background: white;\n}"),".pilingjs-darkmode .".concat(Sr," {\n  text-color: white;\n  box-shadow: inset 0 0 0 1px #333;\n  background: black;\n}"),"li:first-child .".concat(Sr," {\n  padding: 0.5em;\n  border-radius: 0.25em;\n}"),".".concat(Sr,":focus {\n  outline: none;\n}"),".".concat(Sr,".").concat(Sr,"-right-arrow {\n  position: relative;\n  display: block;\n  border-radius: 0;\n  border-left-color: #ccc;\n  background: #ccc;\n}"),".pilingjs-darkmode .".concat(Sr,".").concat(Sr,"-right-arrow {\n  border-left-color: #333;\n  background: #333;\n}"),".".concat(Sr,".").concat(Sr,"-right-arrow:hover, .pilingjs-darkmode .").concat(Sr,".").concat(Sr,"-right-arrow:hover {\n  color: black;\n  border-left-color: #ff7ff6;\n  box-shadow: inset 0 0 0 1px #ff7ff6;\n  background: #ff7ff6;\n}"),".".concat(Sr,".").concat(Sr,"-right-arrow:after {\n  left: 100%;\n  top: 50%;\n  border: solid transparent;\n  content: '';\n  height: 0;\n  width: 0;\n  position: absolute;\n  pointer-events: none;\n  border-color: rgba(0, 0, 0, 0);\n  border-left-color: inherit;\n  border-width: 0.5em;\n  margin-top: -0.5em;\n}")],kr=function e(t){var n=t.element,r=t.store,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=(i.darkMode,i.maxDepth),a=void 0===o?3:o,s=i.onEnter,u=void 0===s?at:s,c=i.onLeave,l=void 0===c?at:c,f=a,h=document.createElement("nav");h.className="pilingjs-breadcrumbs",h.style.position="absolute",h.style.top=0,h.style.left=0;var d=document.createElement("ol");d.className="pilingjs-breadcrumbs-list",d.style.display="flex",d.style.margin=0,d.style.padding=0,d.style.listStyle="none",h.appendChild(d);var g=xr();Er.forEach(g.addRule);var m=[],v=[],y=[],b=function(){We((function(e,t,n){t+1===n.length?(e.style.zIndex=1,e.className="".concat(Sr)):(e.style.zIndex=n.length-t,e.className="".concat(Sr," ").concat(Sr,"-right-arrow"))}))(d.querySelectorAll("button"))},w=function(){return y[y.length-1]},x=function(e){var t=r.state.piles;return e.flatMap((function(e){return t[e].items})).sort().join("-")},S=function(e){var t=r.export(),n=new Set;return e.forEach((function(e){t.piles[e].items.forEach((function(e){return n.add(e)}))})),Object.keys(t.piles).filter((function(e){return!n.has(e)})).forEach((function(e){t.piles[e].items=[]})),t},E=function(e){return Object.values(e.piles).filter((function(e){return e.items.length})).reduce((function(e,t){return e+t.items.length}),0)},k=function(e,t){var n=0===t?"Root":"".concat(t,". Level"),r=E(e);return"<li><button><span><strong>".concat(n,"</strong> (").concat(r,")</span></button></li>")},M=function(e){return function(){if(0!==e){for(var t=m.length;m.length>e+1;)Fe(d),y.pop(),m.pop();t>e&&j()}else P()}},O=function(e,t){var n=k(e,t),r=Ne(n);r.querySelector("button").addEventListener("click",M(t)),d.appendChild(r),b()},A=function(e){var t=x(e),i=w();if(m.length>=f)console.warn("Not allowed! You reached the maximum depth (".concat(f,")"));else if(t!==i){var o=r.export();m=[].concat(p(m),[o]);var a=n.getBoundingClientRect(),s=a.width,c=a.height;v=[].concat(p(v),[{width:s,height:c}]),1===m.length&&O(o,0);var l=S(e);r.import(l),y=[].concat(p(y),[t]),O(l,m.length),u()}else console.warn("Not allowed! You're already on this level.")},j=function(){if(m.length){Fe(d),b(),y.pop();var e=m.pop();r.import(e);var t=v.pop();l(t)}else console.warn("Not allowed! You're already on the root level.")},P=function(){m.length?(ze(d),r.import(m[0]),l(v[0]),y=[],m=[],v=[]):console.warn("Not allowed! You're already on the root level.")},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(e.darkMode,e.maxDepth),n=void 0===t?null:t;f=Rn(n,f),b()},_=function(){g.destroy()};return b(),$e(et("nav",h),Je("size",(function(){return m.length})),Ke(e))({destroy:_,enter:A,leave:j,leaveAll:P,set:C})},Mr='/*! skmeans 2020-01-29 */\n"use strict";\n\n!function e(i, f, s) {\n  function u(n, r) {\n    if (!f[n]) {\n      if (!i[n]) {\n        var t = "function" == typeof require && require;\n        if (!r && t) return t(n, !0);\n        if (v) return v(n, !0);\n        var o = new Error("Cannot find module \'" + n + "\'");\n        throw o.code = "MODULE_NOT_FOUND", o;\n      }\n\n      var a = f[n] = {\n        exports: {}\n      };\n      i[n][0].call(a.exports, function (r) {\n        return u(i[n][1][r] || r);\n      }, a, a.exports, e, i, f, s);\n    }\n\n    return f[n].exports;\n  }\n\n  for (var v = "function" == typeof require && require, r = 0; r < s.length; r++) u(s[r]);\n\n  return u;\n}({\n  1: [function (n, t, o) {\n    (function () {\n      this.skmeans;\n      var r = n("./main.js");\n      void 0 !== o && (void 0 !== t && t.exports && (o = t.exports = r), o.skmeans = r), "undefined" != typeof window && (window.skmeans = r);\n    }).call(this);\n  }, {\n    "./main.js": 4\n  }],\n  2: [function (r, n, t) {\n    n.exports = {\n      eudist: function (r, n) {\n        for (var t = r.length, o = 0, a = 0; a < t; a++) {\n          var e = (r[a] || 0) - (n[a] || 0);\n          o += e * e;\n        }\n\n        return o;\n      },\n      mandist: function (r, n) {\n        for (var t = r.length, o = 0, a = 0, e = 0; e < t; e++) o += 0 <= (a = (r[e] || 0) - (n[e] || 0)) ? a : -a;\n\n        return o;\n      },\n      dist: function (r, n, t) {\n        var o = Math.abs(r - n);\n        return t ? o : o * o;\n      }\n    };\n  }, {}],\n  3: [function (r, n, t) {\n    var o = r("./distance.js"),\n        j = o.eudist,\n        w = o.dist;\n    n.exports = {\n      kmrand: function (r, n) {\n        for (var t = {}, o = [], a = n << 2, e = r.length, i = 0 < r[0].length; o.length < n && 0 < a--;) {\n          var f = r[Math.floor(Math.random() * e)],\n              s = i ? f.join("_") : "".concat(f);\n          t[s] || (t[s] = !0, o.push(f));\n        }\n\n        if (o.length < n) throw new Error("Error initializating clusters");\n        return o;\n      },\n      kmpp: function (r, n, t) {\n        var o = t || (r[0].length ? j : w),\n            a = [],\n            e = r.length,\n            i = 0 < r[0].length,\n            f = r[Math.floor(Math.random() * e)];\n        i ? f.join("_") : "".concat(f);\n\n        for (a.push(f); a.length < n;) {\n          for (var s = [], u = a.length, v = 0, c = [], h = 0; h < e; h++) {\n            for (var d = 1 / 0, l = 0; l < u; l++) {\n              var p = o(r[h], a[l]);\n              p <= d && (d = p);\n            }\n\n            s[h] = d;\n          }\n\n          for (var m = 0; m < e; m++) v += s[m];\n\n          for (var g = 0; g < e; g++) c[g] = {\n            i: g,\n            v: r[g],\n            pr: s[g] / v,\n            cs: 0\n          };\n\n          c.sort(function (r, n) {\n            return r.pr - n.pr;\n          }), c[0].cs = c[0].pr;\n\n          for (var k = 1; k < e; k++) c[k].cs = c[k - 1].cs + c[k].pr;\n\n          for (var x = Math.random(), M = 0; M < e - 1 && c[M++].cs < x;);\n\n          a.push(c[M - 1].v);\n        }\n\n        return a;\n      }\n    };\n  }, {\n    "./distance.js": 2\n  }],\n  4: [function (r, n, t) {\n    var o = r("./distance.js"),\n        a = r("./kinit.js"),\n        H = o.eudist,\n        I = (o.mandist, o.dist, a.kmrand),\n        J = a.kmpp;\n\n    function K(r, n, t) {\n      t = t || [];\n\n      for (var o = 0; o < r; o++) t[o] = n;\n\n      return t;\n    }\n\n    function P(r, n) {\n      for (var t = Array.isArray(r), o = this.centroids, a = o.length, e = 1 / 0, i = 0, f = 0; f < a; f++) {\n        var s = n ? n(r, o[f]) : t ? H(r, o[f]) : Math.abs(r - o[f]);\n        s <= e && (e = s, i = f);\n      }\n\n      return {\n        idx: i,\n        centroid: o[i]\n      };\n    }\n\n    n.exports = function (r, n, t, o, a) {\n      var e = [],\n          i = [],\n          f = [],\n          s = [],\n          u = !1,\n          v = o || 1e4,\n          c = r.length,\n          h = r[0].length,\n          d = 0 < h,\n          l = [];\n      if (t) e = "kmrand" == t ? I(r, n) : "kmpp" == t ? J(r, n, a) : t;else for (var p = {}, m = 0; e.length < n;) {\n        var g = Math.floor(Math.random() * c);\n        p[g] || (p[g] = !0, e[m++] = r[g]);\n      }\n\n      do {\n        K(n, 0, l);\n\n        for (var k = 0; k < c; k++) {\n          for (var x = 1 / 0, M = 0, j = 0; j < n; j++) (s = a ? a(r[k], e[j]) : d ? H(r[k], e[j]) : Math.abs(r[k] - e[j])) <= x && (x = s, M = j);\n\n          l[f[k] = M]++;\n        }\n\n        var w = [];\n        if (i = [], d) for (var b = 0; b < n; b++) w[b] = K(h, 0, w[b]), i[b] = e[b];else for (var y = 0; y < n; y++) w[y] = 0, i[y] = e[y];\n\n        if (d) {\n          for (var q = 0; q < n; q++) e[q] = [];\n\n          for (var E = 0; E < c; E++) for (var _ = w[f[E]], O = r[E], A = 0; A < h; A++) _[A] += O[A];\n\n          u = !0;\n\n          for (var D = 0; D < n; D++) {\n            for (var N = e[D], U = w[D], z = i[D], C = l[D], F = 0; F < h; F++) N[F] = U[F] / C || 0;\n\n            if (u) for (var L = 0; L < h; L++) if (z[L] != N[L]) {\n              u = !1;\n              break;\n            }\n          }\n        } else {\n          for (var T = 0; T < c; T++) w[f[T]] += r[T];\n\n          for (var B = 0; B < n; B++) e[B] = w[B] / l[B] || 0;\n\n          u = !0;\n\n          for (var G = 0; G < n; G++) if (i[G] != e[G]) {\n            u = !1;\n            break;\n          }\n        }\n\n        u = u || --v <= 0;\n      } while (!u);\n\n      return {\n        it: (o || 1e4) - v,\n        k: n,\n        idxs: f,\n        centroids: e,\n        test: P\n      };\n    };\n  }, {\n    "./distance.js": 2,\n    "./kinit.js": 3\n  }]\n}, {}, [1]);',Or=function(){var e=function(e){return{error:new Error(e)}},t=function(e){return e};self.onmessage=function(n){var r,i=n.data,o=i.initialization,a=i.k,s=i.maxIterations,u=i.items,c=i.scripts;try{c.forEach((function(e){importScripts(e)}))}catch(t){return void self.postMessage(e("Failed to import skmeans: ".concat(t)))}try{r=u.map(self.valueGetter||t)}catch(t){return void self.postMessage(e("Failed to load features: ".concat(t)))}if(r.length<=a)self.postMessage(e("Need at least ".concat(a," items!")));else try{var l=self.skmeans(r,a,o||"kmpp",s||1e3*Math.log10(r.length),self.distanceFunction||null),f=self.postProcessing&&self.postProcessing(l,r,u);self.postMessage({centroids:l.centroids,labels:l.idxs,postProcessing:f})}catch(t){self.postMessage(e("Failed to run k-means++: ".concat(t)))}}},Ar=function(e){return window.URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},jr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.distanceFunction,r=void 0===n?null:n,i=t.initialization,o=void 0===i?"kmpp":i,a=t.maxIterations,s=void 0===a?null:a,u=t.valueGetter,c=void 0===u?null:u,l=t.postProcessing,f=void 0===l?null:l,h=[Ar(Mr.replace(/window/g,"self"))];return c&&h.push(Ar("(() => { self.valueGetter = ".concat(c.toString(),"; })();"))),r&&h.push(Ar("(() => { self.distanceFunction = ".concat(r.toString(),"; })();"))),f&&h.push(Ar("(() => { self.postProcessing = ".concat(f.toString(),"; })();"))),function(t){return new Promise((function(n,r){var i=ot(Or);i.onmessage=function(e){e.data.error?r(e.data.error):n(e.data),i.terminate()},i.postMessage({initialization:o,k:e,maxIterations:s,items:t,scripts:h})}))}},Pr=Object.prototype.toString,Cr=function(e){var t=Pr.call(e),n="[object Arguments]"===t;return n||(n="[object Array]"!==t&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===Pr.call(e.callee)),n};if(!Object.keys){var _r=Object.prototype.hasOwnProperty,Ir=Object.prototype.toString,Rr=Cr,Tr=Object.prototype.propertyIsEnumerable,Lr=!Tr.call({toString:null},"toString"),Br=Tr.call((function(){}),"prototype"),Nr=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Dr=function(e){var t=e.constructor;return t&&t.prototype===e},zr={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},Fr=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!zr["$"+e]&&_r.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{Dr(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();vr=function(e){var t=null!==e&&"object"==typeof e,n="[object Function]"===Ir.call(e),r=Rr(e),i=t&&"[object String]"===Ir.call(e),o=[];if(!t&&!n&&!r)throw new TypeError("Object.keys called on a non-object");var a=Br&&n;if(i&&e.length>0&&!_r.call(e,0))for(var s=0;s<e.length;++s)o.push(String(s));if(r&&e.length>0)for(var u=0;u<e.length;++u)o.push(String(u));else for(var c in e)a&&"prototype"===c||!_r.call(e,c)||o.push(String(c));if(Lr)for(var l=function(e){if("undefined"==typeof window||!Fr)return Dr(e);try{return Dr(e)}catch(e){return!1}}(e),f=0;f<Nr.length;++f)l&&"constructor"===Nr[f]||!_r.call(e,Nr[f])||o.push(Nr[f]);return o}}var Vr=vr,Ur=Array.prototype.slice,Yr=Object.keys,Xr=Yr?function(e){return Yr(e)}:Vr,qr=Object.keys;Xr.shim=function(){Object.keys?function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2)||(Object.keys=function(e){return Cr(e)?qr(Ur.call(e)):qr(e)}):Object.keys=Xr;return Object.keys||Xr};var Hr=Xr,Gr="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,Wr=Object.prototype.toString,$r=function(e){return!(Gr&&e&&"object"==typeof e&&Symbol.toStringTag in e)&&"[object Arguments]"===Wr.call(e)},Kr=function(e){return!!$r(e)||null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==Wr.call(e)&&"[object Function]"===Wr.call(e.callee)},Zr=function(){return $r(arguments)}();$r.isLegacyArguments=Kr;var Qr=Zr?$r:Kr,Jr=function(e){return e!=e},ei=function(e,t){return 0===e&&0===t?1/e==1/t:e===t||!(!Jr(e)||!Jr(t))},ti="Function.prototype.bind called on incompatible ",ni=Array.prototype.slice,ri=Object.prototype.toString,ii=(Function.prototype.bind||function(e){var t=this;if("function"!=typeof t||"[object Function]"!==ri.call(t))throw new TypeError(ti+t);for(var n,r=ni.call(arguments,1),i=function(){if(this instanceof n){var i=t.apply(this,r.concat(ni.call(arguments)));return Object(i)===i?i:this}return t.apply(e,r.concat(ni.call(arguments)))},o=Math.max(0,t.length-r.length),a=[],s=0;s<o;s++)a.push("$"+s);if(n=Function("binder","return function ("+a.join(",")+"){ return binder.apply(this,arguments); }")(i),t.prototype){var u=function(){};u.prototype=t.prototype,n.prototype=new u,u.prototype=null}return n}).call(Function.call,Object.prototype.hasOwnProperty),oi=RegExp.prototype.exec,ai=Object.getOwnPropertyDescriptor,si=Object.prototype.toString,ui="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,ci=function(e){if(!e||"object"!=typeof e)return!1;if(!ui)return"[object RegExp]"===si.call(e);var t=ai(e,"lastIndex");return!(!t||!ii(t,"value"))&&function(e){try{var t=e.lastIndex;return e.lastIndex=0,oi.call(e),!0}catch(e){return!1}finally{e.lastIndex=t}}(e)},li="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),fi=Object.prototype.toString,hi=Array.prototype.concat,pi=Object.defineProperty,di=pi&&function(){var e={};try{for(var t in pi(e,"x",{enumerable:!1,value:e}),e)return!1;return e.x===e}catch(e){return!1}}(),gi=function(e,t,n,r){var i;(!(t in e)||"function"==typeof(i=r)&&"[object Function]"===fi.call(i)&&r())&&(di?pi(e,t,{configurable:!0,enumerable:!1,value:n,writable:!0}):e[t]=n)},mi=function(e,t){var n=arguments.length>2?arguments[2]:{},r=Hr(t);li&&(r=hi.call(r,Object.getOwnPropertySymbols(t)));for(var i=0;i<r.length;i+=1)gi(e,r[i],t[r[i]],n[r[i]])};mi.supportsDescriptors=!!di;var vi=mi,yi=Object,bi=TypeError,wi=function(){if(null!=this&&this!==yi(this))throw new bi("RegExp.prototype.flags getter called on non-object");var e="";return this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.sticky&&(e+="y"),e},xi=vi.supportsDescriptors,Si=Object.getOwnPropertyDescriptor,Ei=TypeError,ki=function(){if(!xi)throw new Ei("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");if("gim"===/a/gim.flags){var e=Si(RegExp.prototype,"flags");if(e&&"function"==typeof e.get&&"boolean"==typeof/a/.dotAll)return e.get}return wi},Mi=vi.supportsDescriptors,Oi=Object.getOwnPropertyDescriptor,Ai=Object.defineProperty,ji=TypeError,Pi=Object.getPrototypeOf,Ci=/a/,_i=Function.call.bind(wi);vi(_i,{getPolyfill:ki,implementation:wi,shim:function(){if(!Mi||!Pi)throw new ji("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=ki(),t=Pi(Ci),n=Oi(t,"flags");return n&&n.get===e||Ai(t,"flags",{configurable:!0,enumerable:!1,get:e}),e}});var Ii=_i,Ri=Date.prototype.getDay,Ti=Object.prototype.toString,Li="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,Bi=function(e){return"object"==typeof e&&null!==e&&(Li?function(e){try{return Ri.call(e),!0}catch(e){return!1}}(e):"[object Date]"===Ti.call(e))},Ni=Date.prototype.getTime;function Di(e,t,n){var r=n||{};return!!(r.strict?ei(e,t):e===t)||(!e||!t||"object"!=typeof e&&"object"!=typeof t?r.strict?ei(e,t):e==t:function(e,t,n){var r,i;if(typeof e!=typeof t)return!1;if(zi(e)||zi(t))return!1;if(e.prototype!==t.prototype)return!1;if(Qr(e)!==Qr(t))return!1;var o=ci(e),a=ci(t);if(o!==a)return!1;if(o||a)return e.source===t.source&&Ii(e)===Ii(t);if(Bi(e)&&Bi(t))return Ni.call(e)===Ni.call(t);var s=Fi(e),u=Fi(t);if(s!==u)return!1;if(s||u){if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}if(typeof e!=typeof t)return!1;try{var c=Hr(e),l=Hr(t)}catch(e){return!1}if(c.length!==l.length)return!1;for(c.sort(),l.sort(),r=c.length-1;r>=0;r--)if(c[r]!=l[r])return!1;for(r=c.length-1;r>=0;r--)if(i=c[r],!Di(e[i],t[i],n))return!1;return!0}(e,t,r))}function zi(e){return null==e}function Fi(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(e.length>0&&"number"!=typeof e[0]))}var Vi=Di,Ui=(a((function(e){var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var s,u=[],c=!1,l=-1;function f(){c&&s&&(c=!1,s.length?u=s.concat(u):l=-1,u.length&&h())}function h(){if(!c){var e=a(f);c=!0;for(var t=u.length;t;){for(s=u,u=[];++l<t;)s&&s[l].run();l=-1,t=u.length}s=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function d(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||c||a(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=d,r.addListener=d,r.once=d,r.off=d,r.removeListener=d,r.removeAllListeners=d,r.emit=d,r.prependListener=d,r.prependOnceListener=d,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}})),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Yi=function(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==Ui?Ui:"undefined"!=typeof module?module:Function("return this")()),Xi=function(){return Math.random().toString(36).substring(7).split("").join(".")},qi={INIT:"@@redux/INIT"+Xi(),REPLACE:"@@redux/REPLACE"+Xi(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+Xi()}};function Hi(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Gi(e,t,n){var r;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(Gi)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var i=e,o=t,a=[],s=a,u=!1;function c(){s===a&&(s=a.slice())}function l(){if(u)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return o}function f(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(u)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribelistener for more details.");var t=!0;return c(),s.push(e),function(){if(t){if(u)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribelistener for more details.");t=!1,c();var n=s.indexOf(e);s.splice(n,1),a=null}}}function h(e){if(!Hi(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(u)throw new Error("Reducers may not dispatch actions.");try{u=!0,o=i(o,e)}finally{u=!1}for(var t=a=s,n=0;n<t.length;n++){(0,t[n])()}return e}function p(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");i=e,h({type:qi.REPLACE})}function d(){var e,t=f;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function n(){e.next&&e.next(l())}return n(),{unsubscribe:t(n)}}})[Yi]=function(){return this},e}return h({type:qi.INIT}),(r={dispatch:h,subscribe:f,getState:l,replaceReducer:p})[Yi]=d,r}function Wi(e,t){var n=t&&t.type;return"Given "+(n&&'action "'+String(n)+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function $i(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var i=t[r];0,"function"==typeof e[i]&&(n[i]=e[i])}var o,a=Object.keys(n);try{!function(e){Object.keys(e).forEach((function(t){var n=e[t];if(void 0===n(void 0,{type:qi.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===n(void 0,{type:qi.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+qi.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}(n)}catch(e){o=e}return function(e,t){if(void 0===e&&(e={}),o)throw o;for(var r=!1,i={},s=0;s<a.length;s++){var u=a[s],c=n[u],l=e[u],f=c(l,t);if(void 0===f){var h=Wi(u,t);throw new Error(h)}i[u]=f,r=r||f!==l}return(r=r||a.length!==Object.keys(e).length)?i:e}}function Ki(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ki(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ki(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Qi=function(e,t){switch(Mn(e)){case"object":return Vi(e,t)?t:Ye(e);default:return e}},Ji=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n="SET_".concat(He(e));return function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,i=arguments.length>1?arguments[1]:void 0;switch(i.type){case n:return Qi(i.payload[e],r);default:return r}}},eo=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t=new Set(t);var r="SET_".concat(He(e));return function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,o=arguments.length>1?arguments[1]:void 0;switch(o.type){case r:return t.has(o.payload[e])?Qi(o.payload[e],i):i;default:return i}}},to=function(e){var t="SET_".concat(He(e));return function(n){return{type:t,payload:d({},e,n)}}},no=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return[Ji(e,t),to(e)]},ro=function(e,t){return{type:"OVERWRITE",payload:{newState:e,debug:t}}},io=function(e,t){return{type:"SOFT_OVERWRITE",payload:{newState:e,debug:t}}},oo=no("arrangementType"),ao=y(oo,2),so=ao[0],uo=ao[1],co=no("arrangementObjective"),lo=y(co,2),fo=lo[0],ho=lo[1],po=no("arrangeOnGrouping",!1),go=y(po,2),mo=go[0],vo=go[1],yo=no("arrangementOptions",{}),bo=y(yo,2),wo=bo[0],xo=bo[1],So=no("groupingType"),Eo=y(So,2),ko=Eo[0],Mo=Eo[1],Oo=no("groupingObjective"),Ao=y(Oo,2),jo=Ao[0],Po=Ao[1],Co=no("groupingOptions",{}),_o=y(Co,2),Io=_o[0],Ro=_o[1],To=no("splittingType"),Lo=y(To,2),Bo=Lo[0],No=Lo[1],Do=no("splittingObjective"),zo=y(Do,2),Fo=zo[0],Vo=zo[1],Uo=no("splittingOptions",{}),Yo=y(Uo,2),Xo=Yo[0],qo=Yo[1],Ho=no("backgroundColor",0),Go=y(Ho,2),Wo=Go[0],$o=Go[1],Ko=no("darkMode",!1),Zo=y(Ko,2),Qo=Zo[0],Jo=Zo[1],ea=no("dimensionalityReducer"),ta=y(ea,2),na=ta[0],ra=ta[1],ia=no("gridColor",7895160),oa=y(ia,2),aa=oa[0],sa=oa[1],ua=no("gridOpacity",1),ca=y(ua,2),la=ca[0],fa=ca[1],ha=no("showGrid",!1),pa=y(ha,2),da=pa[0],ga=pa[1],ma=no("popupBackgroundOpacity",.85),va=y(ma,2),ya=va[0],ba=va[1],wa=no("lassoFillColor"),xa=y(wa,2),Sa=xa[0],Ea=xa[1],ka=no("lassoFillOpacity",.15),Ma=y(ka,2),Oa=Ma[0],Aa=Ma[1],ja=no("lassoShowStartIndicator",!0),Pa=y(ja,2),Ca=Pa[0],_a=Pa[1],Ia=no("lassoStartIndicatorOpacity",.1),Ra=y(Ia,2),Ta=Ra[0],La=Ra[1],Ba=no("lassoStrokeColor"),Na=y(Ba,2),Da=Na[0],za=Na[1],Fa=no("lassoStrokeOpacity",.8),Va=y(Fa,2),Ua=Va[0],Ya=Va[1],Xa=no("lassoStrokeSize",1),qa=y(Xa,2),Ha=qa[0],Ga=qa[1],Wa=no("itemRenderer"),$a=y(Wa,2),Ka=$a[0],Za=$a[1],Qa=no("previewRenderer"),Ja=y(Qa,2),es=Ja[0],ts=Ja[1],ns=no("coverRenderer"),rs=y(ns,2),is=rs[0],os=rs[1],as=no("previewAggregator"),ss=y(as,2),us=ss[0],cs=ss[1],ls=no("coverAggregator"),fs=y(ls,2),hs=fs[0],ps=fs[1],ds=no("orderer",(function(e){return function(t){return[Math.floor(t/e),t%e]}})),gs=y(ds,2),ms=gs[0],vs=gs[1],ys=no("itemSize"),bs=y(ys,2),ws=bs[0],xs=bs[1],Ss=no("itemSizeRange",[.5,1]),Es=y(Ss,2),ks=Es[0],Ms=Es[1],Os=no("columns",10),As=y(Os,2),js=As[0],Ps=As[1],Cs=no("rowHeight"),_s=y(Cs,2),Is=_s[0],Rs=_s[1],Ts=no("cellAspectRatio",1),Ls=y(Ts,2),Bs=Ls[0],Ns=Ls[1],Ds=no("cellPadding",12),zs=y(Ds,2),Fs=zs[0],Vs=zs[1],Us=no("cellSize"),Ys=y(Us,2),Xs=Ys[0],qs=Ys[1],Hs=no("pileCoverScale",1),Gs=y(Hs,2),Ws=Gs[0],$s=Gs[1],Ks=no("pileCoverInvert",!1),Zs=y(Ks,2),Qs=Zs[0],Js=Zs[1],eu=no("pileItemBrightness",0),tu=y(eu,2),nu=tu[0],ru=tu[1],iu=no("pileItemInvert",!1),ou=y(iu,2),au=ou[0],su=ou[1],uu=no("pileItemOffset",[5,5]),cu=y(uu,2),lu=cu[0],fu=cu[1],hu=no("pileItemOpacity",1),pu=y(hu,2),du=pu[0],gu=pu[1],mu=no("pileOrderItems"),vu=y(mu,2),yu=vu[0],bu=vu[1],wu=no("pileItemRotation",0),xu=y(wu,2),Su=xu[0],Eu=xu[1],ku=no("pileItemTint",16777215),Mu=y(ku,2),Ou=Mu[0],Au=Mu[1],ju=no("focusedPiles",[]),Pu=y(ju,2),Cu=Pu[0],_u=Pu[1],Iu=no("magnifiedPiles",[]),Ru=y(Iu,2),Tu=Ru[0],Lu=Ru[1],Bu=no("depileMethod","originalPos"),Nu=y(Bu,2),Du=Nu[0],zu=Nu[1],Fu=no("depiledPile",[]),Vu=y(Fu,2),Uu=Vu[0],Yu=Vu[1],Xu=no("temporaryDepiledPiles",[]),qu=y(Xu,2),Hu=qu[0],Gu=qu[1],Wu=no("tempDepileDirection","horizontal"),$u=y(Wu,2),Ku=$u[0],Zu=$u[1],Qu=no("tempDepileOneDNum",6),Ju=y(Qu,2),ec=Ju[0],tc=Ju[1],nc=no("easing",pe),rc=y(nc,2),ic=rc[0],oc=rc[1],ac=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return[eo(e,t,n),to(e)]}("navigationMode",Gn,"auto"),sc=y(ac,2),uc=sc[0],cc=sc[1],lc=no("previewItemOffset"),fc=y(lc,2),hc=fc[0],pc=fc[1],dc=no("previewAlignment","top"),gc=y(dc,2),mc=gc[0],vc=gc[1],yc=no("previewPadding",2),bc=y(yc,2),wc=bc[0],xc=bc[1],Sc=no("previewScaling",[1,1]),Ec=y(Sc,2),kc=Ec[0],Mc=Ec[1],Oc=no("previewScaleToCover",[!1,!1]),Ac=y(Oc,2),jc=Ac[0],Pc=Ac[1],Cc=no("previewSpacing",2),_c=y(Cc,2),Ic=_c[0],Rc=_c[1],Tc=no("previewOffset",2),Lc=y(Tc,2),Bc=Lc[0],Nc=Lc[1],Dc=no("previewBackgroundColor","inherit"),zc=y(Dc,2),Fc=zc[0],Vc=zc[1],Uc=no("previewBackgroundOpacity","inherit"),Yc=y(Uc,2),Xc=Yc[0],qc=Yc[1],Hc=no("previewBorderColor"),Gc=y(Hc,2),Wc=Gc[0],$c=Gc[1],Kc=no("previewBorderOpacity",.85),Zc=y(Kc,2),Qc=Zc[0],Jc=Zc[1],el=no("pileBackgroundColor"),tl=y(el,2),nl=tl[0],rl=tl[1],il=no("pileBackgroundOpacity",0),ol=y(il,2),al=ol[0],sl=ol[1],ul=no("pileBackgroundColorHover"),cl=y(ul,2),ll=cl[0],fl=cl[1],hl=no("pileBackgroundOpacityHover",.85),pl=y(hl,2),dl=pl[0],gl=pl[1],ml=no("pileBackgroundColorFocus"),vl=y(ml,2),yl=vl[0],bl=vl[1],wl=no("pileBackgroundOpacityFocus"),xl=y(wl,2),Sl=xl[0],El=xl[1],kl=no("pileBackgroundColorActive"),Ml=y(kl,2),Ol=Ml[0],Al=Ml[1],jl=no("pileBackgroundOpacityActive"),Pl=y(jl,2),Cl=Pl[0],_l=Pl[1],Il=no("pileBorderColor",8421504),Rl=y(Il,2),Tl=Rl[0],Ll=Rl[1],Bl=no("pileBorderOpacity",1),Nl=y(Bl,2),Dl=Nl[0],zl=Nl[1],Fl=no("pileBorderColorHover",8421504),Vl=y(Fl,2),Ul=Vl[0],Yl=Vl[1],Xl=no("pileBorderOpacityHover",1),ql=y(Xl,2),Hl=ql[0],Gl=ql[1],Wl=no("pileBorderColorFocus",15656034),$l=y(Wl,2),Kl=$l[0],Zl=$l[1],Ql=no("pileBorderOpacityFocus",1),Jl=y(Ql,2),ef=Jl[0],tf=Jl[1],nf=no("pileBorderColorActive",16754138),rf=y(nf,2),of=rf[0],af=rf[1],sf=no("pileBorderOpacityActive",1),uf=y(sf,2),cf=uf[0],lf=uf[1],ff=no("pileBorderSize",0),hf=y(ff,2),pf=hf[0],df=hf[1],gf=no("pileCellAlignment","topLeft"),mf=y(gf,2),vf=mf[0],yf=mf[1],bf=no("pileContextMenuItems",[]),wf=y(bf,2),xf=wf[0],Sf=wf[1],Ef=no("pileSizeBadge",!1),kf=y(Ef,2),Mf=kf[0],Of=kf[1],Af=no("pileSizeBadgeAlign",["top","right"]),jf=y(Af,2),Pf=jf[0],Cf=jf[1],_f=no("pileVisibilityItems",!0),If=y(_f,2),Rf=If[0],Tf=If[1],Lf=no("pileOpacity",1),Bf=y(Lf,2),Nf=Bf[0],Df=Bf[1],zf=no("pileScale",1),Ff=y(zf,2),Vf=Ff[0],Uf=Ff[1],Yf=no("zoomScale",1),Xf=y(Yf,2),qf=Xf[0],Hf=Xf[1],Gf=no("pileLabel"),Wf=y(Gf,2),$f=Wf[0],Kf=Wf[1],Zf=no("pileLabelColor"),Qf=y(Zf,2),Jf=Qf[0],eh=Qf[1],th=no("pileLabelText",!1),nh=y(th,2),rh=nh[0],ih=nh[1],oh=no("pileLabelTextMapping",!1),ah=y(oh,2),sh=ah[0],uh=ah[1],ch=no("pileLabelTextColor",0),lh=y(ch,2),fh=lh[0],hh=lh[1],ph=no("pileLabelTextOpacity",1),dh=y(ph,2),gh=dh[0],mh=dh[1],vh=no("pileLabelTextDropShadow",{}),yh=y(vh,2),bh=yh[0],wh=yh[1],xh=no("pileLabelAlign","bottom"),Sh=y(xh,2),Eh=Sh[0],kh=Sh[1],Mh=no("pileLabelStackAlign","horizontal"),Oh=y(Mh,2),Ah=Oh[0],jh=Oh[1],Ph=no("pileLabelFontSize",7),Ch=y(Ph,2),_h=Ch[0],Ih=Ch[1],Rh=no("pileLabelHeight",2),Th=y(Rh,2),Lh=Th[0],Bh=Th[1],Nh=no("pileLabelSizeTransform"),Dh=y(Nh,2),zh=Dh[0],Fh=Dh[1],Vh=no("projector"),Uh=y(Vh,2),Yh=Uh[0],Xh=Uh[1],qh=no("zoomBounds",[-1/0,1/0]),Hh=y(qh,2),Gh=Hh[0],Wh=Hh[1],$h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ITEMS":var n=!!t.payload.items.length&&void 0!==t.payload.items[0].id;return t.payload.items.reduce((function(e,t,r){var i=n?t.id:r;return e[i]=Zi({id:i,index:r},t),e}),{});default:return e}},Kh=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_PILES":return Object.entries(t.payload.piles).reduce((function(e,t,n){var r=y(t,2),i=r[0],o=r[1];return e[i]=Zi(Zi({},o),{},{id:i,index:Number.isNaN(+o.index)?n:+o.index}),e}),{});case"INIT_PILES":var n=!!t.payload.newItems.length&&void 0!==t.payload.newItems[0].id,r=t.payload.newItems.reduce((function(e,t,n){var r=void 0===t.id?n.toString():t.id;return e.add(r),e}),new Set);return t.payload.newItems.reduce((function(t,i,o){var a=n?i.id:o.toString(),s=e[a],u=Zi({id:a,index:o,items:[a],x:null,y:null},s);if(s)if(s.items.length)u.items=s.items.filter((function(e){return r.has(e)}));else if(r.has(a)){Object.values(e).filter((function(e){return e.items.includes(a)&&r.has(e.id)})).length||(u.items=[a])}return t[a]=u,t}),{});case"MERGE_PILES":var i,o=Zi({},e);i=void 0===t.payload.targetPileId&&isNaN(t.payload.pileIds[0])?t.payload.pileIds[0]:void 0!==t.payload.targetPileId?t.payload.targetPileId:Math.min.apply([],t.payload.pileIds).toString();var a=t.payload.pileIds.filter((function(e){return e!==i})),s=y(t.payload.targetPos,2),u=s[0],c=s[1];return o[i]=Zi(Zi({},o[i]),{},{items:p(o[i].items),x:u,y:c}),a.forEach((function(e){var t;(t=o[i].items).push.apply(t,p(o[e].items)),o[e]=Zi(Zi({},o[e]),{},{items:[],x:null,y:null})})),o;case"MOVE_PILES":var l=Zi({},e);return t.payload.movingPiles.forEach((function(e){var t=e.id,n=e.x,r=e.y;l[t]=Zi(Zi({},l[t]),{},{x:n,y:r})})),l;case"SCATTER_PILES":var f=t.payload.piles.filter((function(e){return e.items.length>1}));if(!f.length)return e;var h=Zi({},e);return f.forEach((function(e){e.items.forEach((function(t){h[t]=Zi(Zi({},h[t]),{},{items:[t],x:e.x,y:e.y})}))})),h;case"SPLIT_PILES":if(!Object.values(t.payload.piles).length)return e;var d=Zi({},e);return Object.entries(t.payload.piles).filter((function(e){return e[1].length>1})).forEach((function(e){var t=y(e,2),n=t[0];t[1].forEach((function(e){d[e[0]]=Zi(Zi({},d[e[0]]),{},{x:d[n].x,y:d[n].y,items:p(e)})}))})),d;default:return e}},Zh=no("showSpatialIndex",!1),Qh=y(Zh,2),Jh=Qh[0],ep=Qh[1],tp=function(){var e,t=null,n={arrangementObjective:fo,arrangementOptions:wo,arrangementType:so,arrangeOnGrouping:mo,backgroundColor:Wo,coverRenderer:is,cellAspectRatio:Bs,cellPadding:Fs,cellSize:Xs,columns:js,coverAggregator:hs,depiledPile:Uu,depileMethod:Du,dimensionalityReducer:na,easing:ic,focusedPiles:Cu,gridColor:aa,gridOpacity:la,groupingObjective:jo,groupingOptions:Io,groupingType:ko,darkMode:Qo,popupBackgroundOpacity:ya,itemRenderer:Ka,items:$h,itemSize:ws,itemSizeRange:ks,lassoFillColor:Sa,lassoFillOpacity:Oa,lassoShowStartIndicator:Ca,lassoStartIndicatorOpacity:Ta,lassoStrokeColor:Da,lassoStrokeOpacity:Ua,lassoStrokeSize:Ha,magnifiedPiles:Tu,navigationMode:uc,orderer:ms,pileBackgroundColor:nl,pileBackgroundColorActive:Ol,pileBackgroundColorFocus:yl,pileBackgroundColorHover:ll,pileBackgroundOpacity:al,pileBackgroundOpacityActive:Cl,pileBackgroundOpacityFocus:Sl,pileBackgroundOpacityHover:dl,pileBorderColor:Tl,pileBorderColorActive:of,pileBorderColorFocus:Kl,pileBorderColorHover:Ul,pileBorderOpacity:Dl,pileBorderOpacityActive:cf,pileBorderOpacityFocus:ef,pileBorderOpacityHover:Hl,pileBorderSize:pf,pileCellAlignment:vf,pileContextMenuItems:xf,pileCoverInvert:Qs,pileCoverScale:Ws,pileItemOffset:lu,pileItemBrightness:nu,pileItemInvert:au,pileItemOpacity:du,pileOrderItems:yu,pileItemRotation:Su,pileItemTint:Ou,pileLabel:$f,pileLabelAlign:Eh,pileLabelColor:Jf,pileLabelFontSize:_h,pileLabelHeight:Lh,pileLabelStackAlign:Ah,pileLabelSizeTransform:zh,pileLabelText:rh,pileLabelTextColor:fh,pileLabelTextMapping:sh,pileLabelTextOpacity:gh,pileLabelTextStyle:bh,pileOpacity:Nf,piles:Kh,pileScale:Vf,pileSizeBadge:Mf,pileSizeBadgeAlign:Pf,pileVisibilityItems:Rf,previewAggregator:us,previewAlignment:mc,previewBackgroundColor:Fc,previewBackgroundOpacity:Xc,previewBorderColor:Wc,previewBorderOpacity:Qc,previewItemOffset:hc,previewOffset:Bc,previewPadding:wc,previewRenderer:es,previewScaleToCover:jc,previewScaling:kc,previewSpacing:Ic,projector:Yh,rowHeight:Is,splittingObjective:Fo,splittingOptions:Xo,splittingType:Bo,showGrid:da,showSpatialIndex:Jh,tempDepileDirection:Ku,tempDepileOneDNum:ec,temporaryDepiledPiles:Hu,zoomBounds:Gh,zoomScale:qf},r=$i(n),i=function(e){var t=Object.keys(e).reduce((function(e,t){return void 0===n[t]&&e.push('"'.concat(t,'"')),e}),[]).join(", ");t&&console.warn("The following state properties are not understood and will not imported: ".concat(t))},o=Gi((e=function(e,n){return t=n,"RESET"===n.type?e=void 0:"OVERWRITE"===n.type?(n.payload.debug&&i(n.payload.newState),e=n.payload.newState):"SOFT_OVERWRITE"===n.type&&(n.payload.debug&&i(n.payload.newState),e=qe(e,n.payload.newState)),r(e,n)},function t(n,r){return r&&r.meta&&r.meta.batch?r.payload.reduce(t,n):e(n,r)}));o.lastAction=function(){return t},Object.defineProperty(o,"lastAction",{get:function(){return t}});return $e(et("reduxStore",o),Je("lastAction",(function(){return t})),Je("state",o.getState),Ze("dispatch",o.dispatch),Ze("subscribe",o.subscribe))({export:function(){var e=Ye(o.getState());return e.version="0.10.0",e},import:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.overwriteState,r=void 0!==n&&n,i=t.debug,a=void 0!==i&&i;"0.10.0"!==e.version&&console.warn('The version of the imported state "'.concat(e.version,'" doesn\'t match the library version "').concat("0.10.0",'". Use at your own risk!')),e.version&&delete e.version,r?o.dispatch(ro(e,a)):o.dispatch(io(e,a))},reset:function(){o.dispatch({type:"RESET",payload:{}})}})},np={initPiles:function(e){return{type:"INIT_PILES",payload:{newItems:e}}},mergePiles:function(e,t,n){return{type:"MERGE_PILES",payload:{pileIds:e,targetPos:t,targetPileId:n}}},movePiles:function(e){return{type:"MOVE_PILES",payload:{movingPiles:e}}},scatterPiles:function(e){return{type:"SCATTER_PILES",payload:{piles:e}}},setPiles:function(e){return{type:"SET_PILES",payload:{piles:e}}},setCoverRenderer:os,setArrangementObjective:ho,setArrangeOnGrouping:vo,setArrangementOptions:xo,setArrangementType:uo,setBackgroundColor:$o,setCellAspectRatio:Ns,setCellPadding:Vs,setCellSize:qs,setColumns:Ps,setCoverAggregator:ps,setDepiledPile:Yu,setDepileMethod:zu,setDimensionalityReducer:ra,setEasing:oc,setFocusedPiles:_u,setGridColor:sa,setGridOpacity:fa,setGroupingObjective:Po,setGroupingOptions:Ro,setGroupingType:Mo,setDarkMode:Jo,setPopupBackgroundOpacity:ba,setItemRenderer:Za,setItems:function(e){return{type:"SET_ITEMS",payload:{items:e}}},setItemSize:xs,setItemSizeRange:Ms,setLassoFillColor:Ea,setLassoFillOpacity:Aa,setLassoShowStartIndicator:_a,setLassoStartIndicatorOpacity:La,setLassoStrokeColor:za,setLassoStrokeOpacity:Ya,setLassoStrokeSize:Ga,setMagnifiedPiles:Lu,setNavigationMode:cc,setOrderer:vs,setPileBackgroundColor:rl,setPileBackgroundColorActive:Al,setPileBackgroundColorFocus:bl,setPileBackgroundColorHover:fl,setPileBackgroundOpacity:sl,setPileBackgroundOpacityActive:_l,setPileBackgroundOpacityFocus:El,setPileBackgroundOpacityHover:gl,setPileBorderColor:Ll,setPileBorderColorActive:af,setPileBorderColorFocus:Zl,setPileBorderColorHover:Yl,setPileBorderOpacity:zl,setPileBorderOpacityActive:lf,setPileBorderOpacityFocus:tf,setPileBorderOpacityHover:Gl,setPileBorderSize:df,setPileCellAlignment:yf,setPileContextMenuItems:Sf,setPileCoverInvert:Js,setPileCoverScale:$s,setPileItemOffset:fu,setPileOrderItems:bu,setPileItemBrightness:ru,setPileItemInvert:su,setPileItemOpacity:gu,setPileItemRotation:Eu,setPileItemTint:Au,setPileLabel:Kf,setPileLabelAlign:kh,setPileLabelColor:eh,setPileLabelFontSize:Ih,setPileLabelHeight:Bh,setPileLabelStackAlign:jh,setPileLabelSizeTransform:Fh,setPileLabelText:ih,setPileLabelTextColor:hh,setPileLabelTextMapping:uh,setPileLabelTextOpacity:mh,setPileLabelTextStyle:wh,setPileVisibilityItems:Tf,setPileOpacity:Df,setPileScale:Uf,setPileSizeBadge:Of,setPileSizeBadgeAlign:Cf,setPreviewAggregator:cs,setPreviewAlignment:vc,setPreviewBackgroundColor:Vc,setPreviewBackgroundOpacity:qc,setPreviewBorderColor:$c,setPreviewBorderOpacity:Jc,setPreviewItemOffset:pc,setPreviewOffset:Nc,setPreviewPadding:xc,setPreviewRenderer:ts,setPreviewScaleToCover:Pc,setPreviewScaling:Mc,setPreviewSpacing:Rc,setProjector:Xh,setRowHeight:Rs,setSplittingObjective:Vo,setSplittingOptions:qo,setSplittingType:No,setShowGrid:ga,setShowSpatialIndex:ep,setTempDepileDirection:Zu,setTempDepileOneDNum:tc,setTemporaryDepiledPiles:Gu,setZoomBounds:Wh,setZoomScale:Hf,splitPiles:function(e){return{type:"SPLIT_PILES",payload:{piles:e}}}},rp=function(e){var t=e.background,n=e.backgroundColor,r=e.backgroundOpacity;return function(e){return Ue(e,{get backgroundColor(){return t.tint},setBackgroundColor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n;t.tint=e},get backgroundOpacity(){return t.alpha},setBackgroundOpacity:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;t.alpha=e},rescaleBackground:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=e.width+e.padding*n,i=e.height+e.padding*n;t.x=-r/2,t.y=-i/2,t.width=r,t.height=i}})}},ip=function(e){return function(t){var n=e;return Ue(t,{get padding(){return n},setPadding:function(e){n=Number.isNaN(+e)?+e:n}})}},op=function e(n){var r,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=o.anchor,s=void 0===a?[.5,.5]:a,u=o.backgroundColor,c=void 0===u?65280:u,l=o.backgroundOpacity,f=void 0===l?.2:l,h=o.padding,d=void 0===h?0:h,g=new t.Container,m=new t.Sprite(t.Texture.WHITE),v=Zn(n);v instanceof t.Texture?(i=(r=new t.Sprite(v)).anchor).set.apply(i,p(s)):r=v;return g.addChild(m),g.addChild(r),$e(et("displayObject",g),et("sprite",r),or(r),sr(r,v.width,v.height),ur(r,v.width,v.height),ip(d),rp({background:m,backgroundColor:c,backgroundOpacity:f}),ar(r),Ke(e))({})};var ap=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i};var sp=function(e,t){if(null==e)return{};var n,r,i=ap(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i};function up(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?up(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):up(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var lp=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.minX,r=void 0===n?0:n,i=t.minY,o=void 0===i?0:i,a=t.maxX,s=void 0===a?1:a,u=t.maxY,c=void 0===u?1:u,l=sp(t,["minX","minY","maxX","maxY"]);return $e.apply(void 0,[et("minX",r),et("minY",o),et("maxX",s),et("maxY",c),et("width",s-r),et("height",c-o),et("cX",r+(s-r)/2),et("cY",o+(c-o)/2)].concat(p(Object.entries(cp(cp({},e),l)).map((function(e){var t=y(e,2),n=t[0],r=t[1];return et(n,r)})))))({})}},fp=function(){var e,t,n,r,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=i.duration,a=void 0===o?250:o,s=i.delay,u=void 0===s?0:s,c=i.interpolator,l=i.easing,f=void 0===l?pe:l,h=i.endValue,p=i.getter,d=i.setter,g=i.onDone,m=void 0===g?at:g,v=h,y=function(){e=p(),(r=null!==e)||console.warn("Invalid start value for animation: ".concat(e))},b=function(){u?setTimeout(y,u):y()},w=function(){return!!r&&(t||(t=performance.now()),(n=performance.now()-t)>=a?(d(v),!0):(d(c(e,v,f(n/a))),!1))},x=function(e){f=e},S=function(e){v=e};return{get dt(){return n},get duration(){return a},onDone:m,register:b,update:w,updateEndValue:S,setEasing:x}},hp=function(e){var t=e.name,n=e.pubSub,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.duration,o=r.delay,a=r.eps,s=void 0===a?1e-6:a;return function(e){var r,a=function(){return e[t]},u=function(n){e["set".concat(Ge(t))](n)};return Ue(e,d({},"animate".concat(Ge(t)),(function(e){if(Math.abs(e-a())<s)u(e);else{var t=i;r&&(n.publish("cancelAnimation",r),r.dt<r.duration&&(t=r.dt)),r=fp({delay:o,duration:t,interpolator:ge,endValue:e,getter:a,setter:u}),n.publish("startAnimation",r)}})))}},pp=function e(n){var r=n.image,i=n.item,o=n.pubSub,a=new t.Container;a.__pilingjs__item=i;var s=function(e){r=e,a.removeChildren(),a.addChild(r.displayObject)};return function(e){return e.displayObject.addChild(e.image.displayObject),e.enableInteractivity(),e}($e(et("displayObject",a),Je("x",(function(){return a.x})),Je("y",(function(){return a.y})),et("id",i.id),Je("image",(function(){return r})),et("item",i),function(e){var t=e.name,n=e.pubSub,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.initialValue,o=r.getter,a=r.setter,s=r.cloner,u=r.transformer,c=r.validator,l=r.duration,f=r.delay;return function(e){return $e(Qe(t,{initialValue:i,getter:o,setter:a,cloner:s,transformer:u,validator:c}),hp({name:t,pubSub:n},{duration:l,delay:f}))(e)}}({name:"opacity",pubSub:o},{getter:function(){return a.alpha},setter:function(e){a.alpha=e}}),function(e){return function(t){return Ue(t,{destroy:function(){return e.destroy()}})}}(a),(function(e){return Ue(e,{moveTo:function(t,n){Number.isNaN(+t)||Number.isNaN(+n)||(e.displayObject.x=t,e.displayObject.y=n)}})}),function(e){return function(t){return Ue(t,{pointerOverHandler:function(){e.publish("itemOver",{item:t})},pointerOutHandler:function(){e.publish("itemOut",{item:t})},disableInteractivity:function(){t.displayObject.interactive=!1,t.displayObject.buttonMode=!1,t.displayObject.off("pointerover",t.pointerOverHandler),t.displayObject.off("pointerout",t.pointerOutHandler)},enableInteractivity:function(){t.displayObject.interactive=!0,t.displayObject.buttonMode=!0,t.displayObject.on("pointerover",t.pointerOverHandler),t.displayObject.on("pointerout",t.pointerOutHandler)}})}}(o),(function(e){return Ue(e,{replaceImage:s})}),Ke(e))({}))},dp=Symbol("Normal"),gp=Symbol("Hover"),mp=Symbol("Focus"),vp=Symbol("Active"),yp=new Map;yp.set(dp,""),yp.set(gp,"Hover"),yp.set(mp,"Focus"),yp.set(vp,"Active");var bp=function(e){switch(e){case"left":return 0;case"right":return 1;default:return.5}},wp=function(e){switch(e){case"top":return 0;case"bottom":return 1;default:return.5}},xp=function(e){var n,r,i,o,a,s,u,c,l,f,h,d,g=e.render,m=e.id,v=e.pubSub,b=e.store,w=e.badgeFactory,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=x.x,E=void 0===S?0:S,k=x.y,M=void 0===k?0:k,O=[],A=new Map,j=new Map,P=new Map,C=new Map,_=new Set,I=new t.Container,R=new t.Graphics,T=new t.Container,L=new t.Container,B=new t.Container,N=new t.Container,D=new t.Container,z=new t.Container,F=new t.Container,V=new t.Container,U=lp({id:m}),Y=U(),X=U(),q=!1,H=!1,G=!1,W=!1,$=!1,K=-1,Z=[0,0],Q=dp,J=1,ee=1,te=1,ne=[],re=function(){s&&s.destroy(),I.destroy(),ne.forEach((function(e){v.unsubscribe(e)}))},ie=function(e){var t=yn(e.item.image.displayObject);return n?(t.x=D.x,t.y=D.y):(t.x=e.displayObject.x,t.y=e.displayObject.y),t.angle=e.displayObject.angle,t},oe=function(e){var t=e.item;if(q&&!I.isDragging){var n=ie(t);if(z.addChild(n),D.visible=!1,pt(t)){var r=b.state,i=r.previewBorderColor,o=r.previewBorderOpacity,a=r.items,s=O.indexOf(t),u=Ln(i,a[t.id],s),c=Ln(o,a[t.id],s);t.image.setBackgroundColor(se(u)),t.image.setBackgroundOpacity(c),t.image.rescaleBackground(!0),V.addChild(t.displayObject)}g()}},ae=function(){var e=b.state,t=e.pileBackgroundColor,n=e.piles,r=e.darkMode,i=Bn(t,n[m]);return null!==i?i:r?0:Vn},se=function(e){return null!==e?e:b.state.darkMode?Vn:0},ue=function(e){var t=e.item;if(q){for(D.visible=!0;z.children.length;)z.removeChildAt(0);if(pt(t)){var n=b.state,r=n.previewBackgroundColor,i=n.previewBackgroundOpacity,o=n.pileBackgroundOpacity,a=n.items,s=n.piles,u=O.indexOf(t),c=ae(),l=r===qn?c:Ln(r,a[t.id],u),f=i===qn?Bn(o,s[m]):Ln(i,a[t.id],u);t.image.setBackgroundColor(l),t.image.setBackgroundOpacity(f),N.addChild(t.displayObject)}g()}},ce={drawCall:-1},le=0,fe=function(){if(ce.drawCall===le)return ce;var e=R.getBounds(),t=T.getBounds();return ce={drawCall:le,x:t.x-e.x,y:t.y-e.y,width:t.width,height:t.height}},he=function(){if(!G){var e=b.state,t=e.darkMode,n=e.piles,i=e.pileSizeBadgeAlign,o=xe(i)?i(n[m]):i,u=y(o,2),c=u[0],l=u[1],f=bp(l),h=wp(c),p=O.length,d=p!==a,v=s;d&&(v=w.create(p,{darkMode:t}),void 0!==a&&(I.removeChild(s.displayObject),s.destroy()));var x=function(){var e=fe();v.displayObject.x=e.x-be+(e.width+2*be)*f,v.displayObject.y=e.y-be+(e.height+2*be)*h,d&&I.addChild(v.displayObject),s=v,a=p,g()};B.children.length||D.children.length?x():r&&r.then(x)}},pe=!1,ve=function(e){(pe=e)?he():s&&(I.removeChild(s.displayObject),s.destroy(),a=void 0)},be=0,we=function(e){be=+e,r?(ke(),r.then((function(){ke()}))):ke()},Se=function(){switch(Q){case gp:case mp:return be||1;case vp:return be||2;case dp:default:return be}},Ee=function(){var e=b.state,t=e.pileBackgroundOpacityHover,n=e.piles,r=Bn(b.state["pileBackgroundOpacity".concat(yp.get(Q)||"")],n[m]);return null===r&&(r=Bn(t,n[m])),r},ke=function e(){++le;var t=Se(),n=Ee();if(t||n)if(G)Xe.set("drawBorder",(function(){e()}));else{R.clear();var r=fe(),i=b.state,o=Math.ceil(t/2),a=Bn(i["pileBackgroundColor".concat(yp.get(Q)||"")],i.piles[m]);null===a&&(a=ae()),R.beginFill(a,n),R.drawRect(r.x-o,r.y-o,r.width+2*o,r.height+2*o),R.endFill();var s=i["pileBorderColor".concat(yp.get(Q)||"")],u=Bn(i["pileBorderOpacity".concat(yp.get(Q)||"")],i.piles[m]);s=xe(s)?bn(s(i.piles[m]))[0]:s,R.lineStyle(t,s,u),R.drawRect(r.x-o,r.y-o,r.width+2*o,r.height+2*o),pe&&he(),g()}else R.clear()},Me=function(){Q=dp,ke()},Oe=function(){Q!==gp&&(Q=gp,ke())},Ae=function(){Q!==mp&&(Q=mp,ke())},je=function(){Q!==vp&&(Q=vp,ke())},Pe=!1,Ce=function(e){Pe=!0,v.publish("pileEnter",{target:b.state.piles[m],event:e}),q?H?je():Ae():Oe(),i||(i=v.subscribe("itemOver",oe),ne.push(i)),o||(o=v.subscribe("itemOut",ue),ne.push(o))},_e=function(e){I.isDragging||(Pe=!1,v.publish("pileLeave",{target:b.state.piles[m],event:e}),q||Me(),i&&(v.unsubscribe(i),i=void 0),o&&(v.unsubscribe(o),o=void 0),z.removeChildren(),g())},Ie=function(e){2!==e.data.button&&(I.draggingMouseOffset=[e.data.getLocalPosition(I.parent).x-I.x,e.data.getLocalPosition(I.parent).y-I.y],I.alpha=1,I.isDragging=!0,I.beforeDragX=I.x,I.beforeDragY=I.y,u=!1,v.publish("pileDragStart",{target:b.state.piles[m],event:e}))},Re=function(e){2!==e.data.button&&I.isDragging&&(I.alpha=1,I.isDragging=!1,I.draggingMouseOffset=null,u&&v.publish("pileDragEnd",{target:b.state.piles[m],event:e}))},Te=function(e){if(2!==e.data.button&&I.isDragging){u=!0,v.publish("pileDragMove",{target:b.state.piles[m],event:e});var t=e.data.getLocalPosition(I.parent),n=t.x,r=t.y;n-=I.draggingMouseOffset[0],r-=I.draggingMouseOffset[1],Se()%2==1&&(n=Math.floor(n)+.5,r=Math.floor(r)+.5),$?f.updateEndValue([n,r]):(I.x=n,I.y=r),H?je():Oe(),g()}},Le=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,o=0,a=0;if(r){if(!D.children.length)return X;e=D.getBounds(!i)}else if(e=B.getBounds(!i),O.length>1){var s=O[0].displayObject.getBounds(!i);o=e.x-s.x,a=e.y-s.y}return U({localXOffset:o,localYOffset:a,minX:e.x-t,minY:e.y-n,maxX:e.x+e.width-t,maxY:e.y+e.height-n})},Be=function(e,t,n){X=Le(e,t,n)},Ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=L.getBounds(!n);return U({minX:r.x-e,minY:r.y-t,maxX:r.x+r.width-e,maxY:r.y+r.height-t})},De=function(e,t,n){Y=Ne(e,t,n)},ze=function(e,t,n){Be(e,t,n),De(e,t,n)},Fe=function(){return I.alpha},Ve=function(e){I.alpha=e},Ue=function(e){var t=Math.abs(e-Fe());if(t<.01)Ve(e);else{var n=250*de(t);c&&(v.publish("cancelAnimation",c),c.dt<c.duration&&(n=c.dt)),c=fp({duration:n,delay:0,interpolator:ge,endValue:e,getter:Fe,setter:Ve}),v.publish("startAnimation",c)}},Ye=function(e){B.visible=e,N.visible=e},Xe=new Map,qe=function(e,t,n,r,i,o){var a=e.tmpTargetScale||e.scale.x;e.tmpTargetScale=void 0,delete e.tmpTargetScale;var s=fp({duration:250,interpolator:me,endValue:[t,n,a,r],getter:function(){return[e.x,e.y,e.scale.x,e.angle]},setter:function(t){e.x=t[0],e.y=t[1],e.scale.x=t[2],e.scale.y=t[2],e.angle=t[3]},onDone:function(){e.tmpTargetScale=void 0,o&&(G=!1,ke(),Ct(),Xe.forEach((function(e){e()})),Xe.clear(),v.publish("updatePileBounds",{id:m}),_t&&Rt())}});i.add(s)},He=function(e){var t=new Map;e.forEach((function(e,n){t.set(e.toString(),n)}));var n=function(e){return function(n,r){var i=e.get(n),o=e.get(r);return t.get(i)-t.get(o)}};B.children.sort(n(P)),N.children.sort(n(C)),O.sort((function(e,n){return t.get(e.id)-t.get(n.id)}))},Ge=function(e,t){var n=b.state,i=n.piles,o=n.previewScaleToCover,a=i[m],s=xe(o)?o(a):o,u=y(s,2),c=u[0],l=u[1],f=function(t){if(!0===c){var n=t.width/e.width;e.scale.x*=n,"auto"===l&&(e.scale.y*=n)}else if(!0===l){var r=t.height/e.height;e.scale.y*=r,"auto"===c&&(e.scale.x*=r)}else!0===c&&!0===l&&(e.scale.x*=t.width/e.width,e.scale.y*=t.height/e.height)};t?f(t):r?r.then(f):f(fe())},We=function(e){var t=b.state,n=t.piles,i=t.previewAlignment,o=t.previewItemOffset,a=t.previewOffset,s=t.previewSpacing,u=n[m];r.then((function(t){var n=xe(i)?i(u):i,r=xe(a)?a(u):a,c=xe(s)?s(u):s;r=null!==r?r:c/2;var l=c/2,f=t.width/2,h=t.height/2;G=N.children.length>0;var d=[0,0],g=[0,0];N.children.forEach((function(i,a){var s,c=i.__pilingjs__item,m=b.state.items[c.id];if(Ge(i,t),xe(o))(s=o(m,a,u))[0]=s[0]*t.scaleFactor-f,s[1]=s[1]*t.scaleFactor-h;else{switch(n){case"left":s=[(0===a)*(-f-r)+d[0]-g[0]/2-i.width/2-l,0];break;case"right":s=[(0===a)*(f+r)+d[0]+g[0]/2+i.width/2+l,0];break;case"bottom":s=[0,(0===a)*(h+r)+d[1]+g[1]/2+i.height/2+l];break;default:case"top":s=[0,(0===a)*(-h-r)+d[1]-g[1]/2-i.height/2-l]}d=p(s),g=[i.width,i.height]}c.preview.setBackgroundOpacity(0),qe(i,s[0],s[1],0,e,a===N.children.length-1)}))}))},$e=function(e,t){var n=t.all,i=void 0!==n&&n,o=b.state,a=o.piles,s=o.pileItemOffset,u=o.pileItemRotation,c=a[m];if(r&&N.children.length)We(e);else if(B.children.length>1)if(i)G=!0,B.children.forEach((function(t,n){var r=t.__pilingjs__item,i=A.get(r.id),o=b.state.items[r.id],a=O.indexOf(i),l=xe(s)?s(o,a,c):s.map((function(e){return e*a})),f=xe(u)?u(o,a,c):u;qe(t,l[0],l[1],f,e,n===B.children.length-1)}));else if(_.size){G=!0;var l=0;_.forEach((function(t){l++;var n=t.item,r=t.displayObject,i=Ze();if(r.tmpTargetScale=r.scale.x,!Number.isNaN(+n.tmpRelScale)){var o=n.tmpRelScale/i;r.scale.x*=o,r.scale.y=r.scale.x,delete n.tmpRelScale}Number.isNaN(+n.tmpAbsX)||Number.isNaN(+n.tmpAbsY)||(t.moveTo((t.x+n.tmpAbsX-I.x)/i,(t.y+n.tmpAbsY-I.y)/i),delete n.tmpAbsX,delete n.tmpAbsY);var a=b.state.items[n.id],f=O.indexOf(t),h=xe(s)?s(a,f,c):s.map((function(e){return e*f})),p=xe(u)?u(a,f,c):u;qe(r,h[0],h[1],p,e,l===_.size)}))}else _t&&Rt();else _t&&Rt();_.clear()},Ke=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J;T.scale.x=e*ee,T.scale.y=e*ee},Ze=function(){return T.scale.x/ee},Qe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.isMagnification,r=void 0!==n&&n;r||(J=e),Ke(e)},Je=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.isMagnification,r=void 0!==n&&n,i=t.onDone,o=void 0===i?at:i,a=ye(Ze(),e*ee,9),s=function(){ke(),Ct(),a||v.publish("updatePileBounds",{id:m,forceUpdate:!0}),o()},u=function(){Qe(e,{isMagnification:r}),s()};if(ye(Ze(),e*ee,3))u();else{r||(J=e);var c=Math.max(Y.width,Y.height),f=Math.abs(e/Ze()*c-c);if(f<2)u();else{W=!0;var h=250*de(Math.min(f,50)/50);l&&(v.publish("cancelAnimation",l),l.dt<l.duration&&(h=l.dt)),l=fp({duration:h,delay:0,interpolator:ge,endValue:e,getter:Ze,setter:function(e){Qe(e,{isMagnification:r}),ke()},onDone:function(){W=!1,Xe.forEach((function(e){return e()})),Xe.clear(),s()}}),v.publish("startAnimation",l)}}},et=function(e){var t=Math.log(Math.abs(e)+1),n=-Math.sign(e)*t,r=Ze(),i=Math.min(Math.max(1,r*(1+.075*n)),3*J);return te=i/J,Qe(i,{isMagnification:!0}),r!==i},tt=function(){te=3,Je(3*J,{isMagnification:!0})},rt=function(){te=1,Je(J,{isMagnification:!0})},ot=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.easing,i=n.onDone,o=void 0===i?at:i,a=nt(e,t,I.x,I.y);if(a<3)return ct(e,t),a>1e-9&&v.publish("updatePileBounds",{id:m}),o(),null;$=!0;var s=250*de(Math.min(a,250)/250);return f&&(v.publish("cancelAnimation",f),f.dt<f.duration&&(s=f.dt)),fp({duration:s,delay:0,easing:r,interpolator:me,endValue:[e,t],getter:function(){return[I.x,I.y]},setter:function(e){return ct(e[0],e[1])},onDone:function(){$=!1,v.publish("updatePileBounds",{id:m}),o()}})},st=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.easing,i=n.onDone,o=void 0===i?at:i;return new Promise((function(n){Bt(),(f=ot(e,t,{easing:r,onDone:function(){n(b.state.piles[m]),Nt(),o()}}))&&v.publish("startAnimation",f)}))},ut=function(){var e=O[0].item.image;e.scaleFactor!==K&&(K=e.scaleFactor,Z=e.center)},ct=function(e,t){return I.x=Math.round(e),I.y=Math.round(t),Math.hypot(I.x-e,I.y-t)>1e-9},lt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==e){var t=ft(e);if(ht(t)){var n=t.item.image;t.replaceImage(n)}else if(pt(t)){var r=t.item.preview;r?t.replaceImage(r):gt(t.item)}}else A.forEach((function(e){e.replaceImage(e.item.image)})),j.forEach((function(e){e.item.preview?e.replaceImage(e.item.preview):gt(e.item)}))},ft=function(e){return A.get(e)||j.get(e)},ht=function(e){return A.has(e.id)},pt=function(e){return j.has(e.id)},dt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.asPreview,r=void 0===n?null:n;return!1===r?ht(e):!0===r?pt(e):ht(e)||pt(e)},gt=function(e){if(!dt(e,{asPreview:!1})){var t=ft(e.id),n=pp({image:e.image,item:e,pubSub:v}),r=O.indexOf(t);O.splice(r,1,n),C.delete(j.get(e.id).displayObject),P.set(n.displayObject,e.id),j.delete(e.id),A.set(e.id,n),N.removeChildAt(N.getChildIndex(t.displayObject)),B.addChild(n.displayObject)}},mt=function(e){if(!dt(e,{asPreview:!0})&&e.preview){var t=ft(e.id),n=pp({image:e.preview,item:e,pubSub:v}),r=O.indexOf(t);O.splice(r,1,n),P.delete(A.get(e.id).displayObject),C.set(n.displayObject,e.id),A.delete(e.id),j.set(e.id,n),B.removeChildAt(B.getChildIndex(t.displayObject)),Ge(n.displayObject),N.addChild(n.displayObject)}},vt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.asPreview,r=void 0!==n&&n;!0===r?mt(e):gt(e)},yt=function(e){var t=pp({image:e.image,item:e,pubSub:v});O.push(t)>1&&_.add(t),A.set(t.id,t),P.set(t.displayObject,t.id),B.addChild(t.displayObject)},bt=function(e){if(e.preview){var t=pp({image:e.preview,item:e,pubSub:v});O.push(t),_.add(t),j.set(t.id,t),C.set(t.displayObject,t.id),Ge(t.displayObject),N.addChild(t.displayObject)}},wt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.asPreview,r=void 0!==n&&n;dt(e)?dt(e,{asPreview:!r})&&vt(e,{asPreview:r}):(r?bt(e):yt(e),1===O.length&&ut())},xt=function(e){var t=ft(e.id),n=O.indexOf(t);n>=0&&O.splice(n,1),dt(e,{asPreview:!1})&&(B.removeChildAt(B.getChildIndex(t.displayObject)),P.delete(t.displayObject)),dt(e,{asPreview:!0})&&(N.removeChildAt(N.getChildIndex(t.displayObject)),C.delete(t.displayObject)),A.delete(e.id),j.delete(e.id)},St=function(){B.removeChildren(),N.removeChildren(),O.splice(0,O.length),A.clear(),j.clear(),P.clear(),C.clear()},Et=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.asPreview,r=void 0!==n&&n,i=t.shouldDrawPlaceholder,o=void 0!==i&&i;o&&It();var a=it(A,j);e.forEach((function(e){dt(e)?(a.delete(e.id),vt(e,{asPreview:r})):wt(e,{asPreview:r})})),a.forEach((function(e){xt(e)}))},kt=function(e){e?(r=e).then((function(e){for(n=e;D.children.length;)D.removeChildAt(0);D.addChild(n.displayObject),v.publish("updatePileBounds",{id:m,forceUpdate:!0}),ke()})):Mt()},Mt=function(){if(n){for(;D.children.length;)D.removeChildAt(0);n=void 0,r=void 0}},Ot=[],At=[],jt=[],Pt=[],Ct=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ot,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:At,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:jt,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Pt;if(e.length){if(Ot=e,At=n,jt=r,Pt=i,!G&&!W){h?(h.clear(),h.removeChildren()):(h=new t.Graphics,I.addChild(h));var o=b.state,a=o.pileLabelHeight,s=o.pileLabelAlign,u=o.pileLabelFontSize,c=o.pileLabelStackAlign,l=o.pileLabelText,f=o.pileLabelTextOpacity,d=o.piles,v=Bn(s,d[m]),y=Bn(u,d[m]),w=Bn(c,d[m]),x=Bn(a,d[m]),S=fe(),E=xe(l)?l(d[m]):l,k=S.width/e.length,M=jt.length?Math.max(E*(y+1),x):x,O="top"===v?S.y-M:S.y+S.height,A=1+-2*(O<0);if(e.forEach((function(e,t){var r,o,a=O+A,s=M;switch(w){case"vertical":k=S.width*i[t],o=-S.width/2,a+=(s+1)*t*A;break;case"horizontal":default:o=k*t-S.width/2,s=M*i[t],"top"===v&&(a+=M-s)}var u=n[t];(r=h).beginFill.apply(r,p(u)),h.drawRect(o,a,k,s),h.endFill()})),E){var j=S.width/jt.length;jt.forEach((function(e,n){var r=new t.Sprite(e);switch(r.y=O+A,w){case"vertical":r.anchor.set(0,0),r.x=-S.width/2+2,r.y+=(M+1)*n*A;break;case"horizontal":default:r.anchor.set(.5,0),r.x=j*n-S.width/2+j/2}r.width/=2*window.devicePixelRatio,r.height/=2*window.devicePixelRatio,r.alpha=f,h.addChild(r)}))}g()}}else h&&(Ot=[],At=[],jt=[],h.clear(),h.removeChildren(),g())},_t=!1,It=function(){d||(d=new t.Graphics,T.addChild(d));var e=X.width/J/ee,n=X.height/J/ee,r=e/12,i=b.state.darkMode?16777215:0;d.lineStyle(0).beginFill(i,1).drawCircle(-e/4,0,r).drawCircle(0,0,r).drawCircle(e/4,0,r).endFill(),d.beginFill(i,.1).drawRect(-e/2,-n/2,e,n).endFill(),_t=!0,g()},Rt=function(){d.clear(),_t=!1,g()},Tt=function(e){ee=e,Ke()},Lt=!1,Bt=function(){Lt&&(O.forEach((function(e){return e.disableInteractivity()})),I.interactive=!1,I.buttonMode=!1,F.interactive=!1,I.off("pointerover",Ce).off("pointerout",_e).off("pointerdown",Ie).off("pointerup",Re).off("pointerupoutside",Re).off("pointermove",Te),Lt=!1)},Nt=function(){Lt||(O.forEach((function(e){return e.enableInteractivity()})),I.interactive=!0,I.buttonMode=!0,F.interactive=!0,I.on("pointerover",Ce).on("pointerout",_e).on("pointerdown",Ie).on("pointerup",Re).on("pointerupoutside",Re).on("pointermove",Te),Lt=!0)},Dt=function(){I.addChild(L),L.addChild(R),L.addChild(T),T.addChild(B),T.addChild(N),T.addChild(D),T.addChild(z),T.addChild(F),T.addChild(V),I.x=E,I.y=M,Nt()};return Dt(),{get anchorBox(){return X},get baseScale(){return J},get bBox(){return Y},get cover(){return n},get graphics(){return I},get contentContainer(){return T},get height(){return L.height},get isFocus(){return q},set isFocus(e){q=!!e},get isHover(){return Pe},get isInteractive(){return Lt},get isMagnified(){return te>1},get isTempDepiled(){return H},set isTempDepiled(e){H=!!e},get normalItemContainer(){return B},get offset(){return[(Z[0]-X.localXOffset)*J,(Z[1]-X.localYOffset)*J]},get previewItemContainer(){return N},get items(){return[].concat(O)},get magnification(){return te},get size(){return O.length},get tempDepileContainer(){return F},get width(){return L.width},get x(){return I.x},get y(){return I.y},id:m,animateMoveTo:st,animateOpacity:Ue,animateScale:Je,blur:Me,disableInteractivity:Bt,enableInteractivity:Nt,hover:Oe,focus:Ae,active:je,addItem:wt,animatePositionItems:qe,calcBBox:Ne,destroy:re,drawBorder:ke,drawPlaceholder:It,drawSizeBadge:he,getMoveToTweener:ot,getItemById:ft,hasItem:dt,magnifyByWheel:et,magnify:tt,moveTo:ct,positionItems:$e,removeAllItems:St,removePlaceholder:Rt,setBorderSize:we,setItems:Et,drawLabel:Ct,setCover:kt,setScale:Qe,setOpacity:Ve,setVisibilityItems:Ye,setItemOrder:He,setZoomScale:Tt,showSizeBadge:ve,updateBounds:ze,updateOffset:ut,replaceItemsImage:lt,unmagnify:rt}};function Sp(e,t,n){var r=n[0],i=n[1];if(Math.abs(t)<1e-6)return e<0;var o=e/t;if(t>0){if(o>i)return 0;o>r&&(n[0]=o)}else{if(o<r)return 0;o<i&&(n[1]=o)}return 1}function Ep(e,t,n,r,i){var o=e[0],a=e[1],s=t[0]-o,u=t[1]-a;if(void 0===r||void 0===i?(r=e,i=t):(r[0]=e[0],r[1]=e[1],i[0]=t[0],i[1]=t[1]),Math.abs(s)<1e-6&&Math.abs(u)<1e-6&&o>=n[0]&&o<=n[2]&&a>=n[1]&&a<=n[3])return 1;var c=[0,1];if(Sp(n[0]-o,s,c)&&Sp(o-n[2],-s,c)&&Sp(n[1]-a,u,c)&&Sp(a-n[3],-u,c)){var l=c[0],f=c[1];return f<1&&(i[0]=o+f*s,i[1]=a+f*u),l>0&&(r[0]+=l*s,r[1]+=l*u),1}return 0}function kp(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kp(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kp(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Op=function(e){var t=e.width,n=e.height,r=e.orderer,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.cellSize,a=void 0===o?null:o,s=i.columns,u=void 0===s?10:s,c=i.rowHeight,l=void 0===c?null:c,f=i.cellAspectRatio,h=void 0===f?1:f,d=i.pileCellAlignment,g=void 0===d?"topLeft":d,m=i.cellPadding,v=void 0===m?0:m,b=u;+a||+u||(b=10);var w=t/b,x=w-2*v,S=null;+a&&(w=a+2*v,b=Math.floor(t/w),x=a),+l?h=w/l:(+h||(h=1),l=w/h),S=l-2*v;var E=w/2,k=l/2,M=Ee([E,k]),O=Math.ceil(n/l),A=function(e,t){return e*b+t},j=r(b),P=function(e,t){return[Math.floor(t/l),Math.floor(e/w)]},C=function(e,t,n,r,i){var o=e*l+v,a=t*w+v;if(!n||!r)return[a,o];switch(a+=i[0],o+=i[1],g){case"topRight":return[a+x-n,o];case"bottomLeft":return[a,o+S-r];case"bottomRight":return[a+x-n,o+S-r];case"center":return[a+(x-n)/2,o+(S-r)/2];case"topLeft":default:return[a,o]}},_=function(e,t,n,r){return C.apply(void 0,p(j(e)).concat([t,n,r]))},I=function(e,r){return[e*t,r*n]},R=function(e){var t="minX",n="minY";switch(g){case"topRight":t="maxX";break;case"bottomLeft":n="maxY";break;case"bottomRight":t="maxX",n="maxY";break;case"center":t="cX",n="cY"}return[e.anchorBox[t],e.anchorBox[n]]},T=function(e){var t=[],n=[],r=new Map;e.forEach((function(e){var t=R(e),n=y(t,2),i=n[0],o=n[1];r.set(e.id,Mp(Mp({id:e.id},e.anchorBox),{},{x:i,y:o,offset:e.offset}))}));var i=function(e){var r,i,o=(e.minY+1)/l,a=(e.minX+1)/w,s=(e.maxY-1)/l,u=(e.maxX-1)/w;switch(g){case"topRight":i=Math.floor(u);break;case"bottomLeft":r=Math.floor(s);break;case"bottomRight":r=Math.floor(s),i=Math.floor(u);break;case"center":r=Math.floor(o+(s-o)/2),i=Math.floor(a+(u-a)/2);break;case"topLeft":default:r=Math.floor(o),i=Math.floor(a)}var c=A(r,i);return t[c]||(t[c]=new Set),1===t[c].size&&n.push(c),t[c].add(e.id),[r,i]};r.forEach((function(e){var t=i(e),n=y(t,2),o=n[0],a=n[1];r.set(e.id,Mp(Mp({},e),{},{i:o,j:a}))}));for(var o=function(){var e=n.shift(),o=C.apply(void 0,p(j(e))),a=[o[0],o[1],o[0]+w,o[1]+l];o[0]+=E,o[1]+=k;var s=new Set(t[e]),u=tt,c=e-b,f=c<0||t[c]&&t[c].size,h=e-1,d=h<0||e%b==0||t[h]&&t[h].size,g=e+1,m=g%b==0||t[g]&&t[g].size,v=function(e){return e},x=function(e){return e};f&&(o[1]-=k,x=function(e){return Math.max(0,e)}),d&&(o[0]-=E,v=function(e){return Math.max(0,e)}),m&&(o[0]+=E,v=d?function(){return 0}:function(e){return Math.min(0,e)}),d&&m&&(x=function(){return f?1:-1},f&&(u=function(e,t,n,r){return Math.abs(t-r)})),f&&d&&m&&(x=function(){return f?1:-1});var S=1/0,O=void 0;s.forEach((function(e){var t=r.get(e),n=u(t.x,t.y,o[0],o[1]);n<S&&(O=e,S=n)})),s.forEach((function(n){n!==O&&t[e].delete(n)})),s.forEach((function(e){if(e!==O){var t=r.get(e),n=[t.x-r.get(O).x,t.y-r.get(O).y];n[0]+=(Math.sign(n[0])||1)*Math.random(),n[1]+=(Math.sign(n[1])||1)*Math.random(),n=Ie([v(n[0]),x(n[1])]);var o=[t.x+M*n[0],t.y+M*n[1]],s=[].concat(o);Ep([t.x,t.y],s,a),s[0]+=.1*Math.sign(n[0]),s[1]+=.1*Math.sign(n[1]);var u=s[0]-t.x,c=s[1]-t.y;t.minX+=u,t.minY+=c,t.maxX+=u,t.maxY+=c,t.cX+=u,t.cY+=c,t.x+=u,t.y+=c;var l=i(t),f=y(l,2),h=f[0],p=f[1];r.set(e,Mp(Mp({},t),{},{i:h,j:p}))}}))};n.length;)o();return Array.from(r.entries(),(function(e){var t=y(e,2),n=t[0],i=t[1],o=i.i,a=i.j,s=C(o,a,r.get(n).width,r.get(n).height,r.get(n).offset),u=y(s,2);return{id:n,x:u[0],y:u[1]}}))};return{get numRows(){return O},set numRows(e){Number.isNaN(+e)||(O=e)},numColumns:b,columnWidth:w,rowHeight:l,cellWidth:x,cellHeight:S,cellAspectRatio:h,cellPadding:v,width:t,height:n,align:T,getPilePosByCellAlignment:R,ijToXy:C,ijToIdx:A,idxToIj:j,idxToXy:_,uvToXy:I,xyToIj:P}},Ap=function e(t){var n=t.id,r=t.image,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.preview,a=void 0===o?null:o,s=i.originalPosition,u=void 0===s?[0,0]:s,c=function(){return function(e){return Ue(e,{destroy:function(){r&&r.destroy(),a&&a.destroy()}})}},l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r.destroy(),r=e,a&&(a.destroy(),a=null),a=t},f=function(){return function(e){return Ue(e,{replaceImage:l})}};return $e(et("id",n),Je("image",(function(){return r})),Je("preview",(function(){return a})),Qe("originalPosition",{initialValue:u,cloner:function(e){return p(e)}}),c(),f(),Ke(e))({})},jp=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t){const n=RegExp(e,"g");return e=>{if("string"!=typeof e)throw new TypeError("expected an argument of type string, but got ".concat(typeof styleObj));return e.match(n)?e.replace(n,t):e}};t.default=n})),Pp=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.snakeToKebab=t.camelToKebab=void 0;var n,r=(n=jp)&&n.__esModule?n:{default:n};const i=(0,r.default)(/[A-Z]/,e=>"-".concat(e.toLowerCase()));t.camelToKebab=i;const o=(0,r.default)(/_/,()=>"-");t.snakeToKebab=o})),Cp=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t=Pp.camelToKebab){if(!e||"object"!=typeof e||Array.isArray(e))throw new TypeError("expected an argument of type object, but got ".concat(typeof e));return Object.keys(e).map(n=>"".concat(t(n),": ").concat(e[n],";")).join("\n")};t.default=n})),_p=o(a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createParser",{enumerable:!0,get:function(){return r.default}}),t.parsers=t.default=void 0;var n=o(Cp),r=o(jp),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(Pp);function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.parsers=i;var s=n.default;t.default=s,e.exports=n.default,e.exports.createParser=r.default,e.exports.parsers=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){a(e,t,n[t])}))}return e}({},i)}))),Ip={root:{position:"absolute",zIndex:2,display:"none"},ul:{listStyle:"none",padding:0,margin:0,borderRadius:"0.25rem",backgroundColor:"white",boxShadow:"0 0 0 1px rgba(0, 0, 0, 0.25), 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 2px 6px 0 rgba(0, 0, 0, 0.075)"},button:{width:"100%",height:"1.5rem",margin:0,padding:"0.25rem 0.5rem",fontSize:"0.85rem",color:"black",border:"none",backgroundColor:"transparent",cursor:"pointer",outline:"none",whiteSpace:"nowrap"},"button:hover":{backgroundColor:"#ff7ff6"},"button:active":{backgroundColor:"#dd33ff"},"button.inactive":{cursor:"default",opacity:.3,backgroundColor:"transparent !important"},"li:first-child > button":{borderRadius:"0.25rem 0.25rem 0 0"},"li:last-child > button":{borderRadius:"0 0 0.25rem 0.25rem"}},Rp='<ul id="piling-js-context-menu-list">\n  <li>\n    <button id="depile-button">Depile</button>\n  </li>\n  <li>\n    <button id="temp-depile-button">Temp. Depile</button>\n  </li>\n  <li>\n    <button id="browse-separately">Browse Separately</button>\n  </li>\n  <li>\n    <button id="grid-button">Show Grid</button>\n  </li>\n  <li>\n    <button id="align-button">Align by Grid</button>\n  </li>\n  <li>\n    <button id="magnify-button">Magnify</button>\n  </li>\n</ul>',Tp=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.template,n=void 0===t?Rp:t,r=e.styles,i=void 0===r?Ip:r,o=e.customItems,a=void 0===o?[]:o,s=document.createElement("nav");s.id="piling-js-context-menu";var u=document.createElement("style");u.setAttribute("type","text/css");var c="";Object.entries(i).forEach((function(e){var t=y(e,2),n=t[0],r=t[1],i="root"===n?"":" ".concat(n);c+="#piling-js-context-menu".concat(i," { ").concat(_p(r)," }\n")})),u.textContent=c,s.appendChild(u),s.insertAdjacentHTML("beforeend",n);var l=s.querySelector("#piling-js-context-menu-list");return a.forEach((function(e,t){var n=document.createElement("li"),r=document.createElement("button");r.textContent=e.label,e.id?r.id=e.id:r.id="piling-js-context-menu-custom-item-".concat(t),n.appendChild(r),l.appendChild(n)})),s},Lp=function(){return Ne('<svg class="pilingjs-spinner" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg" width="40" height="40">\n  <circle\n    class="pilingjs-spinner-circle"\n    cx="20"\n    cy="20"\n    r="18"\n    stroke-width="4"\n    fill="none"\n    stroke="black" />\n  <g class="pilingjs-spinner-block-offset" transform="translate(20, 20)">\n    <g class="pilingjs-spinner-blocks">\n      <animateTransform\n        attributeName="transform"\n        attributeType="XML"\n        dur="1.5s"\n        from="0"\n        repeatCount="indefinite"\n        to="360"z\n        type="rotate" />\n      <path\n        class="pilingjs-spinner-block-one"\n        d="M0-20c1.104,0,2,0.896,2,2s-0.896,2-2,2V0l-4,21h25v-42H0V-20z"\n        fill="white">\n        <animateTransform\n          attributeName="transform"\n          attributeType="XML"\n          calcMode="spline"\n          dur="1.5s"\n          from="0"\n          values="0; 360"\n          keyTimes="0; 1"\n          keySplines="0.2 0.2 0.15 1"\n          repeatCount="indefinite"\n          to="360"\n          type="rotate" />\n      </path>\n      <path\n        class="pilingjs-spinner-block-two"\n        d="M0-20c-1.104,0-2,0.896-2,2s0.896,2,2,2V0l4,21h-25v-42H0V-20z"\n        fill="white">\n        <animateTransform\n          attributeName="transform"\n          attributeType="XML"\n          calcMode="spline"\n          dur="1.5s"\n          from="0"\n          values="0; 360"\n          keyTimes="0; 1"\n          keySplines="0.1 0.15 0.8 0.8"\n          repeatCount="indefinite"\n          to="360"\n          type="rotate" />\n      </path>\n    </g>\n  </g>\n</svg>\n')},Bp=function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=Lp(),r=function(){var e=t?"white":"black",r=t?"black":"white";n.querySelector(".pilingjs-spinner-circle").setAttribute("stroke",e),n.querySelector(".pilingjs-spinner-block-one").setAttribute("fill",r),n.querySelector(".pilingjs-spinner-block-two").setAttribute("fill",r)},i=function(e){var n=e.darkMode;t=Rn(void 0===n?null:n,t),r()};return r(),$e(et("element",n),Ke(e))({set:i})},Np=function(){var e=document.createElement("fake-element"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",MSTransition:"msTransitionEnd",OTransition:"oTransitionEnd",transition:"transitionEnd"};for(var n in t)if(void 0!==e.style[n])return t[n];return"transitionEnd"}(),Dp=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.backgroundOpacity,i=void 0===n?.85:n,o=t.isDarkMode,a=void 0!==o&&o,u=i,c=a,l=function(){return c?"black":"white"},f=function(){return c?"white":"black"},h=function(){return c?"rgba(0, 0, 0, ".concat(u,")"):"rgba(255, 255, 255, ".concat(u,")")},p=document.createElement("div");p.className="pilingjs-popup-background",p.style.position="absolute",p.style.top=0,p.style.left=0,p.style.zIndex=-1,p.style.display="flex",p.style.flexDirection="column",p.style.justifyContent="center",p.style.width="100%",p.style.height="0px",p.style.background=h(),p.style.opacity=0,p.style.transition="opacity 250ms ".concat("cubic-bezier(0.645, 0.045, 0.355, 1)");var d=document.createElement("div");p.className="pilingjs-popup-wrapper",d.style.position="relative",d.style.display="flex",d.style.margin="2rem",d.style.maxHeight="100%",p.appendChild(d);var g=document.createElement("div");p.className="pilingjs-popup-window",g.style.position="relative",g.style.minwidth="4rem",g.style.maxWidth="100%",g.style.maxHeight="100%",g.style.margin="2rem auto",g.style.color=l(),g.style.borderRadius="0.5rem",g.style.background=f(),g.style.transform="scale(0)",g.style.transition="transform 250ms ".concat("cubic-bezier(0.645, 0.045, 0.355, 1)"),d.appendChild(g);var m=document.createElement("div");p.className="pilingjs-popup-content",m.style.position="relative",m.style.display="flex",m.style.flexDirection="column",m.style.alignItems="center",m.style.padding="1rem",m.style.maxHeight="calc(100vh - 4rem)",m.style.overflow="auto",g.appendChild(m);var v=document.createElement("div");p.className="pilingjs-popup-icon",m.appendChild(v);var y=Bp(!c);v.appendChild(y.element);var b=document.createElement("p");b.style.margin="0",m.appendChild(b);var w=!1,x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.text,n=void 0===t?null:t,r=e.showSpinner,i=void 0===r||r;return new Promise((function(e){p.addEventListener(Np,e,{once:!0}),w=!0,p.style.zIndex=99,p.style.height="100%",p.style.opacity=1,g.style.transform="scale(1)",v.style.display=i?"block":"none",v.style.margin=n?"0 0 0.5rem 0":"0",b.textContent=n}))},S=function(){return new Promise((function(e){w=!1,p.addEventListener(Np,r(s.mark((function t(){return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return p.style.zIndex=-1,p.style.height="0px",b.textContent=null,t.next=5,ft();case 5:e();case 6:case"end":return t.stop()}}),t)}))),{once:!0}),p.style.opacity=0,g.style.transform="scale(0)"}))},E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.backgroundOpacity,n=void 0===t?null:t,r=e.darkMode,i=void 0===r?null:r;u=Rn(n,u),c=Rn(i,c),g.style.color=l(),g.style.background=f(),p.style.background=h(),y.set({darkMode:!c})},k=function(){return function(e){return Ue(e,{close:S,open:x,set:E})}};return $e(Je("isOpen",(function(){return w})),et("element",p),k(),Ke(e))({})},zp=document.createElement("style");document.head.appendChild(zp);var Fp=zp.sheet,Vp=function(e){var t=Fp.length;return Fp.insertRule(e,t),t},Up=function(e){Fp.deleteRule(e)},Yp="".concat(2500,"ms ease scaleInFadeOut 0s 1 normal backwards"),Xp=function(e,t){return"\n@keyframes scaleInFadeOut {\n  0% {\n    opacity: ".concat(e,";\n    transform: translate(-50%,-50%) scale(").concat(t,");\n  }\n  10% {\n    opacity: 1;\n    transform: translate(-50%,-50%) scale(1);\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0.9);\n  }\n}\n")},qp=null,Hp="".concat(250,"ms ease fadeScaleOut 0s 1 normal backwards"),Gp=function(e,t){return"\n@keyframes fadeScaleOut {\n  0% {\n    opacity: ".concat(e,";\n    transform: translate(-50%,-50%) scale(").concat(t,");\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0);\n  }\n}\n")},Wp=null,$p=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.fillColor,o=void 0===i?null:i,a=n.fillOpacity,u=void 0===a?.15:a,c=n.isShowStartIndicator,l=void 0===c||c,f=n.isDarkMode,h=void 0!==f&&f,d=n.onDraw,g=void 0===d?ve:d,m=n.onStart,v=void 0===m?ve:m,b=n.startIndicatorOpacity,w=void 0===b?.1:b,x=n.strokeColor,S=void 0===x?null:x,E=n.strokeOpacity,k=void 0===E?.8:E,M=n.strokeSize,O=void 0===M?1:M,A=o,j=u,P=l,C=h,_=w,I=S,R=k,T=O,L=g,B=v,N=new t.Container,D=new t.Container,z=new t.Graphics,F=new t.Graphics;N.addChild(z),D.addChild(F);var V=function(){return A||C?16777215:0},U=function(){return A||C?16777215:0},Y=function(){return C?"rgba(255, 255, 255, ".concat(_,")"):"rgba(0, 0, 0, ".concat(_,")")},X=document.createElement("div");X.id="lasso-start-indicator",X.style.position="absolute",X.style.zIndex=1,X.style.width="4rem",X.style.height="4rem",X.style.borderRadius="4rem",X.style.opacity=.5,X.style.transform="translate(-50%,-50%) scale(0)";var q,H=!1,G=!1,W=[],$=[],K=function(){H=!1},Z=function(e){var t=e.target.parentElement;if(t){var n=t.getBoundingClientRect();ne([e.clientX-n.left,e.clientY-n.top])}},Q=function(){H=!0,G=!0,se(),B()},J=function(){re()};window.addEventListener("mouseup",K);var ee=function(){X.style.opacity=.5,X.style.transform="translate(-50%,-50%) scale(0)"},te=function(){var e=getComputedStyle(X),t=+e.opacity,n=e.transform.match(/([0-9.-]+)+/g);return{opacity:t,scale:n?+n[0]:1}},ne=function(){var e=r(s.mark((function e(t){var n,r,i,o,a,u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=y(t,2),r=n[0],i=n[1],e.next=3,pt(0);case 3:if(!H){e.next=5;break}return e.abrupt("return");case 5:return o=.5,a=0,P&&(u=te(),o=u.opacity,a=u.scale,X.style.opacity=o,X.style.transform="translate(-50%,-50%) scale(".concat(a,")")),X.style.animation="none",e.next=11,ft(2);case 11:return X.style.top="".concat(i,"px"),X.style.left="".concat(r,"px"),null!==qp&&Up(qp),qp=Vp(Xp(o,a)),X.style.animation=Yp,e.next=18,ft();case 18:ee();case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),re=function(){var e=r(s.mark((function e(){var t,n,r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=te(),n=t.opacity,r=t.scale,X.style.opacity=n,X.style.transform="translate(-50%,-50%) scale(".concat(r,")"),X.style.animation="none",e.next=6,ft(2);case 6:return null!==Wp&&Up(Wp),Wp=Vp(Gp(n,r)),X.style.animation=Hp,e.next=11,ft();case 11:ee();case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ie=function(){z.clear(),F.clear(),W.length&&(z.lineStyle(T,U(),R),z.moveTo.apply(z,p(W[0])),W.forEach((function(e){z.lineTo.apply(z,p(e)),z.moveTo.apply(z,p(e))})),F.beginFill(V(),j),F.drawPolygon($)),L()},oe=function(e){q?nt(e[0],e[1],q[0],q[1])>2&&(W.push(e),$.push(e[0],e[1]),q=e,W.length>1&&ie()):(G||(G=!0,B()),W=[e],$=[e[0],e[1]],q=e)},ae=ht(oe,10,10),se=function(){W=[],$=[],q=void 0,ie()},ue=function(){G=!1;var e=p(W);return ae.cancel(),se(),e},ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fillColor,n=void 0===t?null:t,r=e.fillOpacity,i=void 0===r?null:r,o=e.onDraw,a=void 0===o?null:o,s=e.onStart,u=void 0===s?null:s,c=e.showStartIndicator,l=void 0===c?null:c,f=e.startIndicatorOpacity,h=void 0===f?null:f,p=e.strokeColor,d=void 0===p?null:p,g=e.strokeOpacity,m=void 0===g?null:g,v=e.strokeSize,y=void 0===v?null:v,b=e.darkMode,w=void 0===b?null:b;A=Rn(n,A),j=Rn(i,j),L=Rn(a,L),B=Rn(u,B),C=Rn(w,C),P=Rn(l,P),_=Rn(h,_),I=Rn(d,I),R=Rn(m,R),T=Rn(y,T),X.style.background=Y(),P?(X.addEventListener("click",Z),X.addEventListener("mousedown",Q),X.addEventListener("mouseleave",J)):(X.removeEventListener("mousedown",Q),X.removeEventListener("mouseleave",J))},le=function(){window.removeEventListener("mouseup",K),X.removeEventListener("click",Z),X.removeEventListener("mousedown",Q),X.removeEventListener("mouseleave",J)},fe=function(){return function(e){return Ue(e,{clear:se,destroy:le,end:ue,extend:oe,extendDb:ae,set:ce,showStartIndicator:ne})}};return ce({fillColor:A,fillOpacity:j,isShowStartIndicator:P,isDarkMode:C,onDraw:L,onStart:B,startIndicatorOpacity:_,strokeColor:I,strokeOpacity:R,strokeSize:T}),$e(et("startIndicator",X),et("fillContainer",D),et("lineContainer",N),fe(),Ke(e))({})};function Kp(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kp(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kp(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Qp(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Jp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Jp(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Jp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ed,td=(ed=2,(e,t)=>{const n=t.minX-e.minX,r=t.minX-e.maxX,i=t.maxX-e.minX,o=t.maxX-e.maxX,a=n<0&&i>0||r<0&&o>0||n>0&&r<0||i>0&&o<0,s=t.minY-e.minY,u=t.minY-e.maxY,c=t.maxY-e.minY,l=t.maxY-e.maxY,f=s<0&&c>0||u<0&&l>0||s>0&&u<0||c>0&&l<0;if(a&&f)return 0;const h=Math.min(Math.abs(s),Math.abs(u),Math.abs(c),Math.abs(l));if(a)return h;const p=Math.min(Math.abs(n),Math.abs(r),Math.abs(i),Math.abs(o));return f?p:(p**ed+h**ed)**(1/ed)}),nd=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=document.createElement("div");i.className="pilingjs-scroll-container";var o=document.createElement("div");o.className="pilingjs-scroll-element";var a=document.createElement("canvas");a.className="pilingjs-canvas";var u,c,l,f,h,g=L(),m=tp(),v=wr(),b=m.state,w=Vn,E=!1,k=new Float32Array(16),O=new Map,A=e.getBoundingClientRect(),j=A.width,C=A.height,_=!1,I=new t.Renderer({width:j,height:C,view:a,antialias:!0,transparent:!0,resolution:window.devicePixelRatio,autoDensity:!0,preserveDrawingBuffer:!1,legacy:!1,powerPreference:"high-performance"}),R=!0,T=null,B=!1,N=Promise.resolve(),z=new t.Container,F=new t.Container;z.addChild(F);var V=new t.Graphics,U=new t.Graphics,Y=new t.Sprite(t.Texture.WHITE);z.addChild(Y),F.mask=Y;var X=function(e,t){return function(n){if(xe(n))return[np[e](n)];var r=bn(n,null),i=y(r,2),o=i[0],a=i[1],s=[np[e](o)];return null!==a&&s.push(np[t](a)),s}},q={center:{get:function(){return h.target},set:function(e){h.lookAt(e,h.scaling,h.rotation)},noAction:!0},gridColor:{set:X("setGridColor","setGridOpacity")},items:{get:function(){return Object.values(b.items)},set:function(e){return[np.setItems(e),np.initPiles(e)]},batchActions:!0},lassoFillColor:{set:X("setLassoFillColor","setLassoFillOpacity")},lassoStrokeColor:{set:X("setLassoStrokeColor","setLassoStrokeOpacity")},layout:{get:function(){return{cellAspectRatio:we.cellAspectRatio,cellHeight:we.cellHeight,cellPadding:we.cellPadding,cellSize:we.cellSize,cellWidth:we.cellWidth,columnWidth:we.columnWidth,height:we.height,itemSize:we.itemSize,numColumns:we.numColumns,numRows:we.numRows,rowHeight:we.rowHeight,width:we.width}}},pileBorderColor:{set:X("setPileBorderColor","setPileBorderOpacity")},pileBorderColorHover:{set:X("setPileBorderColorHover","setPileBorderOpacityHover")},pileBorderColorFocus:{set:X("setPileBorderColorFocus","setPileBorderOpacityFocus")},pileBorderColorActive:{set:X("setPileBorderColorActive","setPileBorderOpacityActive")},pileBackgroundColor:{set:X("setPileBackgroundColor","setPileBackgroundOpacity")},pileBackgroundColorHover:{set:X("setPileBackgroundColorHover","setPileBackgroundOpacityHover")},pileBackgroundColorFocus:{set:X("setPileBackgroundColorFocus","setPileBackgroundOpacityFocus")},pileBackgroundColorActive:{set:X("setPileBackgroundColorActive","setPileBackgroundOpacityActive")},pileLabel:{set:function(e){var t=Si(e);return[np.setPileLabel(t)]}},pileLabelSizeTransform:{set:function(e){var t=Ei(e);return[np.setPileLabelSizeTransform(t)]}},pileLabelTextColor:{set:X("setPileLabelTextColor","setPileLabelTextOpacity")},pileSizeBadgeAlign:{set:function(e){return[np.setPileSizeBadgeAlign(xe(e)?e:Kn(e))]}},previewBackgroundColor:{set:X("setPreviewBackgroundColor","setPreviewBackgroundOpacity")},previewBorderColor:{set:X("setPreviewBorderColor","setPreviewBorderOpacity")},renderer:{get:function(){return b.itemRenderer},set:function(e){return[np.setItemRenderer(e)]}},rowHeight:!0,scale:{get:function(){return h.scaling},set:function(e){h.scale(e,[I.width/2,I.height/2])},noAction:!0}},H=function(e){return q[e]&&q[e].get?q[e].get():void 0!==b[e]?b[e]:void console.warn('Unknown property "'.concat(e,'"'))},G=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=q[e],i=[];if(r?r.set?i=r.set(t):console.warn('Property "'.concat(e,'" is not settable')):void 0!==b[e]?i=[np["set".concat(Ge(e))](t)]:console.warn('Unknown property "'.concat(e,'"')),n||r&&r.noAction)return i;r&&r.batchActions?m.dispatch(he(i)):i.forEach((function(e){return m.dispatch(e)}))},W=function(e){return e.items?new Promise((function(e){g.subscribe("itemUpdate",e,1)})):Promise.resolve()},$=function(e,t){if("string"==typeof e||e instanceof String){var n=W(d({},e,t));return G(e,t),n}var r=W(e);return m.dispatch(he(Object.entries(e).flatMap((function(e){var t=y(e,2),n=t[0],r=t[1];return G(n,r,!0)})))),r},K=function(){I.render(z),g.publish("render")},Z=D(K),Q=mn(K,g),J=new Map,te=new Map,ne=new t.Container,re=new t.Container,ie=new t.Sprite(t.Texture.WHITE);ie.alpha=0;var oe=function(){ne.children.length&&(re.addChild(ne.getChildAt(0)),ne.removeChildren())},ae=function(e){oe(),ne.addChild(e)},se=Dp(),ue=!1,ce=function(){ue&&(F.interactive=!1,F.interactiveChildren=!1,te.forEach((function(e){e.disableInteractivity()})),ue=!1)},fe=function(){ue||(F.interactive=!0,F.interactiveChildren=!0,te.forEach((function(e){e.enableInteractivity()})),ue=!0)},pe=!1,ge=!1,ye=$p({onStart:function(){ce(),ge=!0,pe=!0},onDraw:function(){Z()}});F.addChild(V),F.addChild(U),F.addChild(ye.fillContainer),F.addChild(re),F.addChild(ie),F.addChild(ne),F.addChild(ye.lineContainer);var we,Ee,Ie,Le=new ee,Ne=function(e,t){if(m.state.showSpatialIndex&&(U.clear(),U.beginFill(65280,.5),Le.all().forEach((function(e){U.drawRect(e.minX,e.minY,e.width,e.height)})),U.endFill(),e&&(U.beginFill(16711680,1),U.drawRect(e[0]-1,e[1]-1,3,3),U.endFill()),t)){U.lineStyle(1,16711680,1),U.moveTo(t[0],t[1]);for(var n=0;n<t.length;n+=2)U.lineTo(t[n],t[n+1]),U.moveTo(t[n],t[n+1])}},De=function(){Le.clear();var e=[];te&&(te.forEach((function(t){t.updateBounds.apply(t,p(Fe()).concat([!0])),e.push(t.bBox)})),Le.load(e),Ne())},ze=function(e){var t=te.get(e);Le.remove(t.bBox,(function(e,t){return e.id===t.id})),Ne()},Fe=function(){return T?h.translation:[0,F.y]},Ue=function(e){var t;return(t=te.get(e)).calcBBox.apply(t,p(Fe()))},Ye=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.forceUpdate,r=void 0!==n&&n,i=te.get(e);Le.remove(i.bBox,(function(e,t){return e.id===t.id})),i.updateBounds.apply(i,p(Fe()).concat([r])),Le.insert(i.bBox),Ne(),g.publish("pileBoundsUpdate",e)},Xe=function(e){var t=e.id,n=e.forceUpdate;return Ye(t,{forceUpdate:n})},qe=function(){O.forEach((function(e,t){At(te.get(t),e[0],e[1])})),Z()},He=function(){var e=m.state.zoomScale,t=xe(e)?e(h.scaling):e;te.forEach((function(e){e.setZoomScale(t),e.drawBorder()})),Z()},We=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];h.tick(),qe(),He(),B=!0,e&&$t(),g.publish("zoom",h)},$e=1,Ke=function(){if(h){var e=m.state,t=e.groupingType,n=e.groupingObjective,r=e.groupingOptions,i=e.splittingType,o=e.splittingObjective,a=e.splittingOptions,s=h.scaling,u=s/$e;t&&u<1&&gr(t,n,r),i&&u>1&&_r(i,o,a),$e=s}},Ze=lt(Ke,250),Qe=function(){B&&(B=!1,h.tick(),qe(),g.publish("zoom",h))},Je=function(){var e=a.getBoundingClientRect().height,t=Math.round(we.rowHeight)*(we.numRows+3);o.style.height="".concat(Math.max(0,t-e),"px"),m.state.showGrid&&at()},et=function(){return!1!==T&&(ot(),T=!1,c=ve,l=ve,f=ve,F.y=0,i.style.overflowY="auto",i.scrollTop=0,i.addEventListener("scroll",$i,Xn),window.addEventListener("mousedown",Vi,Xn),window.addEventListener("mouseup",Ui,Xn),window.addEventListener("mousemove",Yi,Xn),a.addEventListener("wheel",Wi,Yn),!0)},tt=function(){!1===T&&(F.y=0,i.style.overflowY="hidden",i.scrollTop=0,i.removeEventListener("scroll",$i),window.removeEventListener("mousedown",Vi),window.removeEventListener("mouseup",Ui),window.removeEventListener("mousemove",Yi),a.removeEventListener("wheel",Wi))},it=function(){return!0!==T&&(tt(),T=!0,c=qt,l=Ht,f=Gt,(h=P(a,{isNdc:!1,onMouseDown:Vi,onMouseUp:Ui,onMouseMove:Yi,onWheel:Wi,viewCenter:[j/2,C/2],scaleBounds:m.state.zoomBounds.map(nr)})).setView(x(Un)),!0)},ot=function(){!0===T&&(h.dispose(),h=void 0)},at=function(){var e=o.getBoundingClientRect().height+a.getBoundingClientRect().height,t=a.getBoundingClientRect().width,n=Math.ceil(t/we.columnWidth),r=Math.ceil(e/we.rowHeight),i=m.state,s=i.gridColor,u=i.gridOpacity;V.clear(),V.lineStyle(1,s,u);for(var c=1;c<n;c++)V.moveTo(c*we.columnWidth,0),V.lineTo(c*we.columnWidth,e);for(var l=1;l<r;l++)V.moveTo(0,l*we.rowHeight),V.lineTo(t,l*we.rowHeight)},ht=function(){V.clear()},pt=function(){var e=m.state.orderer;we=Op({width:j,height:C,orderer:e},m.state),Je()},dt=function(){var e=m.state.orderer,t=we;we=Op({width:j,height:C,orderer:e},m.state),_t(t),Je(),m.state.showGrid&&at()},gt=function(e){var t=e.width,n=e.height;g.subscribe("animationEnd",(function(){we.width===t&&we.height===n||(we=Op({width:t,height:n,orderer:m.state.orderer},m.state),dt())}),1)},mt=kr({element:a,pubSub:g,store:m},{onLeave:gt}),vt=function(){var e=r(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,se.open(t);case 2:T?h.config({isFixed:!0}):i.style.overflowY="hidden";case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),yt=function(){se.close(),T?h.config({isFixed:!1}):i.style.overflowY="auto"},bt=function(){var e=m.state,t=e.darkMode,n=e.haltBackgroundOpacity;se.set({backgroundOpacity:n,darkMode:t})},wt=function(){var e=m.state.darkMode;mt.set({darkMode:e})},xt=function(){var e=m.state,t=e.darkMode,n=e.lassoFillColor,r=e.lassoFillOpacity,i=e.lassoShowStartIndicator,o=e.lassoStartIndicatorOpacity,a=e.lassoStrokeColor,s=e.lassoStrokeOpacity,u=e.lassoStrokeSize;ye.set({fillColor:n,fillOpacity:r,showStartIndicator:i,startIndicatorOpacity:o,strokeColor:a,strokeOpacity:s,strokeSize:u,darkMode:t})},St=Dn(),Et=Dn(),kt=function(e){return e.aspectRatio>we.cellAspectRatio?St(e.originalWidth)/e.originalWidth:Et(e.originalHeight)/e.originalHeight},Mt=function(){if(J.size){var e=1/0,t=0,n=1/0,r=0;J.forEach((function(i){var o=i.image.originalWidth,a=i.image.originalHeight;o>t&&(t=o),o<e&&(e=o),a>r&&(r=a),a<n&&(n=a)}));var i,o,a=m.state,s=a.itemSizeRange,u=a.itemSize,c=a.piles,l=a.previewScaling,f=u||we.cellWidth,h=u||we.cellHeight;s[0]>0&&s[0]<=1&&s[1]>0&&s[1]<=1?(i=[f*s[0],f*s[1]],o=[h*s[0],h*s[1]]):(i=[0,f],o=[0,h]),St=Dn().domain([e,t]).range(i),Et=Dn().domain([n,r]).range(o),Object.values(c).forEach((function(e){var t=xe(l)?l(e):l;e.items.forEach((function(e){var n=J.get(e);if(n){var r=kt(n.image);if(n.image.scale(r),n.preview){var i=r*t[0]-1+1,o=r*t[1]-1+1;n.preview.scaleX(i),n.preview.scaleY(o),n.preview.rescaleBackground()}}}))})),te.forEach((function(e){if(e.cover){var t=kt(e.cover);e.cover.scale(t)}e.updateOffset(),e.drawBorder()}))}},At=function(e,t,n){return e.moveTo.apply(e,p(c([t,n])))},jt=function(e,t,n){At(e,t,n)&&Ye(e.id)},Pt=function(e,t,n,r){return e.getMoveToTweener.apply(e,p(c([t,n])).concat([r]))},Ct=function(e,t,n,r){return e.animateMoveTo.apply(e,p(c([t,n])).concat([r]))},_t=function(e){var t=m.state,n=t.arrangementType,r=t.items;if(Mt(),null!==n||T)Wt();else{var i=[];we.numRows=Math.ceil(J.size/we.numColumns),te.forEach((function(t){var n=e.getPilePosByCellAlignment(t),r=e.xyToIj(n[0],n[1]),o=y(r,2),a=o[0],s=o[1];t.updateOffset(),Ye(t.id,{forceUpdate:!0});var u=e.ijToIdx(a,s),c=we.idxToXy(u,t.anchorBox.width,t.anchorBox.height,t.offset),l=y(c,2),f=l[0],h=l[1];i.push({id:t.id,x:f,y:h})})),te.forEach((function(e){e.cover&&Kt(e.id)})),m.dispatch(np.movePiles(i)),J.forEach((function(e){e.setOriginalPosition(we.idxToXy(r[e.id].index,e.image.width,e.image.height,e.image.center))}))}De(),m.state.focusedPiles.filter((function(e){return te.has(e)})).forEach((function(e){te.get(e).focus()})),Je(),Z()},It=function(e){var t=Bn(m.state.pileBackgroundColor,e);return null!==t?t:w},Rt=function(e){var t=m.state,n=t.itemRenderer,i=t.previewBackgroundColor,o=t.previewBackgroundOpacity,a=t.pileBackgroundOpacity,u=t.previewAggregator,c=t.previewRenderer,l=t.previewPadding,f=t.piles,h=Object.values(e),p=n(h.map((function(e){return e.src}))).then((function(e){return e.map(cr)})),d=function(e,t){if(null===e)return null;var n=h[t],r=f[n.id],s=It(r),u={backgroundColor:i===qn?s:Ln(i,n),backgroundOpacity:o===qn?Bn(a,r):Ln(o,n),padding:Ln(l,n)};return op(e,u)},g=c?u||function(){var e=r(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.map((function(e){return e.src})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}():null;return[p,g?Promise.resolve(g(h)).then((function(e){return new Promise((function(t){var n=[];c(e.filter((function(e){return null!==e}))).then((function(r){var i=0;e.forEach((function(e){null===e?n.push(null):n.push(r[i++])})),t(n)}))}))})).then((function(e){return e.map(d)})):Promise.resolve([])]},Tt=function(){var e=r(s.mark((function e(){var t,n,r,i,o=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:null,n=m.state,r=n.items,i=n.piles,t||(t=r),e.next=5,vt();case 5:return e.abrupt("return",Promise.all(Rt(t)).then((function(e){var n=y(e,2),r=n[0],o=n[1],a=Object.keys(t);r.forEach((function(e,t){var n=a[t],r=o[n];J.has(n)&&J.get(n).replaceImage(e,r)})),a.forEach((function(e){if(te.has(e)){var t=te.get(e),n=i[e];t.replaceItemsImage(),t.blur(),Qt(n,e),Zt(n,e),oe()}else Object.values(i).forEach((function(t){if(t.items.includes(e)){var n=te.get(t.id);n.replaceItemsImage(e),n.blur()}}))})),te.forEach((function(e){nn(i[e.id],e)})),Mt(),Z(),yt()})));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Lt=function(){var e=r(s.mark((function e(t){var n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=Object.keys(t)).length){e.next=3;break}return e.abrupt("return",Promise.resolve());case 3:return e.next=5,vt();case 5:return e.abrupt("return",Promise.all(Rt(t)).then((function(e){var t=y(e,2),r=t[0],i=t[1],o=m.state.piles;r.forEach((function(e,t){var r=i[t],o=n[t],a=Ap({id:o,image:e,pubSub:g},{preview:r});J.set(o,a)})),r.forEach((function(e,t){var r=n[t],i=o[r];i.items.length&&Fn(r,i)})),Mt(),Z(),yt()})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Bt=function(e){return null===e.x||null===e.y},Nt=function(e){var t=te.get(e),n=we.idxToXy(Br[0][e],t.width,t.height,t.offset);return Promise.resolve(n)},Dt=function(e){return Promise.resolve(Fr.map((function(t,n){return t(Lr[e][n])})))},zt=new Map,Ft=0,Vt=function(){var e=r(s.mark((function e(t){var n,r,i,o,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=m.state.dimensionalityReducer,!zt.has(t)||Ur!==Ft){e.next=3;break}return e.abrupt("return",zt.get(t));case 3:return Ft=Ur,e.next=6,r.transform([Lr[t].flat()]);case 6:return i=e.sent,o=(n=we).uvToXy.apply(n,p(i[0])),1!==(a=te.get(t)).size||zt.has(t)||a.items[0].item.setOriginalPosition(o),zt.set(t,o),e.abrupt("return",o);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ut=function(e,t){var n=m.state,r=n.arrangementObjective,i=n.arrangementOptions,o=n.dimensionalityReducer;return r.length>2||i.forceDimReduction?o?Vt(e):Promise.resolve([t.x,t.y]):r.length>1?Dt(e):r.length?Nt(e):(console.warn("Can't arrange pile by data. No arrangement objective available."),Promise.resolve([t.x,t.y]))},Yt=function(e,t){if(t.isCustom)return t.property(e,e.index);var n=m.state.items;return t.aggregator(e.items.map((function(e){return t.property(n[e])})))},Xt=function(){var e=r(s.mark((function e(t,n){var r,i,o,a,u,c,l,f,h,d,g,v,y;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=m.state,o=i.arrangementType,a=i.arrangementObjective,u=i.piles,c=i.projector,l=te.get(t),f=u[t],h=Bt(f),g=n||h?a||Hn:a,v=function(e,t){return we.ijToXy(e,t,l.width,l.height,l.offset)},"data"!==(d=n||h?o||"index":o)){e.next=9;break}return e.abrupt("return",Ut(t,f));case 9:y=d&&Yt(f,g),e.t0=d,e.next="index"===e.t0?13:"ij"===e.t0?14:"xy"===e.t0?15:"uv"===e.t0?16:"custom"===e.t0?17:19;break;case 13:return e.abrupt("return",v.apply(void 0,p(we.idxToIj(y))));case 14:return e.abrupt("return",v.apply(void 0,p(y)));case 15:return e.abrupt("return",y);case 16:return e.abrupt("return",(r=we).uvToXy.apply(r,p(y)));case 17:if(!c){e.next=19;break}return e.abrupt("return",c(y));case 19:return e.abrupt("return",Promise.resolve([f.x,f.y]));case 20:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),qt=function(e){var t=Qn(e[0],e[1]);return M(t,t,h.view),t.slice(0,2)},Ht=function(e){var t=Qn(e[0],e[1]);return M(t,t,S(k,h.view)),t.slice(0,2)},Gt=function(e){return[e[0]-h.translation[0],e[1]-h.translation[1]]},Wt=function(){var e=r(s.mark((function e(){var t,n,r,i,o,a,u,c,l,f,h,d,g,v,b,w,x,S,E,k=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=k.length>0&&void 0!==k[0]?k[0]:[],n=k.length>1&&void 0!==k[1]?k[1]:{},r=n.immideate,i=void 0!==r&&r,o=m.state,a=o.arrangeOnGrouping,u=o.arrangementType,c=o.items,(l=!t.length)&&(t=Object.keys(m.state.piles)),0!==Object.keys(c).length){e.next=10;break}return De(),Je(),Z(),e.abrupt("return");case 10:if(f=[],(h=t.filter((function(e){return te.has(e)})).map((function(e){return te.get(e)}))).length){e.next=14;break}return e.abrupt("return");case 14:return e.next=16,N;case 16:d=Qp(h),e.prev=17,d.s();case 19:if((g=d.n()).done){e.next=32;break}return v=g.value,e.next=23,Xt(v.id,R);case 23:b=e.sent,O.set(v.id,b),w=y(b,2),x=w[0],S=w[1],(i||R)&&jt(v,x,S),f.push({id:v.id,x:x,y:S}),we.numRows=Math.max(we.numRows,Math.ceil(S/we.rowHeight)),(R||Bt(v)||u&&!a)&&J.get(v.id).setOriginalPosition([x,S]);case 30:e.next=19;break;case 32:e.next=37;break;case 34:e.prev=34,e.t0=e.catch(17),d.e(e.t0);case 37:return e.prev=37,d.f(),e.finish(37);case 40:R=!1,E=a?[]:Hr(),m.dispatch(he([np.movePiles(f)].concat(p(E)))),l&&De(),Je(),Z();case 46:case"end":return e.stop()}}),e,null,[[17,34,37,40]])})));return function(){return e.apply(this,arguments)}}(),$t=lt(Wt,100),Kt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.all,r=void 0!==n&&n,i=m.state,o=i.piles,a=i.pileOrderItems,s=te.get(e);if(s){if(xe(a)){var u=o[e];s.setItemOrder(a(u))}s.positionItems(Q,{all:r})}},Zt=function(e,t){var n=m.state,r=n.items,i=n.pileItemBrightness,o=n.pileItemInvert,a=n.pileItemOpacity,s=n.pileItemTint;te.get(t).items.forEach((function(t,n){var u=r[t.id];t.animateOpacity(xe(a)?a(u,n,e):a),t.image.invert(xe(o)?o(u,n,e):o),o||(t.image.brightness(xe(i)?i(u,n,e):i),i||t.image.tint(xe(s)?s(u,n,e):s))}))},Qt=function(e,t){var n=te.get(t);if(n){var r=m.state,i=r.pileOpacity,o=r.pileBorderSize,a=r.pileScale,s=r.pileSizeBadge,u=r.pileVisibilityItems;n.animateOpacity(xe(i)?i(e):i),n.animateScale(xe(a)?a(e):a),n.setBorderSize(xe(o)?o(e):o),n.showSizeBadge(xe(s)?s(e):s),n.setVisibilityItems(xe(u)?u(e):u),Z()}},Jt=function(e){var t=cr(e);return t.scale(kt(t)),t},en=function(e){var t=m.state,n=t.previewRenderer,r=t.previewScaling;if(n){var i=xe(r)?r(e):r;e.items.forEach((function(e){var t=J.get(e);if(t.preview){var n=kt(t.image),r=n*i[0]-1+1,o=n*i[1]-1+1;t.preview.scaleX(r),t.preview.scaleY(o)}}))}},tn=function(e,t){var n=m.state,r=n.items,i=n.coverRenderer,o=n.coverAggregator,a=n.pileCoverInvert,s=n.pileCoverScale,u=n.previewAggregator,c=n.previewRenderer,l=[],f=[];if(e.items.forEach((function(e){l.push(r[e]),f.push(J.get(e))})),t.setItems(f,{asPreview:!(!u&&!c),shouldDrawPlaceholder:!0}),!i)return t.setCover(null),void Kt(t.id,{all:!0});var h=Promise.resolve(o(l)).then((function(e){return i([e])})).then((function(t){var n=y(t,1)[0],r=Jt(n);r.invert(xe(a)?a(e):a);var i=xe(s)?s(e):s;return r.scale(r.scaleFactor*i),r}));t.setCover(h),h.then((function(){Kt(t.id),Ye(t.id),Z()}))},nn=function(e,t){1===e.items.length?(t.setCover(null),Kt(t.id),t.setItems([J.get(e.items[0])])):(en(e),tn(e,t))},rn=function(){var e=m.state,t=e.arrangementObjective,n=e.arrangementOptions;return t&&(t.length>2||n.forceDimReduction)},on=function(e,t){if(te.has(t)){var n=te.get(t);if(0===e.items.length)Gn(t);else{zt.delete(t);var r=e.items.map((function(e){return J.get(e)}));m.state.coverAggregator?nn(e,n):(m.state.previewRenderer&&en(e),n.setItems(r),Kt(t)),1===r.length&&rn()&&zt.set(t,r[0].originalPosition),Ye(t,{forceUpdate:!0}),Zt(e,t)}}else Fn(t,e)},an=function(e,t){var n=te.get(t);return n?(O.set(t,[e.x,e.y]),Promise.all([Ct(n,e.x,e.y),new Promise((function(e){g.subscribe("pileBoundsUpdate",(function(n){n===t&&(g.unsubscribe("pileBoundsUpdate",this),e())}))}))])):Promise.resolve()},sn=function(e){var t=Ot(new Uint16Array(new Array(we.numColumns*we.numRows).fill(0)),[we.numRows,we.olNum]);u=t,te.forEach((function(t){if(t.id!==e){var n=Math.floor(t.bBox.minX/we.columnWidth),r=Math.floor(t.bBox.minY/we.rowHeight),i=Math.floor(t.bBox.maxX/we.columnWidth),o=Math.floor(t.bBox.maxY/we.rowHeight);u.set(r,n,1),u.set(r,i,1),u.set(o,n,1),u.set(o,i,1)}}))},un=function(e,t){var n,r=1/0;t[0]-1>=0&&e.get(t[0]-1,t[1])<r&&(r=e.get(t[0]-1,t[1]),n=[t[0]-1,t[1]]),t[1]-1>=0&&e.get(t[0],t[1]-1)<r&&(r=e.get(t[0],t[1]-1),n=[t[0],t[1]-1]),t[0]+1<e.shape[0]&&e.get(t[0]+1,t[1])<r&&(r=e.get(t[0]+1,t[1]),n=[t[0]+1,t[1]]),t[1]+1<e.shape[1]&&e.get(t[0],t[1]+1)<r&&(r=e.get(t[0],t[1]+1),n=[t[0],t[1]+1]);var i=e.data.length;if(e.set(t[0],t[1],i),r===e.data.length)for(var o=0;o<e.shape[0];o++)for(var a=0;a<e.shape[1];a++)e.get(o,a)<r&&e.get(o,a)>0&&(r=e.get(o,a)),n=[o,a];return n},cn=function(e,t,n,r){if(-1===e.get(t,n)){var i=nt(t,n,r[0],r[1]);e.set(t,n,i)}},ln=function(e,t,n,r){for(var i,o=p(n),a=0;!i&&a<e.data.length;)t.get(o[0],o[1])<1&&(i=o),i||(o[0]-1>=0&&cn(e,o[0]-1,o[1],n),o[1]-1>=0&&cn(e,o[0],o[1]-1,n),o[0]+1<e.shape[0]&&cn(e,o[0]+1,o[1],n),o[1]+1<e.shape[1]&&cn(e,o[0],o[1]+1,n),o=un(e,o),a++);return i||(i=[t.shape[0]+1,Math.floor(r/2)],we.numRows+=r,Je()),i},fn=function(e,t){var n=Ot(new Float32Array(new Array(e*t).fill(1)),[t,e]),r=Ot(new Float32Array((we.numRows-t+1)*(we.numColumns-e+1)),[we.numRows-t+1,we.olNum-e+1]);return gn(r,u,n),r},hn=function(e,t,n){var r=fn(t,n),i=Ot(new Float32Array(new Array((we.numRows-n+1)*(we.numColumns-t+1)).fill(-1)),[we.numRows-n+1,we.numColumns-t+1]),o=ln(i,r,e,n);return{depilePos:o,distance:nt(o[0],o[1],e[0],e[1])}},pn=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return new Promise((function(r){var i=m.state.easing,o=[],a=te.get(e);a.blur(),a.drawBorder();var s=t.map((function(e){return te.get(e)})).filter(ve),u=0,l=function(){++u===s.length&&(o.forEach((function(e){Ye(e.id)})),m.dispatch(np.movePiles(o)),r())};Q.addBatch(s.map((function(e,t){var r=e.getItemById(e.id);o.push({id:e.id,x:r.item.originalPosition[0],y:r.item.originalPosition[1]});var a=n.length>0?n[t]:c(r.item.originalPosition),s=nt.apply(void 0,p(a).concat([e.x,e.y])),u=250*de(Math.min(s,250)/250);return fp({duration:u,easing:i,interpolator:me,endValue:[].concat(p(n.length>0?n[t]:c(r.item.originalPosition)),[0]),getter:function(){return[e.x,e.y,r.displayObject.angle]},setter:function(t){e.moveTo(t[0],t[1]),r.displayObject.angle=t[2]},onDone:l})})))}))},dn=function(e){var t=te.get(e).size;if(1!==t){sn(e);var n,r,i,o=te.get(e).bBox,a=Math.floor((o.minX+o.maxX)/(2*we.columnWidth)),s=[Math.floor((o.minY+o.maxY)/(2*we.rowHeight)),a],u=Math.ceil(Math.sqrt(t)),c=Math.ceil(t/u);if(u!==c){var l=hn(s,u,c),f=hn(s,c,u);n=l.distance>f.distance?f.depilePos:l.depilePos,i=l.distance>f.distance?c:u,r=l.distance>f.distance?u:c}else n=hn(s,u,c).depilePos,i=u,r=c;for(var h=m.state.piles,d=[],g=p(h[e].items),v=[],y=0;y<g.length;y++){var b=Math.floor(y/i)+n[0]-Math.floor((r-1)/2),w=y%i+n[1]-Math.floor((i-1)/2);v.push([w*we.columnWidth,b*we.rowHeight])}var x={items:g,x:h[e].x,y:h[e].y};d.push(x),m.dispatch(np.scatterPiles(d)),pn(e,g,v),m.dispatch(np.setDepiledPile([]))}},vn=function(e){var t=m.state.piles,n=p(t[e].items),r={items:n,x:t[e].x,y:t[e].y};m.dispatch(np.scatterPiles([r])),Pi(),m.state.arrangementType||pn(e,n)},wn=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.onDone,o=void 0===i?ve:i;Q.add(fp({interpolator:me,endValue:[t,n],getter:function(){return[e.x,e.y]},setter:function(t){e.x=t[0],e.y=t[1]},onDone:function(){o()}}))},xn=function(){ie.tint=m.state.darkMode?0:16777215,ie.width=j,ie.height=C,ie.alpha=.9},Sn=function(){ie.alpha=0},En=function(e){var t=m.state.piles;e.forEach((function(e){var t=te.get(e);oe(),Sn();var n=function(){t.tempDepileContainer.removeChildren(),t.isTempDepiled=!1,t.focus(),m.dispatch(np.setFocusedPiles([t.id])),Ye(e)};t.tempDepileContainer.children.forEach((function(e,r){var i=r===t.tempDepileContainer.children.length-1?{onDone:n}:void 0;wn(e,-t.tempDepileContainer.x,-t.tempDepileContainer.y,i)}))})),g.publish("pileInactive",{targets:e.map((function(e){return t[e]}))}),Z()},kn=function(e){var t=e.pile,n=e.tempDepileDirection,r=e.items,i=function(){t.isTempDepiled=!0,m.dispatch(np.setFocusedPiles([])),m.dispatch(np.setFocusedPiles([t.id]))},o=h?h.scaling:1,a=function(e){return e?{onDone:i}:void 0};if("horizontal"===n){t.tempDepileContainer.x=t.bBox.width/o,t.tempDepileContainer.y=0,t.tempDepileContainer.interactive=!0;var s=0;r.forEach((function(e,n){var i=yn(J.get(e).image.sprite);i.x=-t.tempDepileContainer.x,t.tempDepileContainer.addChild(i);var o=a(n===r.length-1);wn(i,5*n+s,0,o),s+=i.width}))}else if("vertical"===n){t.tempDepileContainer.x=0,t.tempDepileContainer.x=t.bBox.height/o,t.tempDepileContainer.interactive=!0;var u=0;r.forEach((function(e,n){var i=yn(J.get(e).image.sprite);i.y=-t.tempDepileContainer.y,t.tempDepileContainer.addChild(i);var o=a(n===r.length-1);wn(i,0,5*n+u,o),u+=i.height}))}},Mn=function(e){var t=e.pile,n=e.items,r=e.orderer,i=h?h.scaling:1;t.tempDepileContainer.x=t.bBox.width/i,t.tempDepileContainer.y=0;var o=Math.ceil(Math.sqrt(n.length)),a=function(){t.isTempDepiled=!0,m.dispatch(np.setFocusedPiles([])),m.dispatch(np.setFocusedPiles([t.id]))},s=r(o);n.forEach((function(e,r){var i=yn(J.get(e).image.sprite);i.x=-t.tempDepileContainer.x,t.tempDepileContainer.addChild(i);var o=s(r),u=y(o,2),c=u[0],l=u[1],f=c*(we.cellWidth+6),h=l*(we.cellHeight+6),p=r===n.length-1?{onDone:a}:void 0;wn(i,f,h,p)}))},On=function(e){var t=m.state,n=t.piles,r=t.tempDepileDirection,i=t.tempDepileOneDNum,o=t.orderer;e.forEach((function(e){var t=te.get(e);ae(t.graphics),xn(),t.enableInteractivity();var a=p(n[e].items);a.length<i?kn({pile:t,tempDepileDirection:r,items:a}):Mn({pile:t,items:a,orderer:o}),Ye(e)})),g.publish("pileActive",{targets:e.map((function(e){return n[e]}))}),Z()},An=function(e){var t=a.getBoundingClientRect();return[e.clientX-t.left,e.clientY-t.top-F.y]},jn=function(e){var t=Tn(e),n=Le.search(t),r=[];return n.forEach((function(t){(rt([t.minX,t.minY],e)||rt([t.minX,t.maxY],e)||rt([t.maxX,t.minY],e)||rt([t.maxX,t.maxY],e))&&r.push(t.id)})),r},Pn=function(){var e=r(s.mark((function e(){var t,n,r,i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Promise.resolve(),ge=!1,n=ye.end(),r=n.flatMap(f),Ne([r.length-2,r.length-1],r),m.state.temporaryDepiledPiles.length||(i=jn(r),Oi(i),i.length>1&&(m.dispatch(np.setFocusedPiles([])),t=Cn([i]))),e.next=8,t;case 8:fe();case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Cn=function(e,t){var n=function(e){return function(t,n){return t+n/e}},r=function(){return function(e,t){return Math.min(e,t)}},i=function(){return function(e,t){return Math.max(e,t)}},o={x:n,y:n},a={x:0,y:0};switch(t){case"top":o.y=r,a.y=1/0;break;case"bottom":o.y=i,a.y=-1/0;break;case"left":o.x=r,a.x=1/0;break;case"right":o.x=i,a.x=-1/0}return Promise.all(e.map((function(e){return new Promise((function(t,n){var r=m.state,i=r.easing,s=r.piles,u=a.x,c=a.y,l=o.x(e.length),f=o.y(e.length);e.forEach((function(e){u=l(u,s[e].x),c=f(c,s[e].y)}));var h=function(){++p===e.length&&(Ye(e[0]),t(np.mergePiles(e,[u,c])))},p=0;Q.addBatch(e.map((function(e){return te.get(e)||n(new Error("Pile #".concat(e," not ready"))),Pt(te.get(e),u,c,{easing:i,onDone:h})})).filter((function(e){return null===e&&h(),e})))}))}))).then((function(e){m.dispatch(he(e))}))},_n=function(e,t){var n=te.get(e);n.magnifyByWheel(t)&&(Ye(e,{forceUpdate:!0}),n.drawBorder()),Z()},Rn=function(e){J.has(e)&&J.get(e).destroy(),J.delete(e),Gn(e)},zn=function(e){return Object.keys(e).forEach(Rn),Promise.resolve()},Fn=function(e,t){var n=c([t.x,t.y]),r=y(n,2),i=r[0],o=r[1],a=t.items.length?t.items.map((function(e){return J.get(e)})):[J.get(e)],s=xp({render:Z,id:e,pubSub:g,store:m,badgeFactory:v},{x:i,y:o});te.set(e,s),m.state.coverAggregator?nn(t,s):(m.state.previewRenderer&&en(t),s.setItems(a),Kt(e)),re.addChild(s.graphics),Ye(e,{forceUpdate:!0}),Zt(t,e),O.set(e,[t.x,t.y])},Gn=function(e){te.has(e)&&(te.get(e).destroy(),ze(e)),te.delete(e),O.delete(e),delete Lr[e]},Zn=function(e){var t=e.bBoxifier,n=e.absComparator,i=e.relComparator;return function(){var e=r(s.mark((function e(r){var o,a,u,c,l,f,h,p,g,v,b,w,x,S=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=S.length>1&&void 0!==S[1]?S[1]:{},a=o.conditions,u=void 0===a?[]:a,c=o.centerAggregator,l=void 0===c?Ae:c,f=m.state.piles,h=new Map,p={},g={},v=function(e,t,n){if(!p[e.id]){p[e.id]=d({},e.id,!0),h.set(e.id,[e.id,1]);var r=e.maxX-e.minX,o=e.maxY-e.minY;g[e.id]={w:r,h:o,c:[[e.minX+r/2,e.minY+o/2]]}}if(p[e.id][t.id])return!1;p[e.id][t.id]=!0,h.set(t.id,[e.id,i(n,e)[0]]);var a=t.maxX-t.minX,s=t.maxY-t.minY;return g[e.id].w=Math.max(g[e.id].w,a),g[e.id].h=Math.max(g[e.id].h,s),g[e.id].c.push([t.minX+a/2,t.minY+s/2]),!0},b=function(e){var o=Le.search(t(e,r)),a=0;return 1===o.length||o.forEach((function(t){if(t.id!==e.id){var o=n(e,t,r),s=y(o,2),c=s[0];if(s[1]&&u.every((function(n){return n(f[e.id],f[t.id])}))){if(h.has(t.id)&&(!p[e.id]||!p[e.id][t.id])){var l=h.get(t.id),d=y(l,2),g=d[0],m=d[1];if(!i(c,e,m)[1])return;delete p[g][t.id]}a+=v(e,t,c)}}})),a},Le.all().forEach((function(e){h.has(e.id)||b(e)})),w=!1;!w;)x=Object.keys(p).reduce((function(e,t){var n=g[t],r=n.w,i=n.h,o=n.c,a=l(o),s=y(a,2),u=s[0],c=s[1];return e+b({id:t,minX:u-r/2,maxX:u+r/2,minY:c-i/2,maxY:c+i/2})}),0),w=0===x;return e.abrupt("return",Object.values(p).map(Object.keys));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},Jn=function(e,t,n){var r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),o=(Math.min(e.maxX,t.maxX)-r)*(Math.min(e.maxY,t.maxY)-i);return[o,o>=n]},rr=function(e,t,n){var r=e/((t.maxX-t.minX)*(t.maxY-t.minY));return[r,void 0!==n&&r>n]},ir=Zn({bBoxifier:ve,absComparator:Jn,relComparator:rr}),or=function(e,t){return{minX:e.minX-t,minY:e.minY-t,maxX:e.maxX+t,maxY:e.maxY+t}},ar=function(e,t,n){var r=td(e,t);return[r,r<n]},sr=function(e,t,n){return[e,void 0===n&&e<n]},ur=Zn({bBoxifier:or,absComparator:ar,relComparator:sr}),lr=function(){var e=r(s.mark((function e(t){var n,r,i,o;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=m.state,r=n.orderer,i=n.piles,o=t?Op({width:j,height:C,orderer:r},t):we,e.abrupt("return",Object.entries(i).reduce((function(e,t){var n=y(t,2),r=n[0],i=n[1];if(!i.items.length)return e;var a=o.xyToIj(i.x,i.y),s=o.ijToIdx.apply(o,p(a));return e[s]||(e[s]=[]),e[s].push(r),e}),[]));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fr=function(){var e=r(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object.entries(m.state.piles).reduce((function(e,t){var n=y(t,2),r=n[0],i=n[1];if(i.items.length){var o=we.xyToIj(i.x,i.y);e[o[1]]||(e[o[1]]=[]),e[o[1]].push(r)}return e}),[]));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),hr=function(){var e=r(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object.entries(m.state.piles).reduce((function(e,t){var n=y(t,2),r=n[0],i=n[1];if(i.items.length){var o=we.xyToIj(i.x,i.y);e[o[0]]||(e[o[0]]=[]),e[o[0]].push(r)}return e}),[]));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),pr=function(){var e=r(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object.values(Object.entries(m.state.piles).reduce((function(e,n){var r=y(n,2),i=r[0],o=r[1];if(!o.items.length)return e;var a=t.map((function(e){return e.aggregator(o.items.map((function(t,n){return e.property(m.state.items[t],t,n,J.get(t))})))})).join("|");return e[a]?e[a].push(i):e[a]=[i],e}),{})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),dr=function(){var e=r(s.mark((function e(t){var n,r,i,o,a,u,c,l=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:{},r=Object.entries(m.state.piles).reduce((function(e,n){var r=y(n,2),i=r[0],o=r[1];return o.items.length?(e.push({id:i,data:t.flatMap((function(e){return e.aggregator(o.items.map((function(t,n){return e.property(m.state.items[t],t,n,J.get(t))})))}))}),e):e}),[]),(i=n.clusterer)||(o=n.clustererOptions||{},a=o.k,o.valueGetter=function(e){return e.data},a||(a=Math.max(2,Math.ceil(Math.sqrt(r.length/2)))),i=jr(a,o)),e.next=6,i(r);case 6:return u=e.sent,c=u.labels,e.abrupt("return",Object.values(Array.from(c).reduce((function(e,t,n){return-1===t||(e[t]||(e[t]=[]),e[t].push(r[n].id)),e}),{})));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),gr=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i="mean";switch(e){case"overlap":t=ir(n,r);break;case"distance":t=ur(n,r);break;case"grid":t=lr(n);break;case"column":i=n,t=fr(n);break;case"row":i=n,t=hr(n);break;case"category":t=pr(n);break;case"cluster":t=dr(n,r);break;default:t=Promise.reject(new Error("Unknown group by type: ".concat(e)))}return t.then((function(e){return m.dispatch(np.setFocusedPiles([])),Oi(e.flatMap(ve)),Cn(e.filter((function(e){return e.length>1})),i)}))},mr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=vi(e,t),i=gr(e,r,n);return"distance"!==e&&"overlap"!==e||!n.onZoom||(delete n.onZoom,m.dispatch(he([].concat(p(G("groupingObjective",r,!0)),p(G("groupingOptions",n,!0)),p(G("groupingType",e,!0)))))),i},vr=function(e,t){var n="uv"===t?function(e){return e*j}:ve,r="uv"===t?function(e){return e*C}:ve,i=new ee,o=new Map,a=e.map((function(e){var t=Gt(c([n(e.cX),r(e.cY)])),i=y(t,2),a=i[0],s=i[1],u={id:e.id,minX:a-e.width/2,maxX:a+e.width/2,minY:s-e.height/2,maxY:s+e.height/2};return o.set(e.id,u),u}));return i.load(a),[i,o]},yr=function(e){var t=e.toBBox,n=e.compare,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.coordType,a=void 0===o?"uv":o;return function(){var e=r(s.mark((function e(r){var i,o,u,c,l,f,h,d,g,v,b,w,x,S,E=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=E.length>1&&void 0!==E[1]?E[1]:{},o=i.conditions,u=void 0===o?[]:o,c=m.state.piles,l=vr(r.basedOn,a),f=y(l,2),h=f[0],d=f[1],g={},v=function(e,t,r){var i=-1,o=1/0;return e.forEach((function(e,a){var s={minX:e.centroid[0]-e.width/2,maxX:e.centroid[0]+e.width/2,minY:e.centroid[1]-e.height/2,maxY:e.centroid[1]+e.height/2},u=n(s,t,r),c=y(u,2),l=c[0],f=c[1];l&&f<o&&(o=f,i=a)})),i},b=function(e){g[e.id]={keep:[e.id],split:[]}},w=function(e,t){g[e.id].keep.push(t.id)},x=function(e,t){var n=t.maxX-t.minX,i=t.maxY-t.minY,o=[t.minX+n/2,t.minY+i/2];if(g[e.id].split.length){var a=v(g[e.id].split,t,r.threshold);if(-1===a)g[e.id].split.push({centroid:o,width:n,height:i,items:[t.id]});else{var s=g[e.id].split[a],u=s.items.length,c=u+1,l=[s.centroid[0]*u/c+o[0]/c,s.centroid[1]*u/c+o[1]/c];s.centroid=l,s.items.push(t.id)}}else g[e.id].split.push({centroid:o,width:n,height:i,items:[t.id]})},S=function(e){if(!(c[e.id].items.length<2)){var i=h.search(t(e,r.threshold)),o=new Set;o.add(e.id),b(e),i.forEach((function(t){-1!==c[e.id].items.indexOf(t.id)&&(t.id!==e.id&&(n(e,t,r.threshold)[0]&&u.every((function(n){return n(c[e.id],c[t.id])}))?w(e,t):x(e,t),o.add(t.id)))})),c[e.id].items.forEach((function(t){if(!o.has(t)){var n=d.get(t);t===e.id?w(e,n):x(e,n)}}))}},Le.all().forEach(S),Object.keys(g).forEach((function(e){var t=[];g[e].keep.length&&t.push(g[e].keep),g[e].split.length&&t.push.apply(t,p(g[e].split.map((function(e){return e.items})))),t.length>1?g[e]=t:delete g[e]})),e.abrupt("return",g);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},br=function(e,t,n){var r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),o=(Math.min(e.maxX,t.maxX)-r)*(Math.min(e.maxY,t.maxY)-i);return[o>=n,o]},xr=yr({toBBox:ve,compare:br}),Sr=function(e,t){return{minX:e.minX-t,minY:e.minY-t,maxX:e.maxX+t,maxY:e.maxY+t}},Er=function(e,t,n){var r=td(e,t);return[r<n,r]},Mr=yr({toBBox:Sr,compare:Er}),Or=function(){var e=r(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object.entries(m.state.piles).filter((function(e){return e[1].items.length>1})).reduce((function(e,n){var r=y(n,2),i=r[0],o=r[1].items.reduce((function(e,n,r){var i=t.map((function(e){return e(m.state.items[n],n,r,J.get(n))})).join("|");return e[i]?e[i].push(n):e[i]=[n],e}),{});return Object.keys(o).length>1&&(e[i]=Object.values(o)),e}),{}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ar=function(){var e=r(s.mark((function e(t){var n,r,i,o,a,u,c,l,f=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.length>1&&void 0!==f[1]?f[1]:{},r=new Map,i=Object.entries(m.state.items).map((function(e,n){var i=y(e,2),o=i[0],a=i[1];return r.set(o,n),{id:o,data:t.flatMap((function(e){return e.property(a,o,0,J.get(o))}))}})),(o=n.clusterer)||(a=n.clustererOptions||{},u=a.k,a.valueGetter=function(e){return e.data},u||(u=Math.max(2,Math.ceil(Math.sqrt(i.length/2)))),o=jr(u,a)),e.next=7,o(i);case 7:return c=e.sent,l=c.labels,e.abrupt("return",Object.entries(m.state.piles).reduce((function(e,t){var n=y(t,2),i=n[0],o=n[1];if(!o.items.length)return e;var a=o.items.reduce((function(e,t){var n=l[r.get(t)];return e[n]?e[n].push(t):e[n]=[t],e}),{});return Object.keys(a).length>1&&(e[i]=Object.values(a)),e}),{}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Pr=!1,Cr=Promise.resolve(),_r=function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(Pr)return Cr;switch(Pr=!0,e){case"overlap":n=xr(t,r);break;case"distance":n=Mr(t,r);break;case"category":n=Or(t);break;case"cluster":n=Ar(t,r)}return(Cr=n.then((function(e){return Object.keys(e).length?(m.dispatch(he([np.setFocusedPiles([]),np.splitPiles(e)])),Promise.all(Object.entries(e).filter((function(e){return e[1].length>1})).map((function(e){var t=y(e,2),n=t[0],r=t[1].map((function(e){return e[0]}));return pn(n,r)})))):Promise.resolve()}))).then((function(){Pr=!1})),Cr},Ir=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=xi(e,t),i=_r(e,r,n);return"distance"!==e&&"overlap"!==e||!n.onZoom||(delete n.onZoom,m.dispatch(he([].concat(p(G("splittingObjective",r,!0)),p(G("splittingOptions",n,!0)),p(G("splittingType",e,!0)))))),i},Rr=function(){return Ir("category","id")},Tr=function(){var e=m.state,t=e.arrangementType,n=e.arrangementObjective,r=e.arrangementOptions,i=!1;switch(e.navigationMode){case"panZoom":i=it();break;case"scroll":i=et();break;case"auto":default:switch(t){case"data":i=n.length>1||r.forceDimReduction?it():et();break;case"xy":case"uv":i=it();break;case"index":case"ij":i=et()}}i&&(qe(),Je())},Lr={},Br=[],Nr=[],Dr=[],zr=function(e){var t=m.state,n=t.arrangementObjective,r=t.arrangementOptions,i=t.items,o=t.piles,a=e.length>=te.size;n.forEach((function(t,s){var u=void 0===Nr[s]||a?1/0:Nr[s],c=void 0===Dr[s]||a?-1/0:Dr[s],l=a;if(!a&&Br[s]&&n.length<3&&!r.forceDimReduction){var f=0,h=te.size,p=!1,d=!1;if(e.forEach((function(e){var t=Br[s][e];t===f&&(f++,p=!0,l=!0),t===h&&(h--,d=!0,l=!0)})),p){var g=Object.entries(Br[s]).find((function(e){return e[1]===f})),m=y(g,1)[0];u=Lr[m][s]}if(d){var v=Object.entries(Br[s]).find((function(e){return e[1]===h})),b=y(v,1)[0];c=Lr[b][s]}}e.forEach((function(e){var r=o[e].items.map((function(e,n){return t.property(i[e],e,n,J.get(e))})),a=t.aggregator(r);a<u&&(u=a,l=!0),a>c&&(c=a,l=!0),Lr[e]||(Lr[e]=[]),Lr[e][s]=Number.isNaN(a)?null:a,Lr[e].splice(n.length)})),Br[s]=ct(Lr,{getter:function(e){return e[s]},comparator:t.inverse?ut:st,ignoreNull:!0}),l&&(Nr[s]=u,Dr[s]=c)})),Br.splice(n.length),Nr.splice(n.length),Dr.splice(n.length)},Fr=[],Vr=function(){var e=m.state.arrangementObjective,t=[j,C];return Fr=e.map((function(e,n){var r=Fr[n],i=Nr[n],o=Dr[n];if(r){var a=r.domain(),s=y(a,2),u=s[0],c=s[1];if(i===u&&o===c)return Fr[n]}var l=e.inverted?[o,i]:[i,o],f=Oe(St.range()),h=Oe(St.range());return e.scale().domain(l).range([f/2,t[n]-h/2])})),Promise.resolve()},Ur=0,Yr=function(){var e=r(s.mark((function e(t){var n,r,i,o,a,u,c;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=m.state,r=n.arrangementObjective,i=n.arrangementOptions,o=n.dimensionalityReducer,a=n.items,o){e.next=4;break}return console.warn("No dimensionality reducer provided. Unable to arrange piles by multiple dimensions."),e.abrupt("return",Promise.resolve());case 4:if(!Ur||t||i.runDimReductionOnPiles){e.next=6;break}return e.abrupt("return",Promise.resolve());case 6:return vt(),e.next=9,ft();case 9:return u=!0===i.runDimReductionOnPiles?Object.values(Lr).filter((function(e){return null!==e[0]})):Object.entries(a).map((function(e){var t=y(e,2),n=t[0],i=t[1];return r.flatMap((function(e){return e.property(i,n,0,J.get(n))}))})),c=o.fit(u),zt.clear(),c.then((function(){Ur++,yt()})),e.abrupt("return",c);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Xr=function(e,t){var n=m.state,r=n.arrangementObjective,i=n.arrangementOptions;return zr(e),r.length>2||i.forceDimReduction?Yr(t):r.length>1?Vr():Promise.resolve()},qr=function(){var e=r(s.mark((function e(t,n){var r,i,o,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=m.state,i=r.arrangementType,o=r.piles,a=t.length?t:Object.keys(o),"data"!==i){e.next=6;break}return N=Xr(a,n),e.next=6,N;case 6:Tr();case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Hr=function(){return null===m.state.arrangementType?[]:[].concat(p(G("arrangeOnGrouping",!1,!0)),p(G("arrangementOptions",{},!0)),p(G("arrangementObjective",null,!0)),p(G("arrangementType",null,!0)))},Gr=new Map,Wr=new Map,$r=function(){var e=m.state,n=e.items,r=e.piles,i=e.pileLabel,o=e.pileLabelColor,a=e.pileLabelText,s=e.pileLabelTextMapping,u=e.pileLabelTextColor,c=e.pileLabelFontSize,l=e.pileLabelTextStyle;Gr.forEach((function(e){e.pixiText&&e.pixiText.destroy()})),Gr.clear(),Wr.clear();var f=new Set;Object.values(n).forEach((function(e){var t=i.flatMap((function(t){return t(e)})).join("-");Wr.set(e.id,t),!f.has(t)&&t&&(Gr.set(t,{text:t,index:f.size}),f.add(t))})),Gr.forEach((function(e){var n;if(null!==o)if(xe(o))n=bn(o(e.text,Gr));else{var i=o;Array.isArray(o)||(i=[o]);var f=i.length;n=bn(i[e.index%f])}else{var h=Wn.length;n=bn(Wn[e.index%h])}if(e.color=n,xe(a)?Object.values(r).some((function(e){return a(e)})):a){var p=e.text;xe(s)?p=s(e.text,Gr):Array.isArray(a)&&(p=a[e.index]);var d=new t.Text(p,Zp({fill:u,fontSize:2*c*window.devicePixelRatio,align:"center"},l||{}));d.updateText(),e.texture=d.texture,e.pixiText=d}}))},Kr=function(e,t){var n=m.state.pileLabelSizeTransform,r=e.reduce((function(e,t){return e[t]=+!n,e}),{});return n?(t.forEach((function(e){r[e]++})),n(Object.values(r),Object.keys(r))):Object.values(r)},Zr=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=te.get(t);if(r)if(m.state.pileLabel){var i=m.state,o=i.pileLabel,a=i.items;Wr.size&&!n||$r();var s=e.items.flatMap((function(e){return o.map((function(t){return t(a[e])})).join("-")})).filter((function(e){return e.length})),u=be(s);u.sort((function(e,t){return(Gr.get(e.toString()).index||1/0)-(Gr.get(t.toString()).index||1/0)}));var c=u.length>1?Kr(u,s):[1],l=u.reduce((function(e,t){var n=t&&t.toString&&Gr.get(t.toString())||$n;return e[0].push(n.text),e[1].push(n.color),e[2].push(n.texture),e}),[[],[],[]]);r.drawLabel.apply(r,p(l).concat([c]))}else r.drawLabel([])},Qr=[],Jr=[],ei=0,ti=function(e){if(e.length){Qr.push.apply(Qr,p(e));var t=++ei;Promise.all(Qr).then((function(){if(t===ei)return Promise.all(Jr.map((function(e){return e()})))})).then((function(){Jr.splice(0,Jr.length),Qr.splice(0,Qr.length),I.textureGC.run(),g.publish("itemUpdate")}))}},ni=function(){if(!_){var t,n,i=m.state,o=new Set,a=[],u=[];if(b.items!==i.items&&b.itemRenderer){var c=Zp({},b.items),l={},f={},h={};Object.entries(i.items).forEach((function(e){var t=y(e,2),n=t[0],r=t[1];b.items[n]?r.src!==b.items[n].src&&(f[n]=r,Object.values(i.piles).forEach((function(e){e.items.length>1&&e.items.includes(n)&&(h[e.id]=e)}))):l[n]=r,delete c[n]}));var p=Object.keys(l).length,d=Object.keys(f).length,x=Object.keys(c).length,S=Object.keys(h).length;p&&a.push(Lt(l)),d&&a.push(Tt(f)),x&&a.push(zn(c)),S&&a.push(Object.entries(h).forEach((function(e){var t=y(e,2),n=t[0],r=t[1],i=te.get(n);i.cover&&tn(r,i),Zr(r,n)}))),(p||x)&&(o.add("grid"),o.add("layout"))}if(!Object.values(i.items).length||b.itemRenderer===i.itemRenderer&&b.previewRenderer===i.previewRenderer&&b.coverRenderer===i.coverRenderer&&b.previewAggregator===i.previewAggregator&&b.coverAggregator===i.coverAggregator||(J.size?a.push(Tt()):a.push(Lt(i.items))),b.itemSizeRange!==i.itemSizeRange&&o.add("layout"),b.piles!==i.piles&&Object.keys(b.piles).length){var k={},M=[];Object.entries(i.piles).forEach((function(e){var t=y(e,2),n=t[0],r=t[1];b.piles[n]&&r!==b.piles[n]&&(k[n]=r)})),Object.entries(k).forEach((function(e){var t=y(e,2),n=t[0],r=t[1],i=r.items.length!==b.piles[n].items.length,o=(r.x!==b.piles[n].x||r.y!==b.piles[n].y)&&0!==r.items.length;i&&(on(r,n),u.push(n)),o&&M.push(an(r,n)),(i||o)&&(Qt(r,n),Zr(r,n))})),M.length?(E=!1,Promise.all(M).then((function(e){g.publish("pilesPositionEnd",{targets:e})}))):E&&(E=!1,g.publish("pilesPositionEnd",{targets:M}))}if(!te.size||b.pileLabel===i.pileLabel&&b.pileLabelColor===i.pileLabelColor&&b.pileLabelText===i.pileLabelText&&b.pileLabelAlign===i.pileLabelAlign&&b.pileLabelFontSize===i.pileLabelFontSize&&b.pileLabelHeight===i.pileLabelHeight&&b.pileLabelStackAlign===i.pileLabelStackAlign||Object.entries(i.piles).filter((function(e){return e[1].items.length})).forEach((function(e,t){var n=y(e,2),r=n[0],i=n[1];Zr(i,r,!t)})),!te.size||b.pileItemOpacity===i.pileItemOpacity&&b.pileItemBrightness===i.pileItemBrightness&&b.pileItemInvert===i.pileItemInvert&&b.pileItemTint===i.pileItemTint||Object.entries(i.piles).forEach((function(e){var t=y(e,2),n=t[0],r=t[1];Zt(r,n)})),!te.size||b.pileOpacity===i.pileOpacity&&b.pileBorderSize===i.pileBorderSize&&b.pileScale===i.pileScale&&b.pileSizeBadge===i.pileSizeBadge&&b.pileSizeBadgeAlign===i.pileSizeBadgeAlign&&b.pileVisibilityItems===i.pileVisibilityItems||(Object.entries(i.piles).forEach((function(e){var t=y(e,2),n=t[0],r=t[1];Qt(r,n)})),!1===i.pileSizeBadge&&v.clear()),b.orderer!==i.orderer&&o.add("layout"),b.itemSize===i.itemSize&&b.columns===i.columns&&b.rowHeight===i.rowHeight&&b.cellAspectRatio===i.cellAspectRatio&&b.cellPadding===i.cellPadding&&b.cellSize===i.cellSize&&b.orderer===i.orderer&&b.pileCellAlignment===i.pileCellAlignment||(o.add("grid"),o.add("layout")),b.itemSize===i.itemSize&&b.pileItemOffset===i.pileItemOffset&&b.pileItemRotation===i.pileItemRotation&&b.previewPadding===i.previewPadding&&b.previewSpacing===i.previewSpacing&&b.previewScaleToCover===i.previewScaleToCover&&b.previewOffset===i.previewOffset&&b.previewItemOffset===i.previewItemOffset||o.add("positionItems"),te.size&&b.previewScaling!==i.previewScaling&&Object.values(i.piles).forEach((function(e){en(e)})),b.tempDepileDirection===i.tempDepileDirection&&b.tempDepileOneDNum===i.tempDepileOneDNum||o.add("layout"),b.temporaryDepiledPiles!==i.temporaryDepiledPiles&&(b.temporaryDepiledPiles.length&&En(b.temporaryDepiledPiles),i.temporaryDepiledPiles.length?(te.forEach((function(e){e.disableInteractivity()})),On(i.temporaryDepiledPiles)):te.forEach((function(e){e.enableInteractivity()})),Z()),b.focusedPiles!==i.focusedPiles){var O=Nn(b.focusedPiles,i.focusedPiles),A=y(O,2),j=A[0],P=A[1];j.filter((function(e){return te.has(e)})).forEach((function(e){var t=te.get(e);t.isTempDepiled||(t.blur(),t.isFocus=!1)})),P.filter((function(e){return te.has(e)})).forEach((function(e){var t=te.get(e);t.isTempDepiled?t.active():t.focus(),t.isFocus=!0}));var C=m.state.piles;P.length&&g.publish("pileFocus",{targets:P.map((function(e){return C[e]}))}),j.length&&g.publish("pileBlur",{targets:j.map((function(e){return C[e]}))}),Z()}if(b.magnifiedPiles!==i.magnifiedPiles&&(b.magnifiedPiles.map((function(e){return te.get(e)})).filter((function(e){return e})).forEach((function(e){e.unmagnify(),delete e.magnifiedByWheel,Ye(e.id),oe()})),i.magnifiedPiles.map((function(e){return te.get(e)})).filter((function(e){return e})).forEach((function(e){e.magnifiedByWheel||e.magnify(),ae(e.graphics)})),Z()),b.depileMethod!==i.depileMethod&&o.add("layout"),b.depiledPile!==i.depiledPile&&0!==i.depiledPile.length&&dn(i.depiledPile[0]),b.showGrid!==i.showGrid&&(i.showGrid?at():ht()),Object.keys(i.items).length&&i.arrangementType&&(b.arrangementType!==i.arrangementType||b.arrangementObjective!==i.arrangementObjective||a.length||u.length||i.arrangementObjective.length>2&&b.dimensionalityReducer!==i.dimensionalityReducer)){o.add("layout");var I=(t=[].concat(u),n=b.arrangementObjective!==i.arrangementObjective,r(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",qr(t,n));case 1:case"end":return e.stop()}}),e)}))));a.length?Jr.push(I):I()}if(b.navigationMode!==i.navigationMode&&o.add("navigation"),b.darkMode===i.darkMode&&b.haltBackgroundOpacity===i.haltBackgroundOpacity||bt(),b.darkMode!==i.darkMode&&(wt(),i.darkMode?(w=0,Be(e,"pilingjs-darkmode")):(w=Vn,Ve(e,"pilingjs-darkmode"))),b.darkMode===i.darkMode&&b.lassoFillColor===i.lassoFillColor&&b.lassoFillOpacity===i.lassoFillOpacity&&b.lassoShowStartIndicator===i.lassoShowStartIndicator&&b.lassoStartIndicatorOpacity===i.lassoStartIndicatorOpacity&&b.lassoStrokeColor===i.lassoStrokeColor&&b.lassoStrokeOpacity===i.lassoStrokeOpacity&&b.lassoStrokeSize===i.lassoStrokeSize||xt(),b=i,g.publish("update",{action:m.lastAction}),o.has("grid")&&dt(),o.has("layout")||a.length>0||u.length>0){var R=function(e){return r(s.mark((function t(){return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Wt(e));case 1:case"end":return t.stop()}}),t)})))}(b.arrangeOnGrouping?[]:[].concat(u));a.length?Jr.push(R):R()}o.has("navigation")&&Tr(),o.has("positionItems")&&Object.values(b.piles).filter((function(e){return e.items.length>1})).forEach((function(e){Kt(e.id,{all:!0})})),ti(a)}},ri=function(){te.forEach((function(e){e&&e.blur()}))},ii=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.serialize,n=void 0!==t&&t;return n?er(m.export()):m.export()},oi=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.deserialize,i=void 0!==r&&r,o=n.overwriteState,a=void 0!==o&&o,s=n.debug,u=void 0!==s&&s;R=!1;var c=new Promise((function(e){t=g.subscribe("update",(function(t){t.action.type.indexOf("OVERWRITE")>=0&&e()}))}));return m.import(i?In(e):e,{overwriteState:a,debug:u}),ri(),c.then((function(){g.unsubscribe(t)})),c},ai=function(e){return xe(e)?e:function(t){return t[e]}},si=function(e){if(xe(e.aggregator))return e.aggregator;switch(e.aggregator){case"max":return e.propertyIsVector?Me:ke;case"median":return e.propertyIsVector?Pe:je;case"min":return e.propertyIsVector?_e:Ce;case"sum":return e.propertyIsVector?Te:Re;case"mean":default:return e.propertyIsVector?Ae:Oe}},ui=function(e){if(xe(e))return e;switch(e){case"linear":default:return Dn}},ci=function(e){Array.isArray(e)||(e=[e]);var t=[];return e.forEach((function(e){var n={};e.constructor!==Object?(n.property=ai(e),n.aggregator=e.propertyIsVector?Ae:Oe,n.scale=Dn,n.inverse=!1):(n.property=ai(e.property),n.aggregator=si(e),n.scale=ui(e.scale),n.inverse=!!e.inverse),t.push(n)})),t},li=function(e,t){var n={};return e.constructor!==Object?(n.property=ai(e),n.isCustom=xe(e),n.aggregator=t?Ae:Oe):(n.property=ai(e.property),n.aggregator=si(e)),n},fi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t;switch(e){case"data":r=ci(t);break;case"xy":case"ij":case"uv":case"custom":r=li(t,!0);break;case"index":r=li(t)}var i=!!n.onGrouping;return delete n.onGrouping,E=!0,m.dispatch(he([].concat(p(G("arrangeOnGrouping",i,!0)),p(G("arrangementOptions",n,!0)),p(G("arrangementObjective",r,!0)),p(G("arrangementType",e,!0))))),new Promise((function(e){g.subscribe("pilesPositionEnd",e,1)}))},hi=function(e){return e||1},pi=function(e){return e||1},di=function(e){var t=null;return Se(e)?t=Zp(Zp({},t),e):+e&&(t.columns={columns:+e,cellAspectRatio:we.cellAspectRatio}),t},gi=function(e){return(Array.isArray(e)?e:[e]).map((function(t){var n={};return Se(e)?(n.property=ai(t.property),n.aggregator=xe(t.aggregator)?t.aggregator:tr):(n.property=ai(t),n.aggregator=tr),n}))},mi=function(e){return(Array.isArray(e)?e:[e]).map((function(t){var n={};return t.constructor!==Object?(n.property=ai(t),n.aggregator=e.propertyIsVector?Ae:Oe):(n.property=ai(t.property),n.aggregator=si(t)),n}))},vi=function(e,t){switch(e){case"overlap":return pi(t);case"grid":return di(t);case"distance":return hi(t);case"category":return gi(t);case"cluster":return mi(t);default:return t}},yi=function(){var e=m.state.piles,t=Le.all().reduce((function(e,t){var n=t.maxX-t.minX,r=t.maxY-t.minY;return e[t.id]={cX:(t.minX+n/2)/j,cY:(t.minY+n/2)/C,width:n,height:r,id:t.id},e}),{});return Object.entries(e).forEach((function(e){var n=y(e,2),r=n[0];n[1].items.forEach((function(e){t[e]||(t[e]=Zp(Zp({},t[r]),{},{id:e}))}))})),Object.values(t)},bi=function(e){var t={};if(Se(e)?(t.threshold=e.threshold,e.basedOn&&(t.basedOn=ai(e.basedOn))):Array.isArray(e)?(t.threshold=e[0],e.length>1&&(t.basedOn=ai(e[1]))):t.threshold=e,t.basedOn){var n=m.state,r=n.items,i=n.piles;t.basedOn=Object.values(i).flatMap((function(e){return e.items.map((function(e,n){var i=J.get(e),o=t.basedOn(r[e],e,n,i),a=y(o,2);return{id:e,cX:a[0],cY:a[1],width:i.image.width,height:i.image.height}}))}))}else t.basedOn=yi();return t},wi=function(e){return(Array.isArray(e)?e:[e]).map((function(e){return ai(e)}))},xi=function(e,t){switch(e){case"overlap":case"distance":return bi(t);case"category":case"cluster":return wi(t);default:return t}},Si=function(e){return null===e?null:(Array.isArray(e)?e:[e]).map((function(e){return ai(e)}))},Ei=function(e){if(xe(e))return e;switch(e){case"histogram":return function(e){var t=Object.values(e),n=ke(t);return t.map((function(e){return e/n}))};default:return function(e){return e.map((function(){return 1}))}}},ki=!1,Mi=function(e,t){if(!ki){ki=!0;var n=m.state.piles,r=n[e].x,i=n[e].y,o=function(){++a===t.length&&(ki=!1,m.dispatch(np.mergePiles([e].concat(p(t)),[r,i],e)))},a=0;Q.addBatch(t.map((function(e){return Pt(te.get(e),r,i,{onDone:o})})))}},Oi=function(e){var t=m.state.piles;e.filter((function(e){return te.has(e)&&1===te.get(e).size})).forEach((function(e){J.get(e).setOriginalPosition([t[e].x,t[e].y])}))},Ai=function(e){var t=e.target;Ee=!1,Ye(t.id);var n=te.get(t.id),r=n.graphics;if(!n.isTempDepiled){if(n.x!==r.beforeDragX||n.y!==r.beforeDragY){var i=Ue(t.id),o=Le.search(i).filter((function(e){return e.id!==t.id}));if(1===o.length){if(!n.isTempDepiled){var a=o[0].id,s=te.get(a),u=m.state.piles[a];if(Ee=!s.isTempDepiled){n.items.forEach((function(e){e.item.tmpAbsX=r.x,e.item.tmpAbsY=r.y,e.item.tmpRelScale=n.scale})),Oi([a,t.id]);var c=m.state,f=c.previewAggregator,h=c.previewRenderer;f||h?Mi(a,[t.id]):m.dispatch(np.mergePiles([t.id,a],[u.x,u.y],a))}}}else{var p=l([n.x,n.y]),d=y(p,2),g=d[0],v=d[1];m.dispatch(np.movePiles([{id:t.id,x:g,y:v}]))}}Ee||oe(),Pi()}},ji=[],Pi=function(){ji.map((function(e){return te.get(e.id)})).filter(ve).forEach((function(e){e.blur()})),ji=[]},Ci=function(e){if(!m.state.temporaryDepiledPiles.length){var t=Le.search(Ue(e)).filter((function(t){return t.id!==e}));Pi(),t.map((function(e){return te.get(e.id)})).filter(ve).forEach((function(e){e.hover()})),ji=p(t)}},_i=function(e){var t=e.target,n=e.event,r=te.get(t.id);if(r&&r.isMagnified){var i=n.data.getLocalPosition(r.graphics.parent);r.graphics.draggingMouseOffset[0]/=r.magnification,r.graphics.draggingMouseOffset[1]/=r.magnification,Ct(r,i.x-r.graphics.draggingMouseOffset[0],i.y-r.graphics.draggingMouseOffset[1])}m.dispatch(np.setMagnifiedPiles([])),ae(r.graphics)},Ii=function(e){var t=e.target;Ci(t.id)},Ri=function(e){var t=e.target,n=te.get(t.id);ae(n.graphics)},Ti=function(e){var t=e.target,n=te.get(t.id);n&&n.isTempDepiled||oe()},Li=function(t){t.style.display="none",e.removeChild(t)},Bi=function(e,t){return function(){var n=m.state.depileMethod;"originalPos"===n?vn(t):"cloestPos"===n&&m.dispatch(np.setDepiledPile([t])),m.dispatch(np.setFocusedPiles([])),Li(e)}},Ni=function(e,t){return function(){var n=m.state,r=n.piles,i=n.temporaryDepiledPiles;if(r[t].items.length>1){var o=p(i);o=o.includes(t)?o.filter((function(e){return e!==t})):[t],m.dispatch(np.setTemporaryDepiledPiles(p(o)))}Li(e)}},Di=function(e){return function(){var t=m.state.showGrid;m.dispatch(np.setShowGrid(!t)),Li(e),Z()}},zi=function(e,t){return function(){te.get(t).isMagnified?m.dispatch(np.setMagnifiedPiles([])):m.dispatch(np.setMagnifiedPiles([t])),Li(e)}},Fi=[0,0],Vi=function(e){if(0===e.button){Z(),Fi=An(e);var t=f(Fi);pe=!Le.collides({minX:t[0],minY:t[1],maxX:t[0]+1,maxY:t[1]+1}),Ne(t)}},Ui=function(){pe&&(pe=!1,ge?Pn():T&&Qe())},Yi=function(e){pe&&(e.shiftKey||ge?ye.extendDb(An(e)):T&&We(!1))},Xi=!1,qi=function(t){if(Xi)Xi=!1;else{Xi=!0,setTimeout((function(){Xi=!1}),300);var n=e.querySelector("#piling-js-context-menu"),r=!!n;r&&e.removeChild(n);var i=An(t);if(i[0]===Fi[0]&&i[1]===Fi[1]){var o=f(i),a=Le.search({minX:o[0],minY:o[1],maxX:o[0]+1,maxY:o[1]+1});if(0!==a.length)if(t.shiftKey){var s=m.state.focusedPiles,u=a[0].id;s.includes(u)?Hi(u):m.dispatch(np.setFocusedPiles([].concat(p(s),[u])))}else if(t.altKey){var c=m.state.depileMethod;"originalPos"===c?vn(a[0].id):"cloestPos"===c&&m.dispatch(np.setDepiledPile([a[0].id])),m.dispatch(np.setFocusedPiles([]))}else a.forEach((function(e){te.get(e.id).isHover&&m.dispatch(np.setFocusedPiles([e.id]))}));else{var l=m.state,h=l.focusedPiles,d=l.magnifiedPiles;h.length&&m.dispatch(np.setFocusedPiles([])),d.length&&m.dispatch(np.setMagnifiedPiles([])),r||h.length||d.length||ye.showStartIndicator(Fi)}}}},Hi=function(e){var t=m.state.focusedPiles.filter((function(t){return t!==e}));t.length&&(m.dispatch(np.setFocusedPiles([e])),Mi(e,t))},Gi=function(e){var t=An(e),n=f(t),r=m.state,i=r.temporaryDepiledPiles,o=r.piles,a=Le.search({minX:n[0],minY:n[1],maxX:n[0]+1,maxY:n[1]+1});if(0===a.length||i.length)m.dispatch(np.setTemporaryDepiledPiles([])),m.dispatch(np.setFocusedPiles([]));else{var s=a[0].id;if(e.shiftKey)Hi(s);else if(o[s].items.length>1){var u=p(i);u=u.includes(s)?u.filter((function(e){return e!==s})):[s],m.dispatch(np.setTemporaryDepiledPiles(p(u)))}}},Wi=function(e){if(e.altKey){var t=An(e),n=f(t),r=Le.search({minX:n[0],minY:n[1],maxX:n[0]+1,maxY:n[1]+1});if(0!==r.length){var i=te.get(r[0].id);e.preventDefault(),i.isMagnified?(i.magnifiedByWheel=!0,m.dispatch(np.setMagnifiedPiles([i.id]))):(delete i.magnifiedByWheel,m.dispatch(np.setMagnifiedPiles([]))),_n(r[0].id,le(e).pixelY)}}else T&&(We(),Ze())},$i=function(){F.y=-i.scrollTop,Z()},Ki=function(){var t=e.getBoundingClientRect(),n=t.width,r=t.height;j=n,C=r,I.resize(j,C),h&&h.setViewCenter([j/2,C/2]),Y.width=n,Y.height=r,dt(),g.publish("resize",{width:n,height:r})},Zi=lt(Ki,500),Qi=function(){var e=we.align(te),t=[];e.filter((function(e){var t=e.id,n=e.x,r=e.y,i=te.get(t),o=nt(n,r,i.x,i.y);return!(o<3)||(At(i,n,r),o>1e-9&&Ye(i.id),!1)})).forEach((function(n,r,i){var o=n.id,a=n.x,s=n.y,u=te.get(o),c=nt(a,s,u.x,u.y);t.push(fp({duration:Math.max(125,250*de(Math.min(c,250)/250)),interpolator:me,endValue:[a,s],getter:function(){return[u.x,u.y]},setter:function(e){At(u,e[0],e[1])},onDone:function(){Ye(u.id),r===i.length-1&&(m.dispatch(np.movePiles(e)),De(),Je(),Z())}}))})),Q.addBatch(t)},Ji=function(){var t=e.querySelector("#piling-js-context-menu");t&&e.removeChild(t)},eo=function(){Qi(),Ji()},to=function(e,t){return function(){mt.enter([t]),vn(t),Li(e)}},no=function(t){Ji();var n=An(t),r=f(n);if(!t.altKey){var i=m.state,o=i.pileContextMenuItems,s=i.showGrid;t.preventDefault();var u=Le.search({minX:r[0],minY:r[1],maxX:r[0]+1,maxY:r[1]+1}),c=u.length>0,l=Tp({customItems:o.filter((function(e){return e.label&&e.callback}))});e.appendChild(l);var h=l.querySelector("#depile-button"),p=l.querySelector("#temp-depile-button"),d=l.querySelector("#browse-separately"),g=l.querySelector("#grid-button"),v=l.querySelector("#align-button"),y=l.querySelector("#magnify-button");if(c){var b;g.style.display="none",v.style.display="none",u.forEach((function(e){te.get(e.id).isHover&&(b=te.get(e.id))})),b&&1===b.size?(h.setAttribute("disabled",""),h.setAttribute("class","inactive"),p.setAttribute("disabled",""),p.setAttribute("class","inactive"),d.setAttribute("disabled",""),d.setAttribute("class","inactive")):b.isTempDepiled&&(h.setAttribute("disabled",""),h.setAttribute("class","inactive"),y.setAttribute("disabled",""),y.setAttribute("class","inactive"),d.setAttribute("disabled",""),d.setAttribute("class","inactive"),p.innerHTML="Close Temp. Depile"),b.isMagnified&&(y.innerHTML="Unmagnify"),l.style.display="block";var w=l.getBoundingClientRect().width;n[0]>a.getBoundingClientRect().width-w?l.style.left="".concat(n[0]-w,"px"):l.style.left="".concat(n[0],"px"),l.style.top="".concat(n[1]+F.y,"px"),h.addEventListener("click",Bi(l,b.id),Xn),p.addEventListener("click",Ni(l,b.id),Xn),d.addEventListener("click",to(l,b.id),Xn),y.addEventListener("click",zi(l,b.id),Xn),o.forEach((function(e,t){(e.id?l.querySelector("#".concat(e.id)):l.querySelector("#piling-js-context-menu-custom-item-".concat(t))).addEventListener("click",(function(){e.callback(Zp({id:b.id},m.state.piles[b.id])),e.keepOpen||Ji()}),{once:!e.keepOpen,passive:!0})}))}else{h.style.display="none",p.style.display="none",d.style.display="none",y.style.display="none",s&&(g.innerHTML="Hide Grid"),l.style.display="block";var x=l.getBoundingClientRect().width;n[0]>a.getBoundingClientRect().width-x?l.style.left="".concat(n[0]-x,"px"):l.style.left="".concat(n[0],"px"),l.style.top="".concat(n[1]+F.y,"px"),g.addEventListener("click",Di(l),Xn),v.addEventListener("click",eo,Xn),o.forEach((function(e,t){(e.id?l.querySelector("#".concat(e.id)):l.querySelector("#piling-js-context-menu-custom-item-".concat(t))).addEventListener("click",(function(){e.callback(),e.keepOpen||Ji()}),{once:!e.keepOpen,passive:!0})}))}}},ro=function(e){e.setEasing(m.state.easing),Q.add(e)},io=function(e){Q.cancel(e)},oo=function(){window.addEventListener("resize",Zi,Xn),window.addEventListener("orientationchange",Zi,Xn),a.addEventListener("contextmenu",no,Yn),a.addEventListener("click",qi,Xn),a.addEventListener("dblclick",Gi,Xn),g.subscribe("pileDragStart",_i),g.subscribe("pileDragMove",Ii),g.subscribe("pileDragEnd",Ai),g.subscribe("pileEnter",Ri),g.subscribe("pileLeave",Ti),g.subscribe("startAnimation",ro),g.subscribe("cancelAnimation",io),g.subscribe("updatePileBounds",Xe),Ie=m.subscribe(ni),e.appendChild(i),e.appendChild(mt.nav),e.appendChild(se.element),Be(e,"pilingjs"),m.state.darkMode&&Be(e,"pilingjs-darkmode"),e.style.overflow="hidden",i.appendChild(a),i.appendChild(o),i.appendChild(ye.startIndicator),i.style.position="absolute",i.style.overflowX="hidden",i.style.top=0,i.style.right=0,i.style.bottom=0,i.style.left=0,a.style.position="sticky",a.style.display="block",a.style.top="0px",a.style.left="0px",Ki(),pt(),et(),fe();var t=$(n);return!n.piles&&n.items&&m.dispatch(np.initPiles(n.items)),t},ao=function(){for(_=!0,window.removeEventListener("mousedown",Vi),window.removeEventListener("mouseup",Ui),window.removeEventListener("mousemove",Yi),window.removeEventListener("resize",Zi),window.removeEventListener("orientationchange",Zi),i.removeEventListener("scroll",$i),a.removeEventListener("contextmenu",no),a.removeEventListener("click",qi),a.removeEventListener("dblclick",Gi),a.removeEventListener("wheel",Wi),m.reset(),z.destroy(!0),z=null,I.destroy(!0),I=null,ye.destroy(),v.destroy(),Ie&&(Ie(),Ie=void 0);e.firstChild;)e.firstChild.remove();g.clear()},so=oo();return{get renderer(){return I},get version(){return"0.10.0"},arrangeBy:fi,destroy:ao,exportState:ii,get:H,groupBy:mr,halt:vt,importState:oi,render:Z,resume:yt,set:$,splitAll:Rr,splitBy:Ir,subscribe:g.subscribe,unsubscribe:g.unsubscribe,whenInit:so}},rd=function(){self.onmessage=function(e){var t=e.data.src,n=Object.assign({},t);try{for(var r=new Float32Array(t.shape[0]),i=0;i<t.shape[0];i++)for(var o=0;o<t.shape[1];o++)r[o]+=t.data[i*t.shape[0]+o]/t.shape[1];n.data=r,n.shape=[t.shape[0],1]}catch(e){self.postMessage({error:e})}self.postMessage({newSrc:n},[n.data.buffer])}},id=function(){var e=function(e,t,n){for(var r=t.length,i=0;i<r;i++)for(var o=0;o<n;o++)e[o]+=Math.max(0,t[i].src.data[o])/r},t=function(t,n,r){var i=new Float32Array(t.length);e(i,n);for(var o=n.length,a=0;a<o;a++)for(var s=0;s<r;s++)t[s]+=Math.pow(n[a].src.data[s]-i[s],2)/o};self.onmessage=function(n){var r,i,o={};n.data.items.length||self.postMessage({error:new Error("No sources provided")});try{o.shape=n.data.items[0].src.shape,o.dtype=n.data.items[0].src.dtype,i=n.data.items[0].src.data.length,r=new Float32Array(i)}catch(e){self.postMessage({error:e})}try{switch(n.data.aggregator){case"variance":t(r,n.data.items,i);break;case"std":!function(e,n,r){t(e,n,r);for(var i=0;i<r;i++)e[i]=Math.sqrt(e[i])}(r,n.data.items,i);break;case"mean":default:e(r,n.data.items,i)}o.data=r}catch(e){self.postMessage({error:e})}self.postMessage({newSrc:o},[o.data.buffer])}},od=function(){var e=function(e){return{error:new Error(e)}},t=function(e){return e},n=function(e,t,n,r){return e.filter((function(e){return n(e.datum,t.datum)<=r}))};self.onmessage=function(r){var i,o=r.data,a=o.minPoints,s=o.items,u=o.scripts;try{u.forEach((function(e){importScripts(e)}))}catch(t){self.postMessage(e("Failed to import skmeans: ".concat(t)))}try{i=s.map(self.valueGetter||t)}catch(t){self.postMessage(e("Failed to load features: ".concat(t)))}var c,l,f=self.distanceFunction?self.distanceFunction:(c=i[0].length,l=Array(c).fill().map((function(e,t){return"s += (v[".concat(t,"] - w[").concat(t,"]) ** 2;")})).join(" "),new Function("v","w","let s = 0; ".concat(l," return Math.sqrt(s);"))),h=r.data.maxDistance;try{if(null===h)h=.1*i.reduce((function(e,t){return t.map((function(t,n){return[Math.min(t,e[n][0]),Math.max(t,e[n][1])]}))}),Array(i.length).fill().map((function(){return[1/0,-1/0]}))).reduce((function(e,t){return Math.min(e,t[1]-t[0])}),1/0)}catch(t){self.postMessage(e("Failed to determine max distance: ".concat(t)))}try{var p=function(e,t,r,i){var o,a=0,s=0,u=e.map((function(e,t){return{idx:t,datum:e,label:-1}}));return u.forEach((function(e){if(-1===e.label)if((s=n(u,e,t,r)).length<i)e.label=0;else for(a+=1,e.label=a,o=s.filter((function(t){return t.idx!==e.idx}));o.length;){var c=o.pop();0===c.label&&(c.label=a),-1===c.label&&(c.label=a,(s=n(u,c,t,r)).length>=i&&(o=o.concat(s)))}})),u.map((function(e){return e.label-1}))}(i,f,h,a||2),d=self.postProcessing&&self.postProcessing(p,i,s);self.postMessage({labels:p,postProcessing:d}),self.postMessage({labels:p})}catch(t){self.postMessage(e("Failed to run dbscan: ".concat(t)))}}},ad='!function (t, r) {\n  if ("object" == typeof exports && "object" == typeof module) module.exports = r();else if ("function" == typeof define && define.amd) define([], r);else {\n    var e = r();\n\n    for (var n in e) ("object" == typeof exports ? exports : t)[n] = e[n];\n  }\n}(window, function () {\n  return function (t) {\n    var r = {};\n\n    function e(n) {\n      if (r[n]) return r[n].exports;\n      var i = r[n] = {\n        i: n,\n        l: !1,\n        exports: {}\n      };\n      return t[n].call(i.exports, i, i.exports, e), i.l = !0, i.exports;\n    }\n\n    return e.m = t, e.c = r, e.d = function (t, r, n) {\n      e.o(t, r) || Object.defineProperty(t, r, {\n        enumerable: !0,\n        get: n\n      });\n    }, e.r = function (t) {\n      "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(t, Symbol.toStringTag, {\n        value: "Module"\n      }), Object.defineProperty(t, "__esModule", {\n        value: !0\n      });\n    }, e.t = function (t, r) {\n      if (1 & r && (t = e(t)), 8 & r) return t;\n      if (4 & r && "object" == typeof t && t && t.__esModule) return t;\n      var n = Object.create(null);\n      if (e.r(n), Object.defineProperty(n, "default", {\n        enumerable: !0,\n        value: t\n      }), 2 & r && "string" != typeof t) for (var i in t) e.d(n, i, function (r) {\n        return t[r];\n      }.bind(null, i));\n      return n;\n    }, e.n = function (t) {\n      var r = t && t.__esModule ? function () {\n        return t.default;\n      } : function () {\n        return t;\n      };\n      return e.d(r, "a", r), r;\n    }, e.o = function (t, r) {\n      return Object.prototype.hasOwnProperty.call(t, r);\n    }, e.p = "", e(e.s = 5);\n  }([function (t, r, e) {\n    "use strict";\n\n    const n = Object.prototype.toString;\n\n    t.exports = function (t) {\n      return n.call(t).endsWith("Array]");\n    };\n  }, function (t, r, e) {\n    "use strict";\n\n    var n = this && this.__values || function (t) {\n      var r = "function" == typeof Symbol && t[Symbol.iterator],\n          e = 0;\n      return r ? r.call(t) : {\n        next: function () {\n          return t && e >= t.length && (t = void 0), {\n            value: t && t[e++],\n            done: !t\n          };\n        }\n      };\n    };\n\n    function i(t, r) {\n      return Math.floor(r() * t);\n    }\n\n    function o(t) {\n      for (var r = [], e = 0; e < t; e++) r.push(void 0);\n\n      return r;\n    }\n\n    function s(t, r) {\n      return o(t).map(function () {\n        return r;\n      });\n    }\n\n    function a(t) {\n      return s(t, 0);\n    }\n\n    function h(t) {\n      return t.reduce(function (t, r) {\n        return t + r;\n      });\n    }\n\n    Object.defineProperty(r, "__esModule", {\n      value: !0\n    }), r.tauRandInt = i, r.tauRand = function (t) {\n      return t();\n    }, r.norm = function (t) {\n      var r,\n          e,\n          i = 0;\n\n      try {\n        for (var o = n(t), s = o.next(); !s.done; s = o.next()) {\n          var a = s.value;\n          i += Math.pow(a, 2);\n        }\n      } catch (t) {\n        r = {\n          error: t\n        };\n      } finally {\n        try {\n          s && !s.done && (e = o.return) && e.call(o);\n        } finally {\n          if (r) throw r.error;\n        }\n      }\n\n      return Math.sqrt(i);\n    }, r.empty = o, r.range = function (t) {\n      return o(t).map(function (t, r) {\n        return r;\n      });\n    }, r.filled = s, r.zeros = a, r.ones = function (t) {\n      return s(t, 1);\n    }, r.linear = function (t, r, e) {\n      return o(e).map(function (n, i) {\n        return t + i * ((r - t) / (e - 1));\n      });\n    }, r.sum = h, r.mean = function (t) {\n      return h(t) / t.length;\n    }, r.max = function (t) {\n      for (var r = 0, e = 0; e < t.length; e++) r = t[e] > r ? t[e] : r;\n\n      return r;\n    }, r.max2d = function (t) {\n      for (var r = 0, e = 0; e < t.length; e++) for (var n = 0; n < t[e].length; n++) r = t[e][n] > r ? t[e][n] : r;\n\n      return r;\n    }, r.rejectionSample = function (t, r, e) {\n      for (var n = a(t), o = 0; o < t; o++) for (var s = !0; s;) {\n        for (var h = i(r, e), u = !1, l = 0; l < o; l++) if (h === n[l]) {\n          u = !0;\n          break;\n        }\n\n        u || (s = !1), n[o] = h;\n      }\n\n      return n;\n    }, r.reshape2d = function (t, r, e) {\n      var n = [],\n          i = 0;\n      if (t.length !== r * e) throw new Error("Array dimensions must match input length.");\n\n      for (var o = 0; o < r; o++) {\n        for (var s = [], a = 0; a < e; a++) s.push(t[i]), i += 1;\n\n        n.push(s);\n      }\n\n      return n;\n    };\n  }, function (t, r, e) {\n    "use strict";\n\n    var n = this && this.__importStar || function (t) {\n      if (t && t.__esModule) return t;\n      var r = {};\n      if (null != t) for (var e in t) Object.hasOwnProperty.call(t, e) && (r[e] = t[e]);\n      return r.default = t, r;\n    };\n\n    Object.defineProperty(r, "__esModule", {\n      value: !0\n    });\n    var i = n(e(1));\n\n    function o(t, r) {\n      var e = function (e) {\n        return i.empty(t).map(function () {\n          return i.filled(r, e);\n        });\n      },\n          n = [];\n\n      return n.push(e(-1)), n.push(e(1 / 0)), n.push(e(0)), n;\n    }\n\n    function s(t, r, e, n, i) {\n      r = Math.floor(r);\n      var o = t[0][r],\n          s = t[1][r];\n      t[2][r];\n      if (e >= s[0]) return 0;\n\n      for (var h = 0; h < o.length; h++) if (n === o[h]) return 0;\n\n      return a(t, r, e, n, i);\n    }\n\n    function a(t, r, e, n, i) {\n      var o = t[0][r],\n          s = t[1][r],\n          a = t[2][r];\n      if (e >= s[0]) return 0;\n      s[0] = e, o[0] = n, a[0] = i;\n\n      for (var h = 0, u = 0;;) {\n        var l = 2 * h + 1,\n            c = l + 1,\n            f = t[0][0].length;\n        if (l >= f) break;\n\n        if (c >= f) {\n          if (!(s[l] > e)) break;\n          u = l;\n        } else if (s[l] >= s[c]) {\n          if (!(e < s[l])) break;\n          u = l;\n        } else {\n          if (!(e < s[c])) break;\n          u = c;\n        }\n\n        s[h] = s[u], o[h] = o[u], a[h] = a[u], h = u;\n      }\n\n      return s[h] = e, o[h] = n, a[h] = i, 1;\n    }\n\n    function h(t, r, e, n) {\n      for (; 2 * n + 1 < e;) {\n        var i = 2 * n + 1,\n            o = i + 1,\n            s = n;\n        if (t[s] < t[i] && (s = i), o < e && t[s] < t[o] && (s = o), s === n) break;\n        var a = t[n];\n        t[n] = t[s], t[s] = a;\n        var h = r[n];\n        r[n] = r[s], r[s] = h, n = s;\n      }\n    }\n\n    r.makeHeap = o, r.rejectionSample = function (t, r, e) {\n      for (var n = i.zeros(t), o = 0; o < t; o++) {\n        for (var s = !0, a = 0; s;) {\n          a = i.tauRandInt(r, e);\n\n          for (var h = !1, u = 0; u < o; u++) if (a === n[u]) {\n            h = !0;\n            break;\n          }\n\n          h || (s = !1);\n        }\n\n        n[o] = a;\n      }\n\n      return n;\n    }, r.heapPush = s, r.uncheckedHeapPush = a, r.buildCandidates = function (t, r, e, n, a) {\n      for (var h = o(r, n), u = 0; u < r; u++) for (var l = 0; l < e; l++) if (!(t[0][u][l] < 0)) {\n        var c = t[0][u][l],\n            f = t[2][u][l],\n            m = i.tauRand(a);\n        s(h, u, m, c, f), s(h, c, m, u, f), t[2][u][l] = 0;\n      }\n\n      return h;\n    }, r.deheapSort = function (t) {\n      for (var r = t[0], e = t[1], n = 0; n < r.length; n++) for (var i = r[n], o = e[n], s = 0; s < i.length - 1; s++) {\n        var a = i.length - s - 1,\n            u = o.length - s - 1,\n            l = i[0];\n        i[0] = i[a], i[a] = l;\n        var c = o[0];\n        o[0] = o[u], o[u] = c, h(o, i, u, 0);\n      }\n\n      return {\n        indices: r,\n        weights: e\n      };\n    }, r.smallestFlagged = function (t, r) {\n      for (var e = t[0][r], n = t[1][r], i = t[2][r], o = 1 / 0, s = -1, a = 0; a > e.length; a++) 1 === i[a] && n[a] < o && (o = n[a], s = a);\n\n      return s >= 0 ? (i[s] = 0, Math.floor(e[s])) : -1;\n    };\n  }, function (t, r, e) {\n    "use strict";\n\n    var n,\n        i = this && this.__read || function (t, r) {\n      var e = "function" == typeof Symbol && t[Symbol.iterator];\n      if (!e) return t;\n      var n,\n          i,\n          o = e.call(t),\n          s = [];\n\n      try {\n        for (; (void 0 === r || r-- > 0) && !(n = o.next()).done;) s.push(n.value);\n      } catch (t) {\n        i = {\n          error: t\n        };\n      } finally {\n        try {\n          n && !n.done && (e = o.return) && e.call(o);\n        } finally {\n          if (i) throw i.error;\n        }\n      }\n\n      return s;\n    },\n        o = this && this.__values || function (t) {\n      var r = "function" == typeof Symbol && t[Symbol.iterator],\n          e = 0;\n      return r ? r.call(t) : {\n        next: function () {\n          return t && e >= t.length && (t = void 0), {\n            value: t && t[e++],\n            done: !t\n          };\n        }\n      };\n    },\n        s = this && this.__importStar || function (t) {\n      if (t && t.__esModule) return t;\n      var r = {};\n      if (null != t) for (var e in t) Object.hasOwnProperty.call(t, e) && (r[e] = t[e]);\n      return r.default = t, r;\n    };\n\n    Object.defineProperty(r, "__esModule", {\n      value: !0\n    });\n\n    var a = s(e(1)),\n        h = function () {\n      function t(t, r, e, n) {\n        if (this.entries = new Map(), this.nRows = 0, this.nCols = 0, t.length !== r.length || t.length !== e.length) throw new Error("rows, cols and values arrays must all have the same length");\n        this.nRows = n[0], this.nCols = n[1];\n\n        for (var i = 0; i < e.length; i++) {\n          var o = t[i],\n              s = r[i];\n          this.checkDims(o, s);\n          var a = this.makeKey(o, s);\n          this.entries.set(a, {\n            value: e[i],\n            row: o,\n            col: s\n          });\n        }\n      }\n\n      return t.prototype.makeKey = function (t, r) {\n        return t + ":" + r;\n      }, t.prototype.checkDims = function (t, r) {\n        if (!(t < this.nRows && r < this.nCols)) throw new Error("row and/or col specified outside of matrix dimensions");\n      }, t.prototype.set = function (t, r, e) {\n        this.checkDims(t, r);\n        var n = this.makeKey(t, r);\n        this.entries.has(n) ? this.entries.get(n).value = e : this.entries.set(n, {\n          value: e,\n          row: t,\n          col: r\n        });\n      }, t.prototype.get = function (t, r, e) {\n        void 0 === e && (e = 0), this.checkDims(t, r);\n        var n = this.makeKey(t, r);\n        return this.entries.has(n) ? this.entries.get(n).value : e;\n      }, t.prototype.getAll = function (t) {\n        void 0 === t && (t = !0);\n        var r = [];\n        return this.entries.forEach(function (t) {\n          r.push(t);\n        }), t && r.sort(function (t, r) {\n          return t.row === r.row ? t.col - r.col : t.row - r.row;\n        }), r;\n      }, t.prototype.getDims = function () {\n        return [this.nRows, this.nCols];\n      }, t.prototype.getRows = function () {\n        return Array.from(this.entries, function (t) {\n          var r = i(t, 2);\n          r[0];\n          return r[1].row;\n        });\n      }, t.prototype.getCols = function () {\n        return Array.from(this.entries, function (t) {\n          var r = i(t, 2);\n          r[0];\n          return r[1].col;\n        });\n      }, t.prototype.getValues = function () {\n        return Array.from(this.entries, function (t) {\n          var r = i(t, 2);\n          r[0];\n          return r[1].value;\n        });\n      }, t.prototype.forEach = function (t) {\n        this.entries.forEach(function (r) {\n          return t(r.value, r.row, r.col);\n        });\n      }, t.prototype.map = function (r) {\n        var e = [];\n        this.entries.forEach(function (t) {\n          e.push(r(t.value, t.row, t.col));\n        });\n        var n = [this.nRows, this.nCols];\n        return new t(this.getRows(), this.getCols(), e, n);\n      }, t.prototype.toArray = function () {\n        var t = this,\n            r = a.empty(this.nRows).map(function () {\n          return a.zeros(t.nCols);\n        });\n        return this.entries.forEach(function (t) {\n          r[t.row][t.col] = t.value;\n        }), r;\n      }, t;\n    }();\n\n    r.SparseMatrix = h, r.transpose = function (t) {\n      var r = [],\n          e = [],\n          n = [];\n      t.forEach(function (t, i, o) {\n        r.push(i), e.push(o), n.push(t);\n      });\n      var i = [t.nCols, t.nRows];\n      return new h(e, r, n, i);\n    }, r.identity = function (t) {\n      for (var r = i(t, 1)[0], e = new h([], [], [], t), n = 0; n < r; n++) e.set(n, n, 1);\n\n      return e;\n    }, r.pairwiseMultiply = function (t, r) {\n      return l(t, r, function (t, r) {\n        return t * r;\n      });\n    }, r.add = function (t, r) {\n      return l(t, r, function (t, r) {\n        return t + r;\n      });\n    }, r.subtract = function (t, r) {\n      return l(t, r, function (t, r) {\n        return t - r;\n      });\n    }, r.maximum = function (t, r) {\n      return l(t, r, function (t, r) {\n        return t > r ? t : r;\n      });\n    }, r.multiplyScalar = function (t, r) {\n      return t.map(function (t) {\n        return t * r;\n      });\n    }, r.eliminateZeros = function (t) {\n      for (var r = new Set(), e = t.getValues(), n = t.getRows(), i = t.getCols(), o = 0; o < e.length; o++) 0 === e[o] && r.add(o);\n\n      var s = function (t, e) {\n        return !r.has(e);\n      },\n          a = e.filter(s),\n          u = n.filter(s),\n          l = i.filter(s);\n\n      return new h(u, l, a, t.getDims());\n    }, r.normalize = function (t, r) {\n      var e, n;\n      void 0 === r && (r = "l2");\n      var i = u[r],\n          s = new Map();\n      t.forEach(function (t, r, e) {\n        var n = s.get(r) || [];\n        n.push(e), s.set(r, n);\n      });\n\n      var a = new h([], [], [], t.getDims()),\n          l = function (r) {\n        for (var e = s.get(r).sort(), n = e.map(function (e) {\n          return t.get(r, e);\n        }), o = i(n), h = 0; h < o.length; h++) a.set(r, e[h], o[h]);\n      };\n\n      try {\n        for (var c = o(s.keys()), f = c.next(); !f.done; f = c.next()) l(f.value);\n      } catch (t) {\n        e = {\n          error: t\n        };\n      } finally {\n        try {\n          f && !f.done && (n = c.return) && n.call(c);\n        } finally {\n          if (e) throw e.error;\n        }\n      }\n\n      return a;\n    };\n    var u = ((n = {}).max = function (t) {\n      for (var r = -1 / 0, e = 0; e < t.length; e++) r = t[e] > r ? t[e] : r;\n\n      return t.map(function (t) {\n        return t / r;\n      });\n    }, n.l1 = function (t) {\n      for (var r = 0, e = 0; e < t.length; e++) r += t[e];\n\n      return t.map(function (t) {\n        return t / r;\n      });\n    }, n.l2 = function (t) {\n      for (var r = 0, e = 0; e < t.length; e++) r += Math.pow(t[e], 2);\n\n      return t.map(function (t) {\n        return Math.sqrt(Math.pow(t, 2) / r);\n      });\n    }, n);\n\n    function l(t, r, e) {\n      for (var n = new Set(), i = [], o = [], s = [], a = function (n, a) {\n        i.push(n), o.push(a);\n        var h = e(t.get(n, a), r.get(n, a));\n        s.push(h);\n      }, u = t.getValues(), l = t.getRows(), c = t.getCols(), f = 0; f < u.length; f++) {\n        var m = (d = l[f]) + ":" + (w = c[f]);\n        n.add(m), a(d, w);\n      }\n\n      var g = r.getValues(),\n          p = r.getRows(),\n          v = r.getCols();\n\n      for (f = 0; f < g.length; f++) {\n        var d, w;\n        m = (d = p[f]) + ":" + (w = v[f]);\n        n.has(m) || a(d, w);\n      }\n\n      var y = [t.nRows, t.nCols];\n      return new h(i, o, s, y);\n    }\n\n    r.getCSR = function (t) {\n      var r = [];\n      t.forEach(function (t, e, n) {\n        r.push({\n          value: t,\n          row: e,\n          col: n\n        });\n      }), r.sort(function (t, r) {\n        return t.row === r.row ? t.col - r.col : t.row - r.row;\n      });\n\n      for (var e = [], n = [], i = [], o = -1, s = 0; s < r.length; s++) {\n        var a = r[s],\n            h = a.row,\n            u = a.col,\n            l = a.value;\n        h !== o && (o = h, i.push(s)), e.push(u), n.push(l);\n      }\n\n      return {\n        indices: e,\n        values: n,\n        indptr: i\n      };\n    };\n  }, function (t, r, e) {\n    "use strict";\n\n    var n = this && this.__read || function (t, r) {\n      var e = "function" == typeof Symbol && t[Symbol.iterator];\n      if (!e) return t;\n      var n,\n          i,\n          o = e.call(t),\n          s = [];\n\n      try {\n        for (; (void 0 === r || r-- > 0) && !(n = o.next()).done;) s.push(n.value);\n      } catch (t) {\n        i = {\n          error: t\n        };\n      } finally {\n        try {\n          n && !n.done && (e = o.return) && e.call(o);\n        } finally {\n          if (i) throw i.error;\n        }\n      }\n\n      return s;\n    },\n        i = this && this.__spread || function () {\n      for (var t = [], r = 0; r < arguments.length; r++) t = t.concat(n(arguments[r]));\n\n      return t;\n    },\n        o = this && this.__values || function (t) {\n      var r = "function" == typeof Symbol && t[Symbol.iterator],\n          e = 0;\n      return r ? r.call(t) : {\n        next: function () {\n          return t && e >= t.length && (t = void 0), {\n            value: t && t[e++],\n            done: !t\n          };\n        }\n      };\n    },\n        s = this && this.__importStar || function (t) {\n      if (t && t.__esModule) return t;\n      var r = {};\n      if (null != t) for (var e in t) Object.hasOwnProperty.call(t, e) && (r[e] = t[e]);\n      return r.default = t, r;\n    };\n\n    Object.defineProperty(r, "__esModule", {\n      value: !0\n    });\n\n    var a = s(e(1)),\n        h = function () {\n      return function (t, r, e, n) {\n        this.hyperplanes = t, this.offsets = r, this.children = e, this.indices = n;\n      };\n    }();\n\n    function u(t, r, e, n) {\n      for (var i = r, o = 0; o < e.length; o++) i += t[o] * e[o];\n\n      return 0 === i ? a.tauRandInt(2, n) : i > 0 ? 0 : 1;\n    }\n\n    r.FlatTree = h, r.makeForest = function (t, r, e, n) {\n      var o = Math.max(10, r);\n      return a.range(e).map(function (r, e) {\n        return function (t, r, e, n) {\n          void 0 === r && (r = 30);\n          var i = a.range(t.length);\n          return function t(r, e, n, i, o) {\n            if (void 0 === n && (n = 30), e.length > n) {\n              var s = function (t, r, e) {\n                var n = t[0].length,\n                    i = a.tauRandInt(r.length, e),\n                    o = a.tauRandInt(r.length, e);\n                o = (o += i === o ? 1 : 0) % r.length;\n\n                for (var s = r[i], h = r[o], u = 0, l = a.zeros(n), c = 0; c < l.length; c++) l[c] = t[s][c] - t[h][c], u -= l[c] * (t[s][c] + t[h][c]) / 2;\n\n                for (var f = 0, m = 0, g = a.zeros(r.length), c = 0; c < r.length; c++) {\n                  for (var p = u, v = 0; v < n; v++) p += l[v] * t[r[c]][v];\n\n                  0 === p ? (g[c] = a.tauRandInt(2, e), 0 === g[c] ? f += 1 : m += 1) : p > 0 ? (g[c] = 0, f += 1) : (g[c] = 1, m += 1);\n                }\n\n                var d = a.zeros(f),\n                    w = a.zeros(m);\n\n                for (var c in f = 0, m = 0, a.range(g.length)) 0 === g[c] ? (d[f] = r[c], f += 1) : (w[m] = r[c], m += 1);\n\n                return {\n                  indicesLeft: d,\n                  indicesRight: w,\n                  hyperplane: l,\n                  offset: u\n                };\n              }(r, e, o),\n                  h = s.indicesLeft,\n                  u = s.indicesRight,\n                  l = s.hyperplane,\n                  c = s.offset,\n                  f = t(r, h, n, i + 1, o),\n                  m = t(r, u, n, i + 1, o),\n                  g = {\n                leftChild: f,\n                rightChild: m,\n                isLeaf: !1,\n                hyperplane: l,\n                offset: c\n              };\n\n              return g;\n            }\n\n            var g = {\n              indices: e,\n              isLeaf: !0\n            };\n            return g;\n          }(t, i, r, e, n);\n        }(t, o, e, n);\n      }).map(function (t) {\n        return function (t, r) {\n          var e = function t(r) {\n            return r.isLeaf ? 1 : 1 + t(r.leftChild) + t(r.rightChild);\n          }(t),\n              n = function t(r) {\n            return r.isLeaf ? 1 : t(r.leftChild) + t(r.rightChild);\n          }(t),\n              o = a.range(e).map(function () {\n            return a.zeros(t.hyperplane ? t.hyperplane.length : 0);\n          }),\n              s = a.zeros(e),\n              u = a.range(e).map(function () {\n            return [-1, -1];\n          }),\n              l = a.range(n).map(function () {\n            return a.range(r).map(function () {\n              return -1;\n            });\n          });\n\n          return function t(r, e, n, o, s, a, h) {\n            var u;\n            if (r.isLeaf) return o[a][0] = -h, (u = s[h]).splice.apply(u, i([0, r.indices.length], r.indices)), {\n              nodeNum: a,\n              leafNum: h += 1\n            };\n            e[a] = r.hyperplane, n[a] = r.offset, o[a][0] = a + 1;\n            var l = a,\n                c = t(r.leftChild, e, n, o, s, a + 1, h);\n            return a = c.nodeNum, h = c.leafNum, o[l][1] = a + 1, {\n              nodeNum: (c = t(r.rightChild, e, n, o, s, a + 1, h)).nodeNum,\n              leafNum: c.leafNum\n            };\n          }(t, o, s, u, l, 0, 0), new h(o, s, u, l);\n        }(t, o);\n      });\n    }, r.makeLeafArray = function (t) {\n      var r, e;\n\n      if (t.length > 0) {\n        var n = [];\n\n        try {\n          for (var s = o(t), a = s.next(); !a.done; a = s.next()) {\n            var h = a.value;\n            n.push.apply(n, i(h.indices));\n          }\n        } catch (t) {\n          r = {\n            error: t\n          };\n        } finally {\n          try {\n            a && !a.done && (e = s.return) && e.call(s);\n          } finally {\n            if (r) throw r.error;\n          }\n        }\n\n        return n;\n      }\n\n      return [[-1]];\n    }, r.searchFlatTree = function (t, r, e) {\n      for (var n = 0; r.children[n][0] > 0;) n = 0 === u(r.hyperplanes[n], r.offsets[n], t, e) ? r.children[n][0] : r.children[n][1];\n\n      var i = -1 * r.children[n][0];\n      return r.indices[i];\n    };\n  }, function (t, r, e) {\n    "use strict";\n\n    Object.defineProperty(r, "__esModule", {\n      value: !0\n    });\n    var n = e(6);\n    r.UMAP = n.UMAP;\n  }, function (t, r, e) {\n    "use strict";\n\n    var n = this && this.__awaiter || function (t, r, e, n) {\n      return new (e || (e = Promise))(function (i, o) {\n        function s(t) {\n          try {\n            h(n.next(t));\n          } catch (t) {\n            o(t);\n          }\n        }\n\n        function a(t) {\n          try {\n            h(n.throw(t));\n          } catch (t) {\n            o(t);\n          }\n        }\n\n        function h(t) {\n          t.done ? i(t.value) : new e(function (r) {\n            r(t.value);\n          }).then(s, a);\n        }\n\n        h((n = n.apply(t, r || [])).next());\n      });\n    },\n        i = this && this.__generator || function (t, r) {\n      var e,\n          n,\n          i,\n          o,\n          s = {\n        label: 0,\n        sent: function () {\n          if (1 & i[0]) throw i[1];\n          return i[1];\n        },\n        trys: [],\n        ops: []\n      };\n      return o = {\n        next: a(0),\n        throw: a(1),\n        return: a(2)\n      }, "function" == typeof Symbol && (o[Symbol.iterator] = function () {\n        return this;\n      }), o;\n\n      function a(o) {\n        return function (a) {\n          return function (o) {\n            if (e) throw new TypeError("Generator is already executing.");\n\n            for (; s;) try {\n              if (e = 1, n && (i = 2 & o[0] ? n.return : o[0] ? n.throw || ((i = n.return) && i.call(n), 0) : n.next) && !(i = i.call(n, o[1])).done) return i;\n\n              switch (n = 0, i && (o = [2 & o[0], i.value]), o[0]) {\n                case 0:\n                case 1:\n                  i = o;\n                  break;\n\n                case 4:\n                  return s.label++, {\n                    value: o[1],\n                    done: !1\n                  };\n\n                case 5:\n                  s.label++, n = o[1], o = [0];\n                  continue;\n\n                case 7:\n                  o = s.ops.pop(), s.trys.pop();\n                  continue;\n\n                default:\n                  if (!(i = (i = s.trys).length > 0 && i[i.length - 1]) && (6 === o[0] || 2 === o[0])) {\n                    s = 0;\n                    continue;\n                  }\n\n                  if (3 === o[0] && (!i || o[1] > i[0] && o[1] < i[3])) {\n                    s.label = o[1];\n                    break;\n                  }\n\n                  if (6 === o[0] && s.label < i[1]) {\n                    s.label = i[1], i = o;\n                    break;\n                  }\n\n                  if (i && s.label < i[2]) {\n                    s.label = i[2], s.ops.push(o);\n                    break;\n                  }\n\n                  i[2] && s.ops.pop(), s.trys.pop();\n                  continue;\n              }\n\n              o = r.call(t, s);\n            } catch (t) {\n              o = [6, t], n = 0;\n            } finally {\n              e = i = 0;\n            }\n\n            if (5 & o[0]) throw o[1];\n            return {\n              value: o[0] ? o[1] : void 0,\n              done: !0\n            };\n          }([o, a]);\n        };\n      }\n    },\n        o = this && this.__read || function (t, r) {\n      var e = "function" == typeof Symbol && t[Symbol.iterator];\n      if (!e) return t;\n      var n,\n          i,\n          o = e.call(t),\n          s = [];\n\n      try {\n        for (; (void 0 === r || r-- > 0) && !(n = o.next()).done;) s.push(n.value);\n      } catch (t) {\n        i = {\n          error: t\n        };\n      } finally {\n        try {\n          n && !n.done && (e = o.return) && e.call(o);\n        } finally {\n          if (i) throw i.error;\n        }\n      }\n\n      return s;\n    },\n        s = this && this.__spread || function () {\n      for (var t = [], r = 0; r < arguments.length; r++) t = t.concat(o(arguments[r]));\n\n      return t;\n    },\n        a = this && this.__importStar || function (t) {\n      if (t && t.__esModule) return t;\n      var r = {};\n      if (null != t) for (var e in t) Object.hasOwnProperty.call(t, e) && (r[e] = t[e]);\n      return r.default = t, r;\n    },\n        h = this && this.__importDefault || function (t) {\n      return t && t.__esModule ? t : {\n        default: t\n      };\n    };\n\n    Object.defineProperty(r, "__esModule", {\n      value: !0\n    });\n\n    var u = a(e(2)),\n        l = a(e(3)),\n        c = a(e(7)),\n        f = a(e(4)),\n        m = a(e(1)),\n        g = h(e(8)),\n        p = function () {\n      function t(t) {\n        void 0 === t && (t = {});\n        var r = this;\n        this.learningRate = 1, this.localConnectivity = 1, this.minDist = .1, this.nComponents = 2, this.nEpochs = 0, this.nNeighbors = 15, this.negativeSampleRate = 5, this.random = Math.random, this.repulsionStrength = 1, this.setOpMixRatio = 1, this.spread = 1, this.transformQueueSize = 4, this.targetMetric = "categorical", this.targetWeight = .5, this.targetNNeighbors = this.nNeighbors, this.distanceFn = v, this.isInitialized = !1, this.rpForest = [], this.embedding = [], this.optimizationState = new d();\n\n        var e = function (e) {\n          void 0 !== t[e] && (r[e] = t[e]);\n        };\n\n        e("distanceFn"), e("learningRate"), e("localConnectivity"), e("minDist"), e("nComponents"), e("nEpochs"), e("nNeighbors"), e("negativeSampleRate"), e("random"), e("repulsionStrength"), e("setOpMixRatio"), e("spread"), e("transformQueueSize");\n      }\n\n      return t.prototype.fit = function (t) {\n        return this.initializeFit(t), this.optimizeLayout(), this.embedding;\n      }, t.prototype.fitAsync = function (t, r) {\n        return void 0 === r && (r = function () {\n          return !0;\n        }), n(this, void 0, void 0, function () {\n          return i(this, function (e) {\n            switch (e.label) {\n              case 0:\n                return this.initializeFit(t), [4, this.optimizeLayoutAsync(r)];\n\n              case 1:\n                return e.sent(), [2, this.embedding];\n            }\n          });\n        });\n      }, t.prototype.setSupervisedProjection = function (t, r) {\n        void 0 === r && (r = {}), this.Y = t, this.targetMetric = r.targetMetric || this.targetMetric, this.targetWeight = r.targetWeight || this.targetWeight, this.targetNNeighbors = r.targetNNeighbors || this.targetNNeighbors;\n      }, t.prototype.setPrecomputedKNN = function (t, r) {\n        this.knnIndices = t, this.knnDistances = r;\n      }, t.prototype.initializeFit = function (t) {\n        if (t.length <= this.nNeighbors) throw new Error("Not enough data points (" + t.length + ") to create nNeighbors: " + this.nNeighbors + ".  Add more data points or adjust the configuration.");\n        if (this.X === t && this.isInitialized) return this.getNEpochs();\n\n        if (this.X = t, !this.knnIndices && !this.knnDistances) {\n          var r = this.nearestNeighbors(t);\n          this.knnIndices = r.knnIndices, this.knnDistances = r.knnDistances;\n        }\n\n        this.graph = this.fuzzySimplicialSet(t, this.nNeighbors, this.setOpMixRatio), this.makeSearchFns(), this.searchGraph = this.makeSearchGraph(t), this.processGraphForSupervisedProjection();\n        var e = this.initializeSimplicialSetEmbedding(),\n            n = e.head,\n            i = e.tail,\n            o = e.epochsPerSample;\n        return this.optimizationState.head = n, this.optimizationState.tail = i, this.optimizationState.epochsPerSample = o, this.initializeOptimization(), this.prepareForOptimizationLoop(), this.isInitialized = !0, this.getNEpochs();\n      }, t.prototype.makeSearchFns = function () {\n        var t = c.makeInitializations(this.distanceFn),\n            r = t.initFromTree,\n            e = t.initFromRandom;\n        this.initFromTree = r, this.initFromRandom = e, this.search = c.makeInitializedNNSearch(this.distanceFn);\n      }, t.prototype.makeSearchGraph = function (t) {\n        for (var r = this.knnIndices, e = this.knnDistances, n = [t.length, t.length], i = new l.SparseMatrix([], [], [], n), o = 0; o < r.length; o++) for (var s = r[o], a = e[o], h = 0; h < s.length; h++) {\n          var u = s[h],\n              c = a[h];\n          c > 0 && i.set(o, u, c);\n        }\n\n        var f = l.transpose(i);\n        return l.maximum(i, f);\n      }, t.prototype.transform = function (t) {\n        var r = this,\n            e = this.X;\n        if (void 0 === e || 0 === e.length) throw new Error("No data has been fit.");\n        var n = Math.floor(this.nNeighbors * this.transformQueueSize);\n        n = Math.min(e.length, n);\n        var i = c.initializeSearch(this.rpForest, e, t, n, this.initFromRandom, this.initFromTree, this.random),\n            o = this.search(e, this.searchGraph, i, t),\n            s = u.deheapSort(o),\n            a = s.indices,\n            h = s.weights;\n        a = a.map(function (t) {\n          return t.slice(0, r.nNeighbors);\n        }), h = h.map(function (t) {\n          return t.slice(0, r.nNeighbors);\n        });\n        var f = Math.max(0, this.localConnectivity - 1),\n            g = this.smoothKNNDistance(h, this.nNeighbors, f),\n            p = g.sigmas,\n            v = g.rhos,\n            d = this.computeMembershipStrengths(a, h, p, v),\n            w = d.rows,\n            y = d.cols,\n            b = d.vals,\n            M = [t.length, e.length],\n            x = new l.SparseMatrix(w, y, b, M),\n            E = l.normalize(x, "l1"),\n            R = l.getCSR(E),\n            k = t.length,\n            z = S(m.reshape2d(R.indices, k, this.nNeighbors), m.reshape2d(R.values, k, this.nNeighbors), this.embedding),\n            N = this.nEpochs ? this.nEpochs / 3 : x.nRows <= 1e4 ? 100 : 30,\n            A = x.getValues().reduce(function (t, r) {\n          return r > t ? r : t;\n        }, 0);\n        x = x.map(function (t) {\n          return t < A / N ? 0 : t;\n        }), x = l.eliminateZeros(x);\n\n        var V = this.makeEpochsPerSample(x.getValues(), N),\n            C = x.getRows(),\n            _ = x.getCols();\n\n        return this.assignOptimizationStateParameters({\n          headEmbedding: z,\n          tailEmbedding: this.embedding,\n          head: C,\n          tail: _,\n          currentEpoch: 0,\n          nEpochs: N,\n          nVertices: x.getDims()[1],\n          epochsPerSample: V\n        }), this.prepareForOptimizationLoop(), this.optimizeLayout();\n      }, t.prototype.processGraphForSupervisedProjection = function () {\n        var t = this.Y,\n            r = this.X;\n\n        if (t) {\n          if (t.length !== r.length) throw new Error("Length of X and y must be equal");\n\n          if ("categorical" === this.targetMetric) {\n            var e = this.targetWeight < 1 ? 1 / (1 - this.targetWeight) * 2.5 : 1e12;\n            this.graph = this.categoricalSimplicialSetIntersection(this.graph, t, e);\n          }\n        }\n      }, t.prototype.step = function () {\n        var t = this.optimizationState.currentEpoch;\n        return t < this.getNEpochs() && this.optimizeLayoutStep(t), this.optimizationState.currentEpoch;\n      }, t.prototype.getEmbedding = function () {\n        return this.embedding;\n      }, t.prototype.nearestNeighbors = function (t) {\n        var r,\n            e = this.distanceFn,\n            n = this.nNeighbors,\n            i = c.makeNNDescent(e, this.random),\n            o = 5 + Math.floor(.5 === (r = Math.pow(t.length, .5) / 20) ? 0 : Math.round(r)),\n            s = Math.max(5, Math.floor(Math.round(function (t) {\n          return Math.log(t) / Math.log(2);\n        }(t.length))));\n        this.rpForest = f.makeForest(t, n, o, this.random);\n        var a = i(t, f.makeLeafArray(this.rpForest), n, s);\n        return {\n          knnIndices: a.indices,\n          knnDistances: a.weights\n        };\n      }, t.prototype.fuzzySimplicialSet = function (t, r, e) {\n        void 0 === e && (e = 1);\n        var n = this.knnIndices,\n            i = void 0 === n ? [] : n,\n            o = this.knnDistances,\n            s = void 0 === o ? [] : o,\n            a = this.localConnectivity,\n            h = this.smoothKNNDistance(s, r, a),\n            u = h.sigmas,\n            c = h.rhos,\n            f = this.computeMembershipStrengths(i, s, u, c),\n            m = f.rows,\n            g = f.cols,\n            p = f.vals,\n            v = [t.length, t.length],\n            d = new l.SparseMatrix(m, g, p, v),\n            w = l.transpose(d),\n            y = l.pairwiseMultiply(d, w),\n            b = l.subtract(l.add(d, w), y),\n            M = l.multiplyScalar(b, e),\n            x = l.multiplyScalar(y, 1 - e);\n        return l.add(M, x);\n      }, t.prototype.categoricalSimplicialSetIntersection = function (t, r, e, n) {\n        void 0 === n && (n = 1);\n        var i = M(t, r, n, e);\n        return x(i = l.eliminateZeros(i));\n      }, t.prototype.smoothKNNDistance = function (t, r, e, n, i) {\n        void 0 === e && (e = 1), void 0 === n && (n = 64), void 0 === i && (i = 1);\n\n        for (var o = Math.log(r) / Math.log(2) * i, s = m.zeros(t.length), a = m.zeros(t.length), h = 0; h < t.length; h++) {\n          var u = 0,\n              l = 1 / 0,\n              c = 1,\n              f = t[h],\n              g = f.filter(function (t) {\n            return t > 0;\n          });\n\n          if (g.length >= e) {\n            var p = Math.floor(e),\n                v = e - p;\n            p > 0 ? (s[h] = g[p - 1], v > 1e-5 && (s[h] += v * (g[p] - g[p - 1]))) : s[h] = v * g[0];\n          } else g.length > 0 && (s[h] = m.max(g));\n\n          for (var d = 0; d < n; d++) {\n            for (var w = 0, y = 1; y < t[h].length; y++) {\n              var b = t[h][y] - s[h];\n              w += b > 0 ? Math.exp(-b / c) : 1;\n            }\n\n            if (Math.abs(w - o) < 1e-5) break;\n            w > o ? c = (u + (l = c)) / 2 : (u = c, l === 1 / 0 ? c *= 2 : c = (u + l) / 2);\n          }\n\n          if (a[h] = c, s[h] > 0) {\n            var M = m.mean(f);\n            a[h] < .001 * M && (a[h] = .001 * M);\n          } else {\n            var x = m.mean(t.map(m.mean));\n            a[h] < .001 * x && (a[h] = .001 * x);\n          }\n        }\n\n        return {\n          sigmas: a,\n          rhos: s\n        };\n      }, t.prototype.computeMembershipStrengths = function (t, r, e, n) {\n        for (var i = t.length, o = t[0].length, s = m.zeros(i * o), a = m.zeros(i * o), h = m.zeros(i * o), u = 0; u < i; u++) for (var l = 0; l < o; l++) {\n          var c = 0;\n          -1 !== t[u][l] && (c = t[u][l] === u ? 0 : r[u][l] - n[u] <= 0 ? 1 : Math.exp(-(r[u][l] - n[u]) / e[u]), s[u * o + l] = u, a[u * o + l] = t[u][l], h[u * o + l] = c);\n        }\n\n        return {\n          rows: s,\n          cols: a,\n          vals: h\n        };\n      }, t.prototype.initializeSimplicialSetEmbedding = function () {\n        for (var t = this, r = this.getNEpochs(), e = this.nComponents, n = this.graph.getValues(), i = 0, o = 0; o < n.length; o++) {\n          var s = n[o];\n          i < n[o] && (i = s);\n        }\n\n        var a = this.graph.map(function (t) {\n          return t < i / r ? 0 : t;\n        });\n        this.embedding = m.zeros(a.nRows).map(function () {\n          return m.zeros(e).map(function () {\n            return 20 * m.tauRand(t.random) - 10;\n          });\n        });\n        var h = [],\n            u = [],\n            l = [],\n            c = a.getAll();\n\n        for (o = 0; o < c.length; o++) {\n          var f = c[o];\n          f.value && (h.push(f.value), l.push(f.row), u.push(f.col));\n        }\n\n        return {\n          head: u,\n          tail: l,\n          epochsPerSample: this.makeEpochsPerSample(h, r)\n        };\n      }, t.prototype.makeEpochsPerSample = function (t, r) {\n        var e = m.filled(t.length, -1),\n            n = m.max(t),\n            i = t.map(function (t) {\n          return t / n * r;\n        });\n        return i.forEach(function (t, n) {\n          t > 0 && (e[n] = r / i[n]);\n        }), e;\n      }, t.prototype.assignOptimizationStateParameters = function (t) {\n        Object.assign(this.optimizationState, t);\n      }, t.prototype.prepareForOptimizationLoop = function () {\n        var t = this.repulsionStrength,\n            r = this.learningRate,\n            e = this.negativeSampleRate,\n            n = this.optimizationState,\n            i = n.epochsPerSample,\n            o = n.headEmbedding,\n            a = n.tailEmbedding,\n            h = o[0].length,\n            u = o.length === a.length,\n            l = i.map(function (t) {\n          return t / e;\n        }),\n            c = s(l),\n            f = s(i);\n        this.assignOptimizationStateParameters({\n          epochOfNextSample: f,\n          epochOfNextNegativeSample: c,\n          epochsPerNegativeSample: l,\n          moveOther: u,\n          initialAlpha: r,\n          alpha: r,\n          gamma: t,\n          dim: h\n        });\n      }, t.prototype.initializeOptimization = function () {\n        var t = this.embedding,\n            r = this.embedding,\n            e = this.optimizationState,\n            n = e.head,\n            i = e.tail,\n            o = e.epochsPerSample,\n            s = this.getNEpochs(),\n            a = this.graph.nCols,\n            h = b(this.spread, this.minDist),\n            u = h.a,\n            l = h.b;\n        this.assignOptimizationStateParameters({\n          headEmbedding: t,\n          tailEmbedding: r,\n          head: n,\n          tail: i,\n          epochsPerSample: o,\n          a: u,\n          b: l,\n          nEpochs: s,\n          nVertices: a\n        });\n      }, t.prototype.optimizeLayoutStep = function (t) {\n        for (var r = this.optimizationState, e = r.head, n = r.tail, i = r.headEmbedding, o = r.tailEmbedding, s = r.epochsPerSample, a = r.epochOfNextSample, h = r.epochOfNextNegativeSample, u = r.epochsPerNegativeSample, l = r.moveOther, c = r.initialAlpha, f = r.alpha, g = r.gamma, p = r.a, v = r.b, d = r.dim, b = r.nEpochs, M = r.nVertices, x = 0; x < s.length; x++) if (!(a[x] > t)) {\n          var S = e[x],\n              E = n[x],\n              R = i[S],\n              k = o[E],\n              z = y(R, k),\n              N = 0;\n          z > 0 && (N = -2 * p * v * Math.pow(z, v - 1), N /= p * Math.pow(z, v) + 1);\n\n          for (var A = 0; A < d; A++) {\n            var V = w(N * (R[A] - k[A]), 4);\n            R[A] += V * f, l && (k[A] += -V * f);\n          }\n\n          a[x] += s[x];\n\n          for (var C = Math.floor((t - h[x]) / u[x]), _ = 0; _ < C; _++) {\n            var P = m.tauRandInt(M, this.random),\n                j = o[P],\n                I = y(R, j),\n                O = 0;\n            if (I > 0) O = 2 * g * v, O /= (.001 + I) * (p * Math.pow(I, v) + 1);else if (S === P) continue;\n\n            for (A = 0; A < d; A++) {\n              V = 4;\n              O > 0 && (V = w(O * (R[A] - j[A]), 4)), R[A] += V * f;\n            }\n          }\n\n          h[x] += C * u[x];\n        }\n\n        return r.alpha = c * (1 - t / b), r.currentEpoch += 1, i;\n      }, t.prototype.optimizeLayoutAsync = function (t) {\n        var r = this;\n        return void 0 === t && (t = function () {\n          return !0;\n        }), new Promise(function (e, o) {\n          var s = function () {\n            return n(r, void 0, void 0, function () {\n              var r, n, a, h, u, l;\n              return i(this, function (i) {\n                try {\n                  if (r = this.optimizationState, n = r.nEpochs, a = r.currentEpoch, this.embedding = this.optimizeLayoutStep(a), h = this.optimizationState.currentEpoch, u = !1 === t(h), l = h === n, u || l) return [2, e(l)];\n                  setTimeout(function () {\n                    return s();\n                  }, 0);\n                } catch (t) {\n                  o(t);\n                }\n\n                return [2];\n              });\n            });\n          };\n\n          setTimeout(function () {\n            return s();\n          }, 0);\n        });\n      }, t.prototype.optimizeLayout = function (t) {\n        void 0 === t && (t = function () {\n          return !0;\n        });\n\n        for (var r = !1, e = []; !r;) {\n          var n = this.optimizationState,\n              i = n.nEpochs,\n              o = n.currentEpoch;\n          e = this.optimizeLayoutStep(o);\n          var s = this.optimizationState.currentEpoch,\n              a = !1 === t(s);\n          r = s === i || a;\n        }\n\n        return e;\n      }, t.prototype.getNEpochs = function () {\n        var t = this.graph;\n        if (this.nEpochs > 0) return this.nEpochs;\n        var r = t.nRows;\n        return r <= 2500 ? 500 : r <= 5e3 ? 400 : r <= 7500 ? 300 : 200;\n      }, t;\n    }();\n\n    function v(t, r) {\n      for (var e = 0, n = 0; n < t.length; n++) e += Math.pow(t[n] - r[n], 2);\n\n      return Math.sqrt(e);\n    }\n\n    r.UMAP = p, r.euclidean = v, r.cosine = function (t, r) {\n      for (var e = 0, n = 0, i = 0, o = 0; o < t.length; o++) e += t[o] * r[o], n += Math.pow(t[o], 2), i += Math.pow(r[o], 2);\n\n      return 0 === n && 0 === i ? 0 : 0 === n || 0 === i ? 1 : 1 - e / Math.sqrt(n * i);\n    };\n\n    var d = function () {\n      return function () {\n        this.currentEpoch = 0, this.headEmbedding = [], this.tailEmbedding = [], this.head = [], this.tail = [], this.epochsPerSample = [], this.epochOfNextSample = [], this.epochOfNextNegativeSample = [], this.epochsPerNegativeSample = [], this.moveOther = !0, this.initialAlpha = 1, this.alpha = 1, this.gamma = 1, this.a = 1.5769434603113077, this.b = .8950608779109733, this.dim = 2, this.nEpochs = 500, this.nVertices = 0;\n      };\n    }();\n\n    function w(t, r) {\n      return t > r ? r : t < -r ? -r : t;\n    }\n\n    function y(t, r) {\n      for (var e = 0, n = 0; n < t.length; n++) e += Math.pow(t[n] - r[n], 2);\n\n      return e;\n    }\n\n    function b(t, r) {\n      var e = m.linear(0, 3 * t, 300).map(function (t) {\n        return t < r ? 1 : t;\n      }),\n          n = m.zeros(e.length).map(function (n, i) {\n        return e[i] >= r ? Math.exp(-(e[i] - r) / t) : n;\n      }),\n          i = {\n        x: e,\n        y: n\n      },\n          s = {\n        damping: 1.5,\n        initialValues: [.5, .5],\n        gradientDifference: .1,\n        maxIterations: 100,\n        errorTolerance: .01\n      },\n          a = g.default(i, function (t) {\n        var r = o(t, 2),\n            e = r[0],\n            n = r[1];\n        return function (t) {\n          return 1 / (1 + e * Math.pow(t, 2 * n));\n        };\n      }, s).parameterValues,\n          h = o(a, 2);\n      return {\n        a: h[0],\n        b: h[1]\n      };\n    }\n\n    function M(t, r, e, n) {\n      return void 0 === e && (e = 1), void 0 === n && (n = 5), t.map(function (t, i, o) {\n        return -1 === r[i] || -1 === r[o] ? t * Math.exp(-e) : r[i] !== r[o] ? t * Math.exp(-n) : t;\n      });\n    }\n\n    function x(t) {\n      t = l.normalize(t, "max");\n      var r = l.transpose(t),\n          e = l.pairwiseMultiply(r, t);\n      return t = l.add(t, l.subtract(r, e)), l.eliminateZeros(t);\n    }\n\n    function S(t, r, e) {\n      for (var n = m.zeros(t.length).map(function (t) {\n        return m.zeros(e[0].length);\n      }), i = 0; i < t.length; i++) for (var o = 0; o < t[0].length; o++) for (var s = 0; s < e[0].length; s++) {\n        var a = t[i][o];\n        n[i][s] += r[i][o] * e[a][s];\n      }\n\n      return n;\n    }\n\n    r.findABParams = b, r.fastIntersection = M, r.resetLocalConnectivity = x, r.initTransform = S;\n  }, function (t, r, e) {\n    "use strict";\n\n    var n = this && this.__values || function (t) {\n      var r = "function" == typeof Symbol && t[Symbol.iterator],\n          e = 0;\n      return r ? r.call(t) : {\n        next: function () {\n          return t && e >= t.length && (t = void 0), {\n            value: t && t[e++],\n            done: !t\n          };\n        }\n      };\n    },\n        i = this && this.__importStar || function (t) {\n      if (t && t.__esModule) return t;\n      var r = {};\n      if (null != t) for (var e in t) Object.hasOwnProperty.call(t, e) && (r[e] = t[e]);\n      return r.default = t, r;\n    };\n\n    Object.defineProperty(r, "__esModule", {\n      value: !0\n    });\n    var o = i(e(2)),\n        s = i(e(3)),\n        a = i(e(4)),\n        h = i(e(1));\n    r.makeNNDescent = function (t, r) {\n      return function (e, n, i, s, a, u, l, c) {\n        void 0 === s && (s = 10), void 0 === a && (a = 50), void 0 === u && (u = .001), void 0 === l && (l = .5), void 0 === c && (c = !0);\n\n        for (var f = e.length, m = o.makeHeap(e.length, i), g = 0; g < e.length; g++) for (var p = o.rejectionSample(i, e.length, r), v = 0; v < p.length; v++) {\n          var d = t(e[g], e[p[v]]);\n          o.heapPush(m, g, d, p[v], 1), o.heapPush(m, p[v], d, g, 1);\n        }\n\n        if (c) for (var w = 0; w < n.length; w++) for (g = 0; g < n[w].length && !(n[w][g] < 0); g++) for (v = g + 1; v < n[w].length && !(n[w][v] < 0); v++) d = t(e[n[w][g]], e[n[w][v]]), o.heapPush(m, n[w][g], d, n[w][v], 1), o.heapPush(m, n[w][v], d, n[w][g], 1);\n\n        for (w = 0; w < s; w++) {\n          var y = o.buildCandidates(m, f, i, a, r),\n              b = 0;\n\n          for (g = 0; g < f; g++) for (v = 0; v < a; v++) {\n            var M = Math.floor(y[0][g][v]);\n            if (!(M < 0 || h.tauRand(r) < l)) for (var x = 0; x < a; x++) {\n              var S = Math.floor(y[0][g][x]),\n                  E = y[2][g][v],\n                  R = y[2][g][x];\n              S < 0 || !E && !R || (d = t(e[M], e[S]), b += o.heapPush(m, M, d, S, 1), b += o.heapPush(m, S, d, M, 1));\n            }\n          }\n\n          if (b <= u * i * e.length) break;\n        }\n\n        return o.deheapSort(m);\n      };\n    }, r.makeInitializations = function (t) {\n      return {\n        initFromRandom: function (r, e, n, i, s) {\n          for (var a = 0; a < n.length; a++) for (var u = h.rejectionSample(r, e.length, s), l = 0; l < u.length; l++) if (!(u[l] < 0)) {\n            var c = t(e[u[l]], n[a]);\n            o.heapPush(i, a, c, u[l], 1);\n          }\n        },\n        initFromTree: function (r, e, n, i, s) {\n          for (var h = 0; h < n.length; h++) for (var u = a.searchFlatTree(n[h], r, s), l = 0; l < u.length; l++) {\n            if (u[l] < 0) return;\n            var c = t(e[u[l]], n[h]);\n            o.heapPush(i, h, c, u[l], 1);\n          }\n        }\n      };\n    }, r.makeInitializedNNSearch = function (t) {\n      return function (r, e, i, a) {\n        for (var h, u, l = s.getCSR(e), c = l.indices, f = l.indptr, m = 0; m < a.length; m++) for (var g = new Set(i[0][m]);;) {\n          var p = o.smallestFlagged(i, m);\n          if (-1 === p) break;\n          var v = c.slice(f[p], f[p + 1]);\n\n          try {\n            for (var d = n(v), w = d.next(); !w.done; w = d.next()) {\n              var y = w.value;\n\n              if (y !== p && -1 !== y && !g.has(y)) {\n                var b = t(r[y], a[m]);\n                o.uncheckedHeapPush(i, m, b, y, 1), g.add(y);\n              }\n            }\n          } catch (t) {\n            h = {\n              error: t\n            };\n          } finally {\n            try {\n              w && !w.done && (u = d.return) && u.call(d);\n            } finally {\n              if (h) throw h.error;\n            }\n          }\n        }\n\n        return i;\n      };\n    }, r.initializeSearch = function (t, r, e, i, s, a, h) {\n      var u,\n          l,\n          c = o.makeHeap(e.length, i);\n      if (s(i, r, e, c, h), t) try {\n        for (var f = n(t), m = f.next(); !m.done; m = f.next()) a(m.value, r, e, c, h);\n      } catch (t) {\n        u = {\n          error: t\n        };\n      } finally {\n        try {\n          m && !m.done && (l = f.return) && l.call(f);\n        } finally {\n          if (u) throw u.error;\n        }\n      }\n      return c;\n    };\n  }, function (t, r, e) {\n    "use strict";\n\n    var n = e(9);\n\n    function i(t, r, e) {\n      var n = 0;\n      const i = e(r);\n\n      for (var o = 0; o < t.x.length; o++) n += Math.abs(t.y[o] - i(t.x[o]));\n\n      return n;\n    }\n\n    function o(t, r, e, i, o) {\n      var s = n.Matrix.eye(r.length).mul(e * i * i),\n          a = t.x.length,\n          h = new Array(a);\n      const u = o(r);\n\n      for (var l = 0; l < a; l++) h[l] = u(t.x[l]);\n\n      var c = function (t, r, e, i, o) {\n        const s = e.length,\n              a = t.x.length;\n\n        for (var h = new Array(s), u = 0; u < s; u++) {\n          h[u] = new Array(a);\n          var l = e.concat();\n          l[u] += i;\n\n          for (var c = o(l), f = 0; f < a; f++) h[u][f] = r[f] - c(t.x[f]);\n        }\n\n        return new n.Matrix(h);\n      }(t, h, r, i, o),\n          f = function (t, r) {\n        const e = t.x.length;\n\n        for (var i = new Array(e), o = 0; o < e; o++) i[o] = t.y[o] - r[o];\n\n        return new n.Matrix([i]);\n      }(t, h).transposeView(),\n          m = n.inverse(s.add(c.mmul(c.transposeView())));\n\n      return (r = (r = new n.Matrix([r])).sub(m.mmul(c).mmul(f).mul(i).transposeView())).to1DArray();\n    }\n\n    t.exports = function (t, r, e = {}) {\n      let {\n        maxIterations: n = 100,\n        gradientDifference: s = .1,\n        damping: a = 0,\n        errorTolerance: h = .01,\n        initialValues: u\n      } = e;\n      if (a <= 0) throw new Error("The damping option must be a positive number");\n      if (!t.x || !t.y) throw new Error("The data parameter must have x and y elements");\n      if (!Array.isArray(t.x) || t.x.length < 2 || !Array.isArray(t.y) || t.y.length < 2) throw new Error("The data parameter elements must be an array with more than 2 points");\n      if (t.x.length !== t.y.length) throw new Error("The data parameter elements must have the same size");\n      var l = u || new Array(r.length).fill(1);\n      if (!Array.isArray(l)) throw new Error("initialValues must be an array");\n\n      for (var c = i(t, l, r), f = c <= h, m = 0; m < n && !f; m++) f = (c = i(t, l = o(t, l, a, s, r), r)) <= h;\n\n      return {\n        parameterValues: l,\n        parameterError: c,\n        iterations: m\n      };\n    };\n  }, function (t, r, e) {\n    "use strict";\n\n    e.r(r);\n    var n = e(0),\n        i = e.n(n);\n\n    var o = function (t) {\n      if (!i()(t)) throw new TypeError("input must be an array");\n      if (0 === t.length) throw new TypeError("input must not be empty");\n\n      for (var r = t[0], e = 1; e < t.length; e++) t[e] > r && (r = t[e]);\n\n      return r;\n    };\n\n    var s = function (t) {\n      if (!i()(t)) throw new TypeError("input must be an array");\n      if (0 === t.length) throw new TypeError("input must not be empty");\n\n      for (var r = t[0], e = 1; e < t.length; e++) t[e] < r && (r = t[e]);\n\n      return r;\n    };\n\n    var a = function (t) {\n      var r,\n          e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};\n      if (!i()(t)) throw new TypeError("input must be an array");\n      if (0 === t.length) throw new TypeError("input must not be empty");\n\n      if (void 0 !== e.output) {\n        if (!i()(e.output)) throw new TypeError("output option must be an array if specified");\n        r = e.output;\n      } else r = new Array(t.length);\n\n      var n = s(t),\n          a = o(t);\n      if (n === a) throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");\n      var h = e.min,\n          u = void 0 === h ? e.autoMinMax ? n : 0 : h,\n          l = e.max,\n          c = void 0 === l ? e.autoMinMax ? a : 1 : l;\n      if (u >= c) throw new RangeError("min option must be smaller than max option");\n\n      for (var f = (c - u) / (a - n), m = 0; m < t.length; m++) r[m] = (t[m] - n) * f + u;\n\n      return r;\n    };\n\n    class h {\n      constructor(t) {\n        var r,\n            e,\n            n,\n            i,\n            o,\n            s,\n            a,\n            h,\n            u,\n            l = (t = j.checkMatrix(t)).clone(),\n            c = l.rows,\n            f = l.columns,\n            m = new Array(c),\n            g = 1;\n\n        for (r = 0; r < c; r++) m[r] = r;\n\n        for (h = new Array(c), e = 0; e < f; e++) {\n          for (r = 0; r < c; r++) h[r] = l.get(r, e);\n\n          for (r = 0; r < c; r++) {\n            for (u = Math.min(r, e), o = 0, n = 0; n < u; n++) o += l.get(r, n) * h[n];\n\n            h[r] -= o, l.set(r, e, h[r]);\n          }\n\n          for (i = e, r = e + 1; r < c; r++) Math.abs(h[r]) > Math.abs(h[i]) && (i = r);\n\n          if (i !== e) {\n            for (n = 0; n < f; n++) s = l.get(i, n), l.set(i, n, l.get(e, n)), l.set(e, n, s);\n\n            a = m[i], m[i] = m[e], m[e] = a, g = -g;\n          }\n\n          if (e < c && 0 !== l.get(e, e)) for (r = e + 1; r < c; r++) l.set(r, e, l.get(r, e) / l.get(e, e));\n        }\n\n        this.LU = l, this.pivotVector = m, this.pivotSign = g;\n      }\n\n      isSingular() {\n        for (var t = this.LU, r = t.columns, e = 0; e < r; e++) if (0 === t[e][e]) return !0;\n\n        return !1;\n      }\n\n      solve(t) {\n        t = _.checkMatrix(t);\n        var r = this.LU;\n        if (r.rows !== t.rows) throw new Error("Invalid matrix dimensions");\n        if (this.isSingular()) throw new Error("LU matrix is singular");\n        var e,\n            n,\n            i,\n            o = t.columns,\n            s = t.subMatrixRow(this.pivotVector, 0, o - 1),\n            a = r.columns;\n\n        for (i = 0; i < a; i++) for (e = i + 1; e < a; e++) for (n = 0; n < o; n++) s[e][n] -= s[i][n] * r[e][i];\n\n        for (i = a - 1; i >= 0; i--) {\n          for (n = 0; n < o; n++) s[i][n] /= r[i][i];\n\n          for (e = 0; e < i; e++) for (n = 0; n < o; n++) s[e][n] -= s[i][n] * r[e][i];\n        }\n\n        return s;\n      }\n\n      get determinant() {\n        var t = this.LU;\n        if (!t.isSquare()) throw new Error("Matrix must be square");\n\n        for (var r = this.pivotSign, e = t.columns, n = 0; n < e; n++) r *= t[n][n];\n\n        return r;\n      }\n\n      get lowerTriangularMatrix() {\n        for (var t = this.LU, r = t.rows, e = t.columns, n = new _(r, e), i = 0; i < r; i++) for (var o = 0; o < e; o++) n[i][o] = i > o ? t[i][o] : i === o ? 1 : 0;\n\n        return n;\n      }\n\n      get upperTriangularMatrix() {\n        for (var t = this.LU, r = t.rows, e = t.columns, n = new _(r, e), i = 0; i < r; i++) for (var o = 0; o < e; o++) n[i][o] = i <= o ? t[i][o] : 0;\n\n        return n;\n      }\n\n      get pivotPermutationVector() {\n        return this.pivotVector.slice();\n      }\n\n    }\n\n    function u(t, r) {\n      var e = 0;\n      return Math.abs(t) > Math.abs(r) ? (e = r / t, Math.abs(t) * Math.sqrt(1 + e * e)) : 0 !== r ? (e = t / r, Math.abs(r) * Math.sqrt(1 + e * e)) : 0;\n    }\n\n    function l(t, r, e) {\n      for (var n = new Array(t), i = 0; i < t; i++) {\n        n[i] = new Array(r);\n\n        for (var o = 0; o < r; o++) n[i][o] = e;\n      }\n\n      return n;\n    }\n\n    class c {\n      constructor(t, r = {}) {\n        var e = (t = j.checkMatrix(t)).rows,\n            n = t.columns;\n        const {\n          computeLeftSingularVectors: i = !0,\n          computeRightSingularVectors: o = !0,\n          autoTranspose: s = !1\n        } = r;\n        var a,\n            h = Boolean(i),\n            c = Boolean(o),\n            f = !1;\n        if (e < n) {\n          if (s) {\n            e = (a = t.transpose()).rows, n = a.columns, f = !0;\n            var m = h;\n            h = c, c = m;\n          } else a = t.clone(), console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");\n        } else a = t.clone();\n        var g = Math.min(e, n),\n            p = Math.min(e + 1, n),\n            v = new Array(p),\n            d = l(e, g, 0),\n            w = l(n, n, 0),\n            y = new Array(n),\n            b = new Array(e),\n            M = new Array(p);\n\n        for (let t = 0; t < p; t++) M[t] = t;\n\n        var x = Math.min(e - 1, n),\n            S = Math.max(0, Math.min(n - 2, e)),\n            E = Math.max(x, S);\n\n        for (let t = 0; t < E; t++) {\n          if (t < x) {\n            v[t] = 0;\n\n            for (let r = t; r < e; r++) v[t] = u(v[t], a[r][t]);\n\n            if (0 !== v[t]) {\n              a[t][t] < 0 && (v[t] = -v[t]);\n\n              for (let r = t; r < e; r++) a[r][t] /= v[t];\n\n              a[t][t] += 1;\n            }\n\n            v[t] = -v[t];\n          }\n\n          for (let r = t + 1; r < n; r++) {\n            if (t < x && 0 !== v[t]) {\n              let n = 0;\n\n              for (let i = t; i < e; i++) n += a[i][t] * a[i][r];\n\n              n = -n / a[t][t];\n\n              for (let i = t; i < e; i++) a[i][r] += n * a[i][t];\n            }\n\n            y[r] = a[t][r];\n          }\n\n          if (h && t < x) for (let r = t; r < e; r++) d[r][t] = a[r][t];\n\n          if (t < S) {\n            y[t] = 0;\n\n            for (let r = t + 1; r < n; r++) y[t] = u(y[t], y[r]);\n\n            if (0 !== y[t]) {\n              y[t + 1] < 0 && (y[t] = 0 - y[t]);\n\n              for (let r = t + 1; r < n; r++) y[r] /= y[t];\n\n              y[t + 1] += 1;\n            }\n\n            if (y[t] = -y[t], t + 1 < e && 0 !== y[t]) {\n              for (let r = t + 1; r < e; r++) b[r] = 0;\n\n              for (let r = t + 1; r < e; r++) for (let e = t + 1; e < n; e++) b[r] += y[e] * a[r][e];\n\n              for (let r = t + 1; r < n; r++) {\n                let n = -y[r] / y[t + 1];\n\n                for (let i = t + 1; i < e; i++) a[i][r] += n * b[i];\n              }\n            }\n\n            if (c) for (let r = t + 1; r < n; r++) w[r][t] = y[r];\n          }\n        }\n\n        let R = Math.min(n, e + 1);\n\n        if (x < n && (v[x] = a[x][x]), e < R && (v[R - 1] = 0), S + 1 < R && (y[S] = a[S][R - 1]), y[R - 1] = 0, h) {\n          for (let t = x; t < g; t++) {\n            for (let r = 0; r < e; r++) d[r][t] = 0;\n\n            d[t][t] = 1;\n          }\n\n          for (let t = x - 1; t >= 0; t--) if (0 !== v[t]) {\n            for (let r = t + 1; r < g; r++) {\n              let n = 0;\n\n              for (let i = t; i < e; i++) n += d[i][t] * d[i][r];\n\n              n = -n / d[t][t];\n\n              for (let i = t; i < e; i++) d[i][r] += n * d[i][t];\n            }\n\n            for (let r = t; r < e; r++) d[r][t] = -d[r][t];\n\n            d[t][t] = 1 + d[t][t];\n\n            for (let r = 0; r < t - 1; r++) d[r][t] = 0;\n          } else {\n            for (let r = 0; r < e; r++) d[r][t] = 0;\n\n            d[t][t] = 1;\n          }\n        }\n\n        if (c) for (let t = n - 1; t >= 0; t--) {\n          if (t < S && 0 !== y[t]) for (let r = t + 1; r < n; r++) {\n            let e = 0;\n\n            for (let i = t + 1; i < n; i++) e += w[i][t] * w[i][r];\n\n            e = -e / w[t + 1][t];\n\n            for (let i = t + 1; i < n; i++) w[i][r] += e * w[i][t];\n          }\n\n          for (let r = 0; r < n; r++) w[r][t] = 0;\n\n          w[t][t] = 1;\n        }\n\n        for (var k = R - 1, z = Number.EPSILON; R > 0;) {\n          let t, r;\n\n          for (t = R - 2; t >= -1 && -1 !== t; t--) {\n            const r = Number.MIN_VALUE + z * Math.abs(v[t] + Math.abs(v[t + 1]));\n\n            if (Math.abs(y[t]) <= r || Number.isNaN(y[t])) {\n              y[t] = 0;\n              break;\n            }\n          }\n\n          if (t === R - 2) r = 4;else {\n            let e;\n\n            for (e = R - 1; e >= t && e !== t; e--) {\n              let r = (e !== R ? Math.abs(y[e]) : 0) + (e !== t + 1 ? Math.abs(y[e - 1]) : 0);\n\n              if (Math.abs(v[e]) <= z * r) {\n                v[e] = 0;\n                break;\n              }\n            }\n\n            e === t ? r = 3 : e === R - 1 ? r = 1 : (r = 2, t = e);\n          }\n\n          switch (t++, r) {\n            case 1:\n              {\n                let r = y[R - 2];\n                y[R - 2] = 0;\n\n                for (let e = R - 2; e >= t; e--) {\n                  let i = u(v[e], r),\n                      o = v[e] / i,\n                      s = r / i;\n                  if (v[e] = i, e !== t && (r = -s * y[e - 1], y[e - 1] = o * y[e - 1]), c) for (let t = 0; t < n; t++) i = o * w[t][e] + s * w[t][R - 1], w[t][R - 1] = -s * w[t][e] + o * w[t][R - 1], w[t][e] = i;\n                }\n\n                break;\n              }\n\n            case 2:\n              {\n                let r = y[t - 1];\n                y[t - 1] = 0;\n\n                for (let n = t; n < R; n++) {\n                  let i = u(v[n], r),\n                      o = v[n] / i,\n                      s = r / i;\n                  if (v[n] = i, r = -s * y[n], y[n] = o * y[n], h) for (let r = 0; r < e; r++) i = o * d[r][n] + s * d[r][t - 1], d[r][t - 1] = -s * d[r][n] + o * d[r][t - 1], d[r][n] = i;\n                }\n\n                break;\n              }\n\n            case 3:\n              {\n                const r = Math.max(Math.abs(v[R - 1]), Math.abs(v[R - 2]), Math.abs(y[R - 2]), Math.abs(v[t]), Math.abs(y[t])),\n                      i = v[R - 1] / r,\n                      o = v[R - 2] / r,\n                      s = y[R - 2] / r,\n                      a = v[t] / r,\n                      l = y[t] / r,\n                      f = ((o + i) * (o - i) + s * s) / 2,\n                      m = i * s * (i * s);\n                let g = 0;\n                0 === f && 0 === m || (g = m / (f + (g = f < 0 ? 0 - Math.sqrt(f * f + m) : Math.sqrt(f * f + m))));\n                let p = (a + i) * (a - i) + g,\n                    b = a * l;\n\n                for (let r = t; r < R - 1; r++) {\n                  let i = u(p, b);\n                  0 === i && (i = Number.MIN_VALUE);\n                  let o = p / i,\n                      s = b / i;\n                  if (r !== t && (y[r - 1] = i), p = o * v[r] + s * y[r], y[r] = o * y[r] - s * v[r], b = s * v[r + 1], v[r + 1] = o * v[r + 1], c) for (let t = 0; t < n; t++) i = o * w[t][r] + s * w[t][r + 1], w[t][r + 1] = -s * w[t][r] + o * w[t][r + 1], w[t][r] = i;\n                  if (0 === (i = u(p, b)) && (i = Number.MIN_VALUE), o = p / i, s = b / i, v[r] = i, p = o * y[r] + s * v[r + 1], v[r + 1] = -s * y[r] + o * v[r + 1], b = s * y[r + 1], y[r + 1] = o * y[r + 1], h && r < e - 1) for (let t = 0; t < e; t++) i = o * d[t][r] + s * d[t][r + 1], d[t][r + 1] = -s * d[t][r] + o * d[t][r + 1], d[t][r] = i;\n                }\n\n                y[R - 2] = p, 1;\n                break;\n              }\n\n            case 4:\n              if (v[t] <= 0 && (v[t] = v[t] < 0 ? -v[t] : 0, c)) for (let r = 0; r <= k; r++) w[r][t] = -w[r][t];\n\n              for (; t < k && !(v[t] >= v[t + 1]);) {\n                let r = v[t];\n                if (v[t] = v[t + 1], v[t + 1] = r, c && t < n - 1) for (let e = 0; e < n; e++) r = w[e][t + 1], w[e][t + 1] = w[e][t], w[e][t] = r;\n                if (h && t < e - 1) for (let n = 0; n < e; n++) r = d[n][t + 1], d[n][t + 1] = d[n][t], d[n][t] = r;\n                t++;\n              }\n\n              0, R--;\n          }\n        }\n\n        if (f) {\n          var N = w;\n          w = d, d = N;\n        }\n\n        this.m = e, this.n = n, this.s = v, this.U = d, this.V = w;\n      }\n\n      solve(t) {\n        var r = t,\n            e = this.threshold,\n            n = this.s.length,\n            i = _.zeros(n, n);\n\n        for (let t = 0; t < n; t++) Math.abs(this.s[t]) <= e ? i[t][t] = 0 : i[t][t] = 1 / this.s[t];\n\n        var o = this.U,\n            s = this.rightSingularVectors,\n            a = s.mmul(i),\n            h = s.rows,\n            u = o.length,\n            l = _.zeros(h, u);\n\n        for (let t = 0; t < h; t++) for (let r = 0; r < u; r++) {\n          let e = 0;\n\n          for (let i = 0; i < n; i++) e += a[t][i] * o[r][i];\n\n          l[t][r] = e;\n        }\n\n        return l.mmul(r);\n      }\n\n      solveForDiagonal(t) {\n        return this.solve(_.diag(t));\n      }\n\n      inverse() {\n        var t = this.V,\n            r = this.threshold,\n            e = t.length,\n            n = t[0].length,\n            i = new _(e, this.s.length);\n\n        for (let o = 0; o < e; o++) for (let e = 0; e < n; e++) Math.abs(this.s[e]) > r ? i[o][e] = t[o][e] / this.s[e] : i[o][e] = 0;\n\n        var o = this.U,\n            s = o.length,\n            a = o[0].length,\n            h = new _(e, s);\n\n        for (let t = 0; t < e; t++) for (let r = 0; r < s; r++) {\n          let e = 0;\n\n          for (let n = 0; n < a; n++) e += i[t][n] * o[r][n];\n\n          h[t][r] = e;\n        }\n\n        return h;\n      }\n\n      get condition() {\n        return this.s[0] / this.s[Math.min(this.m, this.n) - 1];\n      }\n\n      get norm2() {\n        return this.s[0];\n      }\n\n      get rank() {\n        for (var t = Math.max(this.m, this.n) * this.s[0] * Number.EPSILON, r = 0, e = this.s, n = 0, i = e.length; n < i; n++) e[n] > t && r++;\n\n        return r;\n      }\n\n      get diagonal() {\n        return this.s;\n      }\n\n      get threshold() {\n        return Number.EPSILON / 2 * Math.max(this.m, this.n) * this.s[0];\n      }\n\n      get leftSingularVectors() {\n        return _.isMatrix(this.U) || (this.U = new _(this.U)), this.U;\n      }\n\n      get rightSingularVectors() {\n        return _.isMatrix(this.V) || (this.V = new _(this.V)), this.V;\n      }\n\n      get diagonalMatrix() {\n        return _.diag(this.s);\n      }\n\n    }\n\n    function f(t, r, e) {\n      var n = e ? t.rows : t.rows - 1;\n      if (r < 0 || r > n) throw new RangeError("Row index out of range");\n    }\n\n    function m(t, r, e) {\n      var n = e ? t.columns : t.columns - 1;\n      if (r < 0 || r > n) throw new RangeError("Column index out of range");\n    }\n\n    function g(t, r) {\n      if (r.to1DArray && (r = r.to1DArray()), r.length !== t.columns) throw new RangeError("vector size must be the same as the number of columns");\n      return r;\n    }\n\n    function p(t, r) {\n      if (r.to1DArray && (r = r.to1DArray()), r.length !== t.rows) throw new RangeError("vector size must be the same as the number of rows");\n      return r;\n    }\n\n    function v(t, r, e) {\n      return {\n        row: d(t, r),\n        column: w(t, e)\n      };\n    }\n\n    function d(t, r) {\n      if ("object" != typeof r) throw new TypeError("unexpected type for row indices");\n      if (r.some(r => r < 0 || r >= t.rows)) throw new RangeError("row indices are out of range");\n      return Array.isArray(r) || (r = Array.from(r)), r;\n    }\n\n    function w(t, r) {\n      if ("object" != typeof r) throw new TypeError("unexpected type for column indices");\n      if (r.some(r => r < 0 || r >= t.columns)) throw new RangeError("column indices are out of range");\n      return Array.isArray(r) || (r = Array.from(r)), r;\n    }\n\n    function y(t, r, e, n, i) {\n      if (5 !== arguments.length) throw new RangeError("expected 4 arguments");\n      if (b("startRow", r), b("endRow", e), b("startColumn", n), b("endColumn", i), r > e || n > i || r < 0 || r >= t.rows || e < 0 || e >= t.rows || n < 0 || n >= t.columns || i < 0 || i >= t.columns) throw new RangeError("Submatrix indices are out of range");\n    }\n\n    function b(t, r) {\n      if ("number" != typeof r) throw new TypeError(`${t} must be a number`);\n    }\n\n    class M extends C() {\n      constructor(t, r, e) {\n        super(), this.matrix = t, this.rows = r, this.columns = e;\n      }\n\n      static get [Symbol.species]() {\n        return _;\n      }\n\n    }\n\n    class x extends M {\n      constructor(t) {\n        super(t, t.columns, t.rows);\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(r, t, e), this;\n      }\n\n      get(t, r) {\n        return this.matrix.get(r, t);\n      }\n\n    }\n\n    class S extends M {\n      constructor(t, r) {\n        super(t, 1, t.columns), this.row = r;\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(this.row, r, e), this;\n      }\n\n      get(t, r) {\n        return this.matrix.get(this.row, r);\n      }\n\n    }\n\n    class E extends M {\n      constructor(t, r, e, n, i) {\n        y(t, r, e, n, i), super(t, e - r + 1, i - n + 1), this.startRow = r, this.startColumn = n;\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(this.startRow + t, this.startColumn + r, e), this;\n      }\n\n      get(t, r) {\n        return this.matrix.get(this.startRow + t, this.startColumn + r);\n      }\n\n    }\n\n    class R extends M {\n      constructor(t, r, e) {\n        var n = v(t, r, e);\n        super(t, n.row.length, n.column.length), this.rowIndices = n.row, this.columnIndices = n.column;\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(this.rowIndices[t], this.columnIndices[r], e), this;\n      }\n\n      get(t, r) {\n        return this.matrix.get(this.rowIndices[t], this.columnIndices[r]);\n      }\n\n    }\n\n    class k extends M {\n      constructor(t, r) {\n        super(t, (r = d(t, r)).length, t.columns), this.rowIndices = r;\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(this.rowIndices[t], r, e), this;\n      }\n\n      get(t, r) {\n        return this.matrix.get(this.rowIndices[t], r);\n      }\n\n    }\n\n    class z extends M {\n      constructor(t, r) {\n        r = w(t, r), super(t, t.rows, r.length), this.columnIndices = r;\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(t, this.columnIndices[r], e), this;\n      }\n\n      get(t, r) {\n        return this.matrix.get(t, this.columnIndices[r]);\n      }\n\n    }\n\n    class N extends M {\n      constructor(t, r) {\n        super(t, t.rows, 1), this.column = r;\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(t, this.column, e), this;\n      }\n\n      get(t) {\n        return this.matrix.get(t, this.column);\n      }\n\n    }\n\n    class A extends M {\n      constructor(t) {\n        super(t, t.rows, t.columns);\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(this.rows - t - 1, r, e), this;\n      }\n\n      get(t, r) {\n        return this.matrix.get(this.rows - t - 1, r);\n      }\n\n    }\n\n    class V extends M {\n      constructor(t) {\n        super(t, t.rows, t.columns);\n      }\n\n      set(t, r, e) {\n        return this.matrix.set(t, this.columns - r - 1, e), this;\n      }\n\n      get(t, r) {\n        return this.matrix.get(t, this.columns - r - 1);\n      }\n\n    }\n\n    function C(t) {\n      void 0 === t && (t = Object);\n\n      class r extends t {\n        static get [Symbol.species]() {\n          return this;\n        }\n\n        static from1DArray(t, r, e) {\n          if (t * r !== e.length) throw new RangeError("Data length does not match given dimensions");\n\n          for (var n = new this(t, r), i = 0; i < t; i++) for (var o = 0; o < r; o++) n.set(i, o, e[i * r + o]);\n\n          return n;\n        }\n\n        static rowVector(t) {\n          for (var r = new this(1, t.length), e = 0; e < t.length; e++) r.set(0, e, t[e]);\n\n          return r;\n        }\n\n        static columnVector(t) {\n          for (var r = new this(t.length, 1), e = 0; e < t.length; e++) r.set(e, 0, t[e]);\n\n          return r;\n        }\n\n        static empty(t, r) {\n          return new this(t, r);\n        }\n\n        static zeros(t, r) {\n          return this.empty(t, r).fill(0);\n        }\n\n        static ones(t, r) {\n          return this.empty(t, r).fill(1);\n        }\n\n        static rand(t, r, e) {\n          void 0 === e && (e = Math.random);\n\n          for (var n = this.empty(t, r), i = 0; i < t; i++) for (var o = 0; o < r; o++) n.set(i, o, e());\n\n          return n;\n        }\n\n        static randInt(t, r, e, n) {\n          void 0 === e && (e = 1e3), void 0 === n && (n = Math.random);\n\n          for (var i = this.empty(t, r), o = 0; o < t; o++) for (var s = 0; s < r; s++) {\n            var a = Math.floor(n() * e);\n            i.set(o, s, a);\n          }\n\n          return i;\n        }\n\n        static eye(t, r, e) {\n          void 0 === r && (r = t), void 0 === e && (e = 1);\n\n          for (var n = Math.min(t, r), i = this.zeros(t, r), o = 0; o < n; o++) i.set(o, o, e);\n\n          return i;\n        }\n\n        static diag(t, r, e) {\n          var n = t.length;\n          void 0 === r && (r = n), void 0 === e && (e = r);\n\n          for (var i = Math.min(n, r, e), o = this.zeros(r, e), s = 0; s < i; s++) o.set(s, s, t[s]);\n\n          return o;\n        }\n\n        static min(t, r) {\n          t = this.checkMatrix(t), r = this.checkMatrix(r);\n\n          for (var e = t.rows, n = t.columns, i = new this(e, n), o = 0; o < e; o++) for (var s = 0; s < n; s++) i.set(o, s, Math.min(t.get(o, s), r.get(o, s)));\n\n          return i;\n        }\n\n        static max(t, r) {\n          t = this.checkMatrix(t), r = this.checkMatrix(r);\n\n          for (var e = t.rows, n = t.columns, i = new this(e, n), o = 0; o < e; o++) for (var s = 0; s < n; s++) i.set(o, s, Math.max(t.get(o, s), r.get(o, s)));\n\n          return i;\n        }\n\n        static checkMatrix(t) {\n          return r.isMatrix(t) ? t : new this(t);\n        }\n\n        static isMatrix(t) {\n          return null != t && "Matrix" === t.klass;\n        }\n\n        get size() {\n          return this.rows * this.columns;\n        }\n\n        apply(t) {\n          if ("function" != typeof t) throw new TypeError("callback must be a function");\n\n          for (var r = this.rows, e = this.columns, n = 0; n < r; n++) for (var i = 0; i < e; i++) t.call(this, n, i);\n\n          return this;\n        }\n\n        to1DArray() {\n          for (var t = new Array(this.size), r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) t[r * this.columns + e] = this.get(r, e);\n\n          return t;\n        }\n\n        to2DArray() {\n          for (var t = new Array(this.rows), r = 0; r < this.rows; r++) {\n            t[r] = new Array(this.columns);\n\n            for (var e = 0; e < this.columns; e++) t[r][e] = this.get(r, e);\n          }\n\n          return t;\n        }\n\n        isRowVector() {\n          return 1 === this.rows;\n        }\n\n        isColumnVector() {\n          return 1 === this.columns;\n        }\n\n        isVector() {\n          return 1 === this.rows || 1 === this.columns;\n        }\n\n        isSquare() {\n          return this.rows === this.columns;\n        }\n\n        isSymmetric() {\n          if (this.isSquare()) {\n            for (var t = 0; t < this.rows; t++) for (var r = 0; r <= t; r++) if (this.get(t, r) !== this.get(r, t)) return !1;\n\n            return !0;\n          }\n\n          return !1;\n        }\n\n        set(t, r, e) {\n          throw new Error("set method is unimplemented");\n        }\n\n        get(t, r) {\n          throw new Error("get method is unimplemented");\n        }\n\n        repeat(t, r) {\n          t = t || 1, r = r || 1;\n\n          for (var e = new this.constructor[Symbol.species](this.rows * t, this.columns * r), n = 0; n < t; n++) for (var i = 0; i < r; i++) e.setSubMatrix(this, this.rows * n, this.columns * i);\n\n          return e;\n        }\n\n        fill(t) {\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, t);\n\n          return this;\n        }\n\n        neg() {\n          return this.mulS(-1);\n        }\n\n        getRow(t) {\n          f(this, t);\n\n          for (var r = new Array(this.columns), e = 0; e < this.columns; e++) r[e] = this.get(t, e);\n\n          return r;\n        }\n\n        getRowVector(t) {\n          return this.constructor.rowVector(this.getRow(t));\n        }\n\n        setRow(t, r) {\n          f(this, t), r = g(this, r);\n\n          for (var e = 0; e < this.columns; e++) this.set(t, e, r[e]);\n\n          return this;\n        }\n\n        swapRows(t, r) {\n          f(this, t), f(this, r);\n\n          for (var e = 0; e < this.columns; e++) {\n            var n = this.get(t, e);\n            this.set(t, e, this.get(r, e)), this.set(r, e, n);\n          }\n\n          return this;\n        }\n\n        getColumn(t) {\n          m(this, t);\n\n          for (var r = new Array(this.rows), e = 0; e < this.rows; e++) r[e] = this.get(e, t);\n\n          return r;\n        }\n\n        getColumnVector(t) {\n          return this.constructor.columnVector(this.getColumn(t));\n        }\n\n        setColumn(t, r) {\n          m(this, t), r = p(this, r);\n\n          for (var e = 0; e < this.rows; e++) this.set(e, t, r[e]);\n\n          return this;\n        }\n\n        swapColumns(t, r) {\n          m(this, t), m(this, r);\n\n          for (var e = 0; e < this.rows; e++) {\n            var n = this.get(e, t);\n            this.set(e, t, this.get(e, r)), this.set(e, r, n);\n          }\n\n          return this;\n        }\n\n        addRowVector(t) {\n          t = g(this, t);\n\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, this.get(r, e) + t[e]);\n\n          return this;\n        }\n\n        subRowVector(t) {\n          t = g(this, t);\n\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, this.get(r, e) - t[e]);\n\n          return this;\n        }\n\n        mulRowVector(t) {\n          t = g(this, t);\n\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, this.get(r, e) * t[e]);\n\n          return this;\n        }\n\n        divRowVector(t) {\n          t = g(this, t);\n\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, this.get(r, e) / t[e]);\n\n          return this;\n        }\n\n        addColumnVector(t) {\n          t = p(this, t);\n\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, this.get(r, e) + t[r]);\n\n          return this;\n        }\n\n        subColumnVector(t) {\n          t = p(this, t);\n\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, this.get(r, e) - t[r]);\n\n          return this;\n        }\n\n        mulColumnVector(t) {\n          t = p(this, t);\n\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, this.get(r, e) * t[r]);\n\n          return this;\n        }\n\n        divColumnVector(t) {\n          t = p(this, t);\n\n          for (var r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.set(r, e, this.get(r, e) / t[r]);\n\n          return this;\n        }\n\n        mulRow(t, r) {\n          f(this, t);\n\n          for (var e = 0; e < this.columns; e++) this.set(t, e, this.get(t, e) * r);\n\n          return this;\n        }\n\n        mulColumn(t, r) {\n          m(this, t);\n\n          for (var e = 0; e < this.rows; e++) this.set(e, t, this.get(e, t) * r);\n\n          return this;\n        }\n\n        max() {\n          for (var t = this.get(0, 0), r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.get(r, e) > t && (t = this.get(r, e));\n\n          return t;\n        }\n\n        maxIndex() {\n          for (var t = this.get(0, 0), r = [0, 0], e = 0; e < this.rows; e++) for (var n = 0; n < this.columns; n++) this.get(e, n) > t && (t = this.get(e, n), r[0] = e, r[1] = n);\n\n          return r;\n        }\n\n        min() {\n          for (var t = this.get(0, 0), r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) this.get(r, e) < t && (t = this.get(r, e));\n\n          return t;\n        }\n\n        minIndex() {\n          for (var t = this.get(0, 0), r = [0, 0], e = 0; e < this.rows; e++) for (var n = 0; n < this.columns; n++) this.get(e, n) < t && (t = this.get(e, n), r[0] = e, r[1] = n);\n\n          return r;\n        }\n\n        maxRow(t) {\n          f(this, t);\n\n          for (var r = this.get(t, 0), e = 1; e < this.columns; e++) this.get(t, e) > r && (r = this.get(t, e));\n\n          return r;\n        }\n\n        maxRowIndex(t) {\n          f(this, t);\n\n          for (var r = this.get(t, 0), e = [t, 0], n = 1; n < this.columns; n++) this.get(t, n) > r && (r = this.get(t, n), e[1] = n);\n\n          return e;\n        }\n\n        minRow(t) {\n          f(this, t);\n\n          for (var r = this.get(t, 0), e = 1; e < this.columns; e++) this.get(t, e) < r && (r = this.get(t, e));\n\n          return r;\n        }\n\n        minRowIndex(t) {\n          f(this, t);\n\n          for (var r = this.get(t, 0), e = [t, 0], n = 1; n < this.columns; n++) this.get(t, n) < r && (r = this.get(t, n), e[1] = n);\n\n          return e;\n        }\n\n        maxColumn(t) {\n          m(this, t);\n\n          for (var r = this.get(0, t), e = 1; e < this.rows; e++) this.get(e, t) > r && (r = this.get(e, t));\n\n          return r;\n        }\n\n        maxColumnIndex(t) {\n          m(this, t);\n\n          for (var r = this.get(0, t), e = [0, t], n = 1; n < this.rows; n++) this.get(n, t) > r && (r = this.get(n, t), e[0] = n);\n\n          return e;\n        }\n\n        minColumn(t) {\n          m(this, t);\n\n          for (var r = this.get(0, t), e = 1; e < this.rows; e++) this.get(e, t) < r && (r = this.get(e, t));\n\n          return r;\n        }\n\n        minColumnIndex(t) {\n          m(this, t);\n\n          for (var r = this.get(0, t), e = [0, t], n = 1; n < this.rows; n++) this.get(n, t) < r && (r = this.get(n, t), e[0] = n);\n\n          return e;\n        }\n\n        diag() {\n          for (var t = Math.min(this.rows, this.columns), r = new Array(t), e = 0; e < t; e++) r[e] = this.get(e, e);\n\n          return r;\n        }\n\n        sum(t) {\n          switch (t) {\n            case "row":\n              return function (t) {\n                for (var r = _.zeros(t.rows, 1), e = 0; e < t.rows; ++e) for (var n = 0; n < t.columns; ++n) r.set(e, 0, r.get(e, 0) + t.get(e, n));\n\n                return r;\n              }(this);\n\n            case "column":\n              return function (t) {\n                for (var r = _.zeros(1, t.columns), e = 0; e < t.rows; ++e) for (var n = 0; n < t.columns; ++n) r.set(0, n, r.get(0, n) + t.get(e, n));\n\n                return r;\n              }(this);\n\n            default:\n              return function (t) {\n                for (var r = 0, e = 0; e < t.rows; e++) for (var n = 0; n < t.columns; n++) r += t.get(e, n);\n\n                return r;\n              }(this);\n          }\n        }\n\n        mean() {\n          return this.sum() / this.size;\n        }\n\n        prod() {\n          for (var t = 1, r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) t *= this.get(r, e);\n\n          return t;\n        }\n\n        norm(t = "frobenius") {\n          var r = 0;\n          if ("max" === t) return this.max();\n\n          if ("frobenius" === t) {\n            for (var e = 0; e < this.rows; e++) for (var n = 0; n < this.columns; n++) r += this.get(e, n) * this.get(e, n);\n\n            return Math.sqrt(r);\n          }\n\n          throw new RangeError(`unknown norm type: ${t}`);\n        }\n\n        cumulativeSum() {\n          for (var t = 0, r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) t += this.get(r, e), this.set(r, e, t);\n\n          return this;\n        }\n\n        dot(t) {\n          r.isMatrix(t) && (t = t.to1DArray());\n          var e = this.to1DArray();\n          if (e.length !== t.length) throw new RangeError("vectors do not have the same size");\n\n          for (var n = 0, i = 0; i < e.length; i++) n += e[i] * t[i];\n\n          return n;\n        }\n\n        mmul(t) {\n          t = this.constructor.checkMatrix(t), this.columns !== t.rows && console.warn("Number of columns of left matrix are not equal to number of rows of right matrix.");\n\n          for (var r = this.rows, e = this.columns, n = t.columns, i = new this.constructor[Symbol.species](r, n), o = new Array(e), s = 0; s < n; s++) {\n            for (var a = 0; a < e; a++) o[a] = t.get(a, s);\n\n            for (var h = 0; h < r; h++) {\n              var u = 0;\n\n              for (a = 0; a < e; a++) u += this.get(h, a) * o[a];\n\n              i.set(h, s, u);\n            }\n          }\n\n          return i;\n        }\n\n        strassen2x2(t) {\n          var r = new this.constructor[Symbol.species](2, 2);\n          const e = this.get(0, 0),\n                n = t.get(0, 0),\n                i = this.get(0, 1),\n                o = t.get(0, 1),\n                s = this.get(1, 0),\n                a = t.get(1, 0),\n                h = this.get(1, 1),\n                u = t.get(1, 1),\n                l = (e + h) * (n + u),\n                c = (s + h) * n,\n                f = e * (o - u),\n                m = h * (a - n),\n                g = (e + i) * u,\n                p = l + m - g + (i - h) * (a + u),\n                v = f + g,\n                d = c + m,\n                w = l - c + f + (s - e) * (n + o);\n          return r.set(0, 0, p), r.set(0, 1, v), r.set(1, 0, d), r.set(1, 1, w), r;\n        }\n\n        strassen3x3(t) {\n          var r = new this.constructor[Symbol.species](3, 3);\n\n          const e = this.get(0, 0),\n                n = this.get(0, 1),\n                i = this.get(0, 2),\n                o = this.get(1, 0),\n                s = this.get(1, 1),\n                a = this.get(1, 2),\n                h = this.get(2, 0),\n                u = this.get(2, 1),\n                l = this.get(2, 2),\n                c = t.get(0, 0),\n                f = t.get(0, 1),\n                m = t.get(0, 2),\n                g = t.get(1, 0),\n                p = t.get(1, 1),\n                v = t.get(1, 2),\n                d = t.get(2, 0),\n                w = t.get(2, 1),\n                y = t.get(2, 2),\n                b = (e - o) * (-f + p),\n                M = (-e + o + s) * (c - f + p),\n                x = (o + s) * (-c + f),\n                S = e * c,\n                E = (-e + h + u) * (c - m + v),\n                R = (-e + h) * (m - v),\n                k = (h + u) * (-c + m),\n                z = (-i + u + l) * (p + d - w),\n                N = (i - l) * (p - w),\n                A = i * d,\n                V = (u + l) * (-d + w),\n                C = (-i + s + a) * (v + d - y),\n                _ = (i - a) * (v - y),\n                P = (s + a) * (-d + y),\n                j = S + A + n * g,\n                I = (e + n + i - o - s - u - l) * p + M + x + S + z + A + V,\n                O = S + E + k + (e + n + i - s - a - h - u) * v + A + C + P,\n                D = b + s * (-c + f + g - p - v - d + y) + M + S + A + C + _,\n                L = b + M + x + S + a * w,\n                T = A + C + _ + P + o * m,\n                F = S + E + R + u * (-c + m + g - p - v - d + w) + z + N + A,\n                q = z + N + A + V + h * f,\n                U = S + E + R + k + l * y;\n\n          return r.set(0, 0, j), r.set(0, 1, I), r.set(0, 2, O), r.set(1, 0, D), r.set(1, 1, L), r.set(1, 2, T), r.set(2, 0, F), r.set(2, 1, q), r.set(2, 2, U), r;\n        }\n\n        mmulStrassen(t) {\n          var e = this.clone(),\n              n = e.rows,\n              i = e.columns,\n              o = t.rows,\n              s = t.columns;\n\n          function a(t, e, n) {\n            var i = t.rows,\n                o = t.columns;\n            if (i === e && o === n) return t;\n            var s = r.zeros(e, n);\n            return s = s.setSubMatrix(t, 0, 0);\n          }\n\n          i !== o && console.warn(`Multiplying ${n} x ${i} and ${o} x ${s} matrix: dimensions do not match.`);\n          var h = Math.max(n, o),\n              u = Math.max(i, s);\n          return function t(e, n, i, o) {\n            if (i <= 512 || o <= 512) return e.mmul(n);\n            i % 2 == 1 && o % 2 == 1 ? (e = a(e, i + 1, o + 1), n = a(n, i + 1, o + 1)) : i % 2 == 1 ? (e = a(e, i + 1, o), n = a(n, i + 1, o)) : o % 2 == 1 && (e = a(e, i, o + 1), n = a(n, i, o + 1));\n            var s = parseInt(e.rows / 2, 10),\n                h = parseInt(e.columns / 2, 10),\n                u = e.subMatrix(0, s - 1, 0, h - 1),\n                l = n.subMatrix(0, s - 1, 0, h - 1),\n                c = e.subMatrix(0, s - 1, h, e.columns - 1),\n                f = n.subMatrix(0, s - 1, h, n.columns - 1),\n                m = e.subMatrix(s, e.rows - 1, 0, h - 1),\n                g = n.subMatrix(s, n.rows - 1, 0, h - 1),\n                p = e.subMatrix(s, e.rows - 1, h, e.columns - 1),\n                v = n.subMatrix(s, n.rows - 1, h, n.columns - 1),\n                d = t(r.add(u, p), r.add(l, v), s, h),\n                w = t(r.add(m, p), l, s, h),\n                y = t(u, r.sub(f, v), s, h),\n                b = t(p, r.sub(g, l), s, h),\n                M = t(r.add(u, c), v, s, h),\n                x = t(r.sub(m, u), r.add(l, f), s, h),\n                S = t(r.sub(c, p), r.add(g, v), s, h),\n                E = r.add(d, b);\n            E.sub(M), E.add(S);\n            var R = r.add(y, M),\n                k = r.add(w, b),\n                z = r.sub(d, w);\n            z.add(y), z.add(x);\n            var N = r.zeros(2 * E.rows, 2 * E.columns);\n            return (N = (N = (N = (N = N.setSubMatrix(E, 0, 0)).setSubMatrix(R, E.rows, 0)).setSubMatrix(k, 0, E.columns)).setSubMatrix(z, E.rows, E.columns)).subMatrix(0, i - 1, 0, o - 1);\n          }(e = a(e, h, u), t = a(t, h, u), h, u);\n        }\n\n        scaleRows(t, r) {\n          if ((t = void 0 === t ? 0 : t) >= (r = void 0 === r ? 1 : r)) throw new RangeError("min should be strictly smaller than max");\n\n          for (var e = this.constructor.empty(this.rows, this.columns), n = 0; n < this.rows; n++) {\n            var i = a(this.getRow(n), {\n              min: t,\n              max: r\n            });\n            e.setRow(n, i);\n          }\n\n          return e;\n        }\n\n        scaleColumns(t, r) {\n          if ((t = void 0 === t ? 0 : t) >= (r = void 0 === r ? 1 : r)) throw new RangeError("min should be strictly smaller than max");\n\n          for (var e = this.constructor.empty(this.rows, this.columns), n = 0; n < this.columns; n++) {\n            var i = a(this.getColumn(n), {\n              min: t,\n              max: r\n            });\n            e.setColumn(n, i);\n          }\n\n          return e;\n        }\n\n        kroneckerProduct(t) {\n          t = this.constructor.checkMatrix(t);\n\n          for (var r = this.rows, e = this.columns, n = t.rows, i = t.columns, o = new this.constructor[Symbol.species](r * n, e * i), s = 0; s < r; s++) for (var a = 0; a < e; a++) for (var h = 0; h < n; h++) for (var u = 0; u < i; u++) o[n * s + h][i * a + u] = this.get(s, a) * t.get(h, u);\n\n          return o;\n        }\n\n        transpose() {\n          for (var t = new this.constructor[Symbol.species](this.columns, this.rows), r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) t.set(e, r, this.get(r, e));\n\n          return t;\n        }\n\n        sortRows(t) {\n          void 0 === t && (t = e);\n\n          for (var r = 0; r < this.rows; r++) this.setRow(r, this.getRow(r).sort(t));\n\n          return this;\n        }\n\n        sortColumns(t) {\n          void 0 === t && (t = e);\n\n          for (var r = 0; r < this.columns; r++) this.setColumn(r, this.getColumn(r).sort(t));\n\n          return this;\n        }\n\n        subMatrix(t, r, e, n) {\n          y(this, t, r, e, n);\n\n          for (var i = new this.constructor[Symbol.species](r - t + 1, n - e + 1), o = t; o <= r; o++) for (var s = e; s <= n; s++) i[o - t][s - e] = this.get(o, s);\n\n          return i;\n        }\n\n        subMatrixRow(t, r, e) {\n          if (void 0 === r && (r = 0), void 0 === e && (e = this.columns - 1), r > e || r < 0 || r >= this.columns || e < 0 || e >= this.columns) throw new RangeError("Argument out of range");\n\n          for (var n = new this.constructor[Symbol.species](t.length, e - r + 1), i = 0; i < t.length; i++) for (var o = r; o <= e; o++) {\n            if (t[i] < 0 || t[i] >= this.rows) throw new RangeError(`Row index out of range: ${t[i]}`);\n            n.set(i, o - r, this.get(t[i], o));\n          }\n\n          return n;\n        }\n\n        subMatrixColumn(t, r, e) {\n          if (void 0 === r && (r = 0), void 0 === e && (e = this.rows - 1), r > e || r < 0 || r >= this.rows || e < 0 || e >= this.rows) throw new RangeError("Argument out of range");\n\n          for (var n = new this.constructor[Symbol.species](e - r + 1, t.length), i = 0; i < t.length; i++) for (var o = r; o <= e; o++) {\n            if (t[i] < 0 || t[i] >= this.columns) throw new RangeError(`Column index out of range: ${t[i]}`);\n            n.set(o - r, i, this.get(o, t[i]));\n          }\n\n          return n;\n        }\n\n        setSubMatrix(t, r, e) {\n          y(this, r, r + (t = this.constructor.checkMatrix(t)).rows - 1, e, e + t.columns - 1);\n\n          for (var n = 0; n < t.rows; n++) for (var i = 0; i < t.columns; i++) this[r + n][e + i] = t.get(n, i);\n\n          return this;\n        }\n\n        selection(t, r) {\n          for (var e = v(this, t, r), n = new this.constructor[Symbol.species](t.length, r.length), i = 0; i < e.row.length; i++) for (var o = e.row[i], s = 0; s < e.column.length; s++) {\n            var a = e.column[s];\n            n[i][s] = this.get(o, a);\n          }\n\n          return n;\n        }\n\n        trace() {\n          for (var t = Math.min(this.rows, this.columns), r = 0, e = 0; e < t; e++) r += this.get(e, e);\n\n          return r;\n        }\n\n        transposeView() {\n          return new x(this);\n        }\n\n        rowView(t) {\n          return f(this, t), new S(this, t);\n        }\n\n        columnView(t) {\n          return m(this, t), new N(this, t);\n        }\n\n        flipRowView() {\n          return new A(this);\n        }\n\n        flipColumnView() {\n          return new V(this);\n        }\n\n        subMatrixView(t, r, e, n) {\n          return new E(this, t, r, e, n);\n        }\n\n        selectionView(t, r) {\n          return new R(this, t, r);\n        }\n\n        rowSelectionView(t) {\n          return new k(this, t);\n        }\n\n        columnSelectionView(t) {\n          return new z(this, t);\n        }\n\n        det() {\n          var t, r, e, n, i, o;\n          if (this.isSquare()) return 2 === this.columns ? (t = this.get(0, 0), r = this.get(0, 1), e = this.get(1, 0), t * this.get(1, 1) - r * e) : 3 === this.columns ? (n = this.selectionView([1, 2], [1, 2]), i = this.selectionView([1, 2], [0, 2]), o = this.selectionView([1, 2], [0, 1]), t = this.get(0, 0), r = this.get(0, 1), e = this.get(0, 2), t * n.det() - r * i.det() + e * o.det()) : new h(this).determinant;\n          throw Error("Determinant can only be calculated for a square matrix.");\n        }\n\n        pseudoInverse(t) {\n          void 0 === t && (t = Number.EPSILON);\n\n          for (var r = new c(this, {\n            autoTranspose: !0\n          }), e = r.leftSingularVectors, n = r.rightSingularVectors, i = r.diagonal, o = 0; o < i.length; o++) Math.abs(i[o]) > t ? i[o] = 1 / i[o] : i[o] = 0;\n\n          return i = this.constructor[Symbol.species].diag(i), n.mmul(i.mmul(e.transposeView()));\n        }\n\n        clone() {\n          for (var t = new this.constructor[Symbol.species](this.rows, this.columns), r = 0; r < this.rows; r++) for (var e = 0; e < this.columns; e++) t.set(r, e, this.get(r, e));\n\n          return t;\n        }\n\n      }\n\n      function e(t, r) {\n        return t - r;\n      }\n\n      r.prototype.klass = "Matrix", r.random = r.rand, r.diagonal = r.diag, r.prototype.diagonal = r.prototype.diag, r.identity = r.eye, r.prototype.negate = r.prototype.neg, r.prototype.tensorProduct = r.prototype.kroneckerProduct, r.prototype.determinant = r.prototype.det;\n      var n,\n          i = "\\n(function %name%(matrix, %args%) {\\n    var newMatrix = new this[Symbol.species](matrix);\\n    return newMatrix.%name%(%args%);\\n})\\n",\n          o = eval;\n\n      for (var s of [["+", "add"], ["-", "sub", "subtract"], ["*", "mul", "multiply"], ["/", "div", "divide"], ["%", "mod", "modulus"], ["&", "and"], ["|", "or"], ["^", "xor"], ["<<", "leftShift"], [">>", "signPropagatingRightShift"], [">>>", "rightShift", "zeroFillRightShift"]]) {\n        var u = o($("\\n(function %name%(value) {\\n    if (typeof value === \'number\') return this.%name%S(value);\\n    return this.%name%M(value);\\n})\\n", {\n          name: s[1],\n          op: s[0]\n        })),\n            l = o($("\\n(function %name%S(value) {\\n    for (var i = 0; i < this.rows; i++) {\\n        for (var j = 0; j < this.columns; j++) {\\n            this.set(i, j, this.get(i, j) %op% value);\\n        }\\n    }\\n    return this;\\n})\\n", {\n          name: `${s[1]}S`,\n          op: s[0]\n        })),\n            d = o($("\\n(function %name%M(matrix) {\\n    matrix = this.constructor.checkMatrix(matrix);\\n    if (this.rows !== matrix.rows ||\\n        this.columns !== matrix.columns) {\\n        throw new RangeError(\'Matrices dimensions must be equal\');\\n    }\\n    for (var i = 0; i < this.rows; i++) {\\n        for (var j = 0; j < this.columns; j++) {\\n            this.set(i, j, this.get(i, j) %op% matrix.get(i, j));\\n        }\\n    }\\n    return this;\\n})\\n", {\n          name: `${s[1]}M`,\n          op: s[0]\n        })),\n            w = o($("\\n(function %name%(matrix, value) {\\n    var newMatrix = new this[Symbol.species](matrix);\\n    return newMatrix.%name%(value);\\n})\\n", {\n          name: s[1]\n        }));\n\n        for (n = 1; n < s.length; n++) r.prototype[s[n]] = u, r.prototype[`${s[n]}S`] = l, r.prototype[`${s[n]}M`] = d, r[s[n]] = w;\n      }\n\n      var b = [["~", "not"]];\n\n      for (var M of (["abs", "acos", "acosh", "asin", "asinh", "atan", "atanh", "cbrt", "ceil", "clz32", "cos", "cosh", "exp", "expm1", "floor", "fround", "log", "log1p", "log10", "log2", "round", "sign", "sin", "sinh", "sqrt", "tan", "tanh", "trunc"].forEach(function (t) {\n        b.push([`Math.${t}`, t]);\n      }), b)) {\n        var C = o($("\\n(function %name%() {\\n    for (var i = 0; i < this.rows; i++) {\\n        for (var j = 0; j < this.columns; j++) {\\n            this.set(i, j, %method%(this.get(i, j)));\\n        }\\n    }\\n    return this;\\n})\\n", {\n          name: M[1],\n          method: M[0]\n        })),\n            P = o($("\\n(function %name%(matrix) {\\n    var newMatrix = new this[Symbol.species](matrix);\\n    return newMatrix.%name%();\\n})\\n", {\n          name: M[1]\n        }));\n\n        for (n = 1; n < M.length; n++) r.prototype[M[n]] = C, r[M[n]] = P;\n      }\n\n      for (var j of [["Math.pow", 1, "pow"]]) {\n        var I = "arg0";\n\n        for (n = 1; n < j[1]; n++) I += `, arg${n}`;\n\n        if (1 !== j[1]) {\n          var O = o($("\\n(function %name%(%args%) {\\n    for (var i = 0; i < this.rows; i++) {\\n        for (var j = 0; j < this.columns; j++) {\\n            this.set(i, j, %method%(this.get(i, j), %args%));\\n        }\\n    }\\n    return this;\\n})\\n", {\n            name: j[2],\n            method: j[0],\n            args: I\n          })),\n              D = o($(i, {\n            name: j[2],\n            args: I\n          }));\n\n          for (n = 2; n < j.length; n++) r.prototype[j[n]] = O, r[j[n]] = D;\n        } else {\n          var L = {\n            name: j[2],\n            args: I,\n            method: j[0]\n          },\n              T = o($("\\n(function %name%(value) {\\n    if (typeof value === \'number\') return this.%name%S(value);\\n    return this.%name%M(value);\\n})\\n", L)),\n              F = o($("\\n(function %name%S(value) {\\n    for (var i = 0; i < this.rows; i++) {\\n        for (var j = 0; j < this.columns; j++) {\\n            this.set(i, j, %method%(this.get(i, j), value));\\n        }\\n    }\\n    return this;\\n})\\n", L)),\n              q = o($("\\n(function %name%M(matrix) {\\n    matrix = this.constructor.checkMatrix(matrix);\\n    if (this.rows !== matrix.rows ||\\n        this.columns !== matrix.columns) {\\n        throw new RangeError(\'Matrices dimensions must be equal\');\\n    }\\n    for (var i = 0; i < this.rows; i++) {\\n        for (var j = 0; j < this.columns; j++) {\\n            this.set(i, j, %method%(this.get(i, j), matrix.get(i, j)));\\n        }\\n    }\\n    return this;\\n})\\n", L)),\n              U = o($("\\n(function %name%(matrix, %args%) {\\n    var newMatrix = new this[Symbol.species](matrix);\\n    return newMatrix.%name%(%args%);\\n})\\n", L));\n\n          for (n = 2; n < j.length; n++) r.prototype[j[n]] = T, r.prototype[`${j[n]}M`] = q, r.prototype[`${j[n]}S`] = F, r[j[n]] = U;\n        }\n      }\n\n      function $(t, r) {\n        for (var e in r) t = t.replace(new RegExp(`%${e}%`, "g"), r[e]);\n\n        return t;\n      }\n\n      return r;\n    }\n\n    class _ extends C(Array) {\n      constructor(t, r) {\n        var e;\n        if (1 === arguments.length && "number" == typeof t) return new Array(t);\n        if (_.isMatrix(t)) return t.clone();\n\n        if (Number.isInteger(t) && t > 0) {\n          if (super(t), !(Number.isInteger(r) && r > 0)) throw new TypeError("nColumns must be a positive integer");\n\n          for (e = 0; e < t; e++) this[e] = new Array(r);\n        } else {\n          if (!Array.isArray(t)) throw new TypeError("First argument must be a positive number or an array");\n          {\n            const n = t;\n            if (t = n.length, "number" != typeof (r = n[0].length) || 0 === r) throw new TypeError("Data must be a 2D array with at least one element");\n\n            for (super(t), e = 0; e < t; e++) {\n              if (n[e].length !== r) throw new RangeError("Inconsistent array dimensions");\n              this[e] = [].concat(n[e]);\n            }\n          }\n        }\n\n        return this.rows = t, this.columns = r, this;\n      }\n\n      set(t, r, e) {\n        return this[t][r] = e, this;\n      }\n\n      get(t, r) {\n        return this[t][r];\n      }\n\n      removeRow(t) {\n        if (f(this, t), 1 === this.rows) throw new RangeError("A matrix cannot have less than one row");\n        return this.splice(t, 1), this.rows -= 1, this;\n      }\n\n      addRow(t, r) {\n        return void 0 === r && (r = t, t = this.rows), f(this, t, !0), r = g(this, r), this.splice(t, 0, r), this.rows += 1, this;\n      }\n\n      removeColumn(t) {\n        if (m(this, t), 1 === this.columns) throw new RangeError("A matrix cannot have less than one column");\n\n        for (var r = 0; r < this.rows; r++) this[r].splice(t, 1);\n\n        return this.columns -= 1, this;\n      }\n\n      addColumn(t, r) {\n        void 0 === r && (r = t, t = this.columns), m(this, t, !0), r = p(this, r);\n\n        for (var e = 0; e < this.rows; e++) this[e].splice(t, 0, r[e]);\n\n        return this.columns += 1, this;\n      }\n\n    }\n\n    class P extends C() {\n      constructor(t, r = {}) {\n        const {\n          rows: e = 1\n        } = r;\n        if (t.length % e != 0) throw new Error("the data length is not divisible by the number of rows");\n        super(), this.rows = e, this.columns = t.length / e, this.data = t;\n      }\n\n      set(t, r, e) {\n        var n = this._calculateIndex(t, r);\n\n        return this.data[n] = e, this;\n      }\n\n      get(t, r) {\n        var e = this._calculateIndex(t, r);\n\n        return this.data[e];\n      }\n\n      _calculateIndex(t, r) {\n        return t * this.columns + r;\n      }\n\n      static get [Symbol.species]() {\n        return _;\n      }\n\n    }\n\n    class j extends C() {\n      constructor(t) {\n        super(), this.data = t, this.rows = t.length, this.columns = t[0].length;\n      }\n\n      set(t, r, e) {\n        return this.data[t][r] = e, this;\n      }\n\n      get(t, r) {\n        return this.data[t][r];\n      }\n\n      static get [Symbol.species]() {\n        return _;\n      }\n\n    }\n\n    function I(t, r) {\n      if (Array.isArray(t)) return t[0] && Array.isArray(t[0]) ? new j(t) : new P(t, r);\n      throw new Error("the argument is not an array");\n    }\n\n    class O {\n      constructor(t) {\n        var r,\n            e,\n            n,\n            i,\n            o = (t = j.checkMatrix(t)).clone(),\n            s = t.rows,\n            a = t.columns,\n            h = new Array(a);\n\n        for (n = 0; n < a; n++) {\n          var l = 0;\n\n          for (r = n; r < s; r++) l = u(l, o.get(r, n));\n\n          if (0 !== l) {\n            for (o.get(n, n) < 0 && (l = -l), r = n; r < s; r++) o.set(r, n, o.get(r, n) / l);\n\n            for (o.set(n, n, o.get(n, n) + 1), e = n + 1; e < a; e++) {\n              for (i = 0, r = n; r < s; r++) i += o.get(r, n) * o.get(r, e);\n\n              for (i = -i / o.get(n, n), r = n; r < s; r++) o.set(r, e, o.get(r, e) + i * o.get(r, n));\n            }\n          }\n\n          h[n] = -l;\n        }\n\n        this.QR = o, this.Rdiag = h;\n      }\n\n      solve(t) {\n        t = _.checkMatrix(t);\n        var r = this.QR,\n            e = r.rows;\n        if (t.rows !== e) throw new Error("Matrix row dimensions must agree");\n        if (!this.isFullRank()) throw new Error("Matrix is rank deficient");\n        var n,\n            i,\n            o,\n            s,\n            a = t.columns,\n            h = t.clone(),\n            u = r.columns;\n\n        for (o = 0; o < u; o++) for (i = 0; i < a; i++) {\n          for (s = 0, n = o; n < e; n++) s += r[n][o] * h[n][i];\n\n          for (s = -s / r[o][o], n = o; n < e; n++) h[n][i] += s * r[n][o];\n        }\n\n        for (o = u - 1; o >= 0; o--) {\n          for (i = 0; i < a; i++) h[o][i] /= this.Rdiag[o];\n\n          for (n = 0; n < o; n++) for (i = 0; i < a; i++) h[n][i] -= h[o][i] * r[n][o];\n        }\n\n        return h.subMatrix(0, u - 1, 0, a - 1);\n      }\n\n      isFullRank() {\n        for (var t = this.QR.columns, r = 0; r < t; r++) if (0 === this.Rdiag[r]) return !1;\n\n        return !0;\n      }\n\n      get upperTriangularMatrix() {\n        var t,\n            r,\n            e = this.QR,\n            n = e.columns,\n            i = new _(n, n);\n\n        for (t = 0; t < n; t++) for (r = 0; r < n; r++) i[t][r] = t < r ? e[t][r] : t === r ? this.Rdiag[t] : 0;\n\n        return i;\n      }\n\n      get orthogonalMatrix() {\n        var t,\n            r,\n            e,\n            n,\n            i = this.QR,\n            o = i.rows,\n            s = i.columns,\n            a = new _(o, s);\n\n        for (e = s - 1; e >= 0; e--) {\n          for (t = 0; t < o; t++) a[t][e] = 0;\n\n          for (a[e][e] = 1, r = e; r < s; r++) if (0 !== i[e][e]) {\n            for (n = 0, t = e; t < o; t++) n += i[t][e] * a[t][r];\n\n            for (n = -n / i[e][e], t = e; t < o; t++) a[t][r] += n * i[t][e];\n          }\n        }\n\n        return a;\n      }\n\n    }\n\n    function D(t, r = !1) {\n      return t = j.checkMatrix(t), r ? new c(t).inverse() : L(t, _.eye(t.rows));\n    }\n\n    function L(t, r, e = !1) {\n      return t = j.checkMatrix(t), r = j.checkMatrix(r), e ? new c(t).solve(r) : t.isSquare() ? new h(t).solve(r) : new O(t).solve(r);\n    }\n\n    function T(t, r) {\n      for (var e = [], n = 0; n < t; n++) n !== r && e.push(n);\n\n      return e;\n    }\n\n    function F(t, r, e, n = 1e-9, i = 1e-9) {\n      if (t > i) return new Array(r.rows + 1).fill(0);\n\n      for (var o = r.addRow(e, [0]), s = 0; s < o.rows; s++) Math.abs(o.get(s, 0)) < n && o.set(s, 0, 0);\n\n      return o.to1DArray();\n    }\n\n    function q(t, r = {}) {\n      const {\n        thresholdValue: e = 1e-9,\n        thresholdError: n = 1e-9\n      } = r;\n\n      for (var i = t.rows, s = new _(i, i), a = 0; a < i; a++) {\n        var h = _.columnVector(t.getRow(a)),\n            u = t.subMatrixRow(T(i, a)).transposeView(),\n            l = new c(u).solve(h),\n            f = o(_.sub(h, u.mmul(l)).abs().to1DArray());\n\n        s.setRow(a, F(f, l, a, e, n));\n      }\n\n      return s;\n    }\n\n    class U {\n      constructor(t, r = {}) {\n        const {\n          assumeSymmetric: e = !1\n        } = r;\n        if (!(t = j.checkMatrix(t)).isSquare()) throw new Error("Matrix is not a square matrix");\n        var n,\n            i,\n            o = t.columns,\n            s = l(o, o, 0),\n            a = new Array(o),\n            h = new Array(o),\n            c = t;\n\n        if (!!e || t.isSymmetric()) {\n          for (n = 0; n < o; n++) for (i = 0; i < o; i++) s[n][i] = c.get(n, i);\n\n          !function (t, r, e, n) {\n            var i, o, s, a, h, u, l, c;\n\n            for (h = 0; h < t; h++) e[h] = n[t - 1][h];\n\n            for (a = t - 1; a > 0; a--) {\n              for (c = 0, s = 0, u = 0; u < a; u++) c += Math.abs(e[u]);\n\n              if (0 === c) for (r[a] = e[a - 1], h = 0; h < a; h++) e[h] = n[a - 1][h], n[a][h] = 0, n[h][a] = 0;else {\n                for (u = 0; u < a; u++) e[u] /= c, s += e[u] * e[u];\n\n                for (i = e[a - 1], o = Math.sqrt(s), i > 0 && (o = -o), r[a] = c * o, s -= i * o, e[a - 1] = i - o, h = 0; h < a; h++) r[h] = 0;\n\n                for (h = 0; h < a; h++) {\n                  for (i = e[h], n[h][a] = i, o = r[h] + n[h][h] * i, u = h + 1; u <= a - 1; u++) o += n[u][h] * e[u], r[u] += n[u][h] * i;\n\n                  r[h] = o;\n                }\n\n                for (i = 0, h = 0; h < a; h++) r[h] /= s, i += r[h] * e[h];\n\n                for (l = i / (s + s), h = 0; h < a; h++) r[h] -= l * e[h];\n\n                for (h = 0; h < a; h++) {\n                  for (i = e[h], o = r[h], u = h; u <= a - 1; u++) n[u][h] -= i * r[u] + o * e[u];\n\n                  e[h] = n[a - 1][h], n[a][h] = 0;\n                }\n              }\n              e[a] = s;\n            }\n\n            for (a = 0; a < t - 1; a++) {\n              if (n[t - 1][a] = n[a][a], n[a][a] = 1, 0 !== (s = e[a + 1])) {\n                for (u = 0; u <= a; u++) e[u] = n[u][a + 1] / s;\n\n                for (h = 0; h <= a; h++) {\n                  for (o = 0, u = 0; u <= a; u++) o += n[u][a + 1] * n[u][h];\n\n                  for (u = 0; u <= a; u++) n[u][h] -= o * e[u];\n                }\n              }\n\n              for (u = 0; u <= a; u++) n[u][a + 1] = 0;\n            }\n\n            for (h = 0; h < t; h++) e[h] = n[t - 1][h], n[t - 1][h] = 0;\n\n            n[t - 1][t - 1] = 1, r[0] = 0;\n          }(o, h, a, s), function (t, r, e, n) {\n            var i, o, s, a, h, l, c, f, m, g, p, v, d, w, y, b;\n\n            for (s = 1; s < t; s++) r[s - 1] = r[s];\n\n            r[t - 1] = 0;\n            var M = 0,\n                x = 0,\n                S = Number.EPSILON;\n\n            for (l = 0; l < t; l++) {\n              for (x = Math.max(x, Math.abs(e[l]) + Math.abs(r[l])), c = l; c < t && !(Math.abs(r[c]) <= S * x);) c++;\n\n              if (c > l) {\n                0;\n\n                do {\n                  for (1, i = e[l], f = (e[l + 1] - i) / (2 * r[l]), m = u(f, 1), f < 0 && (m = -m), e[l] = r[l] / (f + m), e[l + 1] = r[l] * (f + m), g = e[l + 1], o = i - e[l], s = l + 2; s < t; s++) e[s] -= o;\n\n                  for (M += o, f = e[c], v = p = 1, d = p, w = r[l + 1], y = 0, b = 0, s = c - 1; s >= l; s--) for (d = v, v = p, b = y, i = p * r[s], o = p * f, m = u(f, r[s]), r[s + 1] = y * m, y = r[s] / m, f = (p = f / m) * e[s] - y * i, e[s + 1] = o + y * (p * i + y * e[s]), h = 0; h < t; h++) o = n[h][s + 1], n[h][s + 1] = y * n[h][s] + p * o, n[h][s] = p * n[h][s] - y * o;\n\n                  f = -y * b * d * w * r[l] / g, r[l] = y * f, e[l] = p * f;\n                } while (Math.abs(r[l]) > S * x);\n              }\n\n              e[l] = e[l] + M, r[l] = 0;\n            }\n\n            for (s = 0; s < t - 1; s++) {\n              for (h = s, f = e[s], a = s + 1; a < t; a++) e[a] < f && (h = a, f = e[a]);\n\n              if (h !== s) for (e[h] = e[s], e[s] = f, a = 0; a < t; a++) f = n[a][s], n[a][s] = n[a][h], n[a][h] = f;\n            }\n          }(o, h, a, s);\n        } else {\n          var f = l(o, o, 0),\n              m = new Array(o);\n\n          for (i = 0; i < o; i++) for (n = 0; n < o; n++) f[n][i] = c.get(n, i);\n\n          !function (t, r, e, n) {\n            var i,\n                o,\n                s,\n                a,\n                h,\n                u,\n                l,\n                c = t - 1;\n\n            for (u = 1; u <= c - 1; u++) {\n              for (l = 0, a = u; a <= c; a++) l += Math.abs(r[a][u - 1]);\n\n              if (0 !== l) {\n                for (s = 0, a = c; a >= u; a--) e[a] = r[a][u - 1] / l, s += e[a] * e[a];\n\n                for (o = Math.sqrt(s), e[u] > 0 && (o = -o), s -= e[u] * o, e[u] = e[u] - o, h = u; h < t; h++) {\n                  for (i = 0, a = c; a >= u; a--) i += e[a] * r[a][h];\n\n                  for (i /= s, a = u; a <= c; a++) r[a][h] -= i * e[a];\n                }\n\n                for (a = 0; a <= c; a++) {\n                  for (i = 0, h = c; h >= u; h--) i += e[h] * r[a][h];\n\n                  for (i /= s, h = u; h <= c; h++) r[a][h] -= i * e[h];\n                }\n\n                e[u] = l * e[u], r[u][u - 1] = l * o;\n              }\n            }\n\n            for (a = 0; a < t; a++) for (h = 0; h < t; h++) n[a][h] = a === h ? 1 : 0;\n\n            for (u = c - 1; u >= 1; u--) if (0 !== r[u][u - 1]) {\n              for (a = u + 1; a <= c; a++) e[a] = r[a][u - 1];\n\n              for (h = u; h <= c; h++) {\n                for (o = 0, a = u; a <= c; a++) o += e[a] * n[a][h];\n\n                for (o = o / e[u] / r[u][u - 1], a = u; a <= c; a++) n[a][h] += o * e[a];\n              }\n            }\n          }(o, f, m, s), function (t, r, e, n, i) {\n            var o,\n                s,\n                a,\n                h,\n                u,\n                l,\n                c,\n                f,\n                m,\n                g,\n                p,\n                v,\n                d,\n                w,\n                y,\n                b = t - 1,\n                M = t - 1,\n                x = Number.EPSILON,\n                S = 0,\n                E = 0,\n                R = 0,\n                k = 0,\n                z = 0,\n                N = 0,\n                A = 0,\n                V = 0;\n\n            for (o = 0; o < t; o++) for ((o < 0 || o > M) && (e[o] = i[o][o], r[o] = 0), s = Math.max(o - 1, 0); s < t; s++) E += Math.abs(i[o][s]);\n\n            for (; b >= 0;) {\n              for (h = b; h > 0 && (0 === (N = Math.abs(i[h - 1][h - 1]) + Math.abs(i[h][h])) && (N = E), !(Math.abs(i[h][h - 1]) < x * N));) h--;\n\n              if (h === b) i[b][b] = i[b][b] + S, e[b] = i[b][b], r[b] = 0, b--, V = 0;else if (h === b - 1) {\n                if (c = i[b][b - 1] * i[b - 1][b], R = (i[b - 1][b - 1] - i[b][b]) / 2, k = R * R + c, A = Math.sqrt(Math.abs(k)), i[b][b] = i[b][b] + S, i[b - 1][b - 1] = i[b - 1][b - 1] + S, f = i[b][b], k >= 0) {\n                  for (A = R >= 0 ? R + A : R - A, e[b - 1] = f + A, e[b] = e[b - 1], 0 !== A && (e[b] = f - c / A), r[b - 1] = 0, r[b] = 0, f = i[b][b - 1], N = Math.abs(f) + Math.abs(A), R = f / N, k = A / N, z = Math.sqrt(R * R + k * k), R /= z, k /= z, s = b - 1; s < t; s++) A = i[b - 1][s], i[b - 1][s] = k * A + R * i[b][s], i[b][s] = k * i[b][s] - R * A;\n\n                  for (o = 0; o <= b; o++) A = i[o][b - 1], i[o][b - 1] = k * A + R * i[o][b], i[o][b] = k * i[o][b] - R * A;\n\n                  for (o = 0; o <= M; o++) A = n[o][b - 1], n[o][b - 1] = k * A + R * n[o][b], n[o][b] = k * n[o][b] - R * A;\n                } else e[b - 1] = f + R, e[b] = f + R, r[b - 1] = A, r[b] = -A;\n\n                b -= 2, V = 0;\n              } else {\n                if (f = i[b][b], m = 0, c = 0, h < b && (m = i[b - 1][b - 1], c = i[b][b - 1] * i[b - 1][b]), 10 === V) {\n                  for (S += f, o = 0; o <= b; o++) i[o][o] -= f;\n\n                  N = Math.abs(i[b][b - 1]) + Math.abs(i[b - 1][b - 2]), f = m = .75 * N, c = -.4375 * N * N;\n                }\n\n                if (30 === V && (N = (N = (m - f) / 2) * N + c) > 0) {\n                  for (N = Math.sqrt(N), m < f && (N = -N), N = f - c / ((m - f) / 2 + N), o = 0; o <= b; o++) i[o][o] -= N;\n\n                  S += N, f = m = c = .964;\n                }\n\n                for (V += 1, u = b - 2; u >= h && (A = i[u][u], R = ((z = f - A) * (N = m - A) - c) / i[u + 1][u] + i[u][u + 1], k = i[u + 1][u + 1] - A - z - N, z = i[u + 2][u + 1], N = Math.abs(R) + Math.abs(k) + Math.abs(z), R /= N, k /= N, z /= N, u !== h) && !(Math.abs(i[u][u - 1]) * (Math.abs(k) + Math.abs(z)) < x * (Math.abs(R) * (Math.abs(i[u - 1][u - 1]) + Math.abs(A) + Math.abs(i[u + 1][u + 1]))));) u--;\n\n                for (o = u + 2; o <= b; o++) i[o][o - 2] = 0, o > u + 2 && (i[o][o - 3] = 0);\n\n                for (a = u; a <= b - 1 && (w = a !== b - 1, a !== u && (R = i[a][a - 1], k = i[a + 1][a - 1], z = w ? i[a + 2][a - 1] : 0, 0 !== (f = Math.abs(R) + Math.abs(k) + Math.abs(z)) && (R /= f, k /= f, z /= f)), 0 !== f); a++) if (N = Math.sqrt(R * R + k * k + z * z), R < 0 && (N = -N), 0 !== N) {\n                  for (a !== u ? i[a][a - 1] = -N * f : h !== u && (i[a][a - 1] = -i[a][a - 1]), f = (R += N) / N, m = k / N, A = z / N, k /= R, z /= R, s = a; s < t; s++) R = i[a][s] + k * i[a + 1][s], w && (R += z * i[a + 2][s], i[a + 2][s] = i[a + 2][s] - R * A), i[a][s] = i[a][s] - R * f, i[a + 1][s] = i[a + 1][s] - R * m;\n\n                  for (o = 0; o <= Math.min(b, a + 3); o++) R = f * i[o][a] + m * i[o][a + 1], w && (R += A * i[o][a + 2], i[o][a + 2] = i[o][a + 2] - R * z), i[o][a] = i[o][a] - R, i[o][a + 1] = i[o][a + 1] - R * k;\n\n                  for (o = 0; o <= M; o++) R = f * n[o][a] + m * n[o][a + 1], w && (R += A * n[o][a + 2], n[o][a + 2] = n[o][a + 2] - R * z), n[o][a] = n[o][a] - R, n[o][a + 1] = n[o][a + 1] - R * k;\n                }\n              }\n            }\n\n            if (0 === E) return;\n\n            for (b = t - 1; b >= 0; b--) if (R = e[b], 0 === (k = r[b])) for (h = b, i[b][b] = 1, o = b - 1; o >= 0; o--) {\n              for (c = i[o][o] - R, z = 0, s = h; s <= b; s++) z += i[o][s] * i[s][b];\n\n              if (r[o] < 0) A = c, N = z;else if (h = o, 0 === r[o] ? i[o][b] = 0 !== c ? -z / c : -z / (x * E) : (f = i[o][o + 1], m = i[o + 1][o], k = (e[o] - R) * (e[o] - R) + r[o] * r[o], l = (f * N - A * z) / k, i[o][b] = l, i[o + 1][b] = Math.abs(f) > Math.abs(A) ? (-z - c * l) / f : (-N - m * l) / A), l = Math.abs(i[o][b]), x * l * l > 1) for (s = o; s <= b; s++) i[s][b] = i[s][b] / l;\n            } else if (k < 0) for (h = b - 1, Math.abs(i[b][b - 1]) > Math.abs(i[b - 1][b]) ? (i[b - 1][b - 1] = k / i[b][b - 1], i[b - 1][b] = -(i[b][b] - R) / i[b][b - 1]) : (y = $(0, -i[b - 1][b], i[b - 1][b - 1] - R, k), i[b - 1][b - 1] = y[0], i[b - 1][b] = y[1]), i[b][b - 1] = 0, i[b][b] = 1, o = b - 2; o >= 0; o--) {\n              for (g = 0, p = 0, s = h; s <= b; s++) g += i[o][s] * i[s][b - 1], p += i[o][s] * i[s][b];\n\n              if (c = i[o][o] - R, r[o] < 0) A = c, z = g, N = p;else if (h = o, 0 === r[o] ? (y = $(-g, -p, c, k), i[o][b - 1] = y[0], i[o][b] = y[1]) : (f = i[o][o + 1], m = i[o + 1][o], v = (e[o] - R) * (e[o] - R) + r[o] * r[o] - k * k, d = 2 * (e[o] - R) * k, 0 === v && 0 === d && (v = x * E * (Math.abs(c) + Math.abs(k) + Math.abs(f) + Math.abs(m) + Math.abs(A))), y = $(f * z - A * g + k * p, f * N - A * p - k * g, v, d), i[o][b - 1] = y[0], i[o][b] = y[1], Math.abs(f) > Math.abs(A) + Math.abs(k) ? (i[o + 1][b - 1] = (-g - c * i[o][b - 1] + k * i[o][b]) / f, i[o + 1][b] = (-p - c * i[o][b] - k * i[o][b - 1]) / f) : (y = $(-z - m * i[o][b - 1], -N - m * i[o][b], A, k), i[o + 1][b - 1] = y[0], i[o + 1][b] = y[1])), l = Math.max(Math.abs(i[o][b - 1]), Math.abs(i[o][b])), x * l * l > 1) for (s = o; s <= b; s++) i[s][b - 1] = i[s][b - 1] / l, i[s][b] = i[s][b] / l;\n            }\n\n            for (o = 0; o < t; o++) if (o < 0 || o > M) for (s = o; s < t; s++) n[o][s] = i[o][s];\n\n            for (s = t - 1; s >= 0; s--) for (o = 0; o <= M; o++) {\n              for (A = 0, a = 0; a <= Math.min(s, M); a++) A += n[o][a] * i[a][s];\n\n              n[o][s] = A;\n            }\n          }(o, h, a, s, f);\n        }\n\n        this.n = o, this.e = h, this.d = a, this.V = s;\n      }\n\n      get realEigenvalues() {\n        return this.d;\n      }\n\n      get imaginaryEigenvalues() {\n        return this.e;\n      }\n\n      get eigenvectorMatrix() {\n        return _.isMatrix(this.V) || (this.V = new _(this.V)), this.V;\n      }\n\n      get diagonalMatrix() {\n        var t,\n            r,\n            e = this.n,\n            n = this.e,\n            i = this.d,\n            o = new _(e, e);\n\n        for (t = 0; t < e; t++) {\n          for (r = 0; r < e; r++) o[t][r] = 0;\n\n          o[t][t] = i[t], n[t] > 0 ? o[t][t + 1] = n[t] : n[t] < 0 && (o[t][t - 1] = n[t]);\n        }\n\n        return o;\n      }\n\n    }\n\n    function $(t, r, e, n) {\n      var i, o;\n      return Math.abs(e) > Math.abs(n) ? [(t + (i = n / e) * r) / (o = e + i * n), (r - i * t) / o] : [((i = e / n) * t + r) / (o = n + i * e), (i * r - t) / o];\n    }\n\n    class Q {\n      constructor(t) {\n        if (!(t = j.checkMatrix(t)).isSymmetric()) throw new Error("Matrix is not symmetric");\n        var r,\n            e,\n            n,\n            i = t,\n            o = i.rows,\n            s = new _(o, o),\n            a = !0;\n\n        for (e = 0; e < o; e++) {\n          var h = s[e],\n              u = 0;\n\n          for (n = 0; n < e; n++) {\n            var l = s[n],\n                c = 0;\n\n            for (r = 0; r < n; r++) c += l[r] * h[r];\n\n            h[n] = c = (i.get(e, n) - c) / s[n][n], u += c * c;\n          }\n\n          for (a &= (u = i.get(e, e) - u) > 0, s[e][e] = Math.sqrt(Math.max(u, 0)), n = e + 1; n < o; n++) s[e][n] = 0;\n        }\n\n        if (!a) throw new Error("Matrix is not positive definite");\n        this.L = s;\n      }\n\n      solve(t) {\n        t = j.checkMatrix(t);\n        var r = this.L,\n            e = r.rows;\n        if (t.rows !== e) throw new Error("Matrix dimensions do not match");\n        var n,\n            i,\n            o,\n            s = t.columns,\n            a = t.clone();\n\n        for (o = 0; o < e; o++) for (i = 0; i < s; i++) {\n          for (n = 0; n < o; n++) a[o][i] -= a[n][i] * r[o][n];\n\n          a[o][i] /= r[o][o];\n        }\n\n        for (o = e - 1; o >= 0; o--) for (i = 0; i < s; i++) {\n          for (n = o + 1; n < e; n++) a[o][i] -= a[n][i] * r[n][o];\n\n          a[o][i] /= r[o][o];\n        }\n\n        return a;\n      }\n\n      get lowerTriangularMatrix() {\n        return this.L;\n      }\n\n    }\n\n    e.d(r, "default", function () {\n      return _;\n    }), e.d(r, "Matrix", function () {\n      return _;\n    }), e.d(r, "abstractMatrix", function () {\n      return C;\n    }), e.d(r, "wrap", function () {\n      return I;\n    }), e.d(r, "WrapperMatrix2D", function () {\n      return j;\n    }), e.d(r, "WrapperMatrix1D", function () {\n      return P;\n    }), e.d(r, "solve", function () {\n      return L;\n    }), e.d(r, "inverse", function () {\n      return D;\n    }), e.d(r, "linearDependencies", function () {\n      return q;\n    }), e.d(r, "SingularValueDecomposition", function () {\n      return c;\n    }), e.d(r, "SVD", function () {\n      return c;\n    }), e.d(r, "EigenvalueDecomposition", function () {\n      return U;\n    }), e.d(r, "EVD", function () {\n      return U;\n    }), e.d(r, "CholeskyDecomposition", function () {\n      return Q;\n    }), e.d(r, "CHO", function () {\n      return Q;\n    }), e.d(r, "LuDecomposition", function () {\n      return h;\n    }), e.d(r, "LU", function () {\n      return h;\n    }), e.d(r, "QrDecomposition", function () {\n      return O;\n    }), e.d(r, "QR", function () {\n      return O;\n    });\n  }]);\n});',sd=function(){var e;self.onmessage=function(t){switch(t.data.task){case"create":i=t.data.umapUrl,o=t.data.config,importScripts(i),e=new self.UMAP(o);break;case"fit":self.postMessage((n=t.data.data,(r=t.data.labels)&&e.setSupervisedProjection(r),e.fit(n)));break;case"transform":self.postMessage(function(t){return e.transform(t)}(t.data.data));break;default:self.postMessage({error:new Error("Unknown or no task specified")})}var n,r,i,o}},ud="#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D uDataTex;\nuniform sampler2D uColorMapTex;\nuniform float uColorMapTexRes;\nuniform float uColorMapSize;\nuniform float uMinValue;\nuniform float uMaxValue;\n\nin vec2 vTextureCoord;\n\nout vec4 outColor;\n\nvec4 toColor(float value) {\n  float halfTexel = 0.5 / uColorMapTexRes;\n\n  // Normalize value\n  float normValue = clamp(\n    (value - uMinValue) / (uMaxValue - uMinValue),\n    0.0,\n    1.0\n  );\n\n  // Linear index into the colormap, e.g., 5 means the 5th color\n  float linIdx = max(normValue * uColorMapSize, float(value > 0.0));\n\n  // Texture index into the colormap texture\n  vec2 colorTexIndex = vec2(\n    (mod(linIdx, uColorMapTexRes) / uColorMapTexRes) + halfTexel,\n    (floor(linIdx / uColorMapTexRes) / uColorMapTexRes) + halfTexel\n  );\n\n  return texture(uColorMapTex, colorTexIndex);\n}\n\nvoid main() {\n  outColor = toColor(texture(uDataTex, vTextureCoord).r);\n}\n",cd="#version 300 es\n\nprecision mediump float;\n\n// From PIXI\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nout vec2 vTextureCoord;\n\nvoid main() {\n  gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n  vTextureCoord = aTextureCoord;\n}\n",ld=[],fd=function(e){var n=Math.max(2,Math.ceil(Math.sqrt(e.length))),r=new Float32Array(4*Math.pow(n,2));return e.forEach((function(e,t){r[4*t]=e[0],r[4*t+1]=e[1],r[4*t+2]=e[2],r[4*t+3]=e[3]})),[t.Texture.fromBuffer(r,n,n),n]},hd=function(e){switch(e){case 1:return[1,1,1,1,1];case 2:return[2,1,2,1.5,1.25];case 3:return[3,1,3,2,1.35];case 4:case 5:return[4,2,2,1,1.25];case 6:case 7:return[6,2,3,1.5,1.5];case 8:return[8,2,4,2,1.7];case 9:default:return[9,3,3,1,1.5]}},pd=function(){var e=r(s.mark((function e(n,r){var i,o,a,u,c,l,f,h,p,d,g,m,v,b,w,x,S,E,k,M,O,A,j,P,C,_,I,R,T=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=T.length>2&&void 0!==T[2]?T[2]:{},o=i.innerPadding,a=void 0===o?2:o,u=i.outerPadding,c=void 0===u?2:u,l=i.backgroundColor,f=void 0===l?0:l,h=i.maxNumberOfRepresentatives,p=void 0===h?9:h,d=Math.min(p,n.length),g=hd(d),m=y(g,4),v=m[0],b=m[1],w=m[2],x=m[3],e.next=5,r(n.slice(0,v));case 5:return S=e.sent,E=1,M=k=1/x,O=new t.Graphics,A=-1/0,S.forEach((function(e){A=Math.max(A,e.width,e.height)})),j=A,P=A*M,C=A*(E/w),_=A*(k/b),S.forEach((function(e,n){var r=Zn(e),i=r instanceof t.Texture;i&&(r=new t.Sprite(r));var o=Math.floor(n/w),s=n%w,u=r.width/r.height<M,l=u?C/r.width:_/r.height;(l>1||i)&&(r.width*=l,r.height*=l);var f=i?s:s+.5,h=i?o:o+.5;if(r.x=f*C+s*a+c,r.y=h*_+o*a+c,i){var p=u?r.width:r.height;r.x-=u?0:(r.width-p)/2,r.y-=u?(r.height-p)/2:0}O.addChild(r);var d=new t.Graphics;d.beginFill(16711680,.5).drawRect(s*C+s*a+c,o*_+o*a+c,C,_).endFill(),r.mask=d,O.addChild(d)})),I=j+(w-1)*a+2*c,R=P+(b-1)*a+2*c,O.beginFill(f).drawRect(0,0,I,R).endFill(),O.pivot.x=I/2,O.pivot.y=R/2,e.abrupt("return",O);case 23:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),dd=function(){var e=r(s.mark((function e(t){var n,r,i,o,a,u,c,l,f,h,p,d=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=d.length>1&&void 0!==d[1]?d[1]:{},r=n.width,i=void 0===r?128:r,o=n.height,a=void 0===o?128:o,u=n.color,c=void 0===u?"black":u,l=n.background,f=void 0===l?null:l,"<"===(h="string"==typeof t||t instanceof String?t:(new XMLSerializer).serializeToString(t))[0]){e.next=9;break}return e.next=5,fetch(h);case 5:return p=e.sent,e.next=8,p.text();case 8:h=e.sent;case 9:return e.abrupt("return",new Promise((function(e,t){var n=new Image,r=[c&&"color: ".concat(c),f&&"background: ".concat(f)].filter((function(e){return e})),o='style="'.concat(r.join("; "),'"'),s=[i&&'width="'.concat(i,'"'),a&&'height="'.concat(a,'"')].filter((function(e){return e})).join(" "),u=(h=h.slice(h.indexOf("<svg"))).indexOf(">"),l=h.slice(0,u+1),p=l.indexOf('width="');if(p>=0){var d=l.indexOf('"',p+7);l=l.slice(0,p)+l.slice(d+1)}var g=l.indexOf('height="');if(g>=0){var m=l.indexOf('"',g+8);l=l.slice(0,g)+l.slice(m+1)}var v=l.indexOf('style="');if(v>=0){var y=l.indexOf('"',v+7);l=l.slice(0,v)+l.slice(y+1)}h=[[l.slice(0,5),s,o,l.slice(5)].join(" "),h.slice(u+1)].join("");var b="data:image/svg+xml;base64,".concat(btoa(unescape(encodeURIComponent(h))));n.onload=function(){e(n)},n.onerror=function(e){e.message="SVG Renderer: Could not render SVG as an image.",t(e)},n.src=b})));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),gd=function(e){return function(t){return Promise.all(t.map((function(t){return dd(t,e)})))}};function md(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?md(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):md(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function yd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yd(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var wd=function(){var e=r(s.mark((function e(t,n){var r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=nd(t,n),e.next=3,r.whenInit;case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),xd=function(){var e=r(s.mark((function e(t,n,r){var i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=nd(t),e.next=3,i.importState(n,r);case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();e.createD3Renderer=function(e,t){var n=gd(t);return function(t){return n(t.map((function(t){var n=e(t);return xe(n.node)?n.node():n})))}},e.createDbscan=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.distanceFunction,n=void 0===t?null:t,r=e.maxDistance,i=void 0===r?null:r,o=e.minPoints,a=void 0===o?2:o,s=e.valueGetter,u=void 0===s?null:s,c=e.postProcessing,l=void 0===c?null:c,f=[];return u&&f.push(Ar("(() => { self.valueGetter = ".concat(u.toString(),"; })();"))),n&&f.push(Ar("(() => { self.distanceFunction = ".concat(n.toString(),"; })();"))),l&&f.push(Ar("(() => { self.postProcessing = ".concat(l.toString(),"; })();"))),function(e){return new Promise((function(t,n){var r=ot(od);r.onmessage=function(e){e.data.error?n(e.data.error):t(e.data),r.terminate()},r.postMessage({maxDistance:i,minPoints:a,items:e,scripts:f})}))}},e.createImage=cr,e.createImageRenderer=function(){return function(e){return Promise.all(e.map((function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(n,r){var i=new Image;t&&(i.crossOrigin="Anonymous"),i.onload=function(){n(i)},i.onerror=function(t){console.error("Could't load ".concat(e)),r(t)},i.src=e}))}(e,!0)})))}},e.createKmeans=jr,e.createLibrary=nd,e.createLibraryAsync=wd,e.createLibraryFromState=xd,e.createMatrixCoverAggregator=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"mean";return function(t){return new Promise((function(n,r){var i=ot(id);i.onmessage=function(e){e.data.error?r(e.data.error):n(e.data.newSrc),i.terminate()},i.postMessage({items:t,aggregator:e})}))}},e.createMatrixPreviewAggregator=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"mean";return function(t){var n=t.map((function(t){return new Promise((function(n,r){var i=ot(rd);i.onmessage=function(e){e.data.error?r(e.data.error):n(e.data.newSrc),i.terminate()},i.postMessage({src:t.src,aggregagtor:e})}))}));return Promise.all(n).catch((function(e){console.error("Matrix preview aggregation failed",e)}))}},e.createMatrixRenderer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.colorMap,i=void 0===n?ld:n,o=e.domain,a=void 0===o?[0,1]:o,u=e.shape,c=new t.Geometry;c.addAttribute("aVertexPosition",[-1,-1,1,-1,1,1,-1,1],2),c.addAttribute("aTextureCoord",[0,0,1,0,1,1,0,1],2),c.addIndex([0,1,2,0,3,2]);var l=fd(i),f=y(l,2),h=f[0],p=f[1],d=i.length-1,g=[],m=function(){var e=r(s.mark((function e(n){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(n.map(function(){var e=r(s.mark((function e(n){var r,i,o,l,f,m,v,b,w;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u||n.shape,i=y(r,2),o=i[0],l=i[1],f=function(e){var n=new Cn(new Float32Array(e),{width:l,height:o,internalFormat:"R32F",format:"RED",type:"FLOAT"});return new t.Texture(new t.BaseTexture(n,{scaleMode:t.SCALE_MODES.NEAREST}))},m=new t.UniformGroup({uColorMapTex:h,uColorMapTexRes:p,uColorMapSize:d,uMinValue:a[0],uMaxValue:a[1],uDataTex:f(n.data)}),g.push(m),v=t.Shader.from(cd,ud,m),b=new t.State,(w=new t.Mesh(c,v,b)).width=l,w.height=o,e.abrupt("return",w);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return m.setColorMap=function(e){var t=fd(e),n=y(t,2),r=n[0],i=n[1];g.forEach((function(e){var t=e.uniforms;t.uColorMapTex=r,t.uColorMapTexRes=i}))},m.setDomain=function(e){g.forEach((function(t){var n=t.uniforms;n.uMinValue=e[0],n.uMaxValue=e[1]}))},m.clear=function(){g=[]},m.renderer=m,m},e.createObservablePlotRenderer=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=gd(n);return function(i){return r(i.map((function(r){return e.plot(bd({marks:t(r)},n))})))}},e.createRepresentativeAggregator=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.distanceFunction,r=void 0===n?null:n,i=t.initialization,o=void 0===i?"kmpp":i,a=t.maxIterations,s=void 0===a?null:a,u=t.valueGetter,c=void 0===u?null:u,l=function(e,t){var n,r,i=(n=t[0].length,r=Array(n).fill().map((function(e,t){return"s += (v[".concat(t,"] - w[").concat(t,"]) ** 2;")})).join(" "),new Function("v","w","let s = 0; ".concat(r," return s;"))),o=Array(e.centroids.length).fill(),a=Array(e.centroids.length).fill(1/0);return t.forEach((function(t,n){var r=e.idxs[n],s=i(t,e.centroids[r]);s<a[r]&&(a[r]=s,o[r]=n)})),{selectedItemIdxs:o}},f=jr(e,{distanceFunction:r,initialization:o,maxIterations:s,valueGetter:c,postProcessing:l});return function(t){return t.length<=e?Promise.resolve(t.map((function(e){return e.src}))):f(t).then((function(e){return e.postProcessing.selectedItemIdxs.map((function(e){return t[e].src}))}))}},e.createRepresentativeRenderer=function(e,t){var n=function(n){return Promise.all(n.map((function(n){return pd(n,e,t)})))};return n.scaler=function(e){return hd(e.items.length)[4]},n},e.createSvgRenderer=gd,e.createUmap=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.padding,r=void 0===n?.1:n,i=Dn(),o=Dn(),a=Ar(ad.replace("window","self")),s=ot(sd);s.postMessage({task:"create",config:e,umapUrl:a});var u=1/0,c=1/0,l=-1/0,f=-1/0,h=function(e){e.forEach((function(e){u=e[0]<u?e[0]:u,c=e[1]<c?e[1]:c,l=e[0]>l?e[0]:l,f=e[1]>f?e[1]:f}));var t=(l-u)*r,n=(f-c)*r;return i.domain([u-t,l+t]),o.domain([c-n,f+n]),e},p=function(e){return[i(e[0]),o(e[1])]},d=function(){s.terminate()},g=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return u=1/0,c=1/0,l=-1/0,f=-1/0,new Promise((function(n){s.onmessage=function(e){n(h(e.data))},s.postMessage({task:"fit",data:e,labels:t})}))},m=function(e){return s?new Promise((function(t){s.onmessage=function(e){t(e.data.map(p))},s.postMessage({task:"transform",data:e})})):Promise.reject(new Error("You need to fit data first!"))};return{destroy:d,fit:g,transform:m}},e.createVegaLiteRenderer=function(e){var t=e.baseSpec,n=e.vega,r=e.vegaLite;return function(e){return Promise.all(e.map((function(e){var i=Object.prototype.hasOwnProperty.call(e,"values")?e.values:e,o=Object.prototype.hasOwnProperty.call(e,"itemSpec")?e.itemSpec:{},a=vd(vd(vd({},t),o),{},{data:{values:i}});return new n.View(n.parse(r.compile(a).spec),{renderer:"none"}).toCanvas()})))}},e.default=nd,e.deserializeState=In,e.serializeState=er,Object.defineProperty(e,"__esModule",{value:!0})}));
